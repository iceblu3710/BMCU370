\doxysection{Bambu\+Bus\+Protocol.\+cpp}
\hypertarget{_bambu_bus_protocol_8cpp_source}{}\label{_bambu_bus_protocol_8cpp_source}\index{src/BambuBusProtocol.cpp@{src/BambuBusProtocol.cpp}}
\mbox{\hyperlink{_bambu_bus_protocol_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00001}00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00002}00002\ \textcolor{comment}{*\ DEVELOPMENT\ STATE:\ EXPERIMENTAL}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00003}00003\ \textcolor{comment}{*\ This\ file\ implements\ the\ BambuBus\ protocol\ which\ is\ currently\ in\ an\ experimental\ state.}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00004}00004\ \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00005}00005\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_bambu_bus_protocol_8h}{BambuBusProtocol.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00006}00006\ \textcolor{preprocessor}{\#include\ "{}CRC16.h"{}}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00007}00007\ \textcolor{preprocessor}{\#include\ "{}CRC8.h"{}}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00008}00008\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00009}00009\ \textcolor{comment}{//\ Static\ members}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00010}00010\ uint8\_t\ \mbox{\hyperlink{class_bambu_bus_protocol_af321f9282a29cb90ff0c5e23e626d43f}{BambuBusProtocol::rx\_buf}}[1000];}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00011}00011\ uint16\_t\ \mbox{\hyperlink{class_bambu_bus_protocol_a4b80d5175b849292dd38278fcf5eabcc}{BambuBusProtocol::rx\_len}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00012}00012\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_bambu_bus_protocol_a6d1e452b12e2a536fb393bf7242930e9}{BambuBusProtocol::packet\_ready}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00014}\mbox{\hyperlink{_bambu_bus_protocol_8cpp_a9e55b5c4cdf6fa62f8dfb9d6604655a6}{00014}}\ \textcolor{keyword}{static}\ CRC16\ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_a9e55b5c4cdf6fa62f8dfb9d6604655a6}{crc\_16}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00015}\mbox{\hyperlink{_bambu_bus_protocol_8cpp_aa25bc6787f31c22990b295d61a409df8}{00015}}\ \textcolor{keyword}{static}\ CRC8\ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_aa25bc6787f31c22990b295d61a409df8}{crc\_8}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00016}\mbox{\hyperlink{_bambu_bus_protocol_8cpp_accdac0b68b69d84409a479fc284f0a1b}{00016}}\ \textcolor{keyword}{static}\ CRC8\ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_accdac0b68b69d84409a479fc284f0a1b}{\_RX\_IRQ\_crcx}}(0x39,\ 0x66,\ 0x00,\ \textcolor{keyword}{false},\ \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00018}00018\ \textcolor{comment}{/*\ DEVELOPMENT\ STATE:\ EXPERIMENTAL\ */}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00024}\mbox{\hyperlink{class_bambu_bus_protocol_a0f26cda5df5c3a8882b7d371d44f6a5e}{00024}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_bambu_bus_protocol_a0f26cda5df5c3a8882b7d371d44f6a5e}{BambuBusProtocol::Init}}()\ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00025}00025\ \ \ \ \ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_aa25bc6787f31c22990b295d61a409df8}{crc\_8}}.reset(0x39,\ 0x66,\ 0,\ \textcolor{keyword}{false},\ \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00026}00026\ \ \ \ \ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_a9e55b5c4cdf6fa62f8dfb9d6604655a6}{crc\_16}}.reset(0x1021,\ 0x913D,\ 0,\ \textcolor{keyword}{false},\ \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00027}00027\ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00029}00029\ \textcolor{comment}{//\ Re-\/implementation\ of\ RX\_IRQ\ logic}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00030}00030\ \textcolor{comment}{/*\ DEVELOPMENT\ STATE:\ EXPERIMENTAL\ */}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00041}\mbox{\hyperlink{class_bambu_bus_protocol_af0a63f3d5cca52f48394c7129407e585}{00041}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_bambu_bus_protocol_af0a63f3d5cca52f48394c7129407e585}{BambuBusProtocol::ParseByte}}(uint8\_t\ \textcolor{keywordtype}{byte})\ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00042}00042\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \_index\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00043}00043\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ length\ =\ 999;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00044}00044\ \ \ \ \ \textcolor{keyword}{static}\ uint8\_t\ data\_length\_index;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00045}00045\ \ \ \ \ \textcolor{keyword}{static}\ uint8\_t\ data\_CRC8\_index;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00047}00047\ \ \ \ \ \mbox{\hyperlink{class_bambu_bus_protocol_a6d1e452b12e2a536fb393bf7242930e9}{packet\_ready}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00048}00048\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00049}00049\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_index\ ==\ 0)\ \textcolor{comment}{//\ waiting\ for\ first\ data}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00050}00050\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00051}00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{byte}\ ==\ 0x3D)\ \textcolor{comment}{//\ 0x3D-\/start}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00052}00052\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_bambu_bus_protocol_af321f9282a29cb90ff0c5e23e626d43f}{rx\_buf}}[0]\ =\ 0x3D;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00054}00054\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_accdac0b68b69d84409a479fc284f0a1b}{\_RX\_IRQ\_crcx}}.restart();\ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_accdac0b68b69d84409a479fc284f0a1b}{\_RX\_IRQ\_crcx}}.add(0x3D);\ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \ \ \ data\_length\_index\ =\ 4;\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00057}00057\ \ \ \ \ \ \ \ \ \ \ \ \ length\ =\ data\_CRC8\_index\ =\ 6;\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00058}00058\ \ \ \ \ \ \ \ \ \ \ \ \ \_index\ =\ 1;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00059}00059\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00060}00060\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00061}00061\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00062}00062\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ have\ 0x3D,\ normal\ data}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00063}00063\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00064}00064\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_bambu_bus_protocol_af321f9282a29cb90ff0c5e23e626d43f}{rx\_buf}}[\_index]\ =\ byte;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00065}00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_index\ ==\ 1)\ \textcolor{comment}{//\ package\ type\ byte}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00066}00066\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00067}00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{byte}\ \&\ 0x80)\ \textcolor{comment}{//\ short\ head\ package}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00069}00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\_length\_index\ =\ 2;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\_CRC8\_index\ =\ 3;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00072}00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ long\ head\ package}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00074}00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\_length\_index\ =\ 4;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00075}00075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\_CRC8\_index\ =\ 6;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00077}00077\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00078}00078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_index\ ==\ data\_length\_index)\ \textcolor{comment}{//\ the\ length\ byte}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00079}00079\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00080}00080\ \ \ \ \ \ \ \ \ \ \ \ \ length\ =\ byte;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00081}00081\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00082}00082\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_index\ <\ data\_CRC8\_index)\ \textcolor{comment}{//\ before\ CRC8\ byte,\ add\ data}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00083}00083\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_accdac0b68b69d84409a479fc284f0a1b}{\_RX\_IRQ\_crcx}}.add(\textcolor{keywordtype}{byte});}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00085}00085\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00086}00086\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_index\ ==\ data\_CRC8\_index)\ \textcolor{comment}{//\ the\ CRC8\ byte,\ check}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00087}00087\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{byte}\ !=\ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_accdac0b68b69d84409a479fc284f0a1b}{\_RX\_IRQ\_crcx}}.calc())\ \textcolor{comment}{//\ check\ error,\ return\ to\ waiting\ 0x3D}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_index\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00091}00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00093}00093\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00094}00094\ \ \ \ \ \ \ \ \ ++\_index;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00095}00095\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_index\ >=\ length)\ \textcolor{comment}{//\ recv\ over}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00096}00096\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \ \ \ \_index\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00098}00098\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_bambu_bus_protocol_a4b80d5175b849292dd38278fcf5eabcc}{rx\_len}}\ =\ length;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_bambu_bus_protocol_a6d1e452b12e2a536fb393bf7242930e9}{packet\_ready}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00101}00101\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00102}00102\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_index\ >=\ 999)\ \textcolor{comment}{//\ buffer\ overflow\ protection}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00103}00103\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00104}00104\ \ \ \ \ \ \ \ \ \ \ \ \ \_index\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00105}00105\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00106}00106\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00107}00107\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00108}00108\ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00109}00109\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00110}00110\ \textcolor{comment}{/*\ DEVELOPMENT\ STATE:\ EXPERIMENTAL\ */}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00116}\mbox{\hyperlink{class_bambu_bus_protocol_a8b2a47c616b38cef6c47c1d1b9c92411}{00116}}\ uint8\_t*\ \mbox{\hyperlink{class_bambu_bus_protocol_a8b2a47c616b38cef6c47c1d1b9c92411}{BambuBusProtocol::GetRxBuffer}}()\ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00117}00117\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_bambu_bus_protocol_af321f9282a29cb90ff0c5e23e626d43f}{rx\_buf}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00118}00118\ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00119}00119\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00120}00120\ \textcolor{comment}{/*\ DEVELOPMENT\ STATE:\ EXPERIMENTAL\ */}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00126}\mbox{\hyperlink{class_bambu_bus_protocol_ae7f742147d3316c118f4230a56a722bd}{00126}}\ uint16\_t\ \mbox{\hyperlink{class_bambu_bus_protocol_ae7f742147d3316c118f4230a56a722bd}{BambuBusProtocol::GetRxLength}}()\ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00127}00127\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_bambu_bus_protocol_a4b80d5175b849292dd38278fcf5eabcc}{rx\_len}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00128}00128\ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00129}00129\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00130}00130\ \textcolor{comment}{/*\ DEVELOPMENT\ STATE:\ EXPERIMENTAL\ */}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00142}\mbox{\hyperlink{class_bambu_bus_protocol_a8b674c03ab157fa7e70fc2f6e271d539}{00142}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_bambu_bus_protocol_a8b674c03ab157fa7e70fc2f6e271d539}{BambuBusProtocol::CheckCRC16}}(uint8\_t\ *data,\ \textcolor{keywordtype}{int}\ data\_length)}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00143}00143\ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00144}00144\ \ \ \ \ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_a9e55b5c4cdf6fa62f8dfb9d6604655a6}{crc\_16}}.restart();}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00145}00145\ \ \ \ \ data\_length\ -\/=\ 2;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00146}00146\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ i\ =\ 0;\ i\ <\ data\_length;\ i++)}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00147}00147\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00148}00148\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_a9e55b5c4cdf6fa62f8dfb9d6604655a6}{crc\_16}}.add(data[i]);}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00149}00149\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00150}00150\ \ \ \ \ uint16\_t\ num\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_a9e55b5c4cdf6fa62f8dfb9d6604655a6}{crc\_16}}.calc();}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00151}00151\ \ \ \ \ \textcolor{keywordflow}{if}\ ((data[(data\_length)]\ ==\ (num\ \&\ 0xFF))\ \&\&\ (data[(data\_length\ +\ 1)]\ ==\ ((num\ >>\ 8)\ \&\ 0xFF)))}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00152}00152\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00153}00153\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00154}00154\ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00155}00155\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00156}00156\ \textcolor{comment}{/*\ DEVELOPMENT\ STATE:\ EXPERIMENTAL\ */}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00167}\mbox{\hyperlink{class_bambu_bus_protocol_a81deddd553eeb25fa96580079d7c9bd0}{00167}}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5}{BambuBus\_package\_type}}\ \mbox{\hyperlink{class_bambu_bus_protocol_a81deddd553eeb25fa96580079d7c9bd0}{BambuBusProtocol::IdentifyPacket}}(uint8\_t*\ \mbox{\hyperlink{_flash__saves_8cpp_a9364481806e5ccb7d6cb2113b1b7a2d5}{buf}},\ uint16\_t\ length)\ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00168}00168\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{class_bambu_bus_protocol_a8b674c03ab157fa7e70fc2f6e271d539}{CheckCRC16}}(\mbox{\hyperlink{_flash__saves_8cpp_a9364481806e5ccb7d6cb2113b1b7a2d5}{buf}},\ length)\ ==\ \textcolor{keyword}{false})}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00169}00169\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00170}00170\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5ab50339a10e1de285ac99d4c3990b8693}{BambuBus\_package\_type::NONE}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00171}00171\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00172}00172\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_flash__saves_8cpp_a9364481806e5ccb7d6cb2113b1b7a2d5}{buf}}[1]\ ==\ 0xC5)}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00173}00173\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00174}00174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{_flash__saves_8cpp_a9364481806e5ccb7d6cb2113b1b7a2d5}{buf}}[4])}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00175}00175\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00176}00176\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x03:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5ad4d3385ad5d973a7b76f0e1e10a9a911}{BambuBus\_package\_type::filament\_motion\_short}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00177}00177\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x04:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5acc8310f3d30aeac76f64a41602888847}{BambuBus\_package\_type::filament\_motion\_long}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00178}00178\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x05:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5ac5942b864a1fc3982fbce8d02e891942}{BambuBus\_package\_type::online\_detect}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00179}00179\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x06:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a403d48ab34ede926334f42e9f1e118b2}{BambuBus\_package\_type::REQx6}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00180}00180\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x07:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a05a1cf045bfd606d4cc9ecb9018340cb}{BambuBus\_package\_type::NFC\_detect}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00181}00181\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x08:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a151b70298322f2552b21cd732c34daca}{BambuBus\_package\_type::set\_filament\_info}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00182}00182\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x20:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a3a06e053a0726537b202ce4ace81dee7}{BambuBus\_package\_type::heartbeat}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00183}00183\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a602bcb15b1e1b9719d1fae7b1b512431}{BambuBus\_package\_type::ETC}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00184}00184\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00185}00185\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00186}00186\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_flash__saves_8cpp_a9364481806e5ccb7d6cb2113b1b7a2d5}{buf}}[1]\ ==\ 0x05)}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00187}00187\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00188}00188\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structlong__packge__data}{long\_packge\_data}}\ info;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00189}00189\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_bambu_bus_protocol_ad0e11ad5c710644e9f1ee2fb4f15a3b9}{ParseLongPacket}}(\mbox{\hyperlink{_flash__saves_8cpp_a9364481806e5ccb7d6cb2113b1b7a2d5}{buf}},\ length,\ \&info);}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00190}00190\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00191}00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (info.\mbox{\hyperlink{structlong__packge__data_ae05dfdfbbc7680846727184e688142d6}{type}})}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00192}00192\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00193}00193\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x21A:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a210fd6ea841c46980bb97dcf450d6433}{BambuBus\_package\_type::MC\_online}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00194}00194\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x211:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a57b48f5ee45c9bae0dfa0a6641e043ca}{BambuBus\_package\_type::read\_filament\_info}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00195}00195\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x218:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5ab3c10f101a42a8c68e7f1b8588bfb9b6}{BambuBus\_package\_type::set\_filament\_info\_type2}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00196}00196\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x103:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a2af72f100c356273d46284f6fd1dfc08}{BambuBus\_package\_type::version}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00197}00197\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x402:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a87da425e91c92b2f5d360a2c60693425}{BambuBus\_package\_type::serial\_number}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00198}00198\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a602bcb15b1e1b9719d1fae7b1b512431}{BambuBus\_package\_type::ETC}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00199}00199\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00200}00200\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00201}00201\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5ab50339a10e1de285ac99d4c3990b8693}{BambuBus\_package\_type::NONE}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00202}00202\ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00203}00203\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00204}00204\ \textcolor{comment}{/*\ DEVELOPMENT\ STATE:\ EXPERIMENTAL\ */}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00214}\mbox{\hyperlink{class_bambu_bus_protocol_ad0e11ad5c710644e9f1ee2fb4f15a3b9}{00214}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_bambu_bus_protocol_ad0e11ad5c710644e9f1ee2fb4f15a3b9}{BambuBusProtocol::ParseLongPacket}}(uint8\_t\ *\mbox{\hyperlink{_flash__saves_8cpp_a9364481806e5ccb7d6cb2113b1b7a2d5}{buf}},\ uint16\_t\ data\_length,\ \mbox{\hyperlink{structlong__packge__data}{long\_packge\_data}}\ *data)}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00215}00215\ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00216}00216\ \ \ \ \ memcpy(data,\ \mbox{\hyperlink{_flash__saves_8cpp_a9364481806e5ccb7d6cb2113b1b7a2d5}{buf}}\ +\ 2,\ 11);}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00217}00217\ \ \ \ \ data-\/>\mbox{\hyperlink{structlong__packge__data_a80c463bfbe59e76ecacb35358cabecaa}{datas}}\ =\ \mbox{\hyperlink{_flash__saves_8cpp_a9364481806e5ccb7d6cb2113b1b7a2d5}{buf}}\ +\ 13;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00218}00218\ \ \ \ \ data-\/>\mbox{\hyperlink{structlong__packge__data_a37cca48d85473aa686a58e3cc32eb177}{data\_length}}\ =\ data\_length\ -\/\ 15;\ \textcolor{comment}{//\ +2byte\ CRC16}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00219}00219\ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00220}00220\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00221}00221\ \textcolor{comment}{/*\ DEVELOPMENT\ STATE:\ EXPERIMENTAL\ */}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00231}\mbox{\hyperlink{class_bambu_bus_protocol_af9d11bc755538718e6ba8fbc5c8e9187}{00231}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_bambu_bus_protocol_af9d11bc755538718e6ba8fbc5c8e9187}{BambuBusProtocol::BuildPacketWithCRC}}(uint8\_t\ *data,\ uint16\_t\ \&data\_length)}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00232}00232\ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00233}00233\ \ \ \ \ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_aa25bc6787f31c22990b295d61a409df8}{crc\_8}}.restart();}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00234}00234\ \ \ \ \ \textcolor{keywordflow}{if}\ (data[1]\ \&\ 0x80)}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00235}00235\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00236}00236\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ i\ =\ 0;\ i\ <\ 3;\ i++)\ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_aa25bc6787f31c22990b295d61a409df8}{crc\_8}}.add(data[i]);}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00237}00237\ \ \ \ \ \ \ \ \ data[3]\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_aa25bc6787f31c22990b295d61a409df8}{crc\_8}}.calc();}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00238}00238\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00239}00239\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00240}00240\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00241}00241\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ i\ =\ 0;\ i\ <\ 6;\ i++)\ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_aa25bc6787f31c22990b295d61a409df8}{crc\_8}}.add(data[i]);}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00242}00242\ \ \ \ \ \ \ \ \ data[6]\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_aa25bc6787f31c22990b295d61a409df8}{crc\_8}}.calc();}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00243}00243\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00244}00244\ \ \ \ \ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_a9e55b5c4cdf6fa62f8dfb9d6604655a6}{crc\_16}}.restart();}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00245}00245\ \ \ \ \ \textcolor{comment}{//\ length\ calculation\ logic\ for\ CRC16}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00246}00246\ \ \ \ \ \textcolor{comment}{//\ In\ original\ code,\ data\_length\ was\ passed\ IN\ as\ the\ target\ length\ including\ CRC16\ bytes\ placeholders?}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00247}00247\ \ \ \ \ \textcolor{comment}{//\ "{}data\_length\ +=\ 2;"{}\ at\ the\ end\ of\ original\ function\ suggests\ the\ input\ length\ EXCLUDED\ the\ CRC16.}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00248}00248\ \ \ \ \ \textcolor{comment}{//\ "{}data\_length\ -\/=\ 2;"{}\ in\ loop\ suggests\ it\ iterated\ up\ to\ CRC\ pos.}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00249}00249\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00250}00250\ \ \ \ \ \textcolor{comment}{//\ Let's\ assume\ input\ data\_length\ is\ the\ length\ of\ payload\ +\ headers,\ WITHOUT\ CRC16.}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00251}00251\ \ \ \ \ \textcolor{comment}{//\ Wait,\ original\ code:}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00252}00252\ \ \ \ \ \textcolor{comment}{//\ package\_send\_with\_crc(uint8\_t\ *data,\ int\ data\_length)}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00253}00253\ \ \ \ \ \textcolor{comment}{//\ \ \ data\_length\ -\/=\ 2;\ ...\ loop\ i\ <\ data\_length\ ...\ }}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00254}00254\ \ \ \ \ \textcolor{comment}{//\ \ \ data[data\_length]\ =\ ...}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00255}00255\ \ \ \ \ \textcolor{comment}{//\ \ \ data\_length\ +=\ 2;}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00256}00256\ \ \ \ \ \textcolor{comment}{//\ So\ the\ input\ data\_length\ INCLUDED\ the\ 2\ bytes\ valid\ space\ for\ CRC16.}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00257}00257\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00258}00258\ \ \ \ \ \textcolor{keywordtype}{int}\ loop\_len\ =\ data\_length\ -\/\ 2;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00259}00259\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ i\ =\ 0;\ i\ <\ loop\_len;\ i++)}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00260}00260\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00261}00261\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_a9e55b5c4cdf6fa62f8dfb9d6604655a6}{crc\_16}}.add(data[i]);}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00262}00262\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00263}00263\ \ \ \ \ uint16\_t\ num\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8cpp_a9e55b5c4cdf6fa62f8dfb9d6604655a6}{crc\_16}}.calc();}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00264}00264\ \ \ \ \ data[loop\_len]\ =\ num\ \&\ 0xFF;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00265}00265\ \ \ \ \ data[loop\_len\ +\ 1]\ =\ num\ >>\ 8;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00266}00266\ \ \ \ \ \textcolor{comment}{//\ Length\ is\ already\ correct\ (it\ was\ passed\ in\ including\ the\ 2\ bytes\ space)}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00267}00267\ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00268}00268\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00269}00269\ \textcolor{comment}{/*\ DEVELOPMENT\ STATE:\ EXPERIMENTAL\ */}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00280}\mbox{\hyperlink{class_bambu_bus_protocol_a30a401ab7075be8ffbe2343bf93ef0bd}{00280}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_bambu_bus_protocol_a30a401ab7075be8ffbe2343bf93ef0bd}{BambuBusProtocol::BuildLongPacket}}(\mbox{\hyperlink{structlong__packge__data}{long\_packge\_data}}\ *data,\ uint8\_t\ *out\_buffer,\ uint16\_t\ \&out\_length)}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00281}00281\ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00282}00282\ \ \ \ \ out\_buffer[0]\ =\ 0x3D;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00283}00283\ \ \ \ \ out\_buffer[1]\ =\ 0x05;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00284}00284\ \ \ \ \ data-\/>\mbox{\hyperlink{structlong__packge__data_a2e114594fa8edb0f94d3baa832dc7d77}{package\_length}}\ =\ data-\/>\mbox{\hyperlink{structlong__packge__data_a37cca48d85473aa686a58e3cc32eb177}{data\_length}}\ +\ 15;\ \textcolor{comment}{//\ 13\ header\ +\ 2\ crc16\ ?\ }}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00285}00285\ \ \ \ \ \textcolor{comment}{//\ Header\ is:\ 3D\ 00\ (2)\ +\ struct(11)\ =\ 13?}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00286}00286\ \ \ \ \ \textcolor{comment}{//\ struct\ is\ 11\ bytes:\ num(2)+len(2)+crc8(1)+target(2)+source(2)+type(2)\ =\ 11.}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00287}00287\ \ \ \ \ \textcolor{comment}{//\ total\ header\ =\ 3D\ 00\ +\ 11\ =\ 13.}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00288}00288\ \ \ \ \ \textcolor{comment}{//\ +\ data}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00289}00289\ \ \ \ \ \textcolor{comment}{//\ +\ crc16\ (2)}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00290}00290\ \ \ \ \ \textcolor{comment}{//\ =\ 15\ +\ data\_length.\ Correct.}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00291}00291\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00292}00292\ \ \ \ \ memcpy(out\_buffer\ +\ 2,\ data,\ 11);}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00293}00293\ \ \ \ \ memcpy(out\_buffer\ +\ 13,\ data-\/>\mbox{\hyperlink{structlong__packge__data_a80c463bfbe59e76ecacb35358cabecaa}{datas}},\ data-\/>\mbox{\hyperlink{structlong__packge__data_a37cca48d85473aa686a58e3cc32eb177}{data\_length}});}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00294}00294\ \ \ \ \ out\_length\ =\ data-\/>\mbox{\hyperlink{structlong__packge__data_a37cca48d85473aa686a58e3cc32eb177}{data\_length}}\ +\ 15;}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00295}00295\ \ \ \ \ \mbox{\hyperlink{class_bambu_bus_protocol_af9d11bc755538718e6ba8fbc5c8e9187}{BuildPacketWithCRC}}(out\_buffer,\ out\_length);}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00296}00296\ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00297}00297\ }
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00298}00298\ \textcolor{comment}{/*\ DEVELOPMENT\ STATE:\ EXPERIMENTAL\ */}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00305}\mbox{\hyperlink{class_bambu_bus_protocol_addece07a1980f5f561e151fd4a09b9ea}{00305}}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9c}{UnifiedCommandType}}\ \mbox{\hyperlink{class_bambu_bus_protocol_addece07a1980f5f561e151fd4a09b9ea}{BambuBusProtocol::GetUnifiedType}}(\mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5}{BambuBus\_package\_type}}\ type)\ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00306}00306\ \ \ \ \ \textcolor{keywordflow}{switch}\ (type)\ \{}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00307}00307\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5ad4d3385ad5d973a7b76f0e1e10a9a911}{BambuBus\_package\_type::filament\_motion\_short}}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9caa2cb872d6738be05568903e3cc0a0c77}{UnifiedCommandType::FilamentMotionShort}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00308}00308\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5acc8310f3d30aeac76f64a41602888847}{BambuBus\_package\_type::filament\_motion\_long}}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9ca84ef06344d5159ac0d02201780d584be}{UnifiedCommandType::FilamentMotionLong}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00309}00309\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5ac5942b864a1fc3982fbce8d02e891942}{BambuBus\_package\_type::online\_detect}}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9cadb5148c679935c8821fac8fad759922f}{UnifiedCommandType::OnlineDetect}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00310}00310\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a403d48ab34ede926334f42e9f1e118b2}{BambuBus\_package\_type::REQx6}}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9ca403d48ab34ede926334f42e9f1e118b2}{UnifiedCommandType::REQx6}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00311}00311\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a05a1cf045bfd606d4cc9ecb9018340cb}{BambuBus\_package\_type::NFC\_detect}}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9cae1af9a3c9b9eb4eab1e151407af92c2a}{UnifiedCommandType::NFCDetect}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00312}00312\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a151b70298322f2552b21cd732c34daca}{BambuBus\_package\_type::set\_filament\_info}}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9cab72778b10468ded56d76c818eae14c76}{UnifiedCommandType::SetFilamentInfo}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00313}00313\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a3a06e053a0726537b202ce4ace81dee7}{BambuBus\_package\_type::heartbeat}}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9ca83622997d22f5f18b9b09bd364cb673e}{UnifiedCommandType::Heartbeat}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00314}00314\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a210fd6ea841c46980bb97dcf450d6433}{BambuBus\_package\_type::MC\_online}}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9cab243c306036d0eec5691b5629d15f024}{UnifiedCommandType::MCOnline}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00315}00315\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a57b48f5ee45c9bae0dfa0a6641e043ca}{BambuBus\_package\_type::read\_filament\_info}}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9ca2c0ccc43448d5e1e8576ab6bc582e2fb}{UnifiedCommandType::ReadFilamentInfo}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00316}00316\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5ab3c10f101a42a8c68e7f1b8588bfb9b6}{BambuBus\_package\_type::set\_filament\_info\_type2}}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9ca182645fd81a6683f911479f84a15e46d}{UnifiedCommandType::SetFilamentInfoType2}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00317}00317\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a2af72f100c356273d46284f6fd1dfc08}{BambuBus\_package\_type::version}}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9ca34b6cd75171affba6957e308dcbd92be}{UnifiedCommandType::Version}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00318}00318\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5a87da425e91c92b2f5d360a2c60693425}{BambuBus\_package\_type::serial\_number}}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9caa54372ef430f726c8343fc5550fade42}{UnifiedCommandType::SerialNumber}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00319}00319\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a28b188362482dd49915e0f8c5cce1ac5abb1ca97ec761fc37101737ba0aa2e7c5}{BambuBus\_package\_type::ERROR}}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9ca902b0d55fddef6f8d651fe1035b7d4bd}{UnifiedCommandType::Error}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00320}00320\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_command_types_8h_a9fa149d3b881fd0f62738e1de747ea9ca6adf97f83acf6453d4a6a4b1070f3754}{UnifiedCommandType::None}};}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00321}00321\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00322}00322\ \}}
\DoxyCodeLine{\Hypertarget{_bambu_bus_protocol_8cpp_source_l00323}00323\ }

\end{DoxyCode}
