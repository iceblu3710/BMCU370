\doxysection{Control\+Logic Namespace Reference}
\hypertarget{namespace_control_logic}{}\label{namespace_control_logic}\index{ControlLogic@{ControlLogic}}
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_control_logic_1_1_m_o_t_o_r___p_i_d}{MOTOR\+\_\+\+PID}}
\item 
class \mbox{\hyperlink{class_control_logic_1_1_motor_channel}{Motor\+Channel}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76}{filament\+\_\+now\+\_\+position\+\_\+enum}} \{ \newline
\mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\+\_\+idle}}
, \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f}{filament\+\_\+sending\+\_\+out}}
, \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f}{filament\+\_\+using}}
, \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049}{filament\+\_\+pulling\+\_\+back}}
, \newline
\mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a0cc46749c7ec1ea4792e7459fe513bae}{filament\+\_\+redetect}}
, \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22}{filament\+\_\+loading}}
, \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2}{filament\+\_\+unloading}}
 \}
\item 
enum class \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cf}{filament\+\_\+motion\+\_\+enum}} \{ \newline
\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b}{stop}}
, \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890}{send}}
, \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0}{pull}}
, \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8}{slow\+\_\+send}}
, \newline
\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c}{pressure\+\_\+ctrl\+\_\+idle}}
, \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75}{pressure\+\_\+ctrl\+\_\+in\+\_\+use}}
, \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa9b01b276e259d1d60ae1bea14f97731d}{pressure\+\_\+ctrl\+\_\+on\+\_\+use}}
, \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3}{velocity\+\_\+control}}
 \}
\item 
enum class \mbox{\hyperlink{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbd}{pressure\+\_\+control\+\_\+enum}} \{ \mbox{\hyperlink{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbda5da09bef03bc5cf7a199c7cf66763f4c}{less\+\_\+pressure}}
, \mbox{\hyperlink{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbdaa181a603769c1f98ad927e7367c7aa51}{all}}
, \mbox{\hyperlink{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbda1366d1b3f33e8e3fb08ac3905b8c9510}{over\+\_\+pressure}}
 \}
\item 
enum class \mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070}{Boot\+Mode}} \+: uint32\+\_\+t \{ \mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a}{Bambu\+Bus}} = 0
, \mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55}{Klipper}} = 1
 \}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
uint64\+\_\+t \mbox{\hyperlink{namespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c}{get\+\_\+time64}} ()
\item 
void \mbox{\hyperlink{namespace_control_logic_ac2d890c891494072159ebc2b30490197}{motor\+\_\+motion\+\_\+switch}} ()
\begin{DoxyCompactList}\small\item\em State Machine for Bambu\+Bus Logic. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13}{MC\+\_\+\+PULL\+\_\+\+ONLINE\+\_\+read}} ()
\begin{DoxyCompactList}\small\item\em Read Analog Sensors and Update State. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_adb4ce7f82b449d6d6d97e7399ce391f5}{Start\+Load\+Filament}} (int tray, int length\+\_\+mm)
\begin{DoxyCompactList}\small\item\em Initiate a Filament Load sequence for a specific tray. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_abcc93276e326829eec4d37024c647745}{Start\+Unload\+Filament}} (int tray, int length\+\_\+mm)
\begin{DoxyCompactList}\small\item\em Initiate a Filament Unload sequence for a specific tray. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_a484eadc314267f8bc9aa0f025c1137d9}{Move\+Axis}} (int axis, float dist\+\_\+mm, float speed)
\begin{DoxyCompactList}\small\item\em Manually move an axis (Klipper Primitive). \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_af084200798d6b89c1b448bf41b105d62}{Stop\+All}} ()
\begin{DoxyCompactList}\small\item\em Stop all motors. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_a9db355302a1c9d608e6dd5341151336e}{Set\+Auto\+Feed}} (int lane, bool enable)
\begin{DoxyCompactList}\small\item\em Enable/\+Disable Auto-\/\+Feed (Pressure Control) for a lane. \end{DoxyCompactList}\item 
uint16\+\_\+t \mbox{\hyperlink{namespace_control_logic_a4428a845041ff986ccbf2555a62d0656}{Get\+Sensor\+State}} ()
\begin{DoxyCompactList}\small\item\em Get a bitmask of sensor states. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{namespace_control_logic_a77da31cf0baa8e886a438b2a9e73a573}{Get\+Lane\+Motion}} (int lane)
\begin{DoxyCompactList}\small\item\em Get the current motion state of a lane. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_aa3d38299372c0822e90d6e649344e8ad}{AS5600\+\_\+\+Update}} (float time\+\_\+E)
\begin{DoxyCompactList}\small\item\em Update Odometer and Speed from AS5600 sensors. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3}{Save\+Settings}} ()
\begin{DoxyCompactList}\small\item\em Commit settings to Flash memory. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_afe90d7f284c20f90f74787274f01c51b}{Set\+Need\+To\+Save}} ()
\begin{DoxyCompactList}\small\item\em Flag that settings need to be saved. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{namespace_control_logic_acb78560c64e5ea050853ab319a03f14e}{Prepare\+\_\+\+For\+\_\+filament\+\_\+\+Pull\+\_\+\+Back}} (float\+\_\+t OUT\+\_\+filament\+\_\+meters)
\begin{DoxyCompactList}\small\item\em Check if pullback is required (Smart Pullback Logic). \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_adc8c269923e0c76c6d104a005833a7f9}{Run}} ()
\begin{DoxyCompactList}\small\item\em Main Control Loop. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2}{Load\+Settings}} ()
\begin{DoxyCompactList}\small\item\em Load settings from Flash memory. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_a1da226a05b7a8c46e16a840900265c03}{Init}} ()
\begin{DoxyCompactList}\small\item\em Initialize \doxylink{namespace_control_logic}{Control\+Logic}. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070}{Boot\+Mode}} \mbox{\hyperlink{namespace_control_logic_a0c732b28cf691fb77359c80a0c000665}{Init\+Boot\+Check}} ()
\begin{DoxyCompactList}\small\item\em Check Boot Mode (Button Press at Startup). \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070}{Boot\+Mode}} \mbox{\hyperlink{namespace_control_logic_a300e5b18ebf53c086955bf02dfe16faa}{Get\+Boot\+Mode}} ()
\begin{DoxyCompactList}\small\item\em Get current Boot Mode. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_a9716be5fe9da72481bee41a80681d8e5}{Update\+Connectivity}} (bool online)
\begin{DoxyCompactList}\small\item\em Update connectivity status (Online/\+Offline). \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_a8880b393facb6828519b8dac8e96393c}{Process\+Motion\+Short\+Logic}} (uint8\+\_\+t ams\+\_\+num, uint8\+\_\+t statu\+\_\+flags, uint8\+\_\+t read\+\_\+num, uint8\+\_\+t fliment\+\_\+motion\+\_\+flag)
\begin{DoxyCompactList}\small\item\em Core logic for processing Short Motion packets. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_a5f85db884abd1a66d8b120729ec0d99e}{Process\+Motion\+Short}} (uint8\+\_\+t \texorpdfstring{$\ast$}{*}buffer, uint16\+\_\+t length)
\begin{DoxyCompactList}\small\item\em Handler for Filament Motion Short packet (0x03). \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_a2ab840bfd454a7709553b89529285b74}{Process\+Motion\+Long}} (uint8\+\_\+t \texorpdfstring{$\ast$}{*}buffer, uint16\+\_\+t length)
\begin{DoxyCompactList}\small\item\em Handler for Filament Motion Long packet (0x04). \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_a412a7a597ff3c04c0ea1480094600ef4}{Process\+Online\+Detect}} (uint8\+\_\+t \texorpdfstring{$\ast$}{*}buffer, uint16\+\_\+t length)
\begin{DoxyCompactList}\small\item\em Handler for Online Detect (0x05). \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_a82b9a1fb120cd91615d2ac478daafefd}{Process\+REQx6}} (uint8\+\_\+t \texorpdfstring{$\ast$}{*}buffer, uint16\+\_\+t length)
\begin{DoxyCompactList}\small\item\em Handler for REQx6 (0x06). \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_a0c4206af909c8128bc68eb6a1bcfa16e}{Process\+Heartbeat}} (uint8\+\_\+t \texorpdfstring{$\ast$}{*}buffer, uint16\+\_\+t length)
\begin{DoxyCompactList}\small\item\em Handler for Heartbeat (0x20). \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_ada1dd6f18fca06d8b26836f4788ab0ad}{Process\+Set\+Filament\+Info}} (uint8\+\_\+t \texorpdfstring{$\ast$}{*}buffer, uint16\+\_\+t length)
\begin{DoxyCompactList}\small\item\em Handler for Set Filament Info (0x08 -\/ Short). \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4}{Set\+Filament\+Info\+Action}} (int id, const \mbox{\hyperlink{struct_filament_info}{Filament\+Info}} \&info, float meters)
\begin{DoxyCompactList}\small\item\em Action helper to update filament metadata. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_a1ff0bcee8062346fb963e4dd845c8bdf}{Process\+Long\+Packet}} (struct \mbox{\hyperlink{structlong__packge__data}{long\+\_\+packge\+\_\+data}} \&data)
\begin{DoxyCompactList}\small\item\em Handler/\+Dispatcher for Long Packets. \end{DoxyCompactList}\item 
uint16\+\_\+t \mbox{\hyperlink{namespace_control_logic_acca64947bdc9cfb88ea5091014c68b75}{Get\+Device\+Type}} ()
\begin{DoxyCompactList}\small\item\em Get the configured device type. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_control_logic_aa490d28f0823086ff5e1e97451425dc7}{Process\+Motion\+Long\+Logic}} (uint8\+\_\+t \texorpdfstring{$\ast$}{*}payload, uint16\+\_\+t length)
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
float \mbox{\hyperlink{namespace_control_logic_a9a6c6bb73ae52885ddaa5ec56d8603f9}{PULL\+\_\+voltage\+\_\+up}} = 1.\+85f
\item 
float \mbox{\hyperlink{namespace_control_logic_a73b9466c4e3c236a186659863283f00e}{PULL\+\_\+voltage\+\_\+down}} = 1.\+45f
\item 
float\+\_\+t \mbox{\hyperlink{namespace_control_logic_a0dc914125ce5b958b6d1620c814a580d}{P1\+X\+\_\+\+OUT\+\_\+filament\+\_\+meters}} = 200.\+0f
\item 
static float \mbox{\hyperlink{namespace_control_logic_a5428672c2045ec91715338f32d8bb5f1}{speed\+\_\+as5600}} \mbox{[}4\mbox{]} = \{0, 0, 0, 0\}
\item 
static float \mbox{\hyperlink{namespace_control_logic_a14f470efe568bae229e028e1b1acd54f}{MC\+\_\+\+PULL\+\_\+stu\+\_\+raw}} \mbox{[}4\mbox{]} = \{0, 0, 0, 0\}
\item 
static int \mbox{\hyperlink{namespace_control_logic_a87d54195660d73ebcd372cad0fd74915}{MC\+\_\+\+PULL\+\_\+stu}} \mbox{[}4\mbox{]} = \{0, 0, 0, 0\}
\item 
static float \mbox{\hyperlink{namespace_control_logic_ae2535696ce7487f6ec12d1f2e174e598}{MC\+\_\+\+ONLINE\+\_\+key\+\_\+stu\+\_\+raw}} \mbox{[}4\mbox{]} = \{0, 0, 0, 0\}
\item 
static int \mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\+\_\+\+ONLINE\+\_\+key\+\_\+stu}} \mbox{[}4\mbox{]} = \{0, 0, 0, 0\}
\item 
static bool \mbox{\hyperlink{namespace_control_logic_a280d12e7265d1830d4859cc38dd5497e}{Assist\+\_\+send\+\_\+filament}} \mbox{[}4\mbox{]} = \{false\}
\item 
static bool \mbox{\hyperlink{namespace_control_logic_a33f7ccbf87b78ae7394f88ffe1a4a75e}{pull\+\_\+state\+\_\+old}} = false
\item 
static bool \mbox{\hyperlink{namespace_control_logic_aef70a34b1f25019450171bfa5c07ab62}{is\+\_\+backing\+\_\+out}} = false
\item 
static const bool \mbox{\hyperlink{namespace_control_logic_a8abb9a7c0790b08a5e5f31c8874bb15f}{is\+\_\+two}} = true
\item 
static int32\+\_\+t \mbox{\hyperlink{namespace_control_logic_ad161a11879586190d66f43141bb6578f}{as5600\+\_\+distance\+\_\+save}} \mbox{[}4\mbox{]} = \{0, 0, 0, 0\}
\item 
static int32\+\_\+t \mbox{\hyperlink{namespace_control_logic_a11bff287b64c24fe91500ba99c6f21c8}{unload\+\_\+target\+\_\+dist}} \mbox{[}4\mbox{]} = \{0, 0, 0, 0\}
\item 
static float \mbox{\hyperlink{namespace_control_logic_a0efb555ba92cc1cedb47929db260e6c8}{unload\+\_\+start\+\_\+meters}} \mbox{[}4\mbox{]} = \{0, 0, 0, 0\}
\item 
static \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76}{filament\+\_\+now\+\_\+position\+\_\+enum}} \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\+\_\+now\+\_\+position}} \mbox{[}4\mbox{]} = \{\mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\+\_\+idle}}, \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\+\_\+idle}}, \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\+\_\+idle}}, \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\+\_\+idle}}\}
\item 
static bool \mbox{\hyperlink{namespace_control_logic_a5cc135d9070e574d8b2fe9c9b328a148}{Bambubus\+\_\+need\+\_\+to\+\_\+save}} = false
\item 
static uint64\+\_\+t \mbox{\hyperlink{namespace_control_logic_a17835f3a0e8384e40e9d647ce79d3d22}{save\+\_\+timer}} = 0
\item 
static \mbox{\hyperlink{class_control_logic_1_1_motor_channel}{Motor\+Channel}} \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}} \mbox{[}4\mbox{]} = \{0, 1, 2, 3\}
\end{DoxyCompactItemize}


\label{doc-enum-members}
\Hypertarget{namespace_control_logic_doc-enum-members}
\doxysubsection{Enumeration Type Documentation}
\Hypertarget{namespace_control_logic_aa23e295fa5022b6569547cf94f091070}\index{ControlLogic@{ControlLogic}!BootMode@{BootMode}}
\index{BootMode@{BootMode}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{BootMode}{BootMode}}
{\footnotesize\ttfamily \label{namespace_control_logic_aa23e295fa5022b6569547cf94f091070} 
enum class \mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070}{Control\+Logic\+::\+Boot\+Mode}} \+: uint32\+\_\+t\hspace{0.3cm}{\ttfamily [strong]}}

\begin{DoxyEnumFields}[2]{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{BambuBus@{BambuBus}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!BambuBus@{BambuBus}}}\Hypertarget{namespace_control_logic_aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a}\label{namespace_control_logic_aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a} 
Bambu\+Bus&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{Klipper@{Klipper}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!Klipper@{Klipper}}}\Hypertarget{namespace_control_logic_aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55}\label{namespace_control_logic_aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55} 
Klipper&\\
\hline

\end{DoxyEnumFields}


Definition at line \mbox{\hyperlink{_control_logic_8h_source_l00014}{14}} of file \mbox{\hyperlink{_control_logic_8h_source}{Control\+Logic.\+h}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ uint32\_t\ \{}
\DoxyCodeLine{00015\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a}{BambuBus}}\ =\ 0,}
\DoxyCodeLine{00016\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55}{Klipper}}\ =\ 1}
\DoxyCodeLine{00017\ \ \ \ \ \};}

\end{DoxyCode}
\Hypertarget{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cf}\index{ControlLogic@{ControlLogic}!filament\_motion\_enum@{filament\_motion\_enum}}
\index{filament\_motion\_enum@{filament\_motion\_enum}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{filament\_motion\_enum}{filament\_motion\_enum}}
{\footnotesize\ttfamily \label{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cf} 
enum class \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cf}{Control\+Logic\+::filament\+\_\+motion\+\_\+enum}}\hspace{0.3cm}{\ttfamily [strong]}}

\begin{DoxyEnumFields}[2]{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{stop@{stop}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!stop@{stop}}}\Hypertarget{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b}\label{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b} 
stop&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{send@{send}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!send@{send}}}\Hypertarget{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890}\label{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890} 
send&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{pull@{pull}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!pull@{pull}}}\Hypertarget{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0}\label{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0} 
pull&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{slow\_send@{slow\_send}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!slow\_send@{slow\_send}}}\Hypertarget{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8}\label{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8} 
slow\+\_\+send&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{pressure\_ctrl\_idle@{pressure\_ctrl\_idle}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!pressure\_ctrl\_idle@{pressure\_ctrl\_idle}}}\Hypertarget{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c}\label{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c} 
pressure\+\_\+ctrl\+\_\+idle&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{pressure\_ctrl\_in\_use@{pressure\_ctrl\_in\_use}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!pressure\_ctrl\_in\_use@{pressure\_ctrl\_in\_use}}}\Hypertarget{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75}\label{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75} 
pressure\+\_\+ctrl\+\_\+in\+\_\+use&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{pressure\_ctrl\_on\_use@{pressure\_ctrl\_on\_use}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!pressure\_ctrl\_on\_use@{pressure\_ctrl\_on\_use}}}\Hypertarget{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa9b01b276e259d1d60ae1bea14f97731d}\label{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa9b01b276e259d1d60ae1bea14f97731d} 
pressure\+\_\+ctrl\+\_\+on\+\_\+use&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{velocity\_control@{velocity\_control}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!velocity\_control@{velocity\_control}}}\Hypertarget{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3}\label{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3} 
velocity\+\_\+control&\\
\hline

\end{DoxyEnumFields}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00181}{181}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00182\ \ \ \ \ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b}{stop}},}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890}{send}},}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0}{pull}},}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8}{slow\_send}},}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c}{pressure\_ctrl\_idle}},}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75}{pressure\_ctrl\_in\_use}},\ }
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa9b01b276e259d1d60ae1bea14f97731d}{pressure\_ctrl\_on\_use}},}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3}{velocity\_control}}\ \textcolor{comment}{//\ Added\ for\ Klipper}}
\DoxyCodeLine{00191\ \ \ \ \ \};}

\end{DoxyCode}
\Hypertarget{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76}\index{ControlLogic@{ControlLogic}!filament\_now\_position\_enum@{filament\_now\_position\_enum}}
\index{filament\_now\_position\_enum@{filament\_now\_position\_enum}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{filament\_now\_position\_enum}{filament\_now\_position\_enum}}
{\footnotesize\ttfamily \label{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76} 
enum \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76}{Control\+Logic\+::filament\+\_\+now\+\_\+position\+\_\+enum}}}

\begin{DoxyEnumFields}[2]{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{filament\_idle@{filament\_idle}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!filament\_idle@{filament\_idle}}}\Hypertarget{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}\label{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5} 
filament\+\_\+idle&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{filament\_sending\_out@{filament\_sending\_out}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!filament\_sending\_out@{filament\_sending\_out}}}\Hypertarget{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f}\label{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f} 
filament\+\_\+sending\+\_\+out&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{filament\_using@{filament\_using}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!filament\_using@{filament\_using}}}\Hypertarget{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f}\label{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f} 
filament\+\_\+using&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{filament\_pulling\_back@{filament\_pulling\_back}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!filament\_pulling\_back@{filament\_pulling\_back}}}\Hypertarget{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049}\label{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049} 
filament\+\_\+pulling\+\_\+back&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{filament\_redetect@{filament\_redetect}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!filament\_redetect@{filament\_redetect}}}\Hypertarget{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a0cc46749c7ec1ea4792e7459fe513bae}\label{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a0cc46749c7ec1ea4792e7459fe513bae} 
filament\+\_\+redetect&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{filament\_loading@{filament\_loading}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!filament\_loading@{filament\_loading}}}\Hypertarget{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22}\label{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22} 
filament\+\_\+loading&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{filament\_unloading@{filament\_unloading}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!filament\_unloading@{filament\_unloading}}}\Hypertarget{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2}\label{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2} 
filament\+\_\+unloading&\\
\hline

\end{DoxyEnumFields}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00170}{170}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00171\ \ \ \ \ \{}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}},}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f}{filament\_sending\_out}},}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f}{filament\_using}},}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049}{filament\_pulling\_back}},}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a0cc46749c7ec1ea4792e7459fe513bae}{filament\_redetect}},}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22}{filament\_loading}},\ \textcolor{comment}{//\ Added\ for\ LOAD\_FILAMENT\ command}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2}{filament\_unloading}},\ \textcolor{comment}{//\ Added\ for\ UNLOAD\_FILAMENT\ command}}
\DoxyCodeLine{00179\ \ \ \ \ \};}

\end{DoxyCode}
\Hypertarget{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbd}\index{ControlLogic@{ControlLogic}!pressure\_control\_enum@{pressure\_control\_enum}}
\index{pressure\_control\_enum@{pressure\_control\_enum}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{pressure\_control\_enum}{pressure\_control\_enum}}
{\footnotesize\ttfamily \label{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbd} 
enum class \mbox{\hyperlink{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbd}{Control\+Logic\+::pressure\+\_\+control\+\_\+enum}}\hspace{0.3cm}{\ttfamily [strong]}}

\begin{DoxyEnumFields}[2]{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{less\_pressure@{less\_pressure}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!less\_pressure@{less\_pressure}}}\Hypertarget{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbda5da09bef03bc5cf7a199c7cf66763f4c}\label{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbda5da09bef03bc5cf7a199c7cf66763f4c} 
less\+\_\+pressure&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{all@{all}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!all@{all}}}\Hypertarget{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbdaa181a603769c1f98ad927e7367c7aa51}\label{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbdaa181a603769c1f98ad927e7367c7aa51} 
all&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{over\_pressure@{over\_pressure}!ControlLogic@{ControlLogic}}\index{ControlLogic@{ControlLogic}!over\_pressure@{over\_pressure}}}\Hypertarget{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbda1366d1b3f33e8e3fb08ac3905b8c9510}\label{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbda1366d1b3f33e8e3fb08ac3905b8c9510} 
over\+\_\+pressure&\\
\hline

\end{DoxyEnumFields}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00322}{322}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00322\ \{\ \mbox{\hyperlink{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbda5da09bef03bc5cf7a199c7cf66763f4c}{less\_pressure}},\ \mbox{\hyperlink{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbdaa181a603769c1f98ad927e7367c7aa51}{all}},\ \mbox{\hyperlink{namespace_control_logic_aeb57036d717bcb2c083d524f4f493cbda1366d1b3f33e8e3fb08ac3905b8c9510}{over\_pressure}}\ \};}

\end{DoxyCode}


\label{doc-func-members}
\Hypertarget{namespace_control_logic_doc-func-members}
\doxysubsection{Function Documentation}
\Hypertarget{namespace_control_logic_aa3d38299372c0822e90d6e649344e8ad}\index{ControlLogic@{ControlLogic}!AS5600\_Update@{AS5600\_Update}}
\index{AS5600\_Update@{AS5600\_Update}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{AS5600\_Update()}{AS5600\_Update()}}
{\footnotesize\ttfamily \label{namespace_control_logic_aa3d38299372c0822e90d6e649344e8ad} 
void Control\+Logic\+::\+AS5600\+\_\+\+Update (\begin{DoxyParamCaption}\item[{float}]{time\+\_\+E}{}\end{DoxyParamCaption})}



Update Odometer and Speed from AS5600 sensors. 

Reads angles, calculates delta, computes speed and distance. Updates global odometer meters for the filament.


\begin{DoxyParams}{Parameters}
{\em time\+\_\+E} & Time elapsed. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00694}{694}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_ab704ea0db8b260d9ddf7fd829cbe637f}{MC\_AS5600}}.updata\_angle();}
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<4;\ i++)\ \{}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{_control_logic_8cpp_ab704ea0db8b260d9ddf7fd829cbe637f}{MC\_AS5600}}.online[i])\ \{}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a5428672c2045ec91715338f32d8bb5f1}{speed\_as5600}}[i]\ =\ 0;\ \mbox{\hyperlink{namespace_control_logic_ad161a11879586190d66f43141bb6578f}{as5600\_distance\_save}}[i]\ =\ 0;\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ now\ =\ \mbox{\hyperlink{_control_logic_8cpp_ab704ea0db8b260d9ddf7fd829cbe637f}{MC\_AS5600}}.raw\_angle[i];}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ last\ =\ \mbox{\hyperlink{namespace_control_logic_ad161a11879586190d66f43141bb6578f}{as5600\_distance\_save}}[i];}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ cir\_E\ =\ 0;}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (now\ >\ 3072\ \&\&\ last\ <=\ 1024)\ cir\_E\ =\ -\/4096;}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (now\ <=\ 1024\ \&\&\ last\ >\ 3072)\ cir\_E\ =\ 4096;}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ dist\_E\ =\ -\/(float)(now\ -\/\ last\ +\ cir\_E)\ *\ \mbox{\hyperlink{_control_logic_8cpp_a4e1c3fb8f754e84e8bc6c30bbba50272}{AS5600\_PI}}\ *\ 7.5\ /\ 4096;\ }
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ad161a11879586190d66f43141bb6578f}{as5600\_distance\_save}}[i]\ =\ now;}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ speedx\ =\ dist\_E\ /\ (time\_E\ >\ 0\ ?\ time\_E\ :\ 0.001f);}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a5428672c2045ec91715338f32d8bb5f1}{speed\_as5600}}[i]\ =\ speedx;}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.filament[i].meters\ +=\ dist\_E\ /\ 1000.0f;}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00714\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00213}{as5600\+\_\+distance\+\_\+save}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00193}{AS5600\+\_\+\+PI}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00032}{MC\+\_\+\+AS5600}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00204}{speed\+\_\+as5600}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00792}{Run()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_aa3d38299372c0822e90d6e649344e8ad_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c}\index{ControlLogic@{ControlLogic}!get\_time64@{get\_time64}}
\index{get\_time64@{get\_time64}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{get\_time64()}{get\_time64()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c} 
uint64\+\_\+t Control\+Logic\+::get\+\_\+time64 (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00227}{227}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00227\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespace_hardware_a8ea28b07408691bc126683a81aa220f3}{Hardware::GetTime}}();\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_hardware_8cpp_source_l00115}{Hardware\+::\+Get\+Time()}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00962}{motor\+\_\+motion\+\_\+switch()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l01160}{Process\+Motion\+Short\+Logic()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a300e5b18ebf53c086955bf02dfe16faa}\index{ControlLogic@{ControlLogic}!GetBootMode@{GetBootMode}}
\index{GetBootMode@{GetBootMode}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{GetBootMode()}{GetBootMode()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a300e5b18ebf53c086955bf02dfe16faa} 
\mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070}{Boot\+Mode}} Control\+Logic\+::\+Get\+Boot\+Mode (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Get current Boot Mode. 

\begin{DoxyReturn}{Returns}
\doxylink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070}{Boot\+Mode} 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00936}{936}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00936\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00937\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070}{BootMode}})\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.boot\_mode;}
\DoxyCodeLine{00938\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}.



Referenced by \mbox{\hyperlink{_command_router_8cpp_source_l00180}{Command\+Router\+::\+Run()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a300e5b18ebf53c086955bf02dfe16faa_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_acca64947bdc9cfb88ea5091014c68b75}\index{ControlLogic@{ControlLogic}!GetDeviceType@{GetDeviceType}}
\index{GetDeviceType@{GetDeviceType}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{GetDeviceType()}{GetDeviceType()}}
{\footnotesize\ttfamily \label{namespace_control_logic_acca64947bdc9cfb88ea5091014c68b75} 
uint16\+\_\+t Control\+Logic\+::\+Get\+Device\+Type (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Get the configured device type. 

\begin{DoxyReturn}{Returns}
uint16\+\_\+t Device Type ID (AMS / AMS Lite). 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l01453}{1453}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01453\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_control_logic_8cpp_a52925c91da70ade3c48b8eb3fe99caf6}{device\_type\_addr}};\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00038}{device\+\_\+type\+\_\+addr}}.

\Hypertarget{namespace_control_logic_a77da31cf0baa8e886a438b2a9e73a573}\index{ControlLogic@{ControlLogic}!GetLaneMotion@{GetLaneMotion}}
\index{GetLaneMotion@{GetLaneMotion}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{GetLaneMotion()}{GetLaneMotion()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a77da31cf0baa8e886a438b2a9e73a573} 
int Control\+Logic\+::\+Get\+Lane\+Motion (\begin{DoxyParamCaption}\item[{int}]{lane}{}\end{DoxyParamCaption})}



Get the current motion state of a lane. 


\begin{DoxyParams}{Parameters}
{\em lane} & Lane index. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
int Motion Enum integer value. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00679}{679}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(lane\ <\ 0\ ||\ lane\ >=\ 4)\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})\mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[lane].motion;}
\DoxyCodeLine{00682\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00517}{motors}}.



Referenced by \mbox{\hyperlink{_klipper_c_l_i_8cpp_source_l00111}{Klipper\+CLI\+::\+Handle\+Status()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a77da31cf0baa8e886a438b2a9e73a573_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a4428a845041ff986ccbf2555a62d0656}\index{ControlLogic@{ControlLogic}!GetSensorState@{GetSensorState}}
\index{GetSensorState@{GetSensorState}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{GetSensorState()}{GetSensorState()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a4428a845041ff986ccbf2555a62d0656} 
uint16\+\_\+t Control\+Logic\+::\+Get\+Sensor\+State (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Get a bitmask of sensor states. 

\begin{DoxyReturn}{Returns}
uint16\+\_\+t Bitmask (Bit i = Filament Present Lane i). 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00662}{662}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ [0:3]\ =\ Filament\ Present\ (MC\_ONLINE\_key\_stu)}}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ [4:7]\ =\ Buffer/Online?}}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ \ uint16\_t\ state\ =\ 0;}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<4;\ i++)\ \{}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[i]\ !=\ 0)\ state\ |=\ (1\ <<\ i);}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ state;}
\DoxyCodeLine{00670\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00208}{MC\+\_\+\+ONLINE\+\_\+key\+\_\+stu}}.



Referenced by \mbox{\hyperlink{_klipper_c_l_i_8cpp_source_l00185}{Klipper\+CLI\+::\+Handle\+Get\+Sensors()}}, and \mbox{\hyperlink{_klipper_c_l_i_8cpp_source_l00111}{Klipper\+CLI\+::\+Handle\+Status()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a4428a845041ff986ccbf2555a62d0656_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a1da226a05b7a8c46e16a840900265c03}\index{ControlLogic@{ControlLogic}!Init@{Init}}
\index{Init@{Init}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{Init()}{Init()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a1da226a05b7a8c46e16a840900265c03} 
void Control\+Logic\+::\+Init (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Initialize \doxylink{namespace_control_logic}{Control\+Logic}. 

Initializes \doxylink{namespace_hardware}{Hardware} (ADC, PWM), Loads Settings, and Initializes AS5600. 

Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00870}{870}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00871\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_a72bd28689a22ff9e3db6b911c020ecbb}{Hardware::ADC\_Init}}();}
\DoxyCodeLine{00872\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_a0745af097a6d21fc3fb1f1ebd9e141ff}{Hardware::PWM\_Init}}();}
\DoxyCodeLine{00873\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2}{LoadSettings}}();}
\DoxyCodeLine{00874\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_ab704ea0db8b260d9ddf7fd829cbe637f}{MC\_AS5600}}.init(\mbox{\hyperlink{_control_logic_8cpp_a25196e4c5bd3fa01c30a213fc32477fb}{AS5600\_SCL}},\ \mbox{\hyperlink{_control_logic_8cpp_a382950b12f65a33105a6b7c7cef4c219}{AS5600\_SDA}},\ 4);}
\DoxyCodeLine{00875\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00876\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<4;\ i++)\ \{}
\DoxyCodeLine{00877\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ d\ =\ \mbox{\hyperlink{_control_logic_8cpp_a5b964c14654ffcb3120d1d8cb9779c86}{mc\_save}}.Motion\_control\_dir[i];}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (d\ ==\ 0)\ d\ =\ 1;\ }
\DoxyCodeLine{00879\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ invert\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}(i)\ \{}
\DoxyCodeLine{00882\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0:\ invert\ =\ \mbox{\hyperlink{_hardware_8h_a70ebf132b9895ffa194e22b718c965e6}{MOTOR\_INVERT\_CH1}};\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00883\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 1:\ invert\ =\ \mbox{\hyperlink{_hardware_8h_ab6e6b731043fb762a0c477898e99e1c1}{MOTOR\_INVERT\_CH2}};\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00884\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 2:\ invert\ =\ \mbox{\hyperlink{_hardware_8h_a5c3ea9cfb6dd24133150cf4b4ead6390}{MOTOR\_INVERT\_CH3}};\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00885\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 3:\ invert\ =\ \mbox{\hyperlink{_hardware_8h_a052ab21e8c6d8c0f6324178cd9058ca9}{MOTOR\_INVERT\_CH4}};\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00886\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00887\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00888\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (invert)\ d\ =\ -\/d;}
\DoxyCodeLine{00889\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[i].\mbox{\hyperlink{class_control_logic_1_1_motor_channel_a853fbfcbd6b5a174c09a1df99de87770}{dir}}\ =\ (float)d;}
\DoxyCodeLine{00890\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00891\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a92f9b1daa685f9041b79423442d440e3}{last\_total\_distance}}[i]\ =\ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.filament[i].meters;}
\DoxyCodeLine{00892\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00893\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_hardware_8cpp_source_l00317}{Hardware\+::\+ADC\+\_\+\+Init()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00033}{AS5600\+\_\+\+SCL}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00034}{AS5600\+\_\+\+SDA}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00035}{last\+\_\+total\+\_\+distance}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00847}{Load\+Settings()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00032}{MC\+\_\+\+AS5600}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00045}{mc\+\_\+save}}, \mbox{\hyperlink{_hardware_8h_source_l00009}{MOTOR\+\_\+\+INVERT\+\_\+\+CH1}}, \mbox{\hyperlink{_hardware_8h_source_l00010}{MOTOR\+\_\+\+INVERT\+\_\+\+CH2}}, \mbox{\hyperlink{_hardware_8h_source_l00011}{MOTOR\+\_\+\+INVERT\+\_\+\+CH3}}, \mbox{\hyperlink{_hardware_8h_source_l00012}{MOTOR\+\_\+\+INVERT\+\_\+\+CH4}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00517}{motors}}, and \mbox{\hyperlink{_hardware_8cpp_source_l00411}{Hardware\+::\+PWM\+\_\+\+Init()}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00287}{Control\+Logic\+::\+MOTOR\+\_\+\+PID\+::\+MOTOR\+\_\+\+PID()}}, and \mbox{\hyperlink{main_8cpp_source_l00013}{setup()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a1da226a05b7a8c46e16a840900265c03_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=320pt]{namespace_control_logic_a1da226a05b7a8c46e16a840900265c03_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a0c732b28cf691fb77359c80a0c000665}\index{ControlLogic@{ControlLogic}!InitBootCheck@{InitBootCheck}}
\index{InitBootCheck@{InitBootCheck}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{InitBootCheck()}{InitBootCheck()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a0c732b28cf691fb77359c80a0c000665} 
\mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070}{Boot\+Mode}} Control\+Logic\+::\+Init\+Boot\+Check (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Check Boot Mode (Button Press at Startup). 

Reading ADC of sensor keys. If all are pressed (\texorpdfstring{$<$}{<} 1.\+3V) at startup, toggle the boot mode (Klipper \texorpdfstring{$<$}{<}-\/\texorpdfstring{$>$}{>} Bambu\+Bus).

\begin{DoxyReturn}{Returns}
\doxylink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070}{Boot\+Mode} The active boot mode. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00904}{904}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00904\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00905\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Read\ Sensors\ (Already\ inited\ in\ Hardware::Init)}}
\DoxyCodeLine{00906\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13}{MC\_PULL\_ONLINE\_read}}();\ }
\DoxyCodeLine{00907\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00908\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ all\_pressed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00909\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<4;\ i++)\ \{}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ User\ requested\ <\ 1.3V\ for\ mode\ switch.}}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a14f470efe568bae229e028e1b1acd54f}{MC\_PULL\_stu\_raw}}[i]\ >\ 1.3f)\ \{\ }
\DoxyCodeLine{00912\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ all\_pressed\ =\ \textcolor{keyword}{false};\ }
\DoxyCodeLine{00913\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ }
\DoxyCodeLine{00914\ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00915\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00916\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00917\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (all\_pressed)\ \{}
\DoxyCodeLine{00918\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Toggle\ Mode}}
\DoxyCodeLine{00919\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_a2c383f5bdbb468f12fb4ea625b5823b6}{boot\_mode}}\ ==\ (uint32\_t)\mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a}{BootMode::BambuBus}})\ \{}
\DoxyCodeLine{00920\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_a2c383f5bdbb468f12fb4ea625b5823b6}{boot\_mode}}\ =\ (uint32\_t)\mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55}{BootMode::Klipper}};}
\DoxyCodeLine{00921\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00922\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_a2c383f5bdbb468f12fb4ea625b5823b6}{boot\_mode}}\ =\ (uint32\_t)\mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a}{BootMode::BambuBus}};}
\DoxyCodeLine{00923\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00924\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_afe90d7f284c20f90f74787274f01c51b}{SetNeedToSave}}();}
\DoxyCodeLine{00925\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00926\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00927\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070}{BootMode}})\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_a2c383f5bdbb468f12fb4ea625b5823b6}{boot\_mode}};}
\DoxyCodeLine{00928\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8h_source_l00015}{Bambu\+Bus}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}, \mbox{\hyperlink{_control_logic_8h_source_l00016}{Klipper}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00240}{MC\+\_\+\+PULL\+\_\+\+ONLINE\+\_\+read()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00205}{MC\+\_\+\+PULL\+\_\+stu\+\_\+raw}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00733}{Set\+Need\+To\+Save()}}.



Referenced by \mbox{\hyperlink{main_8cpp_source_l00013}{setup()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a0c732b28cf691fb77359c80a0c000665_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=295pt]{namespace_control_logic_a0c732b28cf691fb77359c80a0c000665_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2}\index{ControlLogic@{ControlLogic}!LoadSettings@{LoadSettings}}
\index{LoadSettings@{LoadSettings}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{LoadSettings()}{LoadSettings()}}
{\footnotesize\ttfamily \label{namespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2} 
void Control\+Logic\+::\+Load\+Settings (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Load settings from Flash memory. 

If flash is invalid (CRC/\+Version mismatch), loads defaults. 

Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00847}{847}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00847\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structflash__save__struct}{flash\_save\_struct}}\ *ptr\ =\ (\mbox{\hyperlink{structflash__save__struct}{flash\_save\_struct}}\ *)(\mbox{\hyperlink{_control_logic_8cpp_a377d54c27966e6b7bcfb0810524885b1}{use\_flash\_addr}});}
\DoxyCodeLine{00849\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((ptr-\/>\mbox{\hyperlink{structflash__save__struct_a219489a81c5e22462fc6d57432c6ef21}{check}}\ ==\ 0x40614061)\ \&\&\ (ptr-\/>\mbox{\hyperlink{structflash__save__struct_a11de83ae7f3b48ff2ef8cb12143752d3}{version}}\ ==\ \mbox{\hyperlink{_control_logic_8cpp_a5f43c83fd8dd8ac8414357ecd89dec8d}{Bambubus\_version}}))\ \{}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \ \ \ \ \ \ memcpy(\&\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}},\ ptr,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}));}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Default\ constants}}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.filament[0].color\_R\ =\ 0xFF;\ }
\DoxyCodeLine{00854\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.boot\_mode\ =\ (uint32\_t)\mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a}{BootMode::BambuBus}};\ \textcolor{comment}{//\ Default\ to\ BambuBus}}
\DoxyCodeLine{00855\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_afe90d7f284c20f90f74787274f01c51b}{SetNeedToSave}}();\ \textcolor{comment}{//\ Valid\ version\ but\ mismatch\ or\ invalid,\ save\ new\ defaults}}
\DoxyCodeLine{00856\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00857\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00858\ \ \ \ \ \ \ \ \ Motion\_control\_save\_struct\ *mc\_ptr\ =\ (Motion\_control\_save\_struct\ *)(\mbox{\hyperlink{_control_logic_8cpp_a157a750331805d0201ca01160b072510}{Motion\_control\_save\_flash\_addr}});}
\DoxyCodeLine{00859\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (mc\_ptr-\/>\mbox{\hyperlink{struct_motion__control__save__struct_a9b40edb55eff01a8f6b9a32831435dd5}{check}}\ ==\ 0x40614061)\ \{}
\DoxyCodeLine{00860\ \ \ \ \ \ \ \ \ \ \ \ \ memcpy(\&\mbox{\hyperlink{_control_logic_8cpp_a5b964c14654ffcb3120d1d8cb9779c86}{mc\_save}},\ mc\_ptr,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{_control_logic_8cpp_a5b964c14654ffcb3120d1d8cb9779c86}{mc\_save}}));}
\DoxyCodeLine{00861\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00862\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8h_source_l00015}{Bambu\+Bus}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00017}{Bambubus\+\_\+version}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00027}{flash\+\_\+save\+\_\+struct\+::check}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00041}{Motion\+\_\+control\+\_\+save\+\_\+struct\+::check}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00045}{mc\+\_\+save}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00157}{Motion\+\_\+control\+\_\+save\+\_\+flash\+\_\+addr}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00733}{Set\+Need\+To\+Save()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00018}{use\+\_\+flash\+\_\+addr}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00026}{flash\+\_\+save\+\_\+struct\+::version}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00870}{Init()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13}\index{ControlLogic@{ControlLogic}!MC\_PULL\_ONLINE\_read@{MC\_PULL\_ONLINE\_read}}
\index{MC\_PULL\_ONLINE\_read@{MC\_PULL\_ONLINE\_read}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{MC\_PULL\_ONLINE\_read()}{MC\_PULL\_ONLINE\_read()}}
{\footnotesize\ttfamily \label{namespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13} 
void Control\+Logic\+::\+MC\+\_\+\+PULL\+\_\+\+ONLINE\+\_\+read (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Read Analog Sensors and Update State. 

Reads ADC values for Filament sensors and Voltage monitors. Updates {\ttfamily \doxylink{namespace_control_logic_a87d54195660d73ebcd372cad0fd74915}{MC\+\_\+\+PULL\+\_\+stu}} (pressure state) and {\ttfamily \doxylink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\+\_\+\+ONLINE\+\_\+key\+\_\+stu}} (filament presence). Also updates internal \doxylink{class_unit_state}{Unit\+State} flags based on these readings. 

Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00240}{240}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ *data\ =\ \mbox{\hyperlink{namespace_hardware_aa54da804a3d4c6d89ba5d7a2931fc463}{Hardware::ADC\_GetValues}}();\ }
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!data)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a14f470efe568bae229e028e1b1acd54f}{MC\_PULL\_stu\_raw}}[3]\ =\ data[0];}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ae2535696ce7487f6ec12d1f2e174e598}{MC\_ONLINE\_key\_stu\_raw}}[3]\ =\ data[1];}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a14f470efe568bae229e028e1b1acd54f}{MC\_PULL\_stu\_raw}}[2]\ =\ data[2];}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ae2535696ce7487f6ec12d1f2e174e598}{MC\_ONLINE\_key\_stu\_raw}}[2]\ =\ data[3];}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a14f470efe568bae229e028e1b1acd54f}{MC\_PULL\_stu\_raw}}[1]\ =\ data[4];}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ae2535696ce7487f6ec12d1f2e174e598}{MC\_ONLINE\_key\_stu\_raw}}[1]\ =\ data[5];}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a14f470efe568bae229e028e1b1acd54f}{MC\_PULL\_stu\_raw}}[0]\ =\ data[6];}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ae2535696ce7487f6ec12d1f2e174e598}{MC\_ONLINE\_key\_stu\_raw}}[0]\ =\ data[7];}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ i++)\ \{}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a14f470efe568bae229e028e1b1acd54f}{MC\_PULL\_stu\_raw}}[i]\ >\ \mbox{\hyperlink{namespace_control_logic_a9a6c6bb73ae52885ddaa5ec56d8603f9}{PULL\_voltage\_up}})\ \mbox{\hyperlink{namespace_control_logic_a87d54195660d73ebcd372cad0fd74915}{MC\_PULL\_stu}}[i]\ =\ 1;}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a14f470efe568bae229e028e1b1acd54f}{MC\_PULL\_stu\_raw}}[i]\ <\ \mbox{\hyperlink{namespace_control_logic_a73b9466c4e3c236a186659863283f00e}{PULL\_voltage\_down}})\ \mbox{\hyperlink{namespace_control_logic_a87d54195660d73ebcd372cad0fd74915}{MC\_PULL\_stu}}[i]\ =\ -\/1;}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \mbox{\hyperlink{namespace_control_logic_a87d54195660d73ebcd372cad0fd74915}{MC\_PULL\_stu}}[i]\ =\ 0;}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a8abb9a7c0790b08a5e5f31c8874bb15f}{is\_two}}\ ==\ \textcolor{keyword}{false})\ \{}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_ae2535696ce7487f6ec12d1f2e174e598}{MC\_ONLINE\_key\_stu\_raw}}[i]\ >\ 1.65f)\ \mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[i]\ =\ 1;}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_ae2535696ce7487f6ec12d1f2e174e598}{MC\_ONLINE\_key\_stu\_raw}}[i]\ <\ 1.55f)\ \mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[i]\ =\ 0;}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_ae2535696ce7487f6ec12d1f2e174e598}{MC\_ONLINE\_key\_stu\_raw}}[i]\ <\ 0.6f)\ \mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[i]\ =\ 0;}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_ae2535696ce7487f6ec12d1f2e174e598}{MC\_ONLINE\_key\_stu\_raw}}[i]\ <\ 1.4f)\ \mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[i]\ =\ 3;}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_ae2535696ce7487f6ec12d1f2e174e598}{MC\_ONLINE\_key\_stu\_raw}}[i]\ >\ 1.7f)\ \mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[i]\ =\ 1;}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[i]\ =\ 2;}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Sync\ status}}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[i]\ !=\ 0)\ \{}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_af6b0be8daad68d06efd980f1fb68ef72}{filament}}[i].\mbox{\hyperlink{struct_filament_state_a18524f9eb8074bc706971d1d62974179}{status}}\ ==\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a9148fdd6f33c42faedeb9cc1a5520646a27a21354321dfbc28f0cb17b995bb9ca}{AMS\_filament\_status::offline}})\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_af6b0be8daad68d06efd980f1fb68ef72}{filament}}[i].\mbox{\hyperlink{struct_filament_state_a18524f9eb8074bc706971d1d62974179}{status}}\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a9148fdd6f33c42faedeb9cc1a5520646a7f46165474d11ee5836777d85df2cdab}{AMS\_filament\_status::online}};}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_af6b0be8daad68d06efd980f1fb68ef72}{filament}}[i].\mbox{\hyperlink{struct_filament_state_a18524f9eb8074bc706971d1d62974179}{status}}\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a9148fdd6f33c42faedeb9cc1a5520646a27a21354321dfbc28f0cb17b995bb9ca}{AMS\_filament\_status::offline}};}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ pressure\ (voltage\ in\ mV)}}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_af6b0be8daad68d06efd980f1fb68ef72}{filament}}[i].\mbox{\hyperlink{struct_filament_state_a2210f4ad5b00137bf844f1289ee79226}{pressure}}\ =\ (uint16\_t)(\mbox{\hyperlink{namespace_control_logic_a14f470efe568bae229e028e1b1acd54f}{MC\_PULL\_stu\_raw}}[i]\ *\ 1000.0f);}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00280\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_hardware_8cpp_source_l00387}{Hardware\+::\+ADC\+\_\+\+Get\+Values()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00212}{is\+\_\+two}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00208}{MC\+\_\+\+ONLINE\+\_\+key\+\_\+stu}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00207}{MC\+\_\+\+ONLINE\+\_\+key\+\_\+stu\+\_\+raw}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00206}{MC\+\_\+\+PULL\+\_\+stu}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00205}{MC\+\_\+\+PULL\+\_\+stu\+\_\+raw}}, \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00010}{offline}}, \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00011}{online}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00197}{PULL\+\_\+voltage\+\_\+down}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00196}{PULL\+\_\+voltage\+\_\+up}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00904}{Init\+Boot\+Check()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00792}{Run()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_ac2d890c891494072159ebc2b30490197}\index{ControlLogic@{ControlLogic}!motor\_motion\_switch@{motor\_motion\_switch}}
\index{motor\_motion\_switch@{motor\_motion\_switch}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{motor\_motion\_switch()}{motor\_motion\_switch()}}
{\footnotesize\ttfamily \label{namespace_control_logic_ac2d890c891494072159ebc2b30490197} 
void Control\+Logic\+::motor\+\_\+motion\+\_\+switch (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



State Machine for Bambu\+Bus Logic. 

Manages transitions between filament states (Idle, Loading, Unloading, Using, Sending). Implements Load/\+Unload logic completion checks (Pressure/\+Distance). 

Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00962}{962}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00963\ \ \ \ \ \{}
\DoxyCodeLine{00964\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\ =\ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.BambuBus\_now\_filament\_num;\ }
\DoxyCodeLine{00965\ \ \ \ \ \ \ \ \ uint16\_t\ device\_type\ =\ \mbox{\hyperlink{_control_logic_8cpp_a52925c91da70ade3c48b8eb3fe99caf6}{device\_type\_addr}};}
\DoxyCodeLine{00966\ }
\DoxyCodeLine{00967\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ i++)}
\DoxyCodeLine{00968\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00969\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Klipper\ Override:\ Do\ not\ interfere\ if\ we\ are\ in\ velocity\ control\ mode\ OR\ explicit\ auto-\/feed}}
\DoxyCodeLine{00970\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[i].motion\ ==\ \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3}{filament\_motion\_enum::velocity\_control}})\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00971\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[i].motion\ ==\ \mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75}{filament\_motion\_enum::pressure\_ctrl\_in\_use}})\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00972\ }
\DoxyCodeLine{00973\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ !=\ num)}
\DoxyCodeLine{00974\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00975\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[i]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}};}
\DoxyCodeLine{00976\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[i].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c}{filament\_motion\_enum::pressure\_ctrl\_idle}});\ }
\DoxyCodeLine{00977\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00978\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00979\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00980\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Has\ filament\ or\ not,\ we\ check\ for\ overrides\ first}}
\DoxyCodeLine{00981\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[num]\ ==\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2}{filament\_unloading}})\ \{}
\DoxyCodeLine{00982\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ UNLOAD\ LOGIC\ -\/-\/-\/}}
\DoxyCodeLine{00983\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ -\/1,\ we\ wait\ for\ sensor\ to\ clear\ (which\ happens\ in\ MC\_ONLINE\_key\_stu)}}
\DoxyCodeLine{00984\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ sensor\ clear\ (0),\ we\ are\ done.}}
\DoxyCodeLine{00985\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00986\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ done\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00987\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00988\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a11bff287b64c24fe91500ba99c6f21c8}{unload\_target\_dist}}[num]\ ==\ -\/1)\ \{}
\DoxyCodeLine{00989\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Unload\ until\ clear\ (Offline)}}
\DoxyCodeLine{00990\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[num]\ ==\ 0)\ done\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00991\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00992\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Unload\ distance}}
\DoxyCodeLine{00993\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a92f9b1daa685f9041b79423442d440e3}{last\_total\_distance}}[num]\ >=\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{namespace_control_logic_a11bff287b64c24fe91500ba99c6f21c8}{unload\_target\_dist}}[num])\ done\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00994\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00995\ }
\DoxyCodeLine{00996\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00997\ }
\DoxyCodeLine{00998\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (done)\ \{}
\DoxyCodeLine{00999\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[num].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b}{filament\_motion\_enum::stop}});}
\DoxyCodeLine{01000\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[num]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}};}
\DoxyCodeLine{01001\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_aef70a34b1f25019450171bfa5c07ab62}{is\_backing\_out}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01003\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ACK\ Confirmation}}
\DoxyCodeLine{01004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ msg[64];}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a11bff287b64c24fe91500ba99c6f21c8}{unload\_target\_dist}}[num]\ ==\ -\/1)\ sprintf(msg,\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)nUNLOAD\_FILAMENT:\ OK\ (Tray\ \%d,\ Clear)\(\backslash\)r\(\backslash\)n"{}},\ num);}
\DoxyCodeLine{01006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ sprintf(msg,\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)nUNLOAD\_FILAMENT:\ OK\ (Tray\ \%d,\ Dist)\(\backslash\)r\(\backslash\)n"{}},\ num);}
\DoxyCodeLine{01007\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_ad3ec7cad074d6d73508844a06a7bea50}{Hardware::UART\_Send}}((\textcolor{keyword}{const}\ uint8\_t*)msg,\ strlen(msg));}
\DoxyCodeLine{01008\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Done}}
\DoxyCodeLine{01009\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01010\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01011\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ IF\ NOT\ DONE,\ we\ just\ return\ to\ keep\ pulling?}}
\DoxyCodeLine{01012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ ensure\ we\ don't\ fall\ through\ to\ other\ logic.}}
\DoxyCodeLine{01013\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ But\ if\ sensor\ clears,\ done\ becomes\ true\ above.}}
\DoxyCodeLine{01014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ sensor\ is\ still\ 1,\ we\ return\ here\ to\ avoid\ "{}in\_use"{}\ logic\ interfering.}}
\DoxyCodeLine{01015\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ }
\DoxyCodeLine{01016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01017\ }
\DoxyCodeLine{01018\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[num]\ ==\ 1\ ||\ \mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[num]\ ==\ 3)\ \textcolor{comment}{//\ Has\ filament}}
\DoxyCodeLine{01019\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01020\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695}{AMS\_filament\_motion}}\ current\_motion\ =\ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_af6b0be8daad68d06efd980f1fb68ef72}{filament}}[num].\mbox{\hyperlink{struct_filament_state_a183761f2029f1dfed9c1a9f56426d030}{motion\_set}};}
\DoxyCodeLine{01021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01022\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ LOAD\ FILAMENT\ OVERRIDE\ -\/-\/-\/}}
\DoxyCodeLine{01023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[num]\ ==\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22}{filament\_loading}})\ \{}
\DoxyCodeLine{01024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ pressure\ =\ \mbox{\hyperlink{namespace_control_logic_a14f470efe568bae229e028e1b1acd54f}{MC\_PULL\_stu\_raw}}[num];}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01026\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Temporary\ Debug}}
\DoxyCodeLine{01027\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ uint64\_t\ last\_dbg\ =\ 0;}
\DoxyCodeLine{01028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_hardware_a8ea28b07408691bc126683a81aa220f3}{Hardware::GetTime}}()\ -\/\ last\_dbg\ >\ 500)\ \{}
\DoxyCodeLine{01029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ d[64];\ sprintf(d,\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)nLOAD\ P\%d\(\backslash\)r\(\backslash\)n"{}},\ num);}
\DoxyCodeLine{01030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_ad3ec7cad074d6d73508844a06a7bea50}{Hardware::UART\_Send}}((\textcolor{keyword}{const}\ uint8\_t*)d,\ strlen(d));}
\DoxyCodeLine{01031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ last\_dbg\ =\ \mbox{\hyperlink{namespace_hardware_a8ea28b07408691bc126683a81aa220f3}{Hardware::GetTime}}();}
\DoxyCodeLine{01032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ dist\_done\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a11bff287b64c24fe91500ba99c6f21c8}{unload\_target\_dist}}[num]\ >\ 0)\ \{\ \textcolor{comment}{//\ Using\ this\ var\ for\ load\ len\ too}}
\DoxyCodeLine{01036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a92f9b1daa685f9041b79423442d440e3}{last\_total\_distance}}[num]\ >=\ (\textcolor{keywordtype}{float})\mbox{\hyperlink{namespace_control_logic_a11bff287b64c24fe91500ba99c6f21c8}{unload\_target\_dist}}[num])\ \{}
\DoxyCodeLine{01037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dist\_done\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01040\ }
\DoxyCodeLine{01041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pressure\ >\ \mbox{\hyperlink{namespace_control_logic_a9a6c6bb73ae52885ddaa5ec56d8603f9}{PULL\_voltage\_up}})\ \{}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Upper\ Limit\ Reached\ -\/>\ Success\ (Reached\ Toolhead?)}}
\DoxyCodeLine{01043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[num]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f}{filament\_using}};}
\DoxyCodeLine{01044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a33f7ccbf87b78ae7394f88ffe1a4a75e}{pull\_state\_old}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ Set\ for\ pressure\_ctrl}}
\DoxyCodeLine{01045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[num].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75}{filament\_motion\_enum::pressure\_ctrl\_in\_use}});}
\DoxyCodeLine{01046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ACK\ Confirmation}}
\DoxyCodeLine{01048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ msg[64];}
\DoxyCodeLine{01049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sprintf(msg,\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)nLOAD\_FILAMENT:\ OK\ (Tray\ \%d,\ Pressure)\(\backslash\)r\(\backslash\)n"{}},\ num);}
\DoxyCodeLine{01050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_ad3ec7cad074d6d73508844a06a7bea50}{Hardware::UART\_Send}}((\textcolor{keyword}{const}\ uint8\_t*)msg,\ strlen(msg));}
\DoxyCodeLine{01051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ }
\DoxyCodeLine{01052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (dist\_done)\ \{}
\DoxyCodeLine{01053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Distance\ Reached\ -\/>\ Done\ (Feed\ operation\ complete)}}
\DoxyCodeLine{01054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Should\ we\ go\ to\ IDLE?\ Or\ USING?\ }}
\DoxyCodeLine{01055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Plan\ said\ IDLE\ if\ distance\ reached\ without\ pressure.}}
\DoxyCodeLine{01056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[num]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}};}
\DoxyCodeLine{01057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[num].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c}{filament\_motion\_enum::pressure\_ctrl\_idle}});}
\DoxyCodeLine{01058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_aef70a34b1f25019450171bfa5c07ab62}{is\_backing\_out}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Stop\ tracking}}
\DoxyCodeLine{01059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ACK\ Confirmation}}
\DoxyCodeLine{01061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ msg[64];}
\DoxyCodeLine{01062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sprintf(msg,\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)nLOAD\_FILAMENT:\ OK\ (Tray\ \%d,\ Dist)\(\backslash\)r\(\backslash\)n"{}},\ num);}
\DoxyCodeLine{01063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_ad3ec7cad074d6d73508844a06a7bea50}{Hardware::UART\_Send}}((\textcolor{keyword}{const}\ uint8\_t*)msg,\ strlen(msg));}
\DoxyCodeLine{01064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (pressure\ >\ 1.70f)\ \{\ }
\DoxyCodeLine{01066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pressure\ starting\ to\ change/limit\ approaching\ (1.85V\ Max)\ -\/\ Slow\ Down}}
\DoxyCodeLine{01067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[num].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8}{filament\_motion\_enum::slow\_send}});}
\DoxyCodeLine{01068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \ }
\DoxyCodeLine{01069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Regular\ Feed}}
\DoxyCodeLine{01071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[num].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890}{filament\_motion\_enum::send}});}
\DoxyCodeLine{01072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Skip\ standard\ switch}}
\DoxyCodeLine{01074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (current\_motion)\ }
\DoxyCodeLine{01077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695a3a05a41f36f9cb89bd92231a31cbe492}{AMS\_filament\_motion::need\_send\_out}}:\ }
\DoxyCodeLine{01079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_a44347f62b4ee1789ecfed67b195572e4}{Hardware::LED\_SetColor}}(num,\ 0,\ 0,\ 255,\ 0);\ }
\DoxyCodeLine{01080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[num]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f}{filament\_sending\_out}};}
\DoxyCodeLine{01081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[num].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890}{filament\_motion\_enum::send}});}
\DoxyCodeLine{01082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695a4d8b2afa72d93ce2db8ae49c464cab22}{AMS\_filament\_motion::need\_pull\_back}}:}
\DoxyCodeLine{01085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a33f7ccbf87b78ae7394f88ffe1a4a75e}{pull\_state\_old}}\ =\ \textcolor{keyword}{false};\ }
\DoxyCodeLine{01086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_aef70a34b1f25019450171bfa5c07ab62}{is\_backing\_out}}\ =\ \textcolor{keyword}{true};\ }
\DoxyCodeLine{01087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[num]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049}{filament\_pulling\_back}};}
\DoxyCodeLine{01088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (device\_type\ ==\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a955491d79368cb27f0ba2ab28aba5701a8a4e12e61e7479dc0cc80b06558faac3}{BambuBus\_AMS\_lite}})\ \{}
\DoxyCodeLine{01089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[num].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0}{filament\_motion\_enum::pull}});}
\DoxyCodeLine{01090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695affe509f9c202af4bde1fa8c91f084a3e}{AMS\_filament\_motion::before\_pull\_back}}:}
\DoxyCodeLine{01094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695a98b23b2fb5bb3781d8bd041e8ff6e5e3}{AMS\_filament\_motion::in\_use}}:}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ uint64\_t\ time\_end\ =\ 0;}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ time\_now\ =\ \mbox{\hyperlink{namespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c}{get\_time64}}();}
\DoxyCodeLine{01098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[num]\ ==\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f}{filament\_sending\_out}})\ }
\DoxyCodeLine{01100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_aef70a34b1f25019450171bfa5c07ab62}{is\_backing\_out}}\ =\ \textcolor{keyword}{false};\ }
\DoxyCodeLine{01102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a33f7ccbf87b78ae7394f88ffe1a4a75e}{pull\_state\_old}}\ =\ \textcolor{keyword}{true};\ }
\DoxyCodeLine{01103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[num]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f}{filament\_using}};\ }
\DoxyCodeLine{01104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ time\_end\ =\ time\_now\ +\ 1500;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[num]\ ==\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f}{filament\_using}})\ }
\DoxyCodeLine{01107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a92f9b1daa685f9041b79423442d440e3}{last\_total\_distance}}[i]\ =\ 0;\ }
\DoxyCodeLine{01109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (time\_now\ >\ time\_end)}
\DoxyCodeLine{01110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_a44347f62b4ee1789ecfed67b195572e4}{Hardware::LED\_SetColor}}(num,\ 0,\ 255,\ 255,\ 255);}
\DoxyCodeLine{01112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[num].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75}{filament\_motion\_enum::pressure\_ctrl\_in\_use}});}
\DoxyCodeLine{01113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_a44347f62b4ee1789ecfed67b195572e4}{Hardware::LED\_SetColor}}(num,\ 0,\ 128,\ 192,\ 128);\ \ \ \ \ \ \ }
\DoxyCodeLine{01117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[num].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8}{filament\_motion\_enum::slow\_send}});\ }
\DoxyCodeLine{01118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb}{AMS\_filament\_motion::idle}}:}
\DoxyCodeLine{01123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[num]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}};}
\DoxyCodeLine{01124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[num].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c}{filament\_motion\_enum::pressure\_ctrl\_idle}});}
\DoxyCodeLine{01125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ 4;\ j++)}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[j]\ ==\ 1\ ||\ \mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[j]\ ==\ 0)\ \{\ \ \ }
\DoxyCodeLine{01128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_a44347f62b4ee1789ecfed67b195572e4}{Hardware::LED\_SetColor}}(j,\ 0,\ 0,\ 0,\ 255);\ \textcolor{comment}{//\ Blue}}
\DoxyCodeLine{01129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[j]\ ==\ 2)\ \{\ \ \ }
\DoxyCodeLine{01130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_a44347f62b4ee1789ecfed67b195572e4}{Hardware::LED\_SetColor}}(j,\ 0,\ 255,\ 144,\ 0);\ \textcolor{comment}{//\ Orange}}
\DoxyCodeLine{01131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[j]\ ==\ 3)\ \{\ \ \ }
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_a44347f62b4ee1789ecfed67b195572e4}{Hardware::LED\_SetColor}}(j,\ 0,\ 0,\ 255,\ 255);\ \textcolor{comment}{//\ Cyan}}
\DoxyCodeLine{01133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}{MC\_ONLINE\_key\_stu}}[num]\ ==\ 0)\ \textcolor{comment}{//\ No\ filament}}
\DoxyCodeLine{01139\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[num]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}};}
\DoxyCodeLine{01141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[num].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c}{filament\_motion\_enum::pressure\_ctrl\_idle}});}
\DoxyCodeLine{01142\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01143\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ Close\ the\ Main\ Else}}
\DoxyCodeLine{01144\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01145\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00048}{Bambu\+Bus\+\_\+\+AMS\+\_\+lite}}, \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00017}{before\+\_\+pull\+\_\+back}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00038}{device\+\_\+type\+\_\+addr}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00172}{filament\+\_\+idle}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00177}{filament\+\_\+loading}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00220}{filament\+\_\+now\+\_\+position}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00175}{filament\+\_\+pulling\+\_\+back}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00173}{filament\+\_\+sending\+\_\+out}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00178}{filament\+\_\+unloading}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00174}{filament\+\_\+using}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00227}{get\+\_\+time64()}}, \mbox{\hyperlink{_hardware_8cpp_source_l00115}{Hardware\+::\+Get\+Time()}}, \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00021}{idle}}, \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00020}{in\+\_\+use}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00211}{is\+\_\+backing\+\_\+out}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00035}{last\+\_\+total\+\_\+distance}}, \mbox{\hyperlink{_hardware_8cpp_source_l00530}{Hardware\+::\+LED\+\_\+\+Set\+Color()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00208}{MC\+\_\+\+ONLINE\+\_\+key\+\_\+stu}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00205}{MC\+\_\+\+PULL\+\_\+stu\+\_\+raw}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00517}{motors}}, \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00018}{need\+\_\+pull\+\_\+back}}, \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00019}{need\+\_\+send\+\_\+out}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00187}{pressure\+\_\+ctrl\+\_\+idle}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00188}{pressure\+\_\+ctrl\+\_\+in\+\_\+use}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00185}{pull}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00210}{pull\+\_\+state\+\_\+old}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00196}{PULL\+\_\+voltage\+\_\+up}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00184}{send}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00186}{slow\+\_\+send}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00183}{stop}}, \mbox{\hyperlink{_hardware_8cpp_source_l00261}{Hardware\+::\+UART\+\_\+\+Send()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00216}{unload\+\_\+target\+\_\+dist}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00190}{velocity\+\_\+control}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00792}{Run()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_ac2d890c891494072159ebc2b30490197_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_ac2d890c891494072159ebc2b30490197_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a484eadc314267f8bc9aa0f025c1137d9}\index{ControlLogic@{ControlLogic}!MoveAxis@{MoveAxis}}
\index{MoveAxis@{MoveAxis}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{MoveAxis()}{MoveAxis()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a484eadc314267f8bc9aa0f025c1137d9} 
void Control\+Logic\+::\+Move\+Axis (\begin{DoxyParamCaption}\item[{int}]{axis}{, }\item[{float}]{dist\+\_\+mm}{, }\item[{float}]{speed}{}\end{DoxyParamCaption})}



Manually move an axis (Klipper Primitive). 

Uses Velocity Control mode to move a specific distance at a specific speed.


\begin{DoxyParams}{Parameters}
{\em axis} & Axis index (0-\/3). \\
\hline
{\em dist\+\_\+mm} & Distance to move (positive). \\
\hline
{\em speed} & Speed in mm/s. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00616}{616}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(axis\ <\ 0\ ||\ axis\ >=\ 4)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Use\ Velocity\ Control}}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[axis].target\_velocity\ =\ speed;}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[axis].target\_distance\ =\ fabs(dist\_mm);\ \textcolor{comment}{//\ Ensure\ positive}}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[axis].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3}{filament\_motion\_enum::velocity\_control}});}
\DoxyCodeLine{00623\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00517}{motors}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00190}{velocity\+\_\+control}}.



Referenced by \mbox{\hyperlink{_klipper_c_l_i_8cpp_source_l00208}{Klipper\+CLI\+::\+Handle\+Move()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a484eadc314267f8bc9aa0f025c1137d9_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_acb78560c64e5ea050853ab319a03f14e}\index{ControlLogic@{ControlLogic}!Prepare\_For\_filament\_Pull\_Back@{Prepare\_For\_filament\_Pull\_Back}}
\index{Prepare\_For\_filament\_Pull\_Back@{Prepare\_For\_filament\_Pull\_Back}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{Prepare\_For\_filament\_Pull\_Back()}{Prepare\_For\_filament\_Pull\_Back()}}
{\footnotesize\ttfamily \label{namespace_control_logic_acb78560c64e5ea050853ab319a03f14e} 
bool Control\+Logic\+::\+Prepare\+\_\+\+For\+\_\+filament\+\_\+\+Pull\+\_\+\+Back (\begin{DoxyParamCaption}\item[{float\+\_\+t}]{OUT\+\_\+filament\+\_\+meters}{}\end{DoxyParamCaption})}



Check if pullback is required (Smart Pullback Logic). 

If a lane is in {\ttfamily \doxylink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049}{filament\+\_\+pulling\+\_\+back}} state, this checks if it has reached the target distance ({\ttfamily OUT\+\_\+filament\+\_\+meters}). Stops it if so.


\begin{DoxyParams}{Parameters}
{\em OUT\+\_\+filament\+\_\+meters} & Target distance. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true If any lane is actively pulling back. 

false If no lanes are pulling back. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00751}{751}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00752\ \ \ \ \ \{}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ wait\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ i++)}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[i]\ ==\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049}{filament\_pulling\_back}})}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a92f9b1daa685f9041b79423442d440e3}{last\_total\_distance}}[i]\ <\ OUT\_filament\_meters)}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[i].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0}{filament\_motion\_enum::pull}});}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ npercent\ =\ (\mbox{\hyperlink{_control_logic_8cpp_a92f9b1daa685f9041b79423442d440e3}{last\_total\_distance}}[i]\ /\ OUT\_filament\_meters)\ *\ 100.0f;}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ r\ =\ 255\ -\/\ ((255\ /\ 100)\ *\ npercent);}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ g\ =\ 125\ -\/\ ((125\ /\ 100)\ *\ npercent);}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ b\ =\ (255\ /\ 100)\ *\ npercent;}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(r<0)\ r=0;\ }
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(g<0)\ g=0;\ }
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(b<0)\ b=0;}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_a44347f62b4ee1789ecfed67b195572e4}{Hardware::LED\_SetColor}}(i,\ 0,\ r,\ g,\ b);}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_aef70a34b1f25019450171bfa5c07ab62}{is\_backing\_out}}\ =\ \textcolor{keyword}{false};\ }
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[i].\mbox{\hyperlink{class_control_logic_1_1_motor_channel_a0b8ed284da431b3325320e709433a454}{SetMotion}}(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b}{filament\_motion\_enum::stop}});}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[i]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.filament[i].motion\_set\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb}{AMS\_filament\_motion::idle}};}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a92f9b1daa685f9041b79423442d440e3}{last\_total\_distance}}[i]\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ wait\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ wait;}
\DoxyCodeLine{00783\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00172}{filament\+\_\+idle}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00220}{filament\+\_\+now\+\_\+position}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00175}{filament\+\_\+pulling\+\_\+back}}, \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00021}{idle}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00211}{is\+\_\+backing\+\_\+out}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00035}{last\+\_\+total\+\_\+distance}}, \mbox{\hyperlink{_hardware_8cpp_source_l00530}{Hardware\+::\+LED\+\_\+\+Set\+Color()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00517}{motors}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00185}{pull}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00183}{stop}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00792}{Run()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_acb78560c64e5ea050853ab319a03f14e_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_acb78560c64e5ea050853ab319a03f14e_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a0c4206af909c8128bc68eb6a1bcfa16e}\index{ControlLogic@{ControlLogic}!ProcessHeartbeat@{ProcessHeartbeat}}
\index{ProcessHeartbeat@{ProcessHeartbeat}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{ProcessHeartbeat()}{ProcessHeartbeat()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a0c4206af909c8128bc68eb6a1bcfa16e} 
void Control\+Logic\+::\+Process\+Heartbeat (\begin{DoxyParamCaption}\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{buffer}{, }\item[{uint16\+\_\+t}]{length}{}\end{DoxyParamCaption})}



Handler for Heartbeat (0x20). 

Updates connectivity timestamp. 

Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l01355}{1355}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01356\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a9716be5fe9da72481bee41a80681d8e5}{UpdateConnectivity}}(\textcolor{keyword}{true});}
\DoxyCodeLine{01357\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00948}{Update\+Connectivity()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a0c4206af909c8128bc68eb6a1bcfa16e_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a1ff0bcee8062346fb963e4dd845c8bdf}\index{ControlLogic@{ControlLogic}!ProcessLongPacket@{ProcessLongPacket}}
\index{ProcessLongPacket@{ProcessLongPacket}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{ProcessLongPacket()}{ProcessLongPacket()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a1ff0bcee8062346fb963e4dd845c8bdf} 
void Control\+Logic\+::\+Process\+Long\+Packet (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structlong__packge__data}{long\+\_\+packge\+\_\+data}} \&}]{data}{}\end{DoxyParamCaption})}



Handler/\+Dispatcher for Long Packets. 

Processes parsed long packets based on their type (0x211, 0x218, 0x103, etc.).


\begin{DoxyParams}{Parameters}
{\em data} & Reference to parsed {\ttfamily \doxylink{structlong__packge__data}{long\+\_\+packge\+\_\+data}}. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l01435}{1435}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01435\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01436\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ switch\ data.type...}}
\DoxyCodeLine{01437\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 0x211\ Read\ Filament\ -\/>\ Send\ Response}}
\DoxyCodeLine{01438\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 0x218\ Set\ Filament\ -\/>\ Update\ \&\ Send\ ACK}}
\DoxyCodeLine{01439\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 0x103\ Version\ -\/>\ Send\ Response}}
\DoxyCodeLine{01440\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01441\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ function\ executes\ the\ Logic\ for\ Long\ Packets.}}
\DoxyCodeLine{01442\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ uses\ "{}SendPacket"{}\ to\ send\ replies.}}
\DoxyCodeLine{01443\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01444\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Implementation\ omitted\ for\ brevity\ but\ should\ be\ here.}}
\DoxyCodeLine{01445\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ...}}
\DoxyCodeLine{01446\ \ \ \ \ \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{_command_router_8cpp_source_l00061}{Command\+Router\+::\+Handle\+Long\+Packet()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a1ff0bcee8062346fb963e4dd845c8bdf_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a2ab840bfd454a7709553b89529285b74}\index{ControlLogic@{ControlLogic}!ProcessMotionLong@{ProcessMotionLong}}
\index{ProcessMotionLong@{ProcessMotionLong}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{ProcessMotionLong()}{ProcessMotionLong()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a2ab840bfd454a7709553b89529285b74} 
void Control\+Logic\+::\+Process\+Motion\+Long (\begin{DoxyParamCaption}\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{buffer}{, }\item[{uint16\+\_\+t}]{length}{}\end{DoxyParamCaption})}



Handler for Filament Motion Long packet (0x04). 

\begin{DoxyNote}{Note}
Currently a placeholder. 
\end{DoxyNote}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l01302}{1302}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01303\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Just\ forward\ for\ now\ or\ implement\ logic\ if\ found}}
\DoxyCodeLine{01304\ \ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{namespace_control_logic_aa490d28f0823086ff5e1e97451425dc7}\index{ControlLogic@{ControlLogic}!ProcessMotionLongLogic@{ProcessMotionLongLogic}}
\index{ProcessMotionLongLogic@{ProcessMotionLongLogic}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{ProcessMotionLongLogic()}{ProcessMotionLongLogic()}}
{\footnotesize\ttfamily \label{namespace_control_logic_aa490d28f0823086ff5e1e97451425dc7} 
void Control\+Logic\+::\+Process\+Motion\+Long\+Logic (\begin{DoxyParamCaption}\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{payload}{, }\item[{uint16\+\_\+t}]{length}{}\end{DoxyParamCaption})}

\Hypertarget{namespace_control_logic_a5f85db884abd1a66d8b120729ec0d99e}\index{ControlLogic@{ControlLogic}!ProcessMotionShort@{ProcessMotionShort}}
\index{ProcessMotionShort@{ProcessMotionShort}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{ProcessMotionShort()}{ProcessMotionShort()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a5f85db884abd1a66d8b120729ec0d99e} 
void Control\+Logic\+::\+Process\+Motion\+Short (\begin{DoxyParamCaption}\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{buffer}{, }\item[{uint16\+\_\+t}]{length}{}\end{DoxyParamCaption})}



Handler for Filament Motion Short packet (0x03). 

Extracts arguments from the buffer and calls {\ttfamily \doxylink{namespace_control_logic_a8880b393facb6828519b8dac8e96393c}{Process\+Motion\+Short\+Logic}}. 

Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l01285}{1285}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01286\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (length\ <\ 9)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01287\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Parse\ Args}}
\DoxyCodeLine{01288\ \ \ \ \ \ \ \ \ uint8\_t\ ams\_num\ =\ buffer[5];}
\DoxyCodeLine{01289\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ams\_num\ !=\ 0)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01290\ \ \ \ \ \ \ \ \ uint8\_t\ statu\_flags\ =\ buffer[6];}
\DoxyCodeLine{01291\ \ \ \ \ \ \ \ \ uint8\_t\ read\_num\ =\ buffer[7];}
\DoxyCodeLine{01292\ \ \ \ \ \ \ \ \ uint8\_t\ motion\_flag\ =\ buffer[8];}
\DoxyCodeLine{01293\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01294\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a8880b393facb6828519b8dac8e96393c}{ProcessMotionShortLogic}}(ams\_num,\ statu\_flags,\ read\_num,\ motion\_flag);}
\DoxyCodeLine{01295\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l01160}{Process\+Motion\+Short\+Logic()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a5f85db884abd1a66d8b120729ec0d99e_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a8880b393facb6828519b8dac8e96393c}\index{ControlLogic@{ControlLogic}!ProcessMotionShortLogic@{ProcessMotionShortLogic}}
\index{ProcessMotionShortLogic@{ProcessMotionShortLogic}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{ProcessMotionShortLogic()}{ProcessMotionShortLogic()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a8880b393facb6828519b8dac8e96393c} 
void Control\+Logic\+::\+Process\+Motion\+Short\+Logic (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{ams\+\_\+num}{, }\item[{uint8\+\_\+t}]{statu\+\_\+flags}{, }\item[{uint8\+\_\+t}]{read\+\_\+num}{, }\item[{uint8\+\_\+t}]{fliment\+\_\+motion\+\_\+flag}{}\end{DoxyParamCaption})}



Core logic for processing Short Motion packets. 

Handles state transitions based on status flags received from the printer. Updates filament meter usage, pressure status, and responds with the current status.


\begin{DoxyParams}{Parameters}
{\em ams\+\_\+num} & AMS Unit ID (0-\/3). \\
\hline
{\em statu\+\_\+flags} & Status bitmask. \\
\hline
{\em read\+\_\+num} & Filament/\+Tray index interacting. \\
\hline
{\em fliment\+\_\+motion\+\_\+flag} & Motion control flags. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l01160}{1160}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01161\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Core\ Logic\ from\ ProcessMotionShort}}
\DoxyCodeLine{01162\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01163\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ uint64\_t\ time\_last\ =\ 0;}
\DoxyCodeLine{01164\ \ \ \ \ \ \ \ \ uint64\_t\ time\_now\ =\ \mbox{\hyperlink{namespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c}{get\_time64}}();}
\DoxyCodeLine{01165\ \ \ \ \ \ \ \ \ uint64\_t\ time\_used\ =\ time\_now\ -\/\ time\_last;}
\DoxyCodeLine{01166\ \ \ \ \ \ \ \ \ time\_last\ =\ time\_now;}
\DoxyCodeLine{01167\ }
\DoxyCodeLine{01168\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a52925c91da70ade3c48b8eb3fe99caf6}{device\_type\_addr}}\ ==\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a955491d79368cb27f0ba2ab28aba5701a1468bae394016b2d3dd75dea179a6578}{BambuBus\_AMS}})\ \{\ \textcolor{comment}{//\ AMS08}}
\DoxyCodeLine{01169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (read\_num\ <\ 4)\ \{}
\DoxyCodeLine{01170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_filament_state}{FilamentState}}\ \&f\ =\ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.filament[read\_num];}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((statu\_flags\ ==\ 0x03)\ \&\&\ (fliment\_motion\_flag\ ==\ 0x00))\ \{\ \textcolor{comment}{//\ 03\ 00}}
\DoxyCodeLine{01173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.BambuBus\_now\_filament\_num\ !=\ read\_num)\ \{}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.BambuBus\_now\_filament\_num\ <\ 4)\ \{}
\DoxyCodeLine{01175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.filament[\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.BambuBus\_now\_filament\_num].motion\_set\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb}{AMS\_filament\_motion::idle}};}
\DoxyCodeLine{01176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.filament\_use\_flag\ =\ 0x00;}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.filament[\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.BambuBus\_now\_filament\_num].pressure\ =\ 0xFFFF;}
\DoxyCodeLine{01178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.BambuBus\_now\_filament\_num\ =\ read\_num;}
\DoxyCodeLine{01180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.\mbox{\hyperlink{struct_filament_state_a183761f2029f1dfed9c1a9f56426d030}{motion\_set}}\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695a3a05a41f36f9cb89bd92231a31cbe492}{AMS\_filament\_motion::need\_send\_out}};}
\DoxyCodeLine{01182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_a921a5777c50455edf8775c22430bcfa3}{filament\_use\_flag}}\ =\ 0x02;}
\DoxyCodeLine{01183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.\mbox{\hyperlink{struct_filament_state_a2210f4ad5b00137bf844f1289ee79226}{pressure}}\ =\ 0x4700;}
\DoxyCodeLine{01184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (statu\_flags\ ==\ 0x09)\ \{\ \textcolor{comment}{//\ 09\ A5\ /\ 09\ 3F}}
\DoxyCodeLine{01186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (f.\mbox{\hyperlink{struct_filament_state_a183761f2029f1dfed9c1a9f56426d030}{motion\_set}}\ ==\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695a3a05a41f36f9cb89bd92231a31cbe492}{AMS\_filament\_motion::need\_send\_out}})\ \{}
\DoxyCodeLine{01187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.\mbox{\hyperlink{struct_filament_state_a183761f2029f1dfed9c1a9f56426d030}{motion\_set}}\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695a98b23b2fb5bb3781d8bd041e8ff6e5e3}{AMS\_filament\_motion::in\_use}};}
\DoxyCodeLine{01188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_a921a5777c50455edf8775c22430bcfa3}{filament\_use\_flag}}\ =\ 0x04;}
\DoxyCodeLine{01189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.\mbox{\hyperlink{struct_filament_state_a3a223cbec99bcd0f6c113bbd073df9fe}{meters\_virtual\_count}}\ =\ 0;}
\DoxyCodeLine{01190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (f.\mbox{\hyperlink{struct_filament_state_a3a223cbec99bcd0f6c113bbd073df9fe}{meters\_virtual\_count}}\ <\ 10000)\ \{\ }
\DoxyCodeLine{01192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.\mbox{\hyperlink{struct_filament_state_aabba44628ec691809d7b13b94b8a507e}{meters}}\ +=\ (float)time\_used\ /\ 300000;\ }
\DoxyCodeLine{01193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.\mbox{\hyperlink{struct_filament_state_a3a223cbec99bcd0f6c113bbd073df9fe}{meters\_virtual\_count}}\ +=\ time\_used;}
\DoxyCodeLine{01194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.\mbox{\hyperlink{struct_filament_state_a2210f4ad5b00137bf844f1289ee79226}{pressure}}\ =\ 0x2B00;}
\DoxyCodeLine{01196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((statu\_flags\ ==\ 0x07)\ \&\&\ (fliment\_motion\_flag\ ==\ 0x7F))\ \{\ \textcolor{comment}{//\ 07\ 7F}}
\DoxyCodeLine{01198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.\mbox{\hyperlink{struct_filament_state_a183761f2029f1dfed9c1a9f56426d030}{motion\_set}}\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695a98b23b2fb5bb3781d8bd041e8ff6e5e3}{AMS\_filament\_motion::in\_use}};}
\DoxyCodeLine{01199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_a921a5777c50455edf8775c22430bcfa3}{filament\_use\_flag}}\ =\ 0x04;}
\DoxyCodeLine{01200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.\mbox{\hyperlink{struct_filament_state_a2210f4ad5b00137bf844f1289ee79226}{pressure}}\ =\ 0x2B00;}
\DoxyCodeLine{01201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (read\_num\ ==\ 0xFF)\ \{}
\DoxyCodeLine{01204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((statu\_flags\ ==\ 0x03)\ \&\&\ (fliment\_motion\_flag\ ==\ 0x00))\ \{\ \textcolor{comment}{//\ 03\ 00(FF)}}
\DoxyCodeLine{01205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_ad0e64263f719a9fafab8cd0dc04f4a06}{BambuBus\_now\_filament\_num}}\ <\ 4)\ \{}
\DoxyCodeLine{01206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FilamentState\ \&f\ =\ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_af6b0be8daad68d06efd980f1fb68ef72}{filament}}[\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_ad0e64263f719a9fafab8cd0dc04f4a06}{BambuBus\_now\_filament\_num}}];}
\DoxyCodeLine{01207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (f.\mbox{\hyperlink{struct_filament_state_a183761f2029f1dfed9c1a9f56426d030}{motion\_set}}\ ==\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695a98b23b2fb5bb3781d8bd041e8ff6e5e3}{AMS\_filament\_motion::in\_use}})\ \{}
\DoxyCodeLine{01208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.\mbox{\hyperlink{struct_filament_state_a183761f2029f1dfed9c1a9f56426d030}{motion\_set}}\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695a4d8b2afa72d93ce2db8ae49c464cab22}{AMS\_filament\_motion::need\_pull\_back}};}
\DoxyCodeLine{01209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_a921a5777c50455edf8775c22430bcfa3}{filament\_use\_flag}}\ =\ 0x02;}
\DoxyCodeLine{01210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.\mbox{\hyperlink{struct_filament_state_a2210f4ad5b00137bf844f1289ee79226}{pressure}}\ =\ 0x4700;}
\DoxyCodeLine{01212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<4;\ i++)\ \{}
\DoxyCodeLine{01215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_af6b0be8daad68d06efd980f1fb68ef72}{filament}}[i].\mbox{\hyperlink{struct_filament_state_a183761f2029f1dfed9c1a9f56426d030}{motion\_set}}\ !=\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb}{AMS\_filament\_motion::idle}})\ \{}
\DoxyCodeLine{01216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_af6b0be8daad68d06efd980f1fb68ef72}{filament}}[i].\mbox{\hyperlink{struct_filament_state_a183761f2029f1dfed9c1a9f56426d030}{motion\_set}}\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb}{AMS\_filament\_motion::idle}};}
\DoxyCodeLine{01217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_ad0e64263f719a9fafab8cd0dc04f4a06}{BambuBus\_now\_filament\_num}}\ =\ 0xFF;}
\DoxyCodeLine{01220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_a921a5777c50455edf8775c22430bcfa3}{filament\_use\_flag}}\ =\ 0x00;}
\DoxyCodeLine{01221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01223\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01224\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01225\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Respond}}
\DoxyCodeLine{01226\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ IMPORTANT:\ We\ need\ to\ send\ a\ response.\ The\ response\ format\ handles\ details.}}
\DoxyCodeLine{01227\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ will\ construct\ the\ default\ response\ payload\ here.}}
\DoxyCodeLine{01228\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Or\ call\ utility?}}
\DoxyCodeLine{01229\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01230\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ [PAYLOAD:\ AMS\_NUM(0),\ flags(8),\ filament\_left\_char(1),\ 00,\ 00,\ 00,\ 00,\ 00,\ 00,\ 00]}}
\DoxyCodeLine{01231\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Length\ around\ 10.}}
\DoxyCodeLine{01232\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Helper\ needed.}}
\DoxyCodeLine{01233\ \ \ \ \ \ \ \ \ uint8\_t\ res\_buf[14];}
\DoxyCodeLine{01234\ \ \ \ \ \ \ \ \ memset(res\_buf,\ 0,\ 14);}
\DoxyCodeLine{01235\ \ \ \ \ \ \ \ \ res\_buf[0]\ =\ ams\_num;\ \textcolor{comment}{//\ 0}}
\DoxyCodeLine{01236\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01237\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Byte\ 1:\ Flags\ of\ some\ sort?}}
\DoxyCodeLine{01238\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Original:\ package\_send\_short\ logic\ used\ constant\ array\ C\_test?}}
\DoxyCodeLine{01239\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No,\ C\_test\ was\ \#define.\ }}
\DoxyCodeLine{01240\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ BambuBus.cpp\ logic\ was\ lost\ in\ previous\ turn\ but\ snippet\ in\ ControlLogic.cpp\ showed\ some\ logic.}}
\DoxyCodeLine{01241\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Let's\ assume\ response\ is\ simple\ status.}}
\DoxyCodeLine{01242\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01243\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Byte\ 1:\ 0x80\ |\ (0x4\ if\ data\_save.filament\_use\_flag\ \&\ 0x02?)\ }}
\DoxyCodeLine{01244\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Let's\ simplified\ response\ based\ on\ observation:}}
\DoxyCodeLine{01245\ \ \ \ \ \ \ \ \ res\_buf[1]\ =\ 0x80;}
\DoxyCodeLine{01246\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_a921a5777c50455edf8775c22430bcfa3}{filament\_use\_flag}}\ \&\ 0x02)\ res\_buf[1]\ |=\ 0x04;}
\DoxyCodeLine{01247\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01248\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Byte\ 2:\ Filament\ Left\ Char\ (Bitmask)}}
\DoxyCodeLine{01249\ \ \ \ \ \ \ \ \ uint8\_t\ filament\_left\ =\ 0;}
\DoxyCodeLine{01250\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ i++)\ \{}
\DoxyCodeLine{01251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_af6b0be8daad68d06efd980f1fb68ef72}{filament}}[i].\mbox{\hyperlink{struct_filament_state_a18524f9eb8074bc706971d1d62974179}{status}}\ ==\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a9148fdd6f33c42faedeb9cc1a5520646a7f46165474d11ee5836777d85df2cdab}{AMS\_filament\_status::online}})\ \{}
\DoxyCodeLine{01252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ filament\_left\ |=\ (0x1\ <<\ (2*i));}
\DoxyCodeLine{01253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a52925c91da70ade3c48b8eb3fe99caf6}{device\_type\_addr}}\ ==\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a955491d79368cb27f0ba2ab28aba5701a1468bae394016b2d3dd75dea179a6578}{BambuBus\_AMS}})\ \{}
\DoxyCodeLine{01254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_af6b0be8daad68d06efd980f1fb68ef72}{filament}}[i].\mbox{\hyperlink{struct_filament_state_a183761f2029f1dfed9c1a9f56426d030}{motion\_set}}\ !=\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb}{AMS\_filament\_motion::idle}})\ \{}
\DoxyCodeLine{01255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ filament\_left\ |=\ (0x2\ <<\ (2*i));}
\DoxyCodeLine{01256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01259\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01260\ \ \ \ \ \ \ \ \ res\_buf[2]\ =\ filament\_left;}
\DoxyCodeLine{01261\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01262\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Send\ Packet\ Wrapper}}
\DoxyCodeLine{01263\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ a\ way\ to\ send\ the\ packet.}}
\DoxyCodeLine{01264\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ a\ buffer\ for\ CommandRouter::SendPacket}}
\DoxyCodeLine{01265\ \ \ \ \ \ \ \ \ uint8\_t\ packet[32];}
\DoxyCodeLine{01266\ \ \ \ \ \ \ \ \ packet[0]\ =\ 0x3D;\ packet[1]\ =\ 0xC5;}
\DoxyCodeLine{01267\ \ \ \ \ \ \ \ \ packet[4]\ =\ 0x03;\ \textcolor{comment}{//\ CMD\ (Echoing\ command\ type?\ Or\ Res\ type?)}}
\DoxyCodeLine{01268\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ Request\ was\ 0x03,\ Response\ is\ 0x03?\ Check\ logs.}}
\DoxyCodeLine{01269\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Usually\ Motion\ Short\ response\ is\ same\ Command\ ID\ with\ different\ data.}}
\DoxyCodeLine{01270\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01271\ \ \ \ \ \ \ \ \ packet[2]\ =\ 10\ +\ 5;\ \textcolor{comment}{//\ LEN}}
\DoxyCodeLine{01272\ \ \ \ \ \ \ \ \ memcpy(packet+5,\ res\_buf,\ 10);}
\DoxyCodeLine{01273\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01274\ \ \ \ \ \ \ \ \ uint16\_t\ len\ =\ 15;}
\DoxyCodeLine{01275\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_bambu_bus_protocol_af9d11bc755538718e6ba8fbc5c8e9187}{BambuBusProtocol::BuildPacketWithCRC}}(packet,\ len);}
\DoxyCodeLine{01276\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_command_router_a1cf14aabb538f71f140e6b1aa7ef965d}{CommandRouter::SendPacket}}(packet,\ len);}
\DoxyCodeLine{01277\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00047}{Bambu\+Bus\+\_\+\+AMS}}, \mbox{\hyperlink{_bambu_bus_protocol_8cpp_source_l00231}{Bambu\+Bus\+Protocol\+::\+Build\+Packet\+With\+CRC()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00038}{device\+\_\+type\+\_\+addr}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00227}{get\+\_\+time64()}}, \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00021}{idle}}, \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00020}{in\+\_\+use}}, \mbox{\hyperlink{_unit_state_8h_source_l00047}{Filament\+State\+::meters}}, \mbox{\hyperlink{_unit_state_8h_source_l00048}{Filament\+State\+::meters\+\_\+virtual\+\_\+count}}, \mbox{\hyperlink{_unit_state_8h_source_l00050}{Filament\+State\+::motion\+\_\+set}}, \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00018}{need\+\_\+pull\+\_\+back}}, \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00019}{need\+\_\+send\+\_\+out}}, \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00011}{online}}, \mbox{\hyperlink{_unit_state_8h_source_l00051}{Filament\+State\+::pressure}}, and \mbox{\hyperlink{_command_router_8cpp_source_l00234}{Command\+Router\+::\+Send\+Packet()}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l01285}{Process\+Motion\+Short()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a8880b393facb6828519b8dac8e96393c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a8880b393facb6828519b8dac8e96393c_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a412a7a597ff3c04c0ea1480094600ef4}\index{ControlLogic@{ControlLogic}!ProcessOnlineDetect@{ProcessOnlineDetect}}
\index{ProcessOnlineDetect@{ProcessOnlineDetect}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{ProcessOnlineDetect()}{ProcessOnlineDetect()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a412a7a597ff3c04c0ea1480094600ef4} 
void Control\+Logic\+::\+Process\+Online\+Detect (\begin{DoxyParamCaption}\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{buffer}{, }\item[{uint16\+\_\+t}]{length}{}\end{DoxyParamCaption})}



Handler for Online Detect (0x05). 

Responds with the Online (0x05) packet to announce presence to the printer. 

Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l01311}{1311}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01312\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Respond\ 0x05}}
\DoxyCodeLine{01313\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ uint8\_t\ res[1];\ //\ Unused}}
\DoxyCodeLine{01314\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ res[0]\ =\ 0x00;}}
\DoxyCodeLine{01315\ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01316\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 3D\ C5\ LEN\ CRC8\ CMD(05)\ Payload...}}
\DoxyCodeLine{01317\ \ \ \ \ \ \ \ \ \ uint8\_t\ packet[32];}
\DoxyCodeLine{01318\ \ \ \ \ \ \ \ \ \ packet[0]\ =\ 0x3D;\ packet[1]\ =\ 0xC5;}
\DoxyCodeLine{01319\ \ \ \ \ \ \ \ \ \ packet[4]\ =\ 0x05;}
\DoxyCodeLine{01320\ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01321\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Payload\ currently\ nothing?}}
\DoxyCodeLine{01322\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Original\ code\ sent\ 1\ byte\ payload?}}
\DoxyCodeLine{01323\ \ \ \ \ \ \ \ \ \ packet[5]\ =\ 0x00;\ \textcolor{comment}{//\ AMS\ number?}}
\DoxyCodeLine{01324\ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01325\ \ \ \ \ \ \ \ \ \ uint16\_t\ len\ =\ 6;\ \textcolor{comment}{//\ Header(5)\ +\ Payload(1)\ }}
\DoxyCodeLine{01326\ \ \ \ \ \ \ \ \ \ packet[2]\ =\ len;}
\DoxyCodeLine{01327\ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01328\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_bambu_bus_protocol_af9d11bc755538718e6ba8fbc5c8e9187}{BambuBusProtocol::BuildPacketWithCRC}}(packet,\ len);}
\DoxyCodeLine{01329\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_command_router_a1cf14aabb538f71f140e6b1aa7ef965d}{CommandRouter::SendPacket}}(packet,\ len);}
\DoxyCodeLine{01330\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a9716be5fe9da72481bee41a80681d8e5}{UpdateConnectivity}}(\textcolor{keyword}{true});}
\DoxyCodeLine{01331\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_bambu_bus_protocol_8cpp_source_l00231}{Bambu\+Bus\+Protocol\+::\+Build\+Packet\+With\+CRC()}}, \mbox{\hyperlink{_command_router_8cpp_source_l00234}{Command\+Router\+::\+Send\+Packet()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00948}{Update\+Connectivity()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a412a7a597ff3c04c0ea1480094600ef4_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a82b9a1fb120cd91615d2ac478daafefd}\index{ControlLogic@{ControlLogic}!ProcessREQx6@{ProcessREQx6}}
\index{ProcessREQx6@{ProcessREQx6}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{ProcessREQx6()}{ProcessREQx6()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a82b9a1fb120cd91615d2ac478daafefd} 
void Control\+Logic\+::\+Process\+REQx6 (\begin{DoxyParamCaption}\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{buffer}{, }\item[{uint16\+\_\+t}]{length}{}\end{DoxyParamCaption})}



Handler for REQx6 (0x06). 

Responds with a simple ACK (0x06). 

Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l01338}{1338}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01339\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Just\ ACK\ with\ 0x06}}
\DoxyCodeLine{01340\ \ \ \ \ \ \ \ \ uint8\_t\ packet[32];}
\DoxyCodeLine{01341\ \ \ \ \ \ \ \ \ packet[0]\ =\ 0x3D;\ packet[1]\ =\ 0xC5;}
\DoxyCodeLine{01342\ \ \ \ \ \ \ \ \ packet[4]\ =\ 0x06;}
\DoxyCodeLine{01343\ \ \ \ \ \ \ \ \ packet[5]\ =\ 0x00;}
\DoxyCodeLine{01344\ \ \ \ \ \ \ \ \ uint16\_t\ len\ =\ 6;}
\DoxyCodeLine{01345\ \ \ \ \ \ \ \ \ packet[2]\ =\ len;}
\DoxyCodeLine{01346\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_bambu_bus_protocol_af9d11bc755538718e6ba8fbc5c8e9187}{BambuBusProtocol::BuildPacketWithCRC}}(packet,\ len);}
\DoxyCodeLine{01347\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_command_router_a1cf14aabb538f71f140e6b1aa7ef965d}{CommandRouter::SendPacket}}(packet,\ len);}
\DoxyCodeLine{01348\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_bambu_bus_protocol_8cpp_source_l00231}{Bambu\+Bus\+Protocol\+::\+Build\+Packet\+With\+CRC()}}, and \mbox{\hyperlink{_command_router_8cpp_source_l00234}{Command\+Router\+::\+Send\+Packet()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a82b9a1fb120cd91615d2ac478daafefd_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_ada1dd6f18fca06d8b26836f4788ab0ad}\index{ControlLogic@{ControlLogic}!ProcessSetFilamentInfo@{ProcessSetFilamentInfo}}
\index{ProcessSetFilamentInfo@{ProcessSetFilamentInfo}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{ProcessSetFilamentInfo()}{ProcessSetFilamentInfo()}}
{\footnotesize\ttfamily \label{namespace_control_logic_ada1dd6f18fca06d8b26836f4788ab0ad} 
void Control\+Logic\+::\+Process\+Set\+Filament\+Info (\begin{DoxyParamCaption}\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{buffer}{, }\item[{uint16\+\_\+t}]{length}{}\end{DoxyParamCaption})}



Handler for Set Filament Info (0x08 -\/ Short). 

Decodes payload and calls {\ttfamily \doxylink{namespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4}{Set\+Filament\+Info\+Action}}. 

Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l01364}{1364}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01365\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Short\ Packet\ Set\ Filament\ Info\ (0x08)}}
\DoxyCodeLine{01366\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Offset\ 5\ is\ start\ of\ payload.}}
\DoxyCodeLine{01367\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Logic\ from\ original:\ }}
\DoxyCodeLine{01368\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ buffer[5]\ =\ AMS\ num?}}
\DoxyCodeLine{01369\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ buffer[6]\ =\ Filament\ Index?}}
\DoxyCodeLine{01370\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ buffer[7]...\ color?}}
\DoxyCodeLine{01371\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Let's\ assume\ payload\ matches\ SetFilamentInfoAction\ args.}}
\DoxyCodeLine{01372\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01373\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (length\ <\ 10)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01374\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ uint8\_t\ tray\_index\ =\ buffer[5];\ //\ Unused\ warning\ fix}}
\DoxyCodeLine{01375\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Wait,\ normally\ payload\ is:\ [AMS\_Num]\ [Tray\_Num]\ [R]\ [G]\ [B]\ [A]\ ...}}
\DoxyCodeLine{01376\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Needs\ verifying\ protocol.}}
\DoxyCodeLine{01377\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Assuming:}}
\DoxyCodeLine{01378\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id}\ =\ buffer[5];\ \textcolor{comment}{//\ If\ direct\ tray\ mapping}}
\DoxyCodeLine{01379\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{id}\ >=\ 4)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01380\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01381\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_filament_info}{FilamentInfo}}\ info;}
\DoxyCodeLine{01382\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Populate\ info\ from\ buffer...}}
\DoxyCodeLine{01383\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01384\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Call\ Action}}
\DoxyCodeLine{01385\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4}{SetFilamentInfoAction}}(\textcolor{keywordtype}{id},\ info);}
\DoxyCodeLine{01386\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01387\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Send\ ACK\ (0x08)}}
\DoxyCodeLine{01388\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ...}}
\DoxyCodeLine{01389\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l01401}{Set\+Filament\+Info\+Action()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_ada1dd6f18fca06d8b26836f4788ab0ad_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_adc8c269923e0c76c6d104a005833a7f9}\index{ControlLogic@{ControlLogic}!Run@{Run}}
\index{Run@{Run}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{Run()}{Run()}}
{\footnotesize\ttfamily \label{namespace_control_logic_adc8c269923e0c76c6d104a005833a7f9} 
void Control\+Logic\+::\+Run (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Main Control Loop. 

Called repeatedly from main. Checks sensors, manages logic switching, updates motor control, handles LED updates, and manages Flash saving. 

Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00792}{792}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ uint64\_t\ last\_run\ =\ 0;}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \ \ uint64\_t\ now\ =\ \mbox{\hyperlink{namespace_hardware_a8ea28b07408691bc126683a81aa220f3}{Hardware::GetTime}}();}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ time\_E\ =\ (now\ -\/\ last\_run)\ /\ 1000.0f;}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ last\_run\ =\ now;}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13}{MC\_PULL\_ONLINE\_read}}();}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_aa3d38299372c0822e90d6e649344e8ad}{AS5600\_Update}}(time\_E);}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespace_control_logic_a5cc135d9070e574d8b2fe9c9b328a148}{Bambubus\_need\_to\_save}})\ \{}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (now\ -\/\ \mbox{\hyperlink{namespace_control_logic_a17835f3a0e8384e40e9d647ce79d3d22}{save\_timer}}\ >\ 500)\ \{\ }
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3}{SaveSettings}}();\ }
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00805\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ pulling\ =\ \mbox{\hyperlink{namespace_control_logic_acb78560c64e5ea050853ab319a03f14e}{Prepare\_For\_filament\_Pull\_Back}}(\mbox{\hyperlink{namespace_control_logic_a0dc914125ce5b958b6d1620c814a580d}{P1X\_OUT\_filament\_meters}});}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!pulling)\ \{}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac2d890c891494072159ebc2b30490197}{motor\_motion\_switch}}();}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<4;\ i++)\ \{}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[i].Run(time\_E);}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ System\ LED\ Debug\ Flash}}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ uint64\_t\ last\_led\_update\ =\ 0;}
\DoxyCodeLine{00819\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (now\ -\/\ last\_led\_update\ >\ 1000)\ \{}
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ toggle\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00821\ \ \ \ \ \ \ \ \ \ \ \ \ \ toggle\ =\ !toggle;}
\DoxyCodeLine{00822\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Heartbeat\ color:\ Green\ for\ BambuBus,\ White\ for\ Klipper}}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (toggle)\ \{}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.\mbox{\hyperlink{structflash__save__struct_a2c383f5bdbb468f12fb4ea625b5823b6}{boot\_mode}}\ ==\ (uint32\_t)\mbox{\hyperlink{namespace_control_logic_aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55}{BootMode::Klipper}})\ \{}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_a44347f62b4ee1789ecfed67b195572e4}{Hardware::LED\_SetColor}}(4,\ 0,\ 10,\ 10,\ 10);\ \textcolor{comment}{//\ White}}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_a44347f62b4ee1789ecfed67b195572e4}{Hardware::LED\_SetColor}}(4,\ 0,\ 0,\ 10,\ 0);\ \textcolor{comment}{//\ Green}}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00830\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \mbox{\hyperlink{namespace_hardware_a44347f62b4ee1789ecfed67b195572e4}{Hardware::LED\_SetColor}}(4,\ 0,\ 0,\ 0,\ 0);\ }
\DoxyCodeLine{00831\ \ \ \ \ \ \ \ \ \ \ \ \ \ last\_led\_update\ =\ now;}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00833\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ LED\ physical\ output\ at\ \string~20Hz\ to\ prevent\ blocking\ interrupts\ too\ often}}
\DoxyCodeLine{00834\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ uint64\_t\ last\_led\_show\_time\ =\ 0;}
\DoxyCodeLine{00835\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (now\ -\/\ last\_led\_show\_time\ >\ 50)\ \{}
\DoxyCodeLine{00836\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_hardware_a365d946e0cf0fe8cfc8dbcb25cfbdad9}{Hardware::LED\_Show}}();}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \ \ \ \ \ \ \ last\_led\_show\_time\ =\ now;}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00839\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00694}{AS5600\+\_\+\+Update()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00223}{Bambubus\+\_\+need\+\_\+to\+\_\+save}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}, \mbox{\hyperlink{_hardware_8cpp_source_l00115}{Hardware\+::\+Get\+Time()}}, \mbox{\hyperlink{_control_logic_8h_source_l00016}{Klipper}}, \mbox{\hyperlink{_hardware_8cpp_source_l00530}{Hardware\+::\+LED\+\_\+\+Set\+Color()}}, \mbox{\hyperlink{_hardware_8cpp_source_l00544}{Hardware\+::\+LED\+\_\+\+Show()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00240}{MC\+\_\+\+PULL\+\_\+\+ONLINE\+\_\+read()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00962}{motor\+\_\+motion\+\_\+switch()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00517}{motors}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00201}{P1\+X\+\_\+\+OUT\+\_\+filament\+\_\+meters}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00751}{Prepare\+\_\+\+For\+\_\+filament\+\_\+\+Pull\+\_\+\+Back()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00224}{save\+\_\+timer}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00722}{Save\+Settings()}}.



Referenced by \mbox{\hyperlink{main_8cpp_source_l00040}{loop()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_adc8c269923e0c76c6d104a005833a7f9_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_adc8c269923e0c76c6d104a005833a7f9_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3}\index{ControlLogic@{ControlLogic}!SaveSettings@{SaveSettings}}
\index{SaveSettings@{SaveSettings}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{SaveSettings()}{SaveSettings()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3} 
void Control\+Logic\+::\+Save\+Settings (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Commit settings to Flash memory. 

Writes the current {\ttfamily \doxylink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\+\_\+save}} struct to flash. 

Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00722}{722}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_flash__saves_8cpp_ae5951341b70b0da0d768d418bfcb76ce}{Flash\_saves}}(\&\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}),\ \mbox{\hyperlink{_control_logic_8cpp_a377d54c27966e6b7bcfb0810524885b1}{use\_flash\_addr}});}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a5cc135d9070e574d8b2fe9c9b328a148}{Bambubus\_need\_to\_save}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00725\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00223}{Bambubus\+\_\+need\+\_\+to\+\_\+save}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}, \mbox{\hyperlink{_flash__saves_8cpp_source_l00051}{Flash\+\_\+saves()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00018}{use\+\_\+flash\+\_\+addr}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00792}{Run()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=323pt]{namespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a9db355302a1c9d608e6dd5341151336e}\index{ControlLogic@{ControlLogic}!SetAutoFeed@{SetAutoFeed}}
\index{SetAutoFeed@{SetAutoFeed}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{SetAutoFeed()}{SetAutoFeed()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a9db355302a1c9d608e6dd5341151336e} 
void Control\+Logic\+::\+Set\+Auto\+Feed (\begin{DoxyParamCaption}\item[{int}]{lane}{, }\item[{bool}]{enable}{}\end{DoxyParamCaption})}



Enable/\+Disable Auto-\/\+Feed (Pressure Control) for a lane. 


\begin{DoxyParams}{Parameters}
{\em lane} & Lane index. \\
\hline
{\em enable} & True to enable, False to stop. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00643}{643}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(lane\ <\ 0\ ||\ lane\ >=\ 4)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (enable)\ \{}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[lane].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75}{filament\_motion\_enum::pressure\_ctrl\_in\_use}});}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ may\ need\ to\ ensure\ filament\_now\_position\ isn't\ overwriting\ this?}}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Actually,\ motor\_motion\_switch\ checks\ motor[i].motion,\ so\ we\ should\ be\ good\ if\ we\ add\ check\ there.}}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[lane].\mbox{\hyperlink{class_control_logic_1_1_motor_channel_a0b8ed284da431b3325320e709433a454}{SetMotion}}(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b}{filament\_motion\_enum::stop}});}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[lane]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}};}
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00654\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00172}{filament\+\_\+idle}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00220}{filament\+\_\+now\+\_\+position}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00517}{motors}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00188}{pressure\+\_\+ctrl\+\_\+in\+\_\+use}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00183}{stop}}.



Referenced by \mbox{\hyperlink{_klipper_c_l_i_8cpp_source_l00288}{Klipper\+CLI\+::\+Handle\+Set\+Auto\+Feed()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a9db355302a1c9d608e6dd5341151336e_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4}\index{ControlLogic@{ControlLogic}!SetFilamentInfoAction@{SetFilamentInfoAction}}
\index{SetFilamentInfoAction@{SetFilamentInfoAction}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{SetFilamentInfoAction()}{SetFilamentInfoAction()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4} 
void Control\+Logic\+::\+Set\+Filament\+Info\+Action (\begin{DoxyParamCaption}\item[{int}]{id}{, }\item[{const \mbox{\hyperlink{struct_filament_info}{Filament\+Info}} \&}]{info}{, }\item[{float}]{meters}{}\end{DoxyParamCaption})}



Action helper to update filament metadata. 

Updates Color, Type, ID, Temps, etc. for a specific tray. Triggers a Flash Save.


\begin{DoxyParams}{Parameters}
{\em id} & Tray ID. \\
\hline
{\em info} & Info structure. \\
\hline
{\em meters} & Odometer reading (optional, -\/1 to ignore). \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l01401}{1401}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01402\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (id\ <\ 0\ ||\ id\ >=\ 4)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01403\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01404\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_filament_state}{FilamentState}}\ \&target\ =\ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.filament[id];}
\DoxyCodeLine{01405\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01406\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ Basic\ Fields}}
\DoxyCodeLine{01407\ \ \ \ \ \ \ \ \ memcpy(target.\mbox{\hyperlink{struct_filament_info_a26e0e6218d4a40974be5086c2ac89087}{ID}},\ info.\mbox{\hyperlink{struct_filament_info_a26e0e6218d4a40974be5086c2ac89087}{ID}},\ \textcolor{keyword}{sizeof}(target.\mbox{\hyperlink{struct_filament_info_a26e0e6218d4a40974be5086c2ac89087}{ID}}));}
\DoxyCodeLine{01408\ \ \ \ \ \ \ \ \ memcpy(target.\mbox{\hyperlink{struct_filament_info_a5bf1b8820cfc338a0e489064670e6672}{name}},\ info.\mbox{\hyperlink{struct_filament_info_a5bf1b8820cfc338a0e489064670e6672}{name}},\ \textcolor{keyword}{sizeof}(target.\mbox{\hyperlink{struct_filament_info_a5bf1b8820cfc338a0e489064670e6672}{name}}));}
\DoxyCodeLine{01409\ \ \ \ \ \ \ \ \ target.\mbox{\hyperlink{struct_filament_info_a49b75d4f9105d90760ca96138c8fcf45}{color\_R}}\ =\ info.\mbox{\hyperlink{struct_filament_info_a49b75d4f9105d90760ca96138c8fcf45}{color\_R}};}
\DoxyCodeLine{01410\ \ \ \ \ \ \ \ \ target.\mbox{\hyperlink{struct_filament_info_a401880702bfbb50388082ccfc4da0ddd}{color\_G}}\ =\ info.\mbox{\hyperlink{struct_filament_info_a401880702bfbb50388082ccfc4da0ddd}{color\_G}};}
\DoxyCodeLine{01411\ \ \ \ \ \ \ \ \ target.\mbox{\hyperlink{struct_filament_info_ab1c9dff383b15c09a2fad0cf6d7e8714}{color\_B}}\ =\ info.\mbox{\hyperlink{struct_filament_info_ab1c9dff383b15c09a2fad0cf6d7e8714}{color\_B}};}
\DoxyCodeLine{01412\ \ \ \ \ \ \ \ \ target.\mbox{\hyperlink{struct_filament_info_a72997ce70a6852951aac4a8c907e24ac}{color\_A}}\ =\ info.\mbox{\hyperlink{struct_filament_info_a72997ce70a6852951aac4a8c907e24ac}{color\_A}};}
\DoxyCodeLine{01413\ \ \ \ \ \ \ \ \ target.\mbox{\hyperlink{struct_filament_info_a5868192ee8a9087a32bc1b242024aa72}{temperature\_min}}\ =\ info.\mbox{\hyperlink{struct_filament_info_a5868192ee8a9087a32bc1b242024aa72}{temperature\_min}};}
\DoxyCodeLine{01414\ \ \ \ \ \ \ \ \ target.\mbox{\hyperlink{struct_filament_info_a45dff2f7e9e7b3794d9ff6469f50113f}{temperature\_max}}\ =\ info.\mbox{\hyperlink{struct_filament_info_a45dff2f7e9e7b3794d9ff6469f50113f}{temperature\_max}};}
\DoxyCodeLine{01415\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01416\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (meters\ >=\ 0)\ \{}
\DoxyCodeLine{01417\ \ \ \ \ \ \ \ \ \ \ \ \ \ target.\mbox{\hyperlink{struct_filament_state_aabba44628ec691809d7b13b94b8a507e}{meters}}\ =\ meters;}
\DoxyCodeLine{01418\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01419\ }
\DoxyCodeLine{01420\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ strings\ are\ null\ terminated\ just\ in\ case}}
\DoxyCodeLine{01421\ \ \ \ \ \ \ \ \ target.\mbox{\hyperlink{struct_filament_info_a26e0e6218d4a40974be5086c2ac89087}{ID}}[7]\ =\ 0;}
\DoxyCodeLine{01422\ \ \ \ \ \ \ \ \ target.\mbox{\hyperlink{struct_filament_info_a5bf1b8820cfc338a0e489064670e6672}{name}}[19]\ =\ 0;}
\DoxyCodeLine{01423\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01424\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_afe90d7f284c20f90f74787274f01c51b}{SetNeedToSave}}();}
\DoxyCodeLine{01425\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_unit_state_8h_source_l00017}{Filament\+Info\+::color\+\_\+A}}, \mbox{\hyperlink{_unit_state_8h_source_l00016}{Filament\+Info\+::color\+\_\+B}}, \mbox{\hyperlink{_unit_state_8h_source_l00015}{Filament\+Info\+::color\+\_\+G}}, \mbox{\hyperlink{_unit_state_8h_source_l00014}{Filament\+Info\+::color\+\_\+R}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}, \mbox{\hyperlink{_unit_state_8h_source_l00013}{Filament\+Info\+::\+ID}}, \mbox{\hyperlink{_unit_state_8h_source_l00047}{Filament\+State\+::meters}}, \mbox{\hyperlink{_unit_state_8h_source_l00020}{Filament\+Info\+::name}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00733}{Set\+Need\+To\+Save()}}, \mbox{\hyperlink{_unit_state_8h_source_l00019}{Filament\+Info\+::temperature\+\_\+max}}, and \mbox{\hyperlink{_unit_state_8h_source_l00018}{Filament\+Info\+::temperature\+\_\+min}}.



Referenced by \mbox{\hyperlink{_klipper_c_l_i_8cpp_source_l00347}{Klipper\+CLI\+::\+Handle\+Set\+Filament\+Info()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l01364}{Process\+Set\+Filament\+Info()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_afe90d7f284c20f90f74787274f01c51b}\index{ControlLogic@{ControlLogic}!SetNeedToSave@{SetNeedToSave}}
\index{SetNeedToSave@{SetNeedToSave}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{SetNeedToSave()}{SetNeedToSave()}}
{\footnotesize\ttfamily \label{namespace_control_logic_afe90d7f284c20f90f74787274f01c51b} 
void Control\+Logic\+::\+Set\+Need\+To\+Save (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Flag that settings need to be saved. 

Sets a dirty flag and resets the save timer (debounce). 

Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00733}{733}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{namespace_control_logic_a5cc135d9070e574d8b2fe9c9b328a148}{Bambubus\_need\_to\_save}})\ \{}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a5cc135d9070e574d8b2fe9c9b328a148}{Bambubus\_need\_to\_save}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a17835f3a0e8384e40e9d647ce79d3d22}{save\_timer}}\ =\ \mbox{\hyperlink{namespace_hardware_a8ea28b07408691bc126683a81aa220f3}{Hardware::GetTime}}();}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00738\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00223}{Bambubus\+\_\+need\+\_\+to\+\_\+save}}, \mbox{\hyperlink{_hardware_8cpp_source_l00115}{Hardware\+::\+Get\+Time()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00224}{save\+\_\+timer}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00904}{Init\+Boot\+Check()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00847}{Load\+Settings()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l01401}{Set\+Filament\+Info\+Action()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_afe90d7f284c20f90f74787274f01c51b_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_afe90d7f284c20f90f74787274f01c51b_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_adb4ce7f82b449d6d6d97e7399ce391f5}\index{ControlLogic@{ControlLogic}!StartLoadFilament@{StartLoadFilament}}
\index{StartLoadFilament@{StartLoadFilament}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{StartLoadFilament()}{StartLoadFilament()}}
{\footnotesize\ttfamily \label{namespace_control_logic_adb4ce7f82b449d6d6d97e7399ce391f5} 
void Control\+Logic\+::\+Start\+Load\+Filament (\begin{DoxyParamCaption}\item[{int}]{tray}{, }\item[{int}]{length\+\_\+mm}{}\end{DoxyParamCaption})}



Initiate a Filament Load sequence for a specific tray. 

Sets the state machine to {\ttfamily \doxylink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22}{filament\+\_\+loading}}, initializes variables, and sets motor to send.


\begin{DoxyParams}{Parameters}
{\em tray} & Tray index (0-\/3). \\
\hline
{\em length\+\_\+mm} & Target length in mm (if \texorpdfstring{$>$}{>} 0, stops at distance; otherwise uses pressure logic). \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00529}{529}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tray\ <\ 0\ ||\ tray\ >=\ 4)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Setup\ state}}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.BambuBus\_now\_filament\_num\ =\ tray;}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.filament\_use\_flag\ =\ 0x02;\ }
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[tray]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22}{filament\_loading}};}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[tray].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890}{filament\_motion\_enum::send}});\ \textcolor{comment}{//\ Start\ fast}}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a11bff287b64c24fe91500ba99c6f21c8}{unload\_target\_dist}}[tray]\ =\ length\_mm;\ \textcolor{comment}{//\ Reuse\ this\ variable\ for\ target\ distance}}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ distance\ tracking\ if\ we\ are\ using\ length}}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (length\_mm\ >\ 0)\ \{}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_aef70a34b1f25019450171bfa5c07ab62}{is\_backing\_out}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ Use\ backing\ out\ flag\ to\ enable\ distance\ accumulation\ in\ Run()?}}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Wait,\ Run()\ only\ accumulates\ if\ "{}is\_backing\_out"{}\ is\ true?}}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ "{}if\ (is\_backing\_out)\ last\_total\_distance\ +=\ ..."{}}}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yes.\ So\ we\ need\ to\ set\ is\_backing\_out\ =\ true\ even\ for\ loading\ if\ we\ want\ distance.}}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ But\ verify\ if\ "{}StartUnloadFilament"{}\ clears\ it?\ StartUnload\ sets\ it\ true.}}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ should\ ensure\ Run()\ logic\ supports\ positive\ distance\ accumulation\ too\ if\ speed\ is\ positive?}}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Run()\ uses\ fabs(speed\ *\ time).\ So\ direction\ doesn't\ matter\ for\ accumulation.}}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a92f9b1daa685f9041b79423442d440e3}{last\_total\_distance}}[tray]\ =\ 0;}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_aef70a34b1f25019450171bfa5c07ab62}{is\_backing\_out}}\ =\ \textcolor{keyword}{true};\ }
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_aef70a34b1f25019450171bfa5c07ab62}{is\_backing\_out}}\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Normal\ load\ doesn't\ track\ distance\ usually?}}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Actually,\ regular\ load\ uses\ Pressure\ surveillance\ logic.}}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00557\ }
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ others\ are\ idle}}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<4;\ i++)\ \{}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i\ !=\ tray)\ \{}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[i]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}};}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[i].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c}{filament\_motion\_enum::pressure\_ctrl\_idle}});}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00565\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00172}{filament\+\_\+idle}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00177}{filament\+\_\+loading}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00220}{filament\+\_\+now\+\_\+position}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00211}{is\+\_\+backing\+\_\+out}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00035}{last\+\_\+total\+\_\+distance}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00517}{motors}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00187}{pressure\+\_\+ctrl\+\_\+idle}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00184}{send}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00216}{unload\+\_\+target\+\_\+dist}}.

\Hypertarget{namespace_control_logic_abcc93276e326829eec4d37024c647745}\index{ControlLogic@{ControlLogic}!StartUnloadFilament@{StartUnloadFilament}}
\index{StartUnloadFilament@{StartUnloadFilament}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{StartUnloadFilament()}{StartUnloadFilament()}}
{\footnotesize\ttfamily \label{namespace_control_logic_abcc93276e326829eec4d37024c647745} 
void Control\+Logic\+::\+Start\+Unload\+Filament (\begin{DoxyParamCaption}\item[{int}]{tray}{, }\item[{int}]{length\+\_\+mm}{}\end{DoxyParamCaption})}



Initiate a Filament Unload sequence for a specific tray. 

Sets state to {\ttfamily \doxylink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2}{filament\+\_\+unloading}}.


\begin{DoxyParams}{Parameters}
{\em tray} & Tray index (0-\/3). \\
\hline
{\em length\+\_\+mm} & Target distance to unload (or -\/1 to unload until sensor clear). \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00576}{576}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tray\ <\ 0\ ||\ tray\ >=\ 4)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Setup\ state}}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.BambuBus\_now\_filament\_num\ =\ tray;}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a07df3d8e92f2b4de565d574c7950555a}{data\_save}}.filament\_use\_flag\ =\ 0x02;\ \textcolor{comment}{//\ Busy/Moving}}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[tray]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2}{filament\_unloading}};}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[tray].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0}{filament\_motion\_enum::pull}});\ \textcolor{comment}{//\ Start\ Pulling}}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a11bff287b64c24fe91500ba99c6f21c8}{unload\_target\_dist}}[tray]\ =\ length\_mm;}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a0efb555ba92cc1cedb47929db260e6c8}{unload\_start\_meters}}[tray]\ =\ \mbox{\hyperlink{_control_logic_8cpp_a92f9b1daa685f9041b79423442d440e3}{last\_total\_distance}}[tray];\ \textcolor{comment}{//\ Capture\ start\ pos\ (using\ accumulated\ dist\ logic\ if\ valid\ or\ need\ tracking)}}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Actually\ last\_total\_distance\ is\ used\ for\ pullback\ accumulation?}}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Let's\ reset\ last\_total\_distance\ logic\ or\ use\ a\ new\ tracker?}}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Existing\ "{}Prepare\_For\_filament\_Pull\_Back"{}\ uses\ "{}last\_total\_distance"{}\ which\ accumulates\ in\ Run()\ if\ "{}is\_backing\_out"{}\ is\ true.}}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_aef70a34b1f25019450171bfa5c07ab62}{is\_backing\_out}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a92f9b1daa685f9041b79423442d440e3}{last\_total\_distance}}[tray]\ =\ 0;\ \textcolor{comment}{//\ Reset\ counter\ for\ this\ op}}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ others\ are\ idle}}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<4;\ i++)\ \{}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i\ !=\ tray)\ \{}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[i]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}};}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[i].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c}{filament\_motion\_enum::pressure\_ctrl\_idle}});}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00602\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00031}{data\+\_\+save}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00172}{filament\+\_\+idle}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00220}{filament\+\_\+now\+\_\+position}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00178}{filament\+\_\+unloading}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00211}{is\+\_\+backing\+\_\+out}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00035}{last\+\_\+total\+\_\+distance}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00517}{motors}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00187}{pressure\+\_\+ctrl\+\_\+idle}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00185}{pull}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00217}{unload\+\_\+start\+\_\+meters}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00216}{unload\+\_\+target\+\_\+dist}}.

\Hypertarget{namespace_control_logic_af084200798d6b89c1b448bf41b105d62}\index{ControlLogic@{ControlLogic}!StopAll@{StopAll}}
\index{StopAll@{StopAll}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{StopAll()}{StopAll()}}
{\footnotesize\ttfamily \label{namespace_control_logic_af084200798d6b89c1b448bf41b105d62} 
void Control\+Logic\+::\+Stop\+All (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Stop all motors. 



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00629}{629}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i<4;\ i++)\ \{}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}{motors}}[i].SetMotion(\mbox{\hyperlink{namespace_control_logic_ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b}{filament\_motion\_enum::stop}});}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}{filament\_now\_position}}[i]\ =\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}};}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00634\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_control_logic_8cpp_source_l00172}{filament\+\_\+idle}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00220}{filament\+\_\+now\+\_\+position}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00517}{motors}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00183}{stop}}.



Referenced by \mbox{\hyperlink{_klipper_c_l_i_8cpp_source_l00255}{Klipper\+CLI\+::\+Handle\+Stop()}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_af084200798d6b89c1b448bf41b105d62_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespace_control_logic_a9716be5fe9da72481bee41a80681d8e5}\index{ControlLogic@{ControlLogic}!UpdateConnectivity@{UpdateConnectivity}}
\index{UpdateConnectivity@{UpdateConnectivity}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{UpdateConnectivity()}{UpdateConnectivity()}}
{\footnotesize\ttfamily \label{namespace_control_logic_a9716be5fe9da72481bee41a80681d8e5} 
void Control\+Logic\+::\+Update\+Connectivity (\begin{DoxyParamCaption}\item[{bool}]{online}{}\end{DoxyParamCaption})}



Update connectivity status (Online/\+Offline). 

Resets Heartbeat timer.


\begin{DoxyParams}{Parameters}
{\em online} & Status. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00948}{948}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00948\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_control_logic_8cpp_a5995db87b2ef40e52a47d2fb1f13ae42}{is\_connected}}\ =\ \mbox{\hyperlink{_bambu_bus_protocol_8h_a9148fdd6f33c42faedeb9cc1a5520646a7f46165474d11ee5836777d85df2cdab}{online}};}
\DoxyCodeLine{00950\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_bambu_bus_protocol_8h_a9148fdd6f33c42faedeb9cc1a5520646a7f46165474d11ee5836777d85df2cdab}{online}})\ \mbox{\hyperlink{_control_logic_8cpp_abeaf61fc41f3eae5245f0b7484a5fb5e}{last\_heartbeat\_time}}\ =\ \mbox{\hyperlink{namespace_hardware_a8ea28b07408691bc126683a81aa220f3}{Hardware::GetTime}}();}
\DoxyCodeLine{00951\ \ \ \ \ \}}

\end{DoxyCode}


References \mbox{\hyperlink{_hardware_8cpp_source_l00115}{Hardware\+::\+Get\+Time()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00036}{is\+\_\+connected}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00037}{last\+\_\+heartbeat\+\_\+time}}, and \mbox{\hyperlink{_bambu_bus_protocol_8h_source_l00011}{online}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l01355}{Process\+Heartbeat()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l01311}{Process\+Online\+Detect()}}, \mbox{\hyperlink{_command_router_8cpp_source_l00133}{Command\+Router\+::\+Route()}}, and \mbox{\hyperlink{_command_router_8cpp_source_l00180}{Command\+Router\+::\+Run()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a9716be5fe9da72481bee41a80681d8e5_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespace_control_logic_a9716be5fe9da72481bee41a80681d8e5_icgraph}
\end{center}
\end{figure}


\label{doc-var-members}
\Hypertarget{namespace_control_logic_doc-var-members}
\doxysubsection{Variable Documentation}
\Hypertarget{namespace_control_logic_ad161a11879586190d66f43141bb6578f}\index{ControlLogic@{ControlLogic}!as5600\_distance\_save@{as5600\_distance\_save}}
\index{as5600\_distance\_save@{as5600\_distance\_save}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{as5600\_distance\_save}{as5600\_distance\_save}}
{\footnotesize\ttfamily \label{namespace_control_logic_ad161a11879586190d66f43141bb6578f} 
int32\+\_\+t Control\+Logic\+::as5600\+\_\+distance\+\_\+save\mbox{[}4\mbox{]} = \{0, 0, 0, 0\}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00213}{213}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00213\ \{0,\ 0,\ 0,\ 0\};}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00694}{AS5600\+\_\+\+Update()}}.

\Hypertarget{namespace_control_logic_a280d12e7265d1830d4859cc38dd5497e}\index{ControlLogic@{ControlLogic}!Assist\_send\_filament@{Assist\_send\_filament}}
\index{Assist\_send\_filament@{Assist\_send\_filament}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{Assist\_send\_filament}{Assist\_send\_filament}}
{\footnotesize\ttfamily \label{namespace_control_logic_a280d12e7265d1830d4859cc38dd5497e} 
bool Control\+Logic\+::\+Assist\+\_\+send\+\_\+filament\mbox{[}4\mbox{]} = \{false\}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00209}{209}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00209\ \{\textcolor{keyword}{false}\};}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00398}{Control\+Logic\+::\+Motor\+Channel\+::\+Run()}}.

\Hypertarget{namespace_control_logic_a5cc135d9070e574d8b2fe9c9b328a148}\index{ControlLogic@{ControlLogic}!Bambubus\_need\_to\_save@{Bambubus\_need\_to\_save}}
\index{Bambubus\_need\_to\_save@{Bambubus\_need\_to\_save}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{Bambubus\_need\_to\_save}{Bambubus\_need\_to\_save}}
{\footnotesize\ttfamily \label{namespace_control_logic_a5cc135d9070e574d8b2fe9c9b328a148} 
bool Control\+Logic\+::\+Bambubus\+\_\+need\+\_\+to\+\_\+save = false\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00223}{223}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00792}{Run()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00722}{Save\+Settings()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00733}{Set\+Need\+To\+Save()}}.

\Hypertarget{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596}\index{ControlLogic@{ControlLogic}!filament\_now\_position@{filament\_now\_position}}
\index{filament\_now\_position@{filament\_now\_position}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{filament\_now\_position}{filament\_now\_position}}
{\footnotesize\ttfamily \label{namespace_control_logic_a3cb6555c20c1e3a386f34fa9f5e6b596} 
\mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76}{filament\+\_\+now\+\_\+position\+\_\+enum}} Control\+Logic\+::filament\+\_\+now\+\_\+position\mbox{[}4\mbox{]} = \{\mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\+\_\+idle}}, \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\+\_\+idle}}, \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\+\_\+idle}}, \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\+\_\+idle}}\}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00220}{220}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00220\ \{\mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}},\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}},\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}},\ \mbox{\hyperlink{namespace_control_logic_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5}{filament\_idle}}\};}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00962}{motor\+\_\+motion\+\_\+switch()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00751}{Prepare\+\_\+\+For\+\_\+filament\+\_\+\+Pull\+\_\+\+Back()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00643}{Set\+Auto\+Feed()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00529}{Start\+Load\+Filament()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00576}{Start\+Unload\+Filament()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00629}{Stop\+All()}}.

\Hypertarget{namespace_control_logic_aef70a34b1f25019450171bfa5c07ab62}\index{ControlLogic@{ControlLogic}!is\_backing\_out@{is\_backing\_out}}
\index{is\_backing\_out@{is\_backing\_out}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{is\_backing\_out}{is\_backing\_out}}
{\footnotesize\ttfamily \label{namespace_control_logic_aef70a34b1f25019450171bfa5c07ab62} 
bool Control\+Logic\+::is\+\_\+backing\+\_\+out = false\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00211}{211}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00962}{motor\+\_\+motion\+\_\+switch()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00751}{Prepare\+\_\+\+For\+\_\+filament\+\_\+\+Pull\+\_\+\+Back()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00398}{Control\+Logic\+::\+Motor\+Channel\+::\+Run()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00529}{Start\+Load\+Filament()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00576}{Start\+Unload\+Filament()}}.

\Hypertarget{namespace_control_logic_a8abb9a7c0790b08a5e5f31c8874bb15f}\index{ControlLogic@{ControlLogic}!is\_two@{is\_two}}
\index{is\_two@{is\_two}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{is\_two}{is\_two}}
{\footnotesize\ttfamily \label{namespace_control_logic_a8abb9a7c0790b08a5e5f31c8874bb15f} 
const bool Control\+Logic\+::is\+\_\+two = true\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00212}{212}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00240}{MC\+\_\+\+PULL\+\_\+\+ONLINE\+\_\+read()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00398}{Control\+Logic\+::\+Motor\+Channel\+::\+Run()}}.

\Hypertarget{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002}\index{ControlLogic@{ControlLogic}!MC\_ONLINE\_key\_stu@{MC\_ONLINE\_key\_stu}}
\index{MC\_ONLINE\_key\_stu@{MC\_ONLINE\_key\_stu}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{MC\_ONLINE\_key\_stu}{MC\_ONLINE\_key\_stu}}
{\footnotesize\ttfamily \label{namespace_control_logic_a503041f38fbec420305ae1bb79aa4002} 
int Control\+Logic\+::\+MC\+\_\+\+ONLINE\+\_\+key\+\_\+stu\mbox{[}4\mbox{]} = \{0, 0, 0, 0\}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00208}{208}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00208\ \{0,\ 0,\ 0,\ 0\};\ \textcolor{comment}{//\ 0:Off,\ 1:Online(Two),\ 2:ExTrip,\ 3:InTrip}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00662}{Get\+Sensor\+State()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00240}{MC\+\_\+\+PULL\+\_\+\+ONLINE\+\_\+read()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00962}{motor\+\_\+motion\+\_\+switch()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00398}{Control\+Logic\+::\+Motor\+Channel\+::\+Run()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00501}{Control\+Logic\+::\+Motor\+Channel\+::\+Update\+LEDStatus()}}.

\Hypertarget{namespace_control_logic_ae2535696ce7487f6ec12d1f2e174e598}\index{ControlLogic@{ControlLogic}!MC\_ONLINE\_key\_stu\_raw@{MC\_ONLINE\_key\_stu\_raw}}
\index{MC\_ONLINE\_key\_stu\_raw@{MC\_ONLINE\_key\_stu\_raw}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{MC\_ONLINE\_key\_stu\_raw}{MC\_ONLINE\_key\_stu\_raw}}
{\footnotesize\ttfamily \label{namespace_control_logic_ae2535696ce7487f6ec12d1f2e174e598} 
float Control\+Logic\+::\+MC\+\_\+\+ONLINE\+\_\+key\+\_\+stu\+\_\+raw\mbox{[}4\mbox{]} = \{0, 0, 0, 0\}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00207}{207}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00207\ \{0,\ 0,\ 0,\ 0\};}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00240}{MC\+\_\+\+PULL\+\_\+\+ONLINE\+\_\+read()}}.

\Hypertarget{namespace_control_logic_a87d54195660d73ebcd372cad0fd74915}\index{ControlLogic@{ControlLogic}!MC\_PULL\_stu@{MC\_PULL\_stu}}
\index{MC\_PULL\_stu@{MC\_PULL\_stu}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{MC\_PULL\_stu}{MC\_PULL\_stu}}
{\footnotesize\ttfamily \label{namespace_control_logic_a87d54195660d73ebcd372cad0fd74915} 
int Control\+Logic\+::\+MC\+\_\+\+PULL\+\_\+stu\mbox{[}4\mbox{]} = \{0, 0, 0, 0\}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00206}{206}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00206\ \{0,\ 0,\ 0,\ 0\};}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00240}{MC\+\_\+\+PULL\+\_\+\+ONLINE\+\_\+read()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00398}{Control\+Logic\+::\+Motor\+Channel\+::\+Run()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00501}{Control\+Logic\+::\+Motor\+Channel\+::\+Update\+LEDStatus()}}.

\Hypertarget{namespace_control_logic_a14f470efe568bae229e028e1b1acd54f}\index{ControlLogic@{ControlLogic}!MC\_PULL\_stu\_raw@{MC\_PULL\_stu\_raw}}
\index{MC\_PULL\_stu\_raw@{MC\_PULL\_stu\_raw}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{MC\_PULL\_stu\_raw}{MC\_PULL\_stu\_raw}}
{\footnotesize\ttfamily \label{namespace_control_logic_a14f470efe568bae229e028e1b1acd54f} 
float Control\+Logic\+::\+MC\+\_\+\+PULL\+\_\+stu\+\_\+raw\mbox{[}4\mbox{]} = \{0, 0, 0, 0\}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00205}{205}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00205\ \{0,\ 0,\ 0,\ 0\};}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00366}{Control\+Logic\+::\+Motor\+Channel\+::\+Get\+XBy\+Pressure()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00904}{Init\+Boot\+Check()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00240}{MC\+\_\+\+PULL\+\_\+\+ONLINE\+\_\+read()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00962}{motor\+\_\+motion\+\_\+switch()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00398}{Control\+Logic\+::\+Motor\+Channel\+::\+Run()}}.

\Hypertarget{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da}\index{ControlLogic@{ControlLogic}!motors@{motors}}
\index{motors@{motors}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{motors}{motors}}
{\footnotesize\ttfamily \label{namespace_control_logic_ac4fff77bfcf6d233d9c740ce7bc1a4da} 
\mbox{\hyperlink{class_control_logic_1_1_motor_channel}{Motor\+Channel}} Control\+Logic\+::motors\mbox{[}4\mbox{]} = \{0, 1, 2, 3\}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00517}{517}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00517\ \{0,\ 1,\ 2,\ 3\};}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00679}{Get\+Lane\+Motion()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00870}{Init()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00962}{motor\+\_\+motion\+\_\+switch()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00616}{Move\+Axis()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00751}{Prepare\+\_\+\+For\+\_\+filament\+\_\+\+Pull\+\_\+\+Back()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00792}{Run()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00643}{Set\+Auto\+Feed()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00529}{Start\+Load\+Filament()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00576}{Start\+Unload\+Filament()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00629}{Stop\+All()}}.

\Hypertarget{namespace_control_logic_a0dc914125ce5b958b6d1620c814a580d}\index{ControlLogic@{ControlLogic}!P1X\_OUT\_filament\_meters@{P1X\_OUT\_filament\_meters}}
\index{P1X\_OUT\_filament\_meters@{P1X\_OUT\_filament\_meters}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{P1X\_OUT\_filament\_meters}{P1X\_OUT\_filament\_meters}}
{\footnotesize\ttfamily \label{namespace_control_logic_a0dc914125ce5b958b6d1620c814a580d} 
float\+\_\+t Control\+Logic\+::\+P1\+X\+\_\+\+OUT\+\_\+filament\+\_\+meters = 200.\+0f}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00201}{201}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00792}{Run()}}.

\Hypertarget{namespace_control_logic_a33f7ccbf87b78ae7394f88ffe1a4a75e}\index{ControlLogic@{ControlLogic}!pull\_state\_old@{pull\_state\_old}}
\index{pull\_state\_old@{pull\_state\_old}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{pull\_state\_old}{pull\_state\_old}}
{\footnotesize\ttfamily \label{namespace_control_logic_a33f7ccbf87b78ae7394f88ffe1a4a75e} 
bool Control\+Logic\+::pull\+\_\+state\+\_\+old = false\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00210}{210}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00962}{motor\+\_\+motion\+\_\+switch()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00398}{Control\+Logic\+::\+Motor\+Channel\+::\+Run()}}.

\Hypertarget{namespace_control_logic_a73b9466c4e3c236a186659863283f00e}\index{ControlLogic@{ControlLogic}!PULL\_voltage\_down@{PULL\_voltage\_down}}
\index{PULL\_voltage\_down@{PULL\_voltage\_down}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{PULL\_voltage\_down}{PULL\_voltage\_down}}
{\footnotesize\ttfamily \label{namespace_control_logic_a73b9466c4e3c236a186659863283f00e} 
float Control\+Logic\+::\+PULL\+\_\+voltage\+\_\+down = 1.\+45f}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00197}{197}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00240}{MC\+\_\+\+PULL\+\_\+\+ONLINE\+\_\+read()}}.

\Hypertarget{namespace_control_logic_a9a6c6bb73ae52885ddaa5ec56d8603f9}\index{ControlLogic@{ControlLogic}!PULL\_voltage\_up@{PULL\_voltage\_up}}
\index{PULL\_voltage\_up@{PULL\_voltage\_up}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{PULL\_voltage\_up}{PULL\_voltage\_up}}
{\footnotesize\ttfamily \label{namespace_control_logic_a9a6c6bb73ae52885ddaa5ec56d8603f9} 
float Control\+Logic\+::\+PULL\+\_\+voltage\+\_\+up = 1.\+85f}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00196}{196}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00240}{MC\+\_\+\+PULL\+\_\+\+ONLINE\+\_\+read()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00962}{motor\+\_\+motion\+\_\+switch()}}.

\Hypertarget{namespace_control_logic_a17835f3a0e8384e40e9d647ce79d3d22}\index{ControlLogic@{ControlLogic}!save\_timer@{save\_timer}}
\index{save\_timer@{save\_timer}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{save\_timer}{save\_timer}}
{\footnotesize\ttfamily \label{namespace_control_logic_a17835f3a0e8384e40e9d647ce79d3d22} 
uint64\+\_\+t Control\+Logic\+::save\+\_\+timer = 0\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00224}{224}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.



Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00792}{Run()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00733}{Set\+Need\+To\+Save()}}.

\Hypertarget{namespace_control_logic_a5428672c2045ec91715338f32d8bb5f1}\index{ControlLogic@{ControlLogic}!speed\_as5600@{speed\_as5600}}
\index{speed\_as5600@{speed\_as5600}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{speed\_as5600}{speed\_as5600}}
{\footnotesize\ttfamily \label{namespace_control_logic_a5428672c2045ec91715338f32d8bb5f1} 
float Control\+Logic\+::speed\+\_\+as5600\mbox{[}4\mbox{]} = \{0, 0, 0, 0\}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00204}{204}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00204\ \{0,\ 0,\ 0,\ 0\};}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00694}{AS5600\+\_\+\+Update()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00398}{Control\+Logic\+::\+Motor\+Channel\+::\+Run()}}.

\Hypertarget{namespace_control_logic_a0efb555ba92cc1cedb47929db260e6c8}\index{ControlLogic@{ControlLogic}!unload\_start\_meters@{unload\_start\_meters}}
\index{unload\_start\_meters@{unload\_start\_meters}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{unload\_start\_meters}{unload\_start\_meters}}
{\footnotesize\ttfamily \label{namespace_control_logic_a0efb555ba92cc1cedb47929db260e6c8} 
float Control\+Logic\+::unload\+\_\+start\+\_\+meters\mbox{[}4\mbox{]} = \{0, 0, 0, 0\}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00217}{217}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00217\ \{0,\ 0,\ 0,\ 0\};}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00576}{Start\+Unload\+Filament()}}.

\Hypertarget{namespace_control_logic_a11bff287b64c24fe91500ba99c6f21c8}\index{ControlLogic@{ControlLogic}!unload\_target\_dist@{unload\_target\_dist}}
\index{unload\_target\_dist@{unload\_target\_dist}!ControlLogic@{ControlLogic}}
\doxysubsubsection{\texorpdfstring{unload\_target\_dist}{unload\_target\_dist}}
{\footnotesize\ttfamily \label{namespace_control_logic_a11bff287b64c24fe91500ba99c6f21c8} 
int32\+\_\+t Control\+Logic\+::unload\+\_\+target\+\_\+dist\mbox{[}4\mbox{]} = \{0, 0, 0, 0\}\hspace{0.3cm}{\ttfamily [static]}}



Definition at line \mbox{\hyperlink{_control_logic_8cpp_source_l00216}{216}} of file \mbox{\hyperlink{_control_logic_8cpp_source}{Control\+Logic.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00216\ \{0,\ 0,\ 0,\ 0\};\ \textcolor{comment}{//\ -\/1\ for\ clear\ sensor}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{_control_logic_8cpp_source_l00962}{motor\+\_\+motion\+\_\+switch()}}, \mbox{\hyperlink{_control_logic_8cpp_source_l00529}{Start\+Load\+Filament()}}, and \mbox{\hyperlink{_control_logic_8cpp_source_l00576}{Start\+Unload\+Filament()}}.

