<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BMCU370 Firmware: ControlLogic Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BMCU370 Firmware
   </div>
   <div id="projectbrief">Modified BMCU-C 370 Hall firmware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('namespace_control_logic.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">ControlLogic Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-nested-classes" class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:MOTOR_5FPID" id="r_MOTOR_5FPID"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_control_logic_1_1_m_o_t_o_r___p_i_d.html">MOTOR_PID</a></td></tr>
<tr class="memitem:MotorChannel" id="r_MotorChannel"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_control_logic_1_1_motor_channel.html">MotorChannel</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-enum-members" class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a3a47e5f4732fefd1ac3a3f8d33402a76" id="r_a3a47e5f4732fefd1ac3a3f8d33402a76"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76">filament_now_position_enum</a> { <br />
&#160;&#160;<a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>
, <a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f">filament_sending_out</a>
, <a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f">filament_using</a>
, <a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049">filament_pulling_back</a>
, <br />
&#160;&#160;<a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a0cc46749c7ec1ea4792e7459fe513bae">filament_redetect</a>
, <a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22">filament_loading</a>
, <a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2">filament_unloading</a>
<br />
 }</td></tr>
<tr class="memitem:ad46bf74f4e0b4c4fda041bdba813e8cf" id="r_ad46bf74f4e0b4c4fda041bdba813e8cf"><td class="memItemLeft" align="right" valign="top">enum class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad46bf74f4e0b4c4fda041bdba813e8cf">filament_motion_enum</a> { <br />
&#160;&#160;<a class="el" href="#ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b">stop</a>
, <a class="el" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890">send</a>
, <a class="el" href="#ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0">pull</a>
, <a class="el" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8">slow_send</a>
, <br />
&#160;&#160;<a class="el" href="#ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c">pressure_ctrl_idle</a>
, <a class="el" href="#ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75">pressure_ctrl_in_use</a>
, <a class="el" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa9b01b276e259d1d60ae1bea14f97731d">pressure_ctrl_on_use</a>
, <a class="el" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3">velocity_control</a>
<br />
 }</td></tr>
<tr class="memitem:aeb57036d717bcb2c083d524f4f493cbd" id="r_aeb57036d717bcb2c083d524f4f493cbd"><td class="memItemLeft" align="right" valign="top">enum class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aeb57036d717bcb2c083d524f4f493cbd">pressure_control_enum</a> { <a class="el" href="#aeb57036d717bcb2c083d524f4f493cbda5da09bef03bc5cf7a199c7cf66763f4c">less_pressure</a>
, <a class="el" href="#aeb57036d717bcb2c083d524f4f493cbdaa181a603769c1f98ad927e7367c7aa51">all</a>
, <a class="el" href="#aeb57036d717bcb2c083d524f4f493cbda1366d1b3f33e8e3fb08ac3905b8c9510">over_pressure</a>
 }</td></tr>
<tr class="memitem:aa23e295fa5022b6569547cf94f091070" id="r_aa23e295fa5022b6569547cf94f091070"><td class="memItemLeft" align="right" valign="top">enum class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa23e295fa5022b6569547cf94f091070">BootMode</a> : uint32_t { <a class="el" href="#aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a">BambuBus</a> = 0
, <a class="el" href="#aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55">Klipper</a> = 1
 }</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4ddc46100d9f991cb0d171e62707ee7c" id="r_a4ddc46100d9f991cb0d171e62707ee7c"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4ddc46100d9f991cb0d171e62707ee7c">get_time64</a> ()</td></tr>
<tr class="memitem:ac2d890c891494072159ebc2b30490197" id="r_ac2d890c891494072159ebc2b30490197"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac2d890c891494072159ebc2b30490197">motor_motion_switch</a> ()</td></tr>
<tr class="memdesc:ac2d890c891494072159ebc2b30490197"><td class="mdescLeft">&#160;</td><td class="mdescRight">State Machine for BambuBus Logic.  <br /></td></tr>
<tr class="memitem:ab1b5b19d84cdbba6ef3ad97fba14ce13" id="r_ab1b5b19d84cdbba6ef3ad97fba14ce13"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab1b5b19d84cdbba6ef3ad97fba14ce13">MC_PULL_ONLINE_read</a> ()</td></tr>
<tr class="memdesc:ab1b5b19d84cdbba6ef3ad97fba14ce13"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read Analog Sensors and Update State.  <br /></td></tr>
<tr class="memitem:adb4ce7f82b449d6d6d97e7399ce391f5" id="r_adb4ce7f82b449d6d6d97e7399ce391f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adb4ce7f82b449d6d6d97e7399ce391f5">StartLoadFilament</a> (int tray, int length_mm)</td></tr>
<tr class="memdesc:adb4ce7f82b449d6d6d97e7399ce391f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initiate a Filament Load sequence for a specific tray.  <br /></td></tr>
<tr class="memitem:abcc93276e326829eec4d37024c647745" id="r_abcc93276e326829eec4d37024c647745"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abcc93276e326829eec4d37024c647745">StartUnloadFilament</a> (int tray, int length_mm)</td></tr>
<tr class="memdesc:abcc93276e326829eec4d37024c647745"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initiate a Filament Unload sequence for a specific tray.  <br /></td></tr>
<tr class="memitem:a484eadc314267f8bc9aa0f025c1137d9" id="r_a484eadc314267f8bc9aa0f025c1137d9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a484eadc314267f8bc9aa0f025c1137d9">MoveAxis</a> (int axis, float dist_mm, float speed)</td></tr>
<tr class="memdesc:a484eadc314267f8bc9aa0f025c1137d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Manually move an axis (Klipper Primitive).  <br /></td></tr>
<tr class="memitem:af084200798d6b89c1b448bf41b105d62" id="r_af084200798d6b89c1b448bf41b105d62"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af084200798d6b89c1b448bf41b105d62">StopAll</a> ()</td></tr>
<tr class="memdesc:af084200798d6b89c1b448bf41b105d62"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop all motors.  <br /></td></tr>
<tr class="memitem:a9db355302a1c9d608e6dd5341151336e" id="r_a9db355302a1c9d608e6dd5341151336e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9db355302a1c9d608e6dd5341151336e">SetAutoFeed</a> (int lane, bool enable)</td></tr>
<tr class="memdesc:a9db355302a1c9d608e6dd5341151336e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable/Disable Auto-Feed (Pressure Control) for a lane.  <br /></td></tr>
<tr class="memitem:a4428a845041ff986ccbf2555a62d0656" id="r_a4428a845041ff986ccbf2555a62d0656"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4428a845041ff986ccbf2555a62d0656">GetSensorState</a> ()</td></tr>
<tr class="memdesc:a4428a845041ff986ccbf2555a62d0656"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a bitmask of sensor states.  <br /></td></tr>
<tr class="memitem:a77da31cf0baa8e886a438b2a9e73a573" id="r_a77da31cf0baa8e886a438b2a9e73a573"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a77da31cf0baa8e886a438b2a9e73a573">GetLaneMotion</a> (int lane)</td></tr>
<tr class="memdesc:a77da31cf0baa8e886a438b2a9e73a573"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current motion state of a lane.  <br /></td></tr>
<tr class="memitem:aa3d38299372c0822e90d6e649344e8ad" id="r_aa3d38299372c0822e90d6e649344e8ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa3d38299372c0822e90d6e649344e8ad">AS5600_Update</a> (float time_E)</td></tr>
<tr class="memdesc:aa3d38299372c0822e90d6e649344e8ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update Odometer and Speed from AS5600 sensors.  <br /></td></tr>
<tr class="memitem:a175e5057d122e1fee05a99bb0e40bbf3" id="r_a175e5057d122e1fee05a99bb0e40bbf3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a175e5057d122e1fee05a99bb0e40bbf3">SaveSettings</a> ()</td></tr>
<tr class="memdesc:a175e5057d122e1fee05a99bb0e40bbf3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Commit settings to Flash memory.  <br /></td></tr>
<tr class="memitem:afe90d7f284c20f90f74787274f01c51b" id="r_afe90d7f284c20f90f74787274f01c51b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afe90d7f284c20f90f74787274f01c51b">SetNeedToSave</a> ()</td></tr>
<tr class="memdesc:afe90d7f284c20f90f74787274f01c51b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag that settings need to be saved.  <br /></td></tr>
<tr class="memitem:acb78560c64e5ea050853ab319a03f14e" id="r_acb78560c64e5ea050853ab319a03f14e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acb78560c64e5ea050853ab319a03f14e">Prepare_For_filament_Pull_Back</a> (float_t OUT_filament_meters)</td></tr>
<tr class="memdesc:acb78560c64e5ea050853ab319a03f14e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if pullback is required (Smart Pullback Logic).  <br /></td></tr>
<tr class="memitem:adc8c269923e0c76c6d104a005833a7f9" id="r_adc8c269923e0c76c6d104a005833a7f9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adc8c269923e0c76c6d104a005833a7f9">Run</a> ()</td></tr>
<tr class="memdesc:adc8c269923e0c76c6d104a005833a7f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main Control Loop.  <br /></td></tr>
<tr class="memitem:ae855e1aa5895afa9999a3b9e6874e1e2" id="r_ae855e1aa5895afa9999a3b9e6874e1e2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae855e1aa5895afa9999a3b9e6874e1e2">LoadSettings</a> ()</td></tr>
<tr class="memdesc:ae855e1aa5895afa9999a3b9e6874e1e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load settings from Flash memory.  <br /></td></tr>
<tr class="memitem:a1da226a05b7a8c46e16a840900265c03" id="r_a1da226a05b7a8c46e16a840900265c03"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1da226a05b7a8c46e16a840900265c03">Init</a> ()</td></tr>
<tr class="memdesc:a1da226a05b7a8c46e16a840900265c03"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize <a class="el" href="namespace_control_logic.html">ControlLogic</a>.  <br /></td></tr>
<tr class="memitem:a0c732b28cf691fb77359c80a0c000665" id="r_a0c732b28cf691fb77359c80a0c000665"><td class="memItemLeft" align="right" valign="top"><a class="el" href="#aa23e295fa5022b6569547cf94f091070">BootMode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0c732b28cf691fb77359c80a0c000665">InitBootCheck</a> ()</td></tr>
<tr class="memdesc:a0c732b28cf691fb77359c80a0c000665"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check Boot Mode (Button Press at Startup).  <br /></td></tr>
<tr class="memitem:a300e5b18ebf53c086955bf02dfe16faa" id="r_a300e5b18ebf53c086955bf02dfe16faa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="#aa23e295fa5022b6569547cf94f091070">BootMode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a300e5b18ebf53c086955bf02dfe16faa">GetBootMode</a> ()</td></tr>
<tr class="memdesc:a300e5b18ebf53c086955bf02dfe16faa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get current Boot Mode.  <br /></td></tr>
<tr class="memitem:a9716be5fe9da72481bee41a80681d8e5" id="r_a9716be5fe9da72481bee41a80681d8e5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9716be5fe9da72481bee41a80681d8e5">UpdateConnectivity</a> (bool online)</td></tr>
<tr class="memdesc:a9716be5fe9da72481bee41a80681d8e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update connectivity status (Online/Offline).  <br /></td></tr>
<tr class="memitem:a8880b393facb6828519b8dac8e96393c" id="r_a8880b393facb6828519b8dac8e96393c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8880b393facb6828519b8dac8e96393c">ProcessMotionShortLogic</a> (uint8_t ams_num, uint8_t statu_flags, uint8_t read_num, uint8_t fliment_motion_flag)</td></tr>
<tr class="memdesc:a8880b393facb6828519b8dac8e96393c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Core logic for processing Short Motion packets.  <br /></td></tr>
<tr class="memitem:a5f85db884abd1a66d8b120729ec0d99e" id="r_a5f85db884abd1a66d8b120729ec0d99e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5f85db884abd1a66d8b120729ec0d99e">ProcessMotionShort</a> (uint8_t *buffer, uint16_t length)</td></tr>
<tr class="memdesc:a5f85db884abd1a66d8b120729ec0d99e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for Filament Motion Short packet (0x03).  <br /></td></tr>
<tr class="memitem:a2ab840bfd454a7709553b89529285b74" id="r_a2ab840bfd454a7709553b89529285b74"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2ab840bfd454a7709553b89529285b74">ProcessMotionLong</a> (uint8_t *buffer, uint16_t length)</td></tr>
<tr class="memdesc:a2ab840bfd454a7709553b89529285b74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for Filament Motion Long packet (0x04).  <br /></td></tr>
<tr class="memitem:a412a7a597ff3c04c0ea1480094600ef4" id="r_a412a7a597ff3c04c0ea1480094600ef4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a412a7a597ff3c04c0ea1480094600ef4">ProcessOnlineDetect</a> (uint8_t *buffer, uint16_t length)</td></tr>
<tr class="memdesc:a412a7a597ff3c04c0ea1480094600ef4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for Online Detect (0x05).  <br /></td></tr>
<tr class="memitem:a82b9a1fb120cd91615d2ac478daafefd" id="r_a82b9a1fb120cd91615d2ac478daafefd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a82b9a1fb120cd91615d2ac478daafefd">ProcessREQx6</a> (uint8_t *buffer, uint16_t length)</td></tr>
<tr class="memdesc:a82b9a1fb120cd91615d2ac478daafefd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for REQx6 (0x06).  <br /></td></tr>
<tr class="memitem:a0c4206af909c8128bc68eb6a1bcfa16e" id="r_a0c4206af909c8128bc68eb6a1bcfa16e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0c4206af909c8128bc68eb6a1bcfa16e">ProcessHeartbeat</a> (uint8_t *buffer, uint16_t length)</td></tr>
<tr class="memdesc:a0c4206af909c8128bc68eb6a1bcfa16e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for Heartbeat (0x20).  <br /></td></tr>
<tr class="memitem:ada1dd6f18fca06d8b26836f4788ab0ad" id="r_ada1dd6f18fca06d8b26836f4788ab0ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ada1dd6f18fca06d8b26836f4788ab0ad">ProcessSetFilamentInfo</a> (uint8_t *buffer, uint16_t length)</td></tr>
<tr class="memdesc:ada1dd6f18fca06d8b26836f4788ab0ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for Set Filament Info (0x08 - Short).  <br /></td></tr>
<tr class="memitem:a3aed4ef4cb26632467a000c0130b11b4" id="r_a3aed4ef4cb26632467a000c0130b11b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3aed4ef4cb26632467a000c0130b11b4">SetFilamentInfoAction</a> (int id, const <a class="el" href="struct_filament_info.html">FilamentInfo</a> &amp;info, float meters)</td></tr>
<tr class="memdesc:a3aed4ef4cb26632467a000c0130b11b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Action helper to update filament metadata.  <br /></td></tr>
<tr class="memitem:a1ff0bcee8062346fb963e4dd845c8bdf" id="r_a1ff0bcee8062346fb963e4dd845c8bdf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1ff0bcee8062346fb963e4dd845c8bdf">ProcessLongPacket</a> (struct <a class="el" href="structlong__packge__data.html">long_packge_data</a> &amp;data)</td></tr>
<tr class="memdesc:a1ff0bcee8062346fb963e4dd845c8bdf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler/Dispatcher for Long Packets.  <br /></td></tr>
<tr class="memitem:acca64947bdc9cfb88ea5091014c68b75" id="r_acca64947bdc9cfb88ea5091014c68b75"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acca64947bdc9cfb88ea5091014c68b75">GetDeviceType</a> ()</td></tr>
<tr class="memdesc:acca64947bdc9cfb88ea5091014c68b75"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the configured device type.  <br /></td></tr>
<tr class="memitem:aa490d28f0823086ff5e1e97451425dc7" id="r_aa490d28f0823086ff5e1e97451425dc7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa490d28f0823086ff5e1e97451425dc7">ProcessMotionLongLogic</a> (uint8_t *payload, uint16_t length)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a9a6c6bb73ae52885ddaa5ec56d8603f9" id="r_a9a6c6bb73ae52885ddaa5ec56d8603f9"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9a6c6bb73ae52885ddaa5ec56d8603f9">PULL_voltage_up</a> = 1.85f</td></tr>
<tr class="memitem:a73b9466c4e3c236a186659863283f00e" id="r_a73b9466c4e3c236a186659863283f00e"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a73b9466c4e3c236a186659863283f00e">PULL_voltage_down</a> = 1.45f</td></tr>
<tr class="memitem:a0dc914125ce5b958b6d1620c814a580d" id="r_a0dc914125ce5b958b6d1620c814a580d"><td class="memItemLeft" align="right" valign="top">float_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0dc914125ce5b958b6d1620c814a580d">P1X_OUT_filament_meters</a> = 200.0f</td></tr>
<tr class="memitem:a5428672c2045ec91715338f32d8bb5f1" id="r_a5428672c2045ec91715338f32d8bb5f1"><td class="memItemLeft" align="right" valign="top">static float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5428672c2045ec91715338f32d8bb5f1">speed_as5600</a> [4] = {0, 0, 0, 0}</td></tr>
<tr class="memitem:a14f470efe568bae229e028e1b1acd54f" id="r_a14f470efe568bae229e028e1b1acd54f"><td class="memItemLeft" align="right" valign="top">static float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a14f470efe568bae229e028e1b1acd54f">MC_PULL_stu_raw</a> [4] = {0, 0, 0, 0}</td></tr>
<tr class="memitem:a87d54195660d73ebcd372cad0fd74915" id="r_a87d54195660d73ebcd372cad0fd74915"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a87d54195660d73ebcd372cad0fd74915">MC_PULL_stu</a> [4] = {0, 0, 0, 0}</td></tr>
<tr class="memitem:ae2535696ce7487f6ec12d1f2e174e598" id="r_ae2535696ce7487f6ec12d1f2e174e598"><td class="memItemLeft" align="right" valign="top">static float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae2535696ce7487f6ec12d1f2e174e598">MC_ONLINE_key_stu_raw</a> [4] = {0, 0, 0, 0}</td></tr>
<tr class="memitem:a503041f38fbec420305ae1bb79aa4002" id="r_a503041f38fbec420305ae1bb79aa4002"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a> [4] = {0, 0, 0, 0}</td></tr>
<tr class="memitem:a280d12e7265d1830d4859cc38dd5497e" id="r_a280d12e7265d1830d4859cc38dd5497e"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a280d12e7265d1830d4859cc38dd5497e">Assist_send_filament</a> [4] = {false}</td></tr>
<tr class="memitem:a33f7ccbf87b78ae7394f88ffe1a4a75e" id="r_a33f7ccbf87b78ae7394f88ffe1a4a75e"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a33f7ccbf87b78ae7394f88ffe1a4a75e">pull_state_old</a> = false</td></tr>
<tr class="memitem:aef70a34b1f25019450171bfa5c07ab62" id="r_aef70a34b1f25019450171bfa5c07ab62"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aef70a34b1f25019450171bfa5c07ab62">is_backing_out</a> = false</td></tr>
<tr class="memitem:a8abb9a7c0790b08a5e5f31c8874bb15f" id="r_a8abb9a7c0790b08a5e5f31c8874bb15f"><td class="memItemLeft" align="right" valign="top">static const bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8abb9a7c0790b08a5e5f31c8874bb15f">is_two</a> = true</td></tr>
<tr class="memitem:ad161a11879586190d66f43141bb6578f" id="r_ad161a11879586190d66f43141bb6578f"><td class="memItemLeft" align="right" valign="top">static int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad161a11879586190d66f43141bb6578f">as5600_distance_save</a> [4] = {0, 0, 0, 0}</td></tr>
<tr class="memitem:a11bff287b64c24fe91500ba99c6f21c8" id="r_a11bff287b64c24fe91500ba99c6f21c8"><td class="memItemLeft" align="right" valign="top">static int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a11bff287b64c24fe91500ba99c6f21c8">unload_target_dist</a> [4] = {0, 0, 0, 0}</td></tr>
<tr class="memitem:a0efb555ba92cc1cedb47929db260e6c8" id="r_a0efb555ba92cc1cedb47929db260e6c8"><td class="memItemLeft" align="right" valign="top">static float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0efb555ba92cc1cedb47929db260e6c8">unload_start_meters</a> [4] = {0, 0, 0, 0}</td></tr>
<tr class="memitem:a3cb6555c20c1e3a386f34fa9f5e6b596" id="r_a3cb6555c20c1e3a386f34fa9f5e6b596"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76">filament_now_position_enum</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a> [4] = {<a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>, <a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>, <a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>, <a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>}</td></tr>
<tr class="memitem:a5cc135d9070e574d8b2fe9c9b328a148" id="r_a5cc135d9070e574d8b2fe9c9b328a148"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5cc135d9070e574d8b2fe9c9b328a148">Bambubus_need_to_save</a> = false</td></tr>
<tr class="memitem:a17835f3a0e8384e40e9d647ce79d3d22" id="r_a17835f3a0e8384e40e9d647ce79d3d22"><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a17835f3a0e8384e40e9d647ce79d3d22">save_timer</a> = 0</td></tr>
<tr class="memitem:ac4fff77bfcf6d233d9c740ce7bc1a4da" id="r_ac4fff77bfcf6d233d9c740ce7bc1a4da"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="class_control_logic_1_1_motor_channel.html">MotorChannel</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a> [4] = {0, 1, 2, 3}</td></tr>
</table>
<a name="doc-enum-members" id="doc-enum-members"></a><h2 id="header-doc-enum-members" class="groupheader">Enumeration Type Documentation</h2>
<a id="aa23e295fa5022b6569547cf94f091070" name="aa23e295fa5022b6569547cf94f091070"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa23e295fa5022b6569547cf94f091070">&#9670;&#160;</a></span>BootMode</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum class <a class="el" href="#aa23e295fa5022b6569547cf94f091070">ControlLogic::BootMode</a> : uint32_t</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel strong">strong</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a" name="aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a"></a>BambuBus&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55" name="aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55"></a>Klipper&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="_control_logic_8h_source.html#l00014">14</a> of file <a class="el" href="_control_logic_8h_source.html">ControlLogic.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   14</span>                        : uint32_t {</div>
<div class="line"><span class="lineno">   15</span>        <a class="code hl_enumvalue" href="#aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a">BambuBus</a> = 0,</div>
<div class="line"><span class="lineno">   16</span>        <a class="code hl_enumvalue" href="#aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55">Klipper</a> = 1</div>
<div class="line"><span class="lineno">   17</span>    };</div>
<div class="ttc" id="anamespace_control_logic_html_aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55"><div class="ttname"><a href="#aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55">ControlLogic::BootMode::Klipper</a></div><div class="ttdeci">@ Klipper</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8h_source.html#l00016">ControlLogic.h:16</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a"><div class="ttname"><a href="#aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a">ControlLogic::BootMode::BambuBus</a></div><div class="ttdeci">@ BambuBus</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8h_source.html#l00015">ControlLogic.h:15</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad46bf74f4e0b4c4fda041bdba813e8cf" name="ad46bf74f4e0b4c4fda041bdba813e8cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad46bf74f4e0b4c4fda041bdba813e8cf">&#9670;&#160;</a></span>filament_motion_enum</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum class <a class="el" href="#ad46bf74f4e0b4c4fda041bdba813e8cf">ControlLogic::filament_motion_enum</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel strong">strong</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b" name="ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b"></a>stop&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890" name="ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890"></a>send&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0" name="ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0"></a>pull&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8" name="ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8"></a>slow_send&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c" name="ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c"></a>pressure_ctrl_idle&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75" name="ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75"></a>pressure_ctrl_in_use&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad46bf74f4e0b4c4fda041bdba813e8cfa9b01b276e259d1d60ae1bea14f97731d" name="ad46bf74f4e0b4c4fda041bdba813e8cfa9b01b276e259d1d60ae1bea14f97731d"></a>pressure_ctrl_on_use&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3" name="ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3"></a>velocity_control&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00181">181</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  182</span>    {</div>
<div class="line"><span class="lineno">  183</span>        <a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b">stop</a>,</div>
<div class="line"><span class="lineno">  184</span>        <a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890">send</a>,</div>
<div class="line"><span class="lineno">  185</span>        <a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0">pull</a>,</div>
<div class="line"><span class="lineno">  186</span>        <a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8">slow_send</a>,</div>
<div class="line"><span class="lineno">  187</span>        <a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c">pressure_ctrl_idle</a>,</div>
<div class="line"><span class="lineno">  188</span>        <a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75">pressure_ctrl_in_use</a>, </div>
<div class="line"><span class="lineno">  189</span>        <a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa9b01b276e259d1d60ae1bea14f97731d">pressure_ctrl_on_use</a>,</div>
<div class="line"><span class="lineno">  190</span>        <a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3">velocity_control</a> <span class="comment">// Added for Klipper</span></div>
<div class="line"><span class="lineno">  191</span>    };</div>
<div class="ttc" id="anamespace_control_logic_html_ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8"><div class="ttname"><a href="#ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8">ControlLogic::filament_motion_enum::slow_send</a></div><div class="ttdeci">@ slow_send</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00186">ControlLogic.cpp:186</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890"><div class="ttname"><a href="#ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890">ControlLogic::filament_motion_enum::send</a></div><div class="ttdeci">@ send</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00184">ControlLogic.cpp:184</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3"><div class="ttname"><a href="#ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3">ControlLogic::filament_motion_enum::velocity_control</a></div><div class="ttdeci">@ velocity_control</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00190">ControlLogic.cpp:190</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_ad46bf74f4e0b4c4fda041bdba813e8cfa9b01b276e259d1d60ae1bea14f97731d"><div class="ttname"><a href="#ad46bf74f4e0b4c4fda041bdba813e8cfa9b01b276e259d1d60ae1bea14f97731d">ControlLogic::filament_motion_enum::pressure_ctrl_on_use</a></div><div class="ttdeci">@ pressure_ctrl_on_use</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00189">ControlLogic.cpp:189</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c"><div class="ttname"><a href="#ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c">ControlLogic::filament_motion_enum::pressure_ctrl_idle</a></div><div class="ttdeci">@ pressure_ctrl_idle</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00187">ControlLogic.cpp:187</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b"><div class="ttname"><a href="#ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b">ControlLogic::filament_motion_enum::stop</a></div><div class="ttdeci">@ stop</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00183">ControlLogic.cpp:183</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0"><div class="ttname"><a href="#ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0">ControlLogic::filament_motion_enum::pull</a></div><div class="ttdeci">@ pull</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00185">ControlLogic.cpp:185</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75"><div class="ttname"><a href="#ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75">ControlLogic::filament_motion_enum::pressure_ctrl_in_use</a></div><div class="ttdeci">@ pressure_ctrl_in_use</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00188">ControlLogic.cpp:188</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3a47e5f4732fefd1ac3a3f8d33402a76" name="a3a47e5f4732fefd1ac3a3f8d33402a76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a47e5f4732fefd1ac3a3f8d33402a76">&#9670;&#160;</a></span>filament_now_position_enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76">ControlLogic::filament_now_position_enum</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5" name="a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5"></a>filament_idle&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f" name="a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f"></a>filament_sending_out&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f" name="a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f"></a>filament_using&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049" name="a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049"></a>filament_pulling_back&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a3a47e5f4732fefd1ac3a3f8d33402a76a0cc46749c7ec1ea4792e7459fe513bae" name="a3a47e5f4732fefd1ac3a3f8d33402a76a0cc46749c7ec1ea4792e7459fe513bae"></a>filament_redetect&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22" name="a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22"></a>filament_loading&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2" name="a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2"></a>filament_unloading&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00170">170</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  171</span>    {</div>
<div class="line"><span class="lineno">  172</span>        <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>,</div>
<div class="line"><span class="lineno">  173</span>        <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f">filament_sending_out</a>,</div>
<div class="line"><span class="lineno">  174</span>        <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f">filament_using</a>,</div>
<div class="line"><span class="lineno">  175</span>        <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049">filament_pulling_back</a>,</div>
<div class="line"><span class="lineno">  176</span>        <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a0cc46749c7ec1ea4792e7459fe513bae">filament_redetect</a>,</div>
<div class="line"><span class="lineno">  177</span>        <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22">filament_loading</a>, <span class="comment">// Added for LOAD_FILAMENT command</span></div>
<div class="line"><span class="lineno">  178</span>        <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2">filament_unloading</a>, <span class="comment">// Added for UNLOAD_FILAMENT command</span></div>
<div class="line"><span class="lineno">  179</span>    };</div>
<div class="ttc" id="anamespace_control_logic_html_a3a47e5f4732fefd1ac3a3f8d33402a76a0cc46749c7ec1ea4792e7459fe513bae"><div class="ttname"><a href="#a3a47e5f4732fefd1ac3a3f8d33402a76a0cc46749c7ec1ea4792e7459fe513bae">ControlLogic::filament_redetect</a></div><div class="ttdeci">@ filament_redetect</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00176">ControlLogic.cpp:176</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2"><div class="ttname"><a href="#a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2">ControlLogic::filament_unloading</a></div><div class="ttdeci">@ filament_unloading</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00178">ControlLogic.cpp:178</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f"><div class="ttname"><a href="#a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f">ControlLogic::filament_sending_out</a></div><div class="ttdeci">@ filament_sending_out</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00173">ControlLogic.cpp:173</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22"><div class="ttname"><a href="#a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22">ControlLogic::filament_loading</a></div><div class="ttdeci">@ filament_loading</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00177">ControlLogic.cpp:177</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5"><div class="ttname"><a href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">ControlLogic::filament_idle</a></div><div class="ttdeci">@ filament_idle</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00172">ControlLogic.cpp:172</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049"><div class="ttname"><a href="#a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049">ControlLogic::filament_pulling_back</a></div><div class="ttdeci">@ filament_pulling_back</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00175">ControlLogic.cpp:175</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f"><div class="ttname"><a href="#a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f">ControlLogic::filament_using</a></div><div class="ttdeci">@ filament_using</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00174">ControlLogic.cpp:174</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aeb57036d717bcb2c083d524f4f493cbd" name="aeb57036d717bcb2c083d524f4f493cbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb57036d717bcb2c083d524f4f493cbd">&#9670;&#160;</a></span>pressure_control_enum</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum class <a class="el" href="#aeb57036d717bcb2c083d524f4f493cbd">ControlLogic::pressure_control_enum</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel strong">strong</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="aeb57036d717bcb2c083d524f4f493cbda5da09bef03bc5cf7a199c7cf66763f4c" name="aeb57036d717bcb2c083d524f4f493cbda5da09bef03bc5cf7a199c7cf66763f4c"></a>less_pressure&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="aeb57036d717bcb2c083d524f4f493cbdaa181a603769c1f98ad927e7367c7aa51" name="aeb57036d717bcb2c083d524f4f493cbdaa181a603769c1f98ad927e7367c7aa51"></a>all&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="aeb57036d717bcb2c083d524f4f493cbda1366d1b3f33e8e3fb08ac3905b8c9510" name="aeb57036d717bcb2c083d524f4f493cbda1366d1b3f33e8e3fb08ac3905b8c9510"></a>over_pressure&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00322">322</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  322</span>{ <a class="code hl_enumvalue" href="#aeb57036d717bcb2c083d524f4f493cbda5da09bef03bc5cf7a199c7cf66763f4c">less_pressure</a>, <a class="code hl_enumvalue" href="#aeb57036d717bcb2c083d524f4f493cbdaa181a603769c1f98ad927e7367c7aa51">all</a>, <a class="code hl_enumvalue" href="#aeb57036d717bcb2c083d524f4f493cbda1366d1b3f33e8e3fb08ac3905b8c9510">over_pressure</a> };</div>
<div class="ttc" id="anamespace_control_logic_html_aeb57036d717bcb2c083d524f4f493cbda1366d1b3f33e8e3fb08ac3905b8c9510"><div class="ttname"><a href="#aeb57036d717bcb2c083d524f4f493cbda1366d1b3f33e8e3fb08ac3905b8c9510">ControlLogic::pressure_control_enum::over_pressure</a></div><div class="ttdeci">@ over_pressure</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00322">ControlLogic.cpp:322</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_aeb57036d717bcb2c083d524f4f493cbda5da09bef03bc5cf7a199c7cf66763f4c"><div class="ttname"><a href="#aeb57036d717bcb2c083d524f4f493cbda5da09bef03bc5cf7a199c7cf66763f4c">ControlLogic::pressure_control_enum::less_pressure</a></div><div class="ttdeci">@ less_pressure</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00322">ControlLogic.cpp:322</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_aeb57036d717bcb2c083d524f4f493cbdaa181a603769c1f98ad927e7367c7aa51"><div class="ttname"><a href="#aeb57036d717bcb2c083d524f4f493cbdaa181a603769c1f98ad927e7367c7aa51">ControlLogic::pressure_control_enum::all</a></div><div class="ttdeci">@ all</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00322">ControlLogic.cpp:322</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="aa3d38299372c0822e90d6e649344e8ad" name="aa3d38299372c0822e90d6e649344e8ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3d38299372c0822e90d6e649344e8ad">&#9670;&#160;</a></span>AS5600_Update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::AS5600_Update </td>
          <td>(</td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>time_E</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update Odometer and Speed from AS5600 sensors. </p>
<p>Reads angles, calculates delta, computes speed and distance. Updates global odometer meters for the filament.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">time_E</td><td>Time elapsed. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00694">694</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  694</span>                                     {</div>
<div class="line"><span class="lineno">  695</span>        <a class="code hl_variable" href="_control_logic_8cpp.html#ab704ea0db8b260d9ddf7fd829cbe637f">MC_AS5600</a>.updata_angle();</div>
<div class="line"><span class="lineno">  696</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++) {</div>
<div class="line"><span class="lineno">  697</span>            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="_control_logic_8cpp.html#ab704ea0db8b260d9ddf7fd829cbe637f">MC_AS5600</a>.online[i]) {</div>
<div class="line"><span class="lineno">  698</span>                <a class="code hl_variable" href="#a5428672c2045ec91715338f32d8bb5f1">speed_as5600</a>[i] = 0; <a class="code hl_variable" href="#ad161a11879586190d66f43141bb6578f">as5600_distance_save</a>[i] = 0; <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  699</span>            }</div>
<div class="line"><span class="lineno">  700</span>            int32_t now = <a class="code hl_variable" href="_control_logic_8cpp.html#ab704ea0db8b260d9ddf7fd829cbe637f">MC_AS5600</a>.raw_angle[i];</div>
<div class="line"><span class="lineno">  701</span>            int32_t last = <a class="code hl_variable" href="#ad161a11879586190d66f43141bb6578f">as5600_distance_save</a>[i];</div>
<div class="line"><span class="lineno">  702</span>            <span class="keywordtype">int</span> cir_E = 0;</div>
<div class="line"><span class="lineno">  703</span>            <span class="keywordflow">if</span> (now &gt; 3072 &amp;&amp; last &lt;= 1024) cir_E = -4096;</div>
<div class="line"><span class="lineno">  704</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (now &lt;= 1024 &amp;&amp; last &gt; 3072) cir_E = 4096;</div>
<div class="line"><span class="lineno">  705</span>            </div>
<div class="line"><span class="lineno">  706</span>            <span class="keywordtype">float</span> dist_E = -(float)(now - last + cir_E) * <a class="code hl_define" href="_control_logic_8cpp.html#a4e1c3fb8f754e84e8bc6c30bbba50272">AS5600_PI</a> * 7.5 / 4096; </div>
<div class="line"><span class="lineno">  707</span>            <a class="code hl_variable" href="#ad161a11879586190d66f43141bb6578f">as5600_distance_save</a>[i] = now;</div>
<div class="line"><span class="lineno">  708</span>            </div>
<div class="line"><span class="lineno">  709</span>            <span class="keywordtype">float</span> speedx = dist_E / (time_E &gt; 0 ? time_E : 0.001f);</div>
<div class="line"><span class="lineno">  710</span>            <a class="code hl_variable" href="#a5428672c2045ec91715338f32d8bb5f1">speed_as5600</a>[i] = speedx;</div>
<div class="line"><span class="lineno">  711</span>            </div>
<div class="line"><span class="lineno">  712</span>            <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.filament[i].meters += dist_E / 1000.0f;</div>
<div class="line"><span class="lineno">  713</span>        }</div>
<div class="line"><span class="lineno">  714</span>    }</div>
<div class="ttc" id="a_control_logic_8cpp_html_a07df3d8e92f2b4de565d574c7950555a"><div class="ttname"><a href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a></div><div class="ttdeci">static flash_save_struct data_save</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00031">ControlLogic.cpp:31</a></div></div>
<div class="ttc" id="a_control_logic_8cpp_html_a4e1c3fb8f754e84e8bc6c30bbba50272"><div class="ttname"><a href="_control_logic_8cpp.html#a4e1c3fb8f754e84e8bc6c30bbba50272">AS5600_PI</a></div><div class="ttdeci">#define AS5600_PI</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00193">ControlLogic.cpp:193</a></div></div>
<div class="ttc" id="a_control_logic_8cpp_html_ab704ea0db8b260d9ddf7fd829cbe637f"><div class="ttname"><a href="_control_logic_8cpp.html#ab704ea0db8b260d9ddf7fd829cbe637f">MC_AS5600</a></div><div class="ttdeci">static AS5600_soft_IIC MC_AS5600</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00032">ControlLogic.cpp:32</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a5428672c2045ec91715338f32d8bb5f1"><div class="ttname"><a href="#a5428672c2045ec91715338f32d8bb5f1">ControlLogic::speed_as5600</a></div><div class="ttdeci">static float speed_as5600[4]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00204">ControlLogic.cpp:204</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_ad161a11879586190d66f43141bb6578f"><div class="ttname"><a href="#ad161a11879586190d66f43141bb6578f">ControlLogic::as5600_distance_save</a></div><div class="ttdeci">static int32_t as5600_distance_save[4]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00213">ControlLogic.cpp:213</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00213">as5600_distance_save</a>, <a class="el" href="_control_logic_8cpp_source.html#l00193">AS5600_PI</a>, <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>, <a class="el" href="_control_logic_8cpp_source.html#l00032">MC_AS5600</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00204">speed_as5600</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00792">Run()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_aa3d38299372c0822e90d6e649344e8ad_icgraph.png" border="0" usemap="#anamespace_control_logic_aa3d38299372c0822e90d6e649344e8ad_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_aa3d38299372c0822e90d6e649344e8ad_icgraph" id="anamespace_control_logic_aa3d38299372c0822e90d6e649344e8ad_icgraph">
<area shape="rect" title="Update Odometer and Speed from AS5600 sensors." alt="" coords="669,5,817,48"/>
<area shape="rect" href="namespace_control_logic.html#adc8c269923e0c76c6d104a005833a7f9" title="Main Control Loop." alt="" coords="494,13,621,40"/>
<area shape="poly" title=" " alt="" coords="650,27,621,29,621,24,656,27"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,13,446,40"/>
<area shape="poly" title=" " alt="" coords="476,27,447,29,447,24,482,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,13,353,40"/>
<area shape="poly" title=" " alt="" coords="383,27,353,29,353,24,388,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,5,140,48"/>
<area shape="poly" title=" " alt="" coords="170,27,140,29,140,24,175,26"/>
</map>
</div>

</div>
</div>
<a id="a4ddc46100d9f991cb0d171e62707ee7c" name="a4ddc46100d9f991cb0d171e62707ee7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ddc46100d9f991cb0d171e62707ee7c">&#9670;&#160;</a></span>get_time64()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t ControlLogic::get_time64 </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00227">227</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  227</span>{ <span class="keywordflow">return</span> <a class="code hl_function" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3">Hardware::GetTime</a>(); }</div>
<div class="ttc" id="anamespace_hardware_html_a8ea28b07408691bc126683a81aa220f3"><div class="ttname"><a href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3">Hardware::GetTime</a></div><div class="ttdeci">uint64_t GetTime()</div><div class="ttdoc">Get System Time in Milliseconds.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00115">Hardware.cpp:115</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00115">Hardware::GetTime()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00962">motor_motion_switch()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l01160">ProcessMotionShortLogic()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c_cgraph.png" border="0" usemap="#anamespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c_cgraph" id="anamespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,172,32"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="220,5,355,32"/>
<area shape="poly" title=" " alt="" coords="172,16,207,19,201,19,172,21"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="403,5,488,32"/>
<area shape="poly" title=" " alt="" coords="356,16,390,19,385,19,356,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c_icgraph.png" border="0" usemap="#anamespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c_icgraph" id="anamespace_control_logic_a4ddc46100d9f991cb0d171e62707ee7c_icgraph">
<area shape="rect" title=" " alt="" coords="969,47,1135,73"/>
<area shape="rect" href="namespace_control_logic.html#ac2d890c891494072159ebc2b30490197" title="State Machine for BambuBus Logic." alt="" coords="759,5,894,48"/>
<area shape="poly" title=" " alt="" coords="951,45,894,39,895,34,956,45"/>
<area shape="rect" href="namespace_control_logic.html#a8880b393facb6828519b8dac8e96393c" title="Core logic for processing Short Motion packets." alt="" coords="732,72,921,115"/>
<area shape="poly" title=" " alt="" coords="956,74,922,82,921,77,951,75"/>
<area shape="rect" href="namespace_control_logic.html#adc8c269923e0c76c6d104a005833a7f9" title="Main Control Loop." alt="" coords="526,13,652,40"/>
<area shape="poly" title=" " alt="" coords="741,27,653,29,653,24,746,26"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,13,446,40"/>
<area shape="poly" title=" " alt="" coords="507,27,447,29,447,24,513,26"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,13,353,40"/>
<area shape="poly" title=" " alt="" coords="383,27,354,29,353,24,388,26"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,5,140,48"/>
<area shape="poly" title=" " alt="" coords="170,28,140,29,139,24,175,26"/>
<area shape="rect" href="namespace_control_logic.html#a5f85db884abd1a66d8b120729ec0d99e" title="Handler for Filament Motion Short packet (0x03)." alt="" coords="494,72,684,115"/>
<area shape="poly" title=" " alt="" coords="713,93,684,96,684,91,719,93"/>
</map>
</div>

</div>
</div>
<a id="a300e5b18ebf53c086955bf02dfe16faa" name="a300e5b18ebf53c086955bf02dfe16faa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a300e5b18ebf53c086955bf02dfe16faa">&#9670;&#160;</a></span>GetBootMode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="#aa23e295fa5022b6569547cf94f091070">BootMode</a> ControlLogic::GetBootMode </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get current Boot Mode. </p>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="#aa23e295fa5022b6569547cf94f091070">BootMode</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00936">936</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  936</span>                           {</div>
<div class="line"><span class="lineno">  937</span>        <span class="keywordflow">return</span> (<a class="code hl_enumeration" href="#aa23e295fa5022b6569547cf94f091070">BootMode</a>)<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.boot_mode;</div>
<div class="line"><span class="lineno">  938</span>    }</div>
<div class="ttc" id="anamespace_control_logic_html_aa23e295fa5022b6569547cf94f091070"><div class="ttname"><a href="#aa23e295fa5022b6569547cf94f091070">ControlLogic::BootMode</a></div><div class="ttdeci">BootMode</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8h_source.html#l00014">ControlLogic.h:14</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>.</p>

<p class="reference">Referenced by <a class="el" href="_command_router_8cpp_source.html#l00180">CommandRouter::Run()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a300e5b18ebf53c086955bf02dfe16faa_icgraph.png" border="0" usemap="#anamespace_control_logic_a300e5b18ebf53c086955bf02dfe16faa_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a300e5b18ebf53c086955bf02dfe16faa_icgraph" id="anamespace_control_logic_a300e5b18ebf53c086955bf02dfe16faa_icgraph">
<area shape="rect" title="Get current Boot Mode." alt="" coords="695,13,877,40"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,13,647,40"/>
<area shape="poly" title=" " alt="" coords="676,27,647,29,647,24,682,27"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,13,446,40"/>
<area shape="poly" title=" " alt="" coords="476,27,447,29,447,24,481,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,13,353,40"/>
<area shape="poly" title=" " alt="" coords="383,27,353,29,353,24,388,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,5,140,48"/>
<area shape="poly" title=" " alt="" coords="170,27,140,29,140,24,175,26"/>
</map>
</div>

</div>
</div>
<a id="acca64947bdc9cfb88ea5091014c68b75" name="acca64947bdc9cfb88ea5091014c68b75"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acca64947bdc9cfb88ea5091014c68b75">&#9670;&#160;</a></span>GetDeviceType()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t ControlLogic::GetDeviceType </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the configured device type. </p>
<dl class="section return"><dt>Returns</dt><dd>uint16_t Device Type ID (AMS / AMS Lite). </dd></dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l01453">1453</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1453</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="_control_logic_8cpp.html#a52925c91da70ade3c48b8eb3fe99caf6">device_type_addr</a>; }</div>
<div class="ttc" id="a_control_logic_8cpp_html_a52925c91da70ade3c48b8eb3fe99caf6"><div class="ttname"><a href="_control_logic_8cpp.html#a52925c91da70ade3c48b8eb3fe99caf6">device_type_addr</a></div><div class="ttdeci">static uint16_t device_type_addr</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00038">ControlLogic.cpp:38</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00038">device_type_addr</a>.</p>

</div>
</div>
<a id="a77da31cf0baa8e886a438b2a9e73a573" name="a77da31cf0baa8e886a438b2a9e73a573"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77da31cf0baa8e886a438b2a9e73a573">&#9670;&#160;</a></span>GetLaneMotion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ControlLogic::GetLaneMotion </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>lane</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current motion state of a lane. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lane</td><td>Lane index. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int Motion Enum integer value. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00679">679</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  679</span>                                {</div>
<div class="line"><span class="lineno">  680</span>        <span class="keywordflow">if</span>(lane &lt; 0 || lane &gt;= 4) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  681</span>        <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)<a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[lane].motion;</div>
<div class="line"><span class="lineno">  682</span>    }</div>
<div class="ttc" id="anamespace_control_logic_html_ac4fff77bfcf6d233d9c740ce7bc1a4da"><div class="ttname"><a href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">ControlLogic::motors</a></div><div class="ttdeci">static MotorChannel motors[4]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00517">ControlLogic.cpp:517</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00517">motors</a>.</p>

<p class="reference">Referenced by <a class="el" href="_klipper_c_l_i_8cpp_source.html#l00111">KlipperCLI::HandleStatus()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a77da31cf0baa8e886a438b2a9e73a573_icgraph.png" border="0" usemap="#anamespace_control_logic_a77da31cf0baa8e886a438b2a9e73a573_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a77da31cf0baa8e886a438b2a9e73a573_icgraph" id="anamespace_control_logic_a77da31cf0baa8e886a438b2a9e73a573_icgraph">
<area shape="rect" title="Get the current motion state of a lane." alt="" coords="1302,13,1492,40"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a8f239072c1896e64e9f6075edaaea515" title="Handler for STATUS command." alt="" coords="1084,13,1254,40"/>
<area shape="poly" title=" " alt="" coords="1283,27,1254,29,1254,24,1289,27"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a6089e6db2e7edddf19fdf095b9826c88" title="Parse and Dispatch a JSON Packet." alt="" coords="857,13,1036,40"/>
<area shape="poly" title=" " alt="" coords="1066,27,1037,29,1037,24,1071,27"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afe96c8a3898aa7a50f68ab6d726860c3" title="Main Execution Loop." alt="" coords="695,13,809,40"/>
<area shape="poly" title=" " alt="" coords="839,27,809,29,809,24,844,27"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,13,647,40"/>
<area shape="poly" title=" " alt="" coords="677,27,647,29,647,24,682,27"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,13,446,40"/>
<area shape="poly" title=" " alt="" coords="476,27,447,29,447,24,481,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,13,353,40"/>
<area shape="poly" title=" " alt="" coords="383,27,353,29,353,24,388,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,5,140,48"/>
<area shape="poly" title=" " alt="" coords="170,27,140,29,140,24,175,26"/>
</map>
</div>

</div>
</div>
<a id="a4428a845041ff986ccbf2555a62d0656" name="a4428a845041ff986ccbf2555a62d0656"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4428a845041ff986ccbf2555a62d0656">&#9670;&#160;</a></span>GetSensorState()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t ControlLogic::GetSensorState </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a bitmask of sensor states. </p>
<dl class="section return"><dt>Returns</dt><dd>uint16_t Bitmask (Bit i = Filament Present Lane i). </dd></dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00662">662</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  662</span>                              {</div>
<div class="line"><span class="lineno">  663</span>         <span class="comment">// [0:3] = Filament Present (MC_ONLINE_key_stu)</span></div>
<div class="line"><span class="lineno">  664</span>         <span class="comment">// [4:7] = Buffer/Online?</span></div>
<div class="line"><span class="lineno">  665</span>         uint16_t state = 0;</div>
<div class="line"><span class="lineno">  666</span>         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++) {</div>
<div class="line"><span class="lineno">  667</span>             <span class="keywordflow">if</span>(<a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[i] != 0) state |= (1 &lt;&lt; i);</div>
<div class="line"><span class="lineno">  668</span>         }</div>
<div class="line"><span class="lineno">  669</span>         <span class="keywordflow">return</span> state;</div>
<div class="line"><span class="lineno">  670</span>    }</div>
<div class="ttc" id="anamespace_control_logic_html_a503041f38fbec420305ae1bb79aa4002"><div class="ttname"><a href="#a503041f38fbec420305ae1bb79aa4002">ControlLogic::MC_ONLINE_key_stu</a></div><div class="ttdeci">static int MC_ONLINE_key_stu[4]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00208">ControlLogic.cpp:208</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00208">MC_ONLINE_key_stu</a>.</p>

<p class="reference">Referenced by <a class="el" href="_klipper_c_l_i_8cpp_source.html#l00185">KlipperCLI::HandleGetSensors()</a>, and <a class="el" href="_klipper_c_l_i_8cpp_source.html#l00111">KlipperCLI::HandleStatus()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a4428a845041ff986ccbf2555a62d0656_icgraph.png" border="0" usemap="#anamespace_control_logic_a4428a845041ff986ccbf2555a62d0656_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a4428a845041ff986ccbf2555a62d0656_icgraph" id="anamespace_control_logic_a4428a845041ff986ccbf2555a62d0656_icgraph">
<area shape="rect" title="Get a bitmask of sensor states." alt="" coords="1333,31,1528,57"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#ae13dcd8cc2528c12d0a241046fcc304e" title="Handler for GET_SENSORS command." alt="" coords="1084,5,1285,32"/>
<area shape="poly" title=" " alt="" coords="1315,32,1285,32,1285,26,1320,32"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a8f239072c1896e64e9f6075edaaea515" title="Handler for STATUS command." alt="" coords="1100,56,1269,83"/>
<area shape="poly" title=" " alt="" coords="1320,56,1270,63,1270,58,1314,56"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a6089e6db2e7edddf19fdf095b9826c88" title="Parse and Dispatch a JSON Packet." alt="" coords="857,31,1036,57"/>
<area shape="poly" title=" " alt="" coords="1071,31,1037,37,1037,32,1066,31"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afe96c8a3898aa7a50f68ab6d726860c3" title="Main Execution Loop." alt="" coords="695,31,809,57"/>
<area shape="poly" title=" " alt="" coords="839,44,809,47,809,41,844,44"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,31,647,57"/>
<area shape="poly" title=" " alt="" coords="677,44,647,47,647,41,682,44"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,31,446,57"/>
<area shape="poly" title=" " alt="" coords="476,44,447,47,447,41,481,44"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,31,353,57"/>
<area shape="poly" title=" " alt="" coords="383,44,353,47,353,41,388,44"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,23,140,65"/>
<area shape="poly" title=" " alt="" coords="170,44,140,47,139,41,175,44"/>
<area shape="poly" title=" " alt="" coords="1082,59,1037,56,1037,51,1087,59"/>
</map>
</div>

</div>
</div>
<a id="a1da226a05b7a8c46e16a840900265c03" name="a1da226a05b7a8c46e16a840900265c03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1da226a05b7a8c46e16a840900265c03">&#9670;&#160;</a></span>Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::Init </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize <a class="el" href="namespace_control_logic.html">ControlLogic</a>. </p>
<p>Initializes <a class="el" href="namespace_hardware.html">Hardware</a> (ADC, PWM), Loads Settings, and Initializes AS5600. </p>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00870">870</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  870</span>                {</div>
<div class="line"><span class="lineno">  871</span>        <a class="code hl_function" href="namespace_hardware.html#a72bd28689a22ff9e3db6b911c020ecbb">Hardware::ADC_Init</a>();</div>
<div class="line"><span class="lineno">  872</span>        <a class="code hl_function" href="namespace_hardware.html#a0745af097a6d21fc3fb1f1ebd9e141ff">Hardware::PWM_Init</a>();</div>
<div class="line"><span class="lineno">  873</span>        <a class="code hl_function" href="#ae855e1aa5895afa9999a3b9e6874e1e2">LoadSettings</a>();</div>
<div class="line"><span class="lineno">  874</span>        <a class="code hl_variable" href="_control_logic_8cpp.html#ab704ea0db8b260d9ddf7fd829cbe637f">MC_AS5600</a>.init(<a class="code hl_variable" href="_control_logic_8cpp.html#a25196e4c5bd3fa01c30a213fc32477fb">AS5600_SCL</a>, <a class="code hl_variable" href="_control_logic_8cpp.html#a382950b12f65a33105a6b7c7cef4c219">AS5600_SDA</a>, 4);</div>
<div class="line"><span class="lineno">  875</span>        </div>
<div class="line"><span class="lineno">  876</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++) {</div>
<div class="line"><span class="lineno">  877</span>            <span class="keywordtype">int</span> d = <a class="code hl_variable" href="_control_logic_8cpp.html#a5b964c14654ffcb3120d1d8cb9779c86">mc_save</a>.Motion_control_dir[i];</div>
<div class="line"><span class="lineno">  878</span>            <span class="keywordflow">if</span> (d == 0) d = 1; </div>
<div class="line"><span class="lineno">  879</span>            </div>
<div class="line"><span class="lineno">  880</span>            <span class="keywordtype">bool</span> invert = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  881</span>            <span class="keywordflow">switch</span>(i) {</div>
<div class="line"><span class="lineno">  882</span>                <span class="keywordflow">case</span> 0: invert = <a class="code hl_define" href="_hardware_8h.html#a70ebf132b9895ffa194e22b718c965e6">MOTOR_INVERT_CH1</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  883</span>                <span class="keywordflow">case</span> 1: invert = <a class="code hl_define" href="_hardware_8h.html#ab6e6b731043fb762a0c477898e99e1c1">MOTOR_INVERT_CH2</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  884</span>                <span class="keywordflow">case</span> 2: invert = <a class="code hl_define" href="_hardware_8h.html#a5c3ea9cfb6dd24133150cf4b4ead6390">MOTOR_INVERT_CH3</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  885</span>                <span class="keywordflow">case</span> 3: invert = <a class="code hl_define" href="_hardware_8h.html#a052ab21e8c6d8c0f6324178cd9058ca9">MOTOR_INVERT_CH4</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  886</span>            }</div>
<div class="line"><span class="lineno">  887</span>            </div>
<div class="line"><span class="lineno">  888</span>            <span class="keywordflow">if</span> (invert) d = -d;</div>
<div class="line"><span class="lineno">  889</span>            <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[i].<a class="code hl_variable" href="class_control_logic_1_1_motor_channel.html#a853fbfcbd6b5a174c09a1df99de87770">dir</a> = (float)d;</div>
<div class="line"><span class="lineno">  890</span>            </div>
<div class="line"><span class="lineno">  891</span>            <a class="code hl_variable" href="_control_logic_8cpp.html#a92f9b1daa685f9041b79423442d440e3">last_total_distance</a>[i] = <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.filament[i].meters;</div>
<div class="line"><span class="lineno">  892</span>        }</div>
<div class="line"><span class="lineno">  893</span>    }</div>
<div class="ttc" id="a_control_logic_8cpp_html_a25196e4c5bd3fa01c30a213fc32477fb"><div class="ttname"><a href="_control_logic_8cpp.html#a25196e4c5bd3fa01c30a213fc32477fb">AS5600_SCL</a></div><div class="ttdeci">static uint32_t AS5600_SCL[]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00033">ControlLogic.cpp:33</a></div></div>
<div class="ttc" id="a_control_logic_8cpp_html_a382950b12f65a33105a6b7c7cef4c219"><div class="ttname"><a href="_control_logic_8cpp.html#a382950b12f65a33105a6b7c7cef4c219">AS5600_SDA</a></div><div class="ttdeci">static uint32_t AS5600_SDA[]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00034">ControlLogic.cpp:34</a></div></div>
<div class="ttc" id="a_control_logic_8cpp_html_a5b964c14654ffcb3120d1d8cb9779c86"><div class="ttname"><a href="_control_logic_8cpp.html#a5b964c14654ffcb3120d1d8cb9779c86">mc_save</a></div><div class="ttdeci">static Motion_control_save_struct mc_save</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00045">ControlLogic.cpp:45</a></div></div>
<div class="ttc" id="a_control_logic_8cpp_html_a92f9b1daa685f9041b79423442d440e3"><div class="ttname"><a href="_control_logic_8cpp.html#a92f9b1daa685f9041b79423442d440e3">last_total_distance</a></div><div class="ttdeci">static float last_total_distance[4]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00035">ControlLogic.cpp:35</a></div></div>
<div class="ttc" id="a_hardware_8h_html_a052ab21e8c6d8c0f6324178cd9058ca9"><div class="ttname"><a href="_hardware_8h.html#a052ab21e8c6d8c0f6324178cd9058ca9">MOTOR_INVERT_CH4</a></div><div class="ttdeci">#define MOTOR_INVERT_CH4</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8h_source.html#l00012">Hardware.h:12</a></div></div>
<div class="ttc" id="a_hardware_8h_html_a5c3ea9cfb6dd24133150cf4b4ead6390"><div class="ttname"><a href="_hardware_8h.html#a5c3ea9cfb6dd24133150cf4b4ead6390">MOTOR_INVERT_CH3</a></div><div class="ttdeci">#define MOTOR_INVERT_CH3</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8h_source.html#l00011">Hardware.h:11</a></div></div>
<div class="ttc" id="a_hardware_8h_html_a70ebf132b9895ffa194e22b718c965e6"><div class="ttname"><a href="_hardware_8h.html#a70ebf132b9895ffa194e22b718c965e6">MOTOR_INVERT_CH1</a></div><div class="ttdeci">#define MOTOR_INVERT_CH1</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8h_source.html#l00009">Hardware.h:9</a></div></div>
<div class="ttc" id="a_hardware_8h_html_ab6e6b731043fb762a0c477898e99e1c1"><div class="ttname"><a href="_hardware_8h.html#ab6e6b731043fb762a0c477898e99e1c1">MOTOR_INVERT_CH2</a></div><div class="ttdeci">#define MOTOR_INVERT_CH2</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8h_source.html#l00010">Hardware.h:10</a></div></div>
<div class="ttc" id="aclass_control_logic_1_1_motor_channel_html_a853fbfcbd6b5a174c09a1df99de87770"><div class="ttname"><a href="class_control_logic_1_1_motor_channel.html#a853fbfcbd6b5a174c09a1df99de87770">ControlLogic::MotorChannel::dir</a></div><div class="ttdeci">float dir</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00332">ControlLogic.cpp:332</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_ae855e1aa5895afa9999a3b9e6874e1e2"><div class="ttname"><a href="#ae855e1aa5895afa9999a3b9e6874e1e2">ControlLogic::LoadSettings</a></div><div class="ttdeci">void LoadSettings()</div><div class="ttdoc">Load settings from Flash memory.</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00847">ControlLogic.cpp:847</a></div></div>
<div class="ttc" id="anamespace_hardware_html_a0745af097a6d21fc3fb1f1ebd9e141ff"><div class="ttname"><a href="namespace_hardware.html#a0745af097a6d21fc3fb1f1ebd9e141ff">Hardware::PWM_Init</a></div><div class="ttdeci">void PWM_Init()</div><div class="ttdoc">Initialize PWM Timers for Motor Control.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00411">Hardware.cpp:411</a></div></div>
<div class="ttc" id="anamespace_hardware_html_a72bd28689a22ff9e3db6b911c020ecbb"><div class="ttname"><a href="namespace_hardware.html#a72bd28689a22ff9e3db6b911c020ecbb">Hardware::ADC_Init</a></div><div class="ttdeci">void ADC_Init()</div><div class="ttdoc">Initialize the Analog-to-Digital Converter.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00317">Hardware.cpp:317</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00317">Hardware::ADC_Init()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00033">AS5600_SCL</a>, <a class="el" href="_control_logic_8cpp_source.html#l00034">AS5600_SDA</a>, <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>, <a class="el" href="_control_logic_8cpp_source.html#l00035">last_total_distance</a>, <a class="el" href="_control_logic_8cpp_source.html#l00847">LoadSettings()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00032">MC_AS5600</a>, <a class="el" href="_control_logic_8cpp_source.html#l00045">mc_save</a>, <a class="el" href="_hardware_8h_source.html#l00009">MOTOR_INVERT_CH1</a>, <a class="el" href="_hardware_8h_source.html#l00010">MOTOR_INVERT_CH2</a>, <a class="el" href="_hardware_8h_source.html#l00011">MOTOR_INVERT_CH3</a>, <a class="el" href="_hardware_8h_source.html#l00012">MOTOR_INVERT_CH4</a>, <a class="el" href="_control_logic_8cpp_source.html#l00517">motors</a>, and <a class="el" href="_hardware_8cpp_source.html#l00411">Hardware::PWM_Init()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00287">ControlLogic::MOTOR_PID::MOTOR_PID()</a>, and <a class="el" href="main_8cpp_source.html#l00013">setup()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a1da226a05b7a8c46e16a840900265c03_cgraph.png" border="0" usemap="#anamespace_control_logic_a1da226a05b7a8c46e16a840900265c03_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a1da226a05b7a8c46e16a840900265c03_cgraph" id="anamespace_control_logic_a1da226a05b7a8c46e16a840900265c03_cgraph">
<area shape="rect" title="Initialize ControlLogic." alt="" coords="5,80,126,107"/>
<area shape="rect" href="namespace_hardware.html#a72bd28689a22ff9e3db6b911c020ecbb" title="Initialize the Analog&#45;to&#45;Digital Converter." alt="" coords="193,29,332,56"/>
<area shape="poly" title=" " alt="" coords="120,77,195,59,191,62,121,82"/>
<area shape="rect" href="namespace_control_logic.html#ae855e1aa5895afa9999a3b9e6874e1e2" title="Load settings from Flash memory." alt="" coords="174,80,352,107"/>
<area shape="poly" title=" " alt="" coords="126,91,160,93,155,94,127,96"/>
<area shape="rect" href="namespace_hardware.html#a0745af097a6d21fc3fb1f1ebd9e141ff" title="Initialize PWM Timers for Motor Control." alt="" coords="191,131,334,157"/>
<area shape="poly" title=" " alt="" coords="121,105,196,125,191,127,120,110"/>
<area shape="poly" title=" " alt="" coords="229,28,223,21,227,11,241,5,263,3,286,5,300,14,295,14,285,10,263,8,242,10,231,15,229,20,234,29"/>
<area shape="rect" href="namespace_hardware.html#ad269fd29299dd87118b408e4551f4d2d" title="Millisecond Delay." alt="" coords="429,29,568,56"/>
<area shape="poly" title=" " alt="" coords="333,40,416,42,411,43,333,45"/>
<area shape="rect" href="namespace_control_logic.html#afe90d7f284c20f90f74787274f01c51b" title="Flag that settings need to be saved." alt="" coords="400,80,597,107"/>
<area shape="poly" title=" " alt="" coords="352,91,387,93,382,94,353,96"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="645,80,781,107"/>
<area shape="poly" title=" " alt="" coords="598,91,633,93,627,93,598,96"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="829,80,914,107"/>
<area shape="poly" title=" " alt="" coords="781,91,816,93,810,93,781,96"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a1da226a05b7a8c46e16a840900265c03_icgraph.png" border="0" usemap="#anamespace_control_logic_a1da226a05b7a8c46e16a840900265c03_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a1da226a05b7a8c46e16a840900265c03_icgraph" id="anamespace_control_logic_a1da226a05b7a8c46e16a840900265c03_icgraph">
<area shape="rect" title="Initialize ControlLogic." alt="" coords="205,43,325,69"/>
<area shape="rect" href="class_control_logic_1_1_m_o_t_o_r___p_i_d.html#a9edc970b22d74b15904b4929d862cc07" title=" " alt="" coords="5,5,157,48"/>
<area shape="poly" title=" " alt="" coords="187,44,157,41,157,36,192,44"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="54,72,108,99"/>
<area shape="poly" title=" " alt="" coords="187,68,108,84,107,79,192,68"/>
</map>
</div>

</div>
</div>
<a id="a0c732b28cf691fb77359c80a0c000665" name="a0c732b28cf691fb77359c80a0c000665"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c732b28cf691fb77359c80a0c000665">&#9670;&#160;</a></span>InitBootCheck()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="#aa23e295fa5022b6569547cf94f091070">BootMode</a> ControlLogic::InitBootCheck </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check Boot Mode (Button Press at Startup). </p>
<p>Reading ADC of sensor keys. If all are pressed (&lt; 1.3V) at startup, toggle the boot mode (Klipper &lt;-&gt; BambuBus).</p>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="#aa23e295fa5022b6569547cf94f091070">BootMode</a> The active boot mode. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00904">904</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  904</span>                             {</div>
<div class="line"><span class="lineno">  905</span>        <span class="comment">// Read Sensors (Already inited in Hardware::Init)</span></div>
<div class="line"><span class="lineno">  906</span>        <a class="code hl_function" href="#ab1b5b19d84cdbba6ef3ad97fba14ce13">MC_PULL_ONLINE_read</a>(); </div>
<div class="line"><span class="lineno">  907</span>        </div>
<div class="line"><span class="lineno">  908</span>        <span class="keywordtype">bool</span> all_pressed = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  909</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++) {</div>
<div class="line"><span class="lineno">  910</span>             <span class="comment">// User requested &lt; 1.3V for mode switch.</span></div>
<div class="line"><span class="lineno">  911</span>             <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a14f470efe568bae229e028e1b1acd54f">MC_PULL_stu_raw</a>[i] &gt; 1.3f) { </div>
<div class="line"><span class="lineno">  912</span>                 all_pressed = <span class="keyword">false</span>; </div>
<div class="line"><span class="lineno">  913</span>                 <span class="keywordflow">break</span>; </div>
<div class="line"><span class="lineno">  914</span>             }</div>
<div class="line"><span class="lineno">  915</span>        }</div>
<div class="line"><span class="lineno">  916</span>        </div>
<div class="line"><span class="lineno">  917</span>        <span class="keywordflow">if</span> (all_pressed) {</div>
<div class="line"><span class="lineno">  918</span>            <span class="comment">// Toggle Mode</span></div>
<div class="line"><span class="lineno">  919</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#a2c383f5bdbb468f12fb4ea625b5823b6">boot_mode</a> == (uint32_t)<a class="code hl_enumvalue" href="#aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a">BootMode::BambuBus</a>) {</div>
<div class="line"><span class="lineno">  920</span>                <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#a2c383f5bdbb468f12fb4ea625b5823b6">boot_mode</a> = (uint32_t)<a class="code hl_enumvalue" href="#aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55">BootMode::Klipper</a>;</div>
<div class="line"><span class="lineno">  921</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  922</span>                <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#a2c383f5bdbb468f12fb4ea625b5823b6">boot_mode</a> = (uint32_t)<a class="code hl_enumvalue" href="#aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a">BootMode::BambuBus</a>;</div>
<div class="line"><span class="lineno">  923</span>            }</div>
<div class="line"><span class="lineno">  924</span>            <a class="code hl_function" href="#afe90d7f284c20f90f74787274f01c51b">SetNeedToSave</a>();</div>
<div class="line"><span class="lineno">  925</span>        }</div>
<div class="line"><span class="lineno">  926</span>        </div>
<div class="line"><span class="lineno">  927</span>        <span class="keywordflow">return</span> (<a class="code hl_enumeration" href="#aa23e295fa5022b6569547cf94f091070">BootMode</a>)<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#a2c383f5bdbb468f12fb4ea625b5823b6">boot_mode</a>;</div>
<div class="line"><span class="lineno">  928</span>    }</div>
<div class="ttc" id="anamespace_control_logic_html_a14f470efe568bae229e028e1b1acd54f"><div class="ttname"><a href="#a14f470efe568bae229e028e1b1acd54f">ControlLogic::MC_PULL_stu_raw</a></div><div class="ttdeci">static float MC_PULL_stu_raw[4]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00205">ControlLogic.cpp:205</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_ab1b5b19d84cdbba6ef3ad97fba14ce13"><div class="ttname"><a href="#ab1b5b19d84cdbba6ef3ad97fba14ce13">ControlLogic::MC_PULL_ONLINE_read</a></div><div class="ttdeci">void MC_PULL_ONLINE_read()</div><div class="ttdoc">Read Analog Sensors and Update State.</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00240">ControlLogic.cpp:240</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_afe90d7f284c20f90f74787274f01c51b"><div class="ttname"><a href="#afe90d7f284c20f90f74787274f01c51b">ControlLogic::SetNeedToSave</a></div><div class="ttdeci">void SetNeedToSave()</div><div class="ttdoc">Flag that settings need to be saved.</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00733">ControlLogic.cpp:733</a></div></div>
<div class="ttc" id="astructflash__save__struct_html_a2c383f5bdbb468f12fb4ea625b5823b6"><div class="ttname"><a href="structflash__save__struct.html#a2c383f5bdbb468f12fb4ea625b5823b6">flash_save_struct::boot_mode</a></div><div class="ttdeci">uint32_t boot_mode</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00025">ControlLogic.cpp:25</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8h_source.html#l00015">BambuBus</a>, <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>, <a class="el" href="_control_logic_8h_source.html#l00016">Klipper</a>, <a class="el" href="_control_logic_8cpp_source.html#l00240">MC_PULL_ONLINE_read()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00205">MC_PULL_stu_raw</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00733">SetNeedToSave()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8cpp_source.html#l00013">setup()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a0c732b28cf691fb77359c80a0c000665_cgraph.png" border="0" usemap="#anamespace_control_logic_a0c732b28cf691fb77359c80a0c000665_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a0c732b28cf691fb77359c80a0c000665_cgraph" id="anamespace_control_logic_a0c732b28cf691fb77359c80a0c000665_cgraph">
<area shape="rect" title="Check Boot Mode (Button Press at Startup)." alt="" coords="5,43,191,69"/>
<area shape="rect" href="namespace_control_logic.html#ab1b5b19d84cdbba6ef3ad97fba14ce13" title="Read Analog Sensors and Update State." alt="" coords="256,5,419,48"/>
<area shape="poly" title=" " alt="" coords="191,42,242,38,237,39,192,47"/>
<area shape="rect" href="namespace_control_logic.html#afe90d7f284c20f90f74787274f01c51b" title="Flag that settings need to be saved." alt="" coords="239,72,436,99"/>
<area shape="poly" title=" " alt="" coords="191,65,226,71,221,71,191,70"/>
<area shape="rect" href="namespace_hardware.html#aa54da804a3d4c6d89ba5d7a2931fc463" title="Get filtered ADC voltage values." alt="" coords="484,13,665,40"/>
<area shape="poly" title=" " alt="" coords="419,24,471,26,466,27,420,29"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="507,72,642,99"/>
<area shape="poly" title=" " alt="" coords="436,83,494,85,489,85,437,88"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="713,72,799,99"/>
<area shape="poly" title=" " alt="" coords="643,83,701,85,695,85,643,88"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a0c732b28cf691fb77359c80a0c000665_icgraph.png" border="0" usemap="#anamespace_control_logic_a0c732b28cf691fb77359c80a0c000665_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a0c732b28cf691fb77359c80a0c000665_icgraph" id="anamespace_control_logic_a0c732b28cf691fb77359c80a0c000665_icgraph">
<area shape="rect" title="Check Boot Mode (Button Press at Startup)." alt="" coords="107,5,292,32"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="5,5,59,32"/>
<area shape="poly" title=" " alt="" coords="88,19,59,21,59,16,93,18"/>
</map>
</div>

</div>
</div>
<a id="ae855e1aa5895afa9999a3b9e6874e1e2" name="ae855e1aa5895afa9999a3b9e6874e1e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae855e1aa5895afa9999a3b9e6874e1e2">&#9670;&#160;</a></span>LoadSettings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::LoadSettings </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load settings from Flash memory. </p>
<p>If flash is invalid (CRC/Version mismatch), loads defaults. </p>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00847">847</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  847</span>                        {</div>
<div class="line"><span class="lineno">  848</span>        <a class="code hl_struct" href="structflash__save__struct.html">flash_save_struct</a> *ptr = (<a class="code hl_struct" href="structflash__save__struct.html">flash_save_struct</a> *)(<a class="code hl_define" href="_control_logic_8cpp.html#a377d54c27966e6b7bcfb0810524885b1">use_flash_addr</a>);</div>
<div class="line"><span class="lineno">  849</span>        <span class="keywordflow">if</span> ((ptr-&gt;<a class="code hl_variable" href="structflash__save__struct.html#a219489a81c5e22462fc6d57432c6ef21">check</a> == 0x40614061) &amp;&amp; (ptr-&gt;<a class="code hl_variable" href="structflash__save__struct.html#a11de83ae7f3b48ff2ef8cb12143752d3">version</a> == <a class="code hl_define" href="_control_logic_8cpp.html#a5f43c83fd8dd8ac8414357ecd89dec8d">Bambubus_version</a>)) {</div>
<div class="line"><span class="lineno">  850</span>            memcpy(&amp;<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>, ptr, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>));</div>
<div class="line"><span class="lineno">  851</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  852</span>            <span class="comment">// Default constants</span></div>
<div class="line"><span class="lineno">  853</span>            <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.filament[0].color_R = 0xFF; </div>
<div class="line"><span class="lineno">  854</span>            <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.boot_mode = (uint32_t)<a class="code hl_enumvalue" href="#aa23e295fa5022b6569547cf94f091070aa215a57b244f3b893020269133af794a">BootMode::BambuBus</a>; <span class="comment">// Default to BambuBus</span></div>
<div class="line"><span class="lineno">  855</span>            <a class="code hl_function" href="#afe90d7f284c20f90f74787274f01c51b">SetNeedToSave</a>(); <span class="comment">// Valid version but mismatch or invalid, save new defaults</span></div>
<div class="line"><span class="lineno">  856</span>        }</div>
<div class="line"><span class="lineno">  857</span>        </div>
<div class="line"><span class="lineno">  858</span>        Motion_control_save_struct *mc_ptr = (Motion_control_save_struct *)(<a class="code hl_define" href="_control_logic_8cpp.html#a157a750331805d0201ca01160b072510">Motion_control_save_flash_addr</a>);</div>
<div class="line"><span class="lineno">  859</span>        <span class="keywordflow">if</span> (mc_ptr-&gt;<a class="code hl_variable" href="struct_motion__control__save__struct.html#a9b40edb55eff01a8f6b9a32831435dd5">check</a> == 0x40614061) {</div>
<div class="line"><span class="lineno">  860</span>            memcpy(&amp;<a class="code hl_variable" href="_control_logic_8cpp.html#a5b964c14654ffcb3120d1d8cb9779c86">mc_save</a>, mc_ptr, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="_control_logic_8cpp.html#a5b964c14654ffcb3120d1d8cb9779c86">mc_save</a>));</div>
<div class="line"><span class="lineno">  861</span>        }</div>
<div class="line"><span class="lineno">  862</span>    }</div>
<div class="ttc" id="a_control_logic_8cpp_html_a157a750331805d0201ca01160b072510"><div class="ttname"><a href="_control_logic_8cpp.html#a157a750331805d0201ca01160b072510">Motion_control_save_flash_addr</a></div><div class="ttdeci">#define Motion_control_save_flash_addr</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00157">ControlLogic.cpp:157</a></div></div>
<div class="ttc" id="a_control_logic_8cpp_html_a377d54c27966e6b7bcfb0810524885b1"><div class="ttname"><a href="_control_logic_8cpp.html#a377d54c27966e6b7bcfb0810524885b1">use_flash_addr</a></div><div class="ttdeci">#define use_flash_addr</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00018">ControlLogic.cpp:18</a></div></div>
<div class="ttc" id="a_control_logic_8cpp_html_a5f43c83fd8dd8ac8414357ecd89dec8d"><div class="ttname"><a href="_control_logic_8cpp.html#a5f43c83fd8dd8ac8414357ecd89dec8d">Bambubus_version</a></div><div class="ttdeci">#define Bambubus_version</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00017">ControlLogic.cpp:17</a></div></div>
<div class="ttc" id="astruct_motion__control__save__struct_html_a9b40edb55eff01a8f6b9a32831435dd5"><div class="ttname"><a href="struct_motion__control__save__struct.html#a9b40edb55eff01a8f6b9a32831435dd5">Motion_control_save_struct::check</a></div><div class="ttdeci">uint32_t check</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00041">ControlLogic.cpp:41</a></div></div>
<div class="ttc" id="astructflash__save__struct_html"><div class="ttname"><a href="structflash__save__struct.html">flash_save_struct</a></div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00020">ControlLogic.cpp:21</a></div></div>
<div class="ttc" id="astructflash__save__struct_html_a11de83ae7f3b48ff2ef8cb12143752d3"><div class="ttname"><a href="structflash__save__struct.html#a11de83ae7f3b48ff2ef8cb12143752d3">flash_save_struct::version</a></div><div class="ttdeci">uint32_t version</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00026">ControlLogic.cpp:26</a></div></div>
<div class="ttc" id="astructflash__save__struct_html_a219489a81c5e22462fc6d57432c6ef21"><div class="ttname"><a href="structflash__save__struct.html#a219489a81c5e22462fc6d57432c6ef21">flash_save_struct::check</a></div><div class="ttdeci">uint32_t check</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00027">ControlLogic.cpp:27</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8h_source.html#l00015">BambuBus</a>, <a class="el" href="_control_logic_8cpp_source.html#l00017">Bambubus_version</a>, <a class="el" href="_control_logic_8cpp_source.html#l00027">flash_save_struct::check</a>, <a class="el" href="_control_logic_8cpp_source.html#l00041">Motion_control_save_struct::check</a>, <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>, <a class="el" href="_control_logic_8cpp_source.html#l00045">mc_save</a>, <a class="el" href="_control_logic_8cpp_source.html#l00157">Motion_control_save_flash_addr</a>, <a class="el" href="_control_logic_8cpp_source.html#l00733">SetNeedToSave()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00018">use_flash_addr</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00026">flash_save_struct::version</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00870">Init()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2_cgraph.png" border="0" usemap="#anamespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2_cgraph" id="anamespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2_cgraph">
<area shape="rect" title="Load settings from Flash memory." alt="" coords="5,5,184,32"/>
<area shape="rect" href="namespace_control_logic.html#afe90d7f284c20f90f74787274f01c51b" title="Flag that settings need to be saved." alt="" coords="232,5,429,32"/>
<area shape="poly" title=" " alt="" coords="184,16,219,19,213,19,184,21"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="477,5,612,32"/>
<area shape="poly" title=" " alt="" coords="429,16,464,19,459,19,429,21"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="660,5,746,32"/>
<area shape="poly" title=" " alt="" coords="613,16,647,19,642,19,613,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2_icgraph.png" border="0" usemap="#anamespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2_icgraph" id="anamespace_control_logic_ae855e1aa5895afa9999a3b9e6874e1e2_icgraph">
<area shape="rect" title="Load settings from Flash memory." alt="" coords="373,43,551,69"/>
<area shape="rect" href="namespace_control_logic.html#a1da226a05b7a8c46e16a840900265c03" title="Initialize ControlLogic." alt="" coords="205,43,325,69"/>
<area shape="poly" title=" " alt="" coords="355,56,326,59,326,53,360,56"/>
<area shape="rect" href="class_control_logic_1_1_m_o_t_o_r___p_i_d.html#a9edc970b22d74b15904b4929d862cc07" title=" " alt="" coords="5,5,157,48"/>
<area shape="poly" title=" " alt="" coords="187,44,157,41,157,36,192,44"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="54,72,108,99"/>
<area shape="poly" title=" " alt="" coords="187,68,108,84,107,79,192,68"/>
</map>
</div>

</div>
</div>
<a id="ab1b5b19d84cdbba6ef3ad97fba14ce13" name="ab1b5b19d84cdbba6ef3ad97fba14ce13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab1b5b19d84cdbba6ef3ad97fba14ce13">&#9670;&#160;</a></span>MC_PULL_ONLINE_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::MC_PULL_ONLINE_read </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read Analog Sensors and Update State. </p>
<p>Reads ADC values for Filament sensors and Voltage monitors. Updates <span class="tt"><a class="el" href="#a87d54195660d73ebcd372cad0fd74915">MC_PULL_stu</a></span> (pressure state) and <span class="tt"><a class="el" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a></span> (filament presence). Also updates internal <a class="el" href="class_unit_state.html">UnitState</a> flags based on these readings. </p>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00240">240</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  240</span>                               {</div>
<div class="line"><span class="lineno">  241</span>        <span class="keywordtype">float</span> *data = <a class="code hl_function" href="namespace_hardware.html#aa54da804a3d4c6d89ba5d7a2931fc463">Hardware::ADC_GetValues</a>(); </div>
<div class="line"><span class="lineno">  242</span>        <span class="keywordflow">if</span> (!data) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>        <a class="code hl_variable" href="#a14f470efe568bae229e028e1b1acd54f">MC_PULL_stu_raw</a>[3] = data[0];</div>
<div class="line"><span class="lineno">  245</span>        <a class="code hl_variable" href="#ae2535696ce7487f6ec12d1f2e174e598">MC_ONLINE_key_stu_raw</a>[3] = data[1];</div>
<div class="line"><span class="lineno">  246</span>        <a class="code hl_variable" href="#a14f470efe568bae229e028e1b1acd54f">MC_PULL_stu_raw</a>[2] = data[2];</div>
<div class="line"><span class="lineno">  247</span>        <a class="code hl_variable" href="#ae2535696ce7487f6ec12d1f2e174e598">MC_ONLINE_key_stu_raw</a>[2] = data[3];</div>
<div class="line"><span class="lineno">  248</span>        <a class="code hl_variable" href="#a14f470efe568bae229e028e1b1acd54f">MC_PULL_stu_raw</a>[1] = data[4];</div>
<div class="line"><span class="lineno">  249</span>        <a class="code hl_variable" href="#ae2535696ce7487f6ec12d1f2e174e598">MC_ONLINE_key_stu_raw</a>[1] = data[5];</div>
<div class="line"><span class="lineno">  250</span>        <a class="code hl_variable" href="#a14f470efe568bae229e028e1b1acd54f">MC_PULL_stu_raw</a>[0] = data[6];</div>
<div class="line"><span class="lineno">  251</span>        <a class="code hl_variable" href="#ae2535696ce7487f6ec12d1f2e174e598">MC_ONLINE_key_stu_raw</a>[0] = data[7];</div>
<div class="line"><span class="lineno">  252</span> </div>
<div class="line"><span class="lineno">  253</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; i++) {</div>
<div class="line"><span class="lineno">  254</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a14f470efe568bae229e028e1b1acd54f">MC_PULL_stu_raw</a>[i] &gt; <a class="code hl_variable" href="#a9a6c6bb73ae52885ddaa5ec56d8603f9">PULL_voltage_up</a>) <a class="code hl_variable" href="#a87d54195660d73ebcd372cad0fd74915">MC_PULL_stu</a>[i] = 1;</div>
<div class="line"><span class="lineno">  255</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a14f470efe568bae229e028e1b1acd54f">MC_PULL_stu_raw</a>[i] &lt; <a class="code hl_variable" href="#a73b9466c4e3c236a186659863283f00e">PULL_voltage_down</a>) <a class="code hl_variable" href="#a87d54195660d73ebcd372cad0fd74915">MC_PULL_stu</a>[i] = -1;</div>
<div class="line"><span class="lineno">  256</span>            <span class="keywordflow">else</span> <a class="code hl_variable" href="#a87d54195660d73ebcd372cad0fd74915">MC_PULL_stu</a>[i] = 0;</div>
<div class="line"><span class="lineno">  257</span> </div>
<div class="line"><span class="lineno">  258</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a8abb9a7c0790b08a5e5f31c8874bb15f">is_two</a> == <span class="keyword">false</span>) {</div>
<div class="line"><span class="lineno">  259</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="#ae2535696ce7487f6ec12d1f2e174e598">MC_ONLINE_key_stu_raw</a>[i] &gt; 1.65f) <a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[i] = 1;</div>
<div class="line"><span class="lineno">  260</span>                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="#ae2535696ce7487f6ec12d1f2e174e598">MC_ONLINE_key_stu_raw</a>[i] &lt; 1.55f) <a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[i] = 0;</div>
<div class="line"><span class="lineno">  261</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  262</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="#ae2535696ce7487f6ec12d1f2e174e598">MC_ONLINE_key_stu_raw</a>[i] &lt; 0.6f) <a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[i] = 0;</div>
<div class="line"><span class="lineno">  263</span>                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="#ae2535696ce7487f6ec12d1f2e174e598">MC_ONLINE_key_stu_raw</a>[i] &lt; 1.4f) <a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[i] = 3;</div>
<div class="line"><span class="lineno">  264</span>                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="#ae2535696ce7487f6ec12d1f2e174e598">MC_ONLINE_key_stu_raw</a>[i] &gt; 1.7f) <a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[i] = 1;</div>
<div class="line"><span class="lineno">  265</span>                <span class="keywordflow">else</span> <a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[i] = 2;</div>
<div class="line"><span class="lineno">  266</span>            }</div>
<div class="line"><span class="lineno">  267</span>            </div>
<div class="line"><span class="lineno">  268</span>            <span class="comment">// Sync status</span></div>
<div class="line"><span class="lineno">  269</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[i] != 0) {</div>
<div class="line"><span class="lineno">  270</span>                 <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#af6b0be8daad68d06efd980f1fb68ef72">filament</a>[i].<a class="code hl_variable" href="struct_filament_state.html#a18524f9eb8074bc706971d1d62974179">status</a> == <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a9148fdd6f33c42faedeb9cc1a5520646a27a21354321dfbc28f0cb17b995bb9ca">AMS_filament_status::offline</a>) {</div>
<div class="line"><span class="lineno">  271</span>                     <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#af6b0be8daad68d06efd980f1fb68ef72">filament</a>[i].<a class="code hl_variable" href="struct_filament_state.html#a18524f9eb8074bc706971d1d62974179">status</a> = <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a9148fdd6f33c42faedeb9cc1a5520646a7f46165474d11ee5836777d85df2cdab">AMS_filament_status::online</a>;</div>
<div class="line"><span class="lineno">  272</span>                 }</div>
<div class="line"><span class="lineno">  273</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  274</span>                 <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#af6b0be8daad68d06efd980f1fb68ef72">filament</a>[i].<a class="code hl_variable" href="struct_filament_state.html#a18524f9eb8074bc706971d1d62974179">status</a> = <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a9148fdd6f33c42faedeb9cc1a5520646a27a21354321dfbc28f0cb17b995bb9ca">AMS_filament_status::offline</a>;</div>
<div class="line"><span class="lineno">  275</span>            }</div>
<div class="line"><span class="lineno">  276</span>            </div>
<div class="line"><span class="lineno">  277</span>            <span class="comment">// Update pressure (voltage in mV)</span></div>
<div class="line"><span class="lineno">  278</span>            <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#af6b0be8daad68d06efd980f1fb68ef72">filament</a>[i].<a class="code hl_variable" href="struct_filament_state.html#a2210f4ad5b00137bf844f1289ee79226">pressure</a> = (uint16_t)(<a class="code hl_variable" href="#a14f470efe568bae229e028e1b1acd54f">MC_PULL_stu_raw</a>[i] * 1000.0f);</div>
<div class="line"><span class="lineno">  279</span>        }</div>
<div class="line"><span class="lineno">  280</span>    }</div>
<div class="ttc" id="a_bambu_bus_protocol_8h_html_a9148fdd6f33c42faedeb9cc1a5520646a27a21354321dfbc28f0cb17b995bb9ca"><div class="ttname"><a href="_bambu_bus_protocol_8h.html#a9148fdd6f33c42faedeb9cc1a5520646a27a21354321dfbc28f0cb17b995bb9ca">AMS_filament_status::offline</a></div><div class="ttdeci">@ offline</div><div class="ttdef"><b>Definition</b> <a href="_bambu_bus_protocol_8h_source.html#l00010">BambuBusProtocol.h:10</a></div></div>
<div class="ttc" id="a_bambu_bus_protocol_8h_html_a9148fdd6f33c42faedeb9cc1a5520646a7f46165474d11ee5836777d85df2cdab"><div class="ttname"><a href="_bambu_bus_protocol_8h.html#a9148fdd6f33c42faedeb9cc1a5520646a7f46165474d11ee5836777d85df2cdab">AMS_filament_status::online</a></div><div class="ttdeci">@ online</div><div class="ttdef"><b>Definition</b> <a href="_bambu_bus_protocol_8h_source.html#l00011">BambuBusProtocol.h:11</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a73b9466c4e3c236a186659863283f00e"><div class="ttname"><a href="#a73b9466c4e3c236a186659863283f00e">ControlLogic::PULL_voltage_down</a></div><div class="ttdeci">float PULL_voltage_down</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00197">ControlLogic.cpp:197</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a87d54195660d73ebcd372cad0fd74915"><div class="ttname"><a href="#a87d54195660d73ebcd372cad0fd74915">ControlLogic::MC_PULL_stu</a></div><div class="ttdeci">static int MC_PULL_stu[4]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00206">ControlLogic.cpp:206</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a8abb9a7c0790b08a5e5f31c8874bb15f"><div class="ttname"><a href="#a8abb9a7c0790b08a5e5f31c8874bb15f">ControlLogic::is_two</a></div><div class="ttdeci">static const bool is_two</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00212">ControlLogic.cpp:212</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a9a6c6bb73ae52885ddaa5ec56d8603f9"><div class="ttname"><a href="#a9a6c6bb73ae52885ddaa5ec56d8603f9">ControlLogic::PULL_voltage_up</a></div><div class="ttdeci">float PULL_voltage_up</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00196">ControlLogic.cpp:196</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_ae2535696ce7487f6ec12d1f2e174e598"><div class="ttname"><a href="#ae2535696ce7487f6ec12d1f2e174e598">ControlLogic::MC_ONLINE_key_stu_raw</a></div><div class="ttdeci">static float MC_ONLINE_key_stu_raw[4]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00207">ControlLogic.cpp:207</a></div></div>
<div class="ttc" id="anamespace_hardware_html_aa54da804a3d4c6d89ba5d7a2931fc463"><div class="ttname"><a href="namespace_hardware.html#aa54da804a3d4c6d89ba5d7a2931fc463">Hardware::ADC_GetValues</a></div><div class="ttdeci">float * ADC_GetValues()</div><div class="ttdoc">Get filtered ADC voltage values.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00387">Hardware.cpp:387</a></div></div>
<div class="ttc" id="astruct_filament_state_html_a18524f9eb8074bc706971d1d62974179"><div class="ttname"><a href="struct_filament_state.html#a18524f9eb8074bc706971d1d62974179">FilamentState::status</a></div><div class="ttdeci">AMS_filament_status status</div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00049">UnitState.h:49</a></div></div>
<div class="ttc" id="astruct_filament_state_html_a2210f4ad5b00137bf844f1289ee79226"><div class="ttname"><a href="struct_filament_state.html#a2210f4ad5b00137bf844f1289ee79226">FilamentState::pressure</a></div><div class="ttdeci">uint16_t pressure</div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00051">UnitState.h:51</a></div></div>
<div class="ttc" id="astructflash__save__struct_html_af6b0be8daad68d06efd980f1fb68ef72"><div class="ttname"><a href="structflash__save__struct.html#af6b0be8daad68d06efd980f1fb68ef72">flash_save_struct::filament</a></div><div class="ttdeci">FilamentState filament[4]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00022">ControlLogic.cpp:22</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00387">Hardware::ADC_GetValues()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>, <a class="el" href="_control_logic_8cpp_source.html#l00212">is_two</a>, <a class="el" href="_control_logic_8cpp_source.html#l00208">MC_ONLINE_key_stu</a>, <a class="el" href="_control_logic_8cpp_source.html#l00207">MC_ONLINE_key_stu_raw</a>, <a class="el" href="_control_logic_8cpp_source.html#l00206">MC_PULL_stu</a>, <a class="el" href="_control_logic_8cpp_source.html#l00205">MC_PULL_stu_raw</a>, <a class="el" href="_bambu_bus_protocol_8h_source.html#l00010">offline</a>, <a class="el" href="_bambu_bus_protocol_8h_source.html#l00011">online</a>, <a class="el" href="_control_logic_8cpp_source.html#l00197">PULL_voltage_down</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00196">PULL_voltage_up</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00904">InitBootCheck()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00792">Run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13_cgraph.png" border="0" usemap="#anamespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13_cgraph" id="anamespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13_cgraph">
<area shape="rect" title="Read Analog Sensors and Update State." alt="" coords="5,5,169,48"/>
<area shape="rect" href="namespace_hardware.html#aa54da804a3d4c6d89ba5d7a2931fc463" title="Get filtered ADC voltage values." alt="" coords="217,13,398,40"/>
<area shape="poly" title=" " alt="" coords="169,24,204,26,198,27,169,29"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13_icgraph.png" border="0" usemap="#anamespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13_icgraph" id="anamespace_control_logic_ab1b5b19d84cdbba6ef3ad97fba14ce13_icgraph">
<area shape="rect" title="Read Analog Sensors and Update State." alt="" coords="736,23,899,65"/>
<area shape="rect" href="namespace_control_logic.html#a0c732b28cf691fb77359c80a0c000665" title="Check Boot Mode (Button Press at Startup)." alt="" coords="502,5,688,32"/>
<area shape="poly" title=" " alt="" coords="718,33,688,32,688,27,723,33"/>
<area shape="rect" href="namespace_control_logic.html#adc8c269923e0c76c6d104a005833a7f9" title="Main Control Loop." alt="" coords="532,56,658,83"/>
<area shape="poly" title=" " alt="" coords="723,55,659,65,658,59,718,55"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="401,5,454,32"/>
<area shape="poly" title=" " alt="" coords="484,19,455,21,455,16,489,18"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="405,56,450,83"/>
<area shape="poly" title=" " alt="" coords="514,69,451,72,451,67,519,69"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,56,353,83"/>
<area shape="poly" title=" " alt="" coords="387,69,353,72,353,67,392,69"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,48,140,91"/>
<area shape="poly" title=" " alt="" coords="170,70,140,72,140,67,175,69"/>
</map>
</div>

</div>
</div>
<a id="ac2d890c891494072159ebc2b30490197" name="ac2d890c891494072159ebc2b30490197"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2d890c891494072159ebc2b30490197">&#9670;&#160;</a></span>motor_motion_switch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::motor_motion_switch </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>State Machine for BambuBus Logic. </p>
<p>Manages transitions between filament states (Idle, Loading, Unloading, Using, Sending). Implements Load/Unload logic completion checks (Pressure/Distance). </p>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00962">962</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  963</span>    {</div>
<div class="line"><span class="lineno">  964</span>        <span class="keywordtype">int</span> num = <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.BambuBus_now_filament_num; </div>
<div class="line"><span class="lineno">  965</span>        uint16_t device_type = <a class="code hl_variable" href="_control_logic_8cpp.html#a52925c91da70ade3c48b8eb3fe99caf6">device_type_addr</a>;</div>
<div class="line"><span class="lineno">  966</span> </div>
<div class="line"><span class="lineno">  967</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; i++)</div>
<div class="line"><span class="lineno">  968</span>        {</div>
<div class="line"><span class="lineno">  969</span>            <span class="comment">// Klipper Override: Do not interfere if we are in velocity control mode OR explicit auto-feed</span></div>
<div class="line"><span class="lineno">  970</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[i].motion == <a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3">filament_motion_enum::velocity_control</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  971</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[i].motion == <a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75">filament_motion_enum::pressure_ctrl_in_use</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  972</span> </div>
<div class="line"><span class="lineno">  973</span>            <span class="keywordflow">if</span> (i != num)</div>
<div class="line"><span class="lineno">  974</span>            {</div>
<div class="line"><span class="lineno">  975</span>                <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[i] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>;</div>
<div class="line"><span class="lineno">  976</span>                <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[i].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c">filament_motion_enum::pressure_ctrl_idle</a>); </div>
<div class="line"><span class="lineno">  977</span>            }</div>
<div class="line"><span class="lineno">  978</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  979</span>            {</div>
<div class="line"><span class="lineno">  980</span>                <span class="comment">// Has filament or not, we check for overrides first</span></div>
<div class="line"><span class="lineno">  981</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[num] == <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2">filament_unloading</a>) {</div>
<div class="line"><span class="lineno">  982</span>                    <span class="comment">// --- UNLOAD LOGIC ---</span></div>
<div class="line"><span class="lineno">  983</span>                    <span class="comment">// If -1, we wait for sensor to clear (which happens in MC_ONLINE_key_stu)</span></div>
<div class="line"><span class="lineno">  984</span>                    <span class="comment">// If sensor clear (0), we are done.</span></div>
<div class="line"><span class="lineno">  985</span>                    </div>
<div class="line"><span class="lineno">  986</span>                    <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  987</span>                    </div>
<div class="line"><span class="lineno">  988</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a11bff287b64c24fe91500ba99c6f21c8">unload_target_dist</a>[num] == -1) {</div>
<div class="line"><span class="lineno">  989</span>                         <span class="comment">// Unload until clear (Offline)</span></div>
<div class="line"><span class="lineno">  990</span>                         <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[num] == 0) done = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  991</span>                    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  992</span>                         <span class="comment">// Unload distance</span></div>
<div class="line"><span class="lineno">  993</span>                         <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a92f9b1daa685f9041b79423442d440e3">last_total_distance</a>[num] &gt;= (<span class="keywordtype">float</span>)<a class="code hl_variable" href="#a11bff287b64c24fe91500ba99c6f21c8">unload_target_dist</a>[num]) done = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  994</span>                         </div>
<div class="line"><span class="lineno">  995</span> </div>
<div class="line"><span class="lineno">  996</span>                    }</div>
<div class="line"><span class="lineno">  997</span> </div>
<div class="line"><span class="lineno">  998</span>                    <span class="keywordflow">if</span> (done) {</div>
<div class="line"><span class="lineno">  999</span>                        <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[num].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b">filament_motion_enum::stop</a>);</div>
<div class="line"><span class="lineno"> 1000</span>                        <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[num] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>;</div>
<div class="line"><span class="lineno"> 1001</span>                        <a class="code hl_variable" href="#aef70a34b1f25019450171bfa5c07ab62">is_backing_out</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1002</span>                        </div>
<div class="line"><span class="lineno"> 1003</span>                         <span class="comment">// ACK Confirmation</span></div>
<div class="line"><span class="lineno"> 1004</span>                        <span class="keywordtype">char</span> msg[64];</div>
<div class="line"><span class="lineno"> 1005</span>                        <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a11bff287b64c24fe91500ba99c6f21c8">unload_target_dist</a>[num] == -1) sprintf(msg, <span class="stringliteral">&quot;\r\nUNLOAD_FILAMENT: OK (Tray %d, Clear)\r\n&quot;</span>, num);</div>
<div class="line"><span class="lineno"> 1006</span>                        <span class="keywordflow">else</span> sprintf(msg, <span class="stringliteral">&quot;\r\nUNLOAD_FILAMENT: OK (Tray %d, Dist)\r\n&quot;</span>, num);</div>
<div class="line"><span class="lineno"> 1007</span>                        <a class="code hl_function" href="namespace_hardware.html#ad3ec7cad074d6d73508844a06a7bea50">Hardware::UART_Send</a>((<span class="keyword">const</span> uint8_t*)msg, strlen(msg));</div>
<div class="line"><span class="lineno"> 1008</span>                        <span class="keywordflow">return</span>; <span class="comment">// Done</span></div>
<div class="line"><span class="lineno"> 1009</span>                    }</div>
<div class="line"><span class="lineno"> 1010</span>                    </div>
<div class="line"><span class="lineno"> 1011</span>                    <span class="comment">// IF NOT DONE, we just return to keep pulling?</span></div>
<div class="line"><span class="lineno"> 1012</span>                    <span class="comment">// We need to ensure we don&#39;t fall through to other logic.</span></div>
<div class="line"><span class="lineno"> 1013</span>                    <span class="comment">// But if sensor clears, done becomes true above.</span></div>
<div class="line"><span class="lineno"> 1014</span>                    <span class="comment">// If sensor is still 1, we return here to avoid &quot;in_use&quot; logic interfering.</span></div>
<div class="line"><span class="lineno"> 1015</span>                    <span class="keywordflow">return</span>; </div>
<div class="line"><span class="lineno"> 1016</span>                }</div>
<div class="line"><span class="lineno"> 1017</span> </div>
<div class="line"><span class="lineno"> 1018</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[num] == 1 || <a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[num] == 3) <span class="comment">// Has filament</span></div>
<div class="line"><span class="lineno"> 1019</span>            {</div>
<div class="line"><span class="lineno"> 1020</span>                <a class="code hl_enumeration" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695">AMS_filament_motion</a> current_motion = <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#af6b0be8daad68d06efd980f1fb68ef72">filament</a>[num].<a class="code hl_variable" href="struct_filament_state.html#a183761f2029f1dfed9c1a9f56426d030">motion_set</a>;</div>
<div class="line"><span class="lineno"> 1021</span>                </div>
<div class="line"><span class="lineno"> 1022</span>                <span class="comment">// --- LOAD FILAMENT OVERRIDE ---</span></div>
<div class="line"><span class="lineno"> 1023</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[num] == <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22">filament_loading</a>) {</div>
<div class="line"><span class="lineno"> 1024</span>                    <span class="keywordtype">float</span> pressure = <a class="code hl_variable" href="#a14f470efe568bae229e028e1b1acd54f">MC_PULL_stu_raw</a>[num];</div>
<div class="line"><span class="lineno"> 1025</span>                    </div>
<div class="line"><span class="lineno"> 1026</span>                    <span class="comment">// Temporary Debug</span></div>
<div class="line"><span class="lineno"> 1027</span>                    <span class="keyword">static</span> uint64_t last_dbg = 0;</div>
<div class="line"><span class="lineno"> 1028</span>                    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3">Hardware::GetTime</a>() - last_dbg &gt; 500) {</div>
<div class="line"><span class="lineno"> 1029</span>                        <span class="keywordtype">char</span> d[64]; sprintf(d, <span class="stringliteral">&quot;\r\nLOAD P%d\r\n&quot;</span>, num);</div>
<div class="line"><span class="lineno"> 1030</span>                        <a class="code hl_function" href="namespace_hardware.html#ad3ec7cad074d6d73508844a06a7bea50">Hardware::UART_Send</a>((<span class="keyword">const</span> uint8_t*)d, strlen(d));</div>
<div class="line"><span class="lineno"> 1031</span>                        last_dbg = <a class="code hl_function" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3">Hardware::GetTime</a>();</div>
<div class="line"><span class="lineno"> 1032</span>                    }</div>
<div class="line"><span class="lineno"> 1033</span>                    </div>
<div class="line"><span class="lineno"> 1034</span>                    <span class="keywordtype">bool</span> dist_done = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1035</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a11bff287b64c24fe91500ba99c6f21c8">unload_target_dist</a>[num] &gt; 0) { <span class="comment">// Using this var for load len too</span></div>
<div class="line"><span class="lineno"> 1036</span>                        <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a92f9b1daa685f9041b79423442d440e3">last_total_distance</a>[num] &gt;= (<span class="keywordtype">float</span>)<a class="code hl_variable" href="#a11bff287b64c24fe91500ba99c6f21c8">unload_target_dist</a>[num]) {</div>
<div class="line"><span class="lineno"> 1037</span>                            dist_done = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1038</span>                        }</div>
<div class="line"><span class="lineno"> 1039</span>                    }</div>
<div class="line"><span class="lineno"> 1040</span> </div>
<div class="line"><span class="lineno"> 1041</span>                    <span class="keywordflow">if</span> (pressure &gt; <a class="code hl_variable" href="#a9a6c6bb73ae52885ddaa5ec56d8603f9">PULL_voltage_up</a>) {</div>
<div class="line"><span class="lineno"> 1042</span>                        <span class="comment">// Upper Limit Reached -&gt; Success (Reached Toolhead?)</span></div>
<div class="line"><span class="lineno"> 1043</span>                        <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[num] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f">filament_using</a>;</div>
<div class="line"><span class="lineno"> 1044</span>                        <a class="code hl_variable" href="#a33f7ccbf87b78ae7394f88ffe1a4a75e">pull_state_old</a> = <span class="keyword">true</span>; <span class="comment">// Set for pressure_ctrl</span></div>
<div class="line"><span class="lineno"> 1045</span>                        <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[num].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75">filament_motion_enum::pressure_ctrl_in_use</a>);</div>
<div class="line"><span class="lineno"> 1046</span>                        </div>
<div class="line"><span class="lineno"> 1047</span>                        <span class="comment">// ACK Confirmation</span></div>
<div class="line"><span class="lineno"> 1048</span>                        <span class="keywordtype">char</span> msg[64];</div>
<div class="line"><span class="lineno"> 1049</span>                        sprintf(msg, <span class="stringliteral">&quot;\r\nLOAD_FILAMENT: OK (Tray %d, Pressure)\r\n&quot;</span>, num);</div>
<div class="line"><span class="lineno"> 1050</span>                        <a class="code hl_function" href="namespace_hardware.html#ad3ec7cad074d6d73508844a06a7bea50">Hardware::UART_Send</a>((<span class="keyword">const</span> uint8_t*)msg, strlen(msg));</div>
<div class="line"><span class="lineno"> 1051</span>                    } </div>
<div class="line"><span class="lineno"> 1052</span>                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dist_done) {</div>
<div class="line"><span class="lineno"> 1053</span>                        <span class="comment">// Distance Reached -&gt; Done (Feed operation complete)</span></div>
<div class="line"><span class="lineno"> 1054</span>                        <span class="comment">// Should we go to IDLE? Or USING? </span></div>
<div class="line"><span class="lineno"> 1055</span>                        <span class="comment">// Plan said IDLE if distance reached without pressure.</span></div>
<div class="line"><span class="lineno"> 1056</span>                        <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[num] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>;</div>
<div class="line"><span class="lineno"> 1057</span>                        <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[num].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c">filament_motion_enum::pressure_ctrl_idle</a>);</div>
<div class="line"><span class="lineno"> 1058</span>                        <a class="code hl_variable" href="#aef70a34b1f25019450171bfa5c07ab62">is_backing_out</a> = <span class="keyword">false</span>; <span class="comment">// Stop tracking</span></div>
<div class="line"><span class="lineno"> 1059</span>                        </div>
<div class="line"><span class="lineno"> 1060</span>                         <span class="comment">// ACK Confirmation</span></div>
<div class="line"><span class="lineno"> 1061</span>                        <span class="keywordtype">char</span> msg[64];</div>
<div class="line"><span class="lineno"> 1062</span>                        sprintf(msg, <span class="stringliteral">&quot;\r\nLOAD_FILAMENT: OK (Tray %d, Dist)\r\n&quot;</span>, num);</div>
<div class="line"><span class="lineno"> 1063</span>                        <a class="code hl_function" href="namespace_hardware.html#ad3ec7cad074d6d73508844a06a7bea50">Hardware::UART_Send</a>((<span class="keyword">const</span> uint8_t*)msg, strlen(msg));</div>
<div class="line"><span class="lineno"> 1064</span>                    }</div>
<div class="line"><span class="lineno"> 1065</span>                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pressure &gt; 1.70f) { </div>
<div class="line"><span class="lineno"> 1066</span>                        <span class="comment">// Pressure starting to change/limit approaching (1.85V Max) - Slow Down</span></div>
<div class="line"><span class="lineno"> 1067</span>                        <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[num].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8">filament_motion_enum::slow_send</a>);</div>
<div class="line"><span class="lineno"> 1068</span>                    }  </div>
<div class="line"><span class="lineno"> 1069</span>                    <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1070</span>                        <span class="comment">// Regular Feed</span></div>
<div class="line"><span class="lineno"> 1071</span>                        <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[num].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890">filament_motion_enum::send</a>);</div>
<div class="line"><span class="lineno"> 1072</span>                    }</div>
<div class="line"><span class="lineno"> 1073</span>                    <span class="keywordflow">return</span>; <span class="comment">// Skip standard switch</span></div>
<div class="line"><span class="lineno"> 1074</span>                }</div>
<div class="line"><span class="lineno"> 1075</span>                </div>
<div class="line"><span class="lineno"> 1076</span>                <span class="keywordflow">switch</span> (current_motion) </div>
<div class="line"><span class="lineno"> 1077</span>                {</div>
<div class="line"><span class="lineno"> 1078</span>                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695a3a05a41f36f9cb89bd92231a31cbe492">AMS_filament_motion::need_send_out</a>: </div>
<div class="line"><span class="lineno"> 1079</span>                     <a class="code hl_function" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4">Hardware::LED_SetColor</a>(num, 0, 0, 255, 0); </div>
<div class="line"><span class="lineno"> 1080</span>                    <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[num] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f">filament_sending_out</a>;</div>
<div class="line"><span class="lineno"> 1081</span>                    <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[num].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890">filament_motion_enum::send</a>);</div>
<div class="line"><span class="lineno"> 1082</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1083</span>                    </div>
<div class="line"><span class="lineno"> 1084</span>                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695a4d8b2afa72d93ce2db8ae49c464cab22">AMS_filament_motion::need_pull_back</a>:</div>
<div class="line"><span class="lineno"> 1085</span>                    <a class="code hl_variable" href="#a33f7ccbf87b78ae7394f88ffe1a4a75e">pull_state_old</a> = <span class="keyword">false</span>; </div>
<div class="line"><span class="lineno"> 1086</span>                    <a class="code hl_variable" href="#aef70a34b1f25019450171bfa5c07ab62">is_backing_out</a> = <span class="keyword">true</span>; </div>
<div class="line"><span class="lineno"> 1087</span>                    <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[num] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049">filament_pulling_back</a>;</div>
<div class="line"><span class="lineno"> 1088</span>                    <span class="keywordflow">if</span> (device_type == <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a955491d79368cb27f0ba2ab28aba5701a8a4e12e61e7479dc0cc80b06558faac3">BambuBus_AMS_lite</a>) {</div>
<div class="line"><span class="lineno"> 1089</span>                        <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[num].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0">filament_motion_enum::pull</a>);</div>
<div class="line"><span class="lineno"> 1090</span>                    }</div>
<div class="line"><span class="lineno"> 1091</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1092</span>                    </div>
<div class="line"><span class="lineno"> 1093</span>                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695affe509f9c202af4bde1fa8c91f084a3e">AMS_filament_motion::before_pull_back</a>:</div>
<div class="line"><span class="lineno"> 1094</span>                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695a98b23b2fb5bb3781d8bd041e8ff6e5e3">AMS_filament_motion::in_use</a>:</div>
<div class="line"><span class="lineno"> 1095</span>                {</div>
<div class="line"><span class="lineno"> 1096</span>                    <span class="keyword">static</span> uint64_t time_end = 0;</div>
<div class="line"><span class="lineno"> 1097</span>                    uint64_t time_now = <a class="code hl_function" href="#a4ddc46100d9f991cb0d171e62707ee7c">get_time64</a>();</div>
<div class="line"><span class="lineno"> 1098</span>                    </div>
<div class="line"><span class="lineno"> 1099</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[num] == <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a2c4088b74a742f829f7d1ff682b0e19f">filament_sending_out</a>) </div>
<div class="line"><span class="lineno"> 1100</span>                    {</div>
<div class="line"><span class="lineno"> 1101</span>                        <a class="code hl_variable" href="#aef70a34b1f25019450171bfa5c07ab62">is_backing_out</a> = <span class="keyword">false</span>; </div>
<div class="line"><span class="lineno"> 1102</span>                        <a class="code hl_variable" href="#a33f7ccbf87b78ae7394f88ffe1a4a75e">pull_state_old</a> = <span class="keyword">true</span>; </div>
<div class="line"><span class="lineno"> 1103</span>                        <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[num] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f">filament_using</a>; </div>
<div class="line"><span class="lineno"> 1104</span>                        time_end = time_now + 1500;                  </div>
<div class="line"><span class="lineno"> 1105</span>                    }</div>
<div class="line"><span class="lineno"> 1106</span>                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[num] == <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76ae1f30b011a381f9a04ab6eafdbced13f">filament_using</a>) </div>
<div class="line"><span class="lineno"> 1107</span>                    {</div>
<div class="line"><span class="lineno"> 1108</span>                        <a class="code hl_variable" href="_control_logic_8cpp.html#a92f9b1daa685f9041b79423442d440e3">last_total_distance</a>[i] = 0; </div>
<div class="line"><span class="lineno"> 1109</span>                        <span class="keywordflow">if</span> (time_now &gt; time_end)</div>
<div class="line"><span class="lineno"> 1110</span>                        {                                          </div>
<div class="line"><span class="lineno"> 1111</span>                             <a class="code hl_function" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4">Hardware::LED_SetColor</a>(num, 0, 255, 255, 255);</div>
<div class="line"><span class="lineno"> 1112</span>                            <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[num].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75">filament_motion_enum::pressure_ctrl_in_use</a>);</div>
<div class="line"><span class="lineno"> 1113</span>                        }</div>
<div class="line"><span class="lineno"> 1114</span>                        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1115</span>                        {                                                                  </div>
<div class="line"><span class="lineno"> 1116</span>                            <a class="code hl_function" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4">Hardware::LED_SetColor</a>(num, 0, 128, 192, 128);       </div>
<div class="line"><span class="lineno"> 1117</span>                            <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[num].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa1957e2ed8ffcb49c6bdfdb7a2c0a93a8">filament_motion_enum::slow_send</a>); </div>
<div class="line"><span class="lineno"> 1118</span>                        }</div>
<div class="line"><span class="lineno"> 1119</span>                    }</div>
<div class="line"><span class="lineno"> 1120</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1121</span>                }</div>
<div class="line"><span class="lineno"> 1122</span>                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb">AMS_filament_motion::idle</a>:</div>
<div class="line"><span class="lineno"> 1123</span>                    <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[num] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>;</div>
<div class="line"><span class="lineno"> 1124</span>                    <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[num].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c">filament_motion_enum::pressure_ctrl_idle</a>);</div>
<div class="line"><span class="lineno"> 1125</span>                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; j++)</div>
<div class="line"><span class="lineno"> 1126</span>                    {</div>
<div class="line"><span class="lineno"> 1127</span>                        <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[j] == 1 || <a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[j] == 0) {   </div>
<div class="line"><span class="lineno"> 1128</span>                             <a class="code hl_function" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4">Hardware::LED_SetColor</a>(j, 0, 0, 0, 255); <span class="comment">// Blue</span></div>
<div class="line"><span class="lineno"> 1129</span>                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[j] == 2) {   </div>
<div class="line"><span class="lineno"> 1130</span>                             <a class="code hl_function" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4">Hardware::LED_SetColor</a>(j, 0, 255, 144, 0); <span class="comment">// Orange</span></div>
<div class="line"><span class="lineno"> 1131</span>                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[j] == 3) {   </div>
<div class="line"><span class="lineno"> 1132</span>                             <a class="code hl_function" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4">Hardware::LED_SetColor</a>(j, 0, 0, 255, 255); <span class="comment">// Cyan</span></div>
<div class="line"><span class="lineno"> 1133</span>                        }</div>
<div class="line"><span class="lineno"> 1134</span>                    }</div>
<div class="line"><span class="lineno"> 1135</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1136</span>                }</div>
<div class="line"><span class="lineno"> 1137</span>            }</div>
<div class="line"><span class="lineno"> 1138</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a503041f38fbec420305ae1bb79aa4002">MC_ONLINE_key_stu</a>[num] == 0) <span class="comment">// No filament</span></div>
<div class="line"><span class="lineno"> 1139</span>            {</div>
<div class="line"><span class="lineno"> 1140</span>                <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[num] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>;</div>
<div class="line"><span class="lineno"> 1141</span>                <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[num].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c">filament_motion_enum::pressure_ctrl_idle</a>);</div>
<div class="line"><span class="lineno"> 1142</span>            }</div>
<div class="line"><span class="lineno"> 1143</span>            } <span class="comment">// Close the Main Else</span></div>
<div class="line"><span class="lineno"> 1144</span>        }</div>
<div class="line"><span class="lineno"> 1145</span>    }</div>
<div class="ttc" id="a_bambu_bus_protocol_8h_html_a83dede43fdaba7acdcee93b724737695"><div class="ttname"><a href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695">AMS_filament_motion</a></div><div class="ttdeci">AMS_filament_motion</div><div class="ttdef"><b>Definition</b> <a href="_bambu_bus_protocol_8h_source.html#l00015">BambuBusProtocol.h:16</a></div></div>
<div class="ttc" id="a_bambu_bus_protocol_8h_html_a83dede43fdaba7acdcee93b724737695a3a05a41f36f9cb89bd92231a31cbe492"><div class="ttname"><a href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695a3a05a41f36f9cb89bd92231a31cbe492">AMS_filament_motion::need_send_out</a></div><div class="ttdeci">@ need_send_out</div><div class="ttdef"><b>Definition</b> <a href="_bambu_bus_protocol_8h_source.html#l00019">BambuBusProtocol.h:19</a></div></div>
<div class="ttc" id="a_bambu_bus_protocol_8h_html_a83dede43fdaba7acdcee93b724737695a4d8b2afa72d93ce2db8ae49c464cab22"><div class="ttname"><a href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695a4d8b2afa72d93ce2db8ae49c464cab22">AMS_filament_motion::need_pull_back</a></div><div class="ttdeci">@ need_pull_back</div><div class="ttdef"><b>Definition</b> <a href="_bambu_bus_protocol_8h_source.html#l00018">BambuBusProtocol.h:18</a></div></div>
<div class="ttc" id="a_bambu_bus_protocol_8h_html_a83dede43fdaba7acdcee93b724737695a98b23b2fb5bb3781d8bd041e8ff6e5e3"><div class="ttname"><a href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695a98b23b2fb5bb3781d8bd041e8ff6e5e3">AMS_filament_motion::in_use</a></div><div class="ttdeci">@ in_use</div><div class="ttdef"><b>Definition</b> <a href="_bambu_bus_protocol_8h_source.html#l00020">BambuBusProtocol.h:20</a></div></div>
<div class="ttc" id="a_bambu_bus_protocol_8h_html_a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb"><div class="ttname"><a href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb">AMS_filament_motion::idle</a></div><div class="ttdeci">@ idle</div><div class="ttdef"><b>Definition</b> <a href="_bambu_bus_protocol_8h_source.html#l00021">BambuBusProtocol.h:21</a></div></div>
<div class="ttc" id="a_bambu_bus_protocol_8h_html_a83dede43fdaba7acdcee93b724737695affe509f9c202af4bde1fa8c91f084a3e"><div class="ttname"><a href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695affe509f9c202af4bde1fa8c91f084a3e">AMS_filament_motion::before_pull_back</a></div><div class="ttdeci">@ before_pull_back</div><div class="ttdef"><b>Definition</b> <a href="_bambu_bus_protocol_8h_source.html#l00017">BambuBusProtocol.h:17</a></div></div>
<div class="ttc" id="a_bambu_bus_protocol_8h_html_a955491d79368cb27f0ba2ab28aba5701a8a4e12e61e7479dc0cc80b06558faac3"><div class="ttname"><a href="_bambu_bus_protocol_8h.html#a955491d79368cb27f0ba2ab28aba5701a8a4e12e61e7479dc0cc80b06558faac3">BambuBus_AMS_lite</a></div><div class="ttdeci">@ BambuBus_AMS_lite</div><div class="ttdef"><b>Definition</b> <a href="_bambu_bus_protocol_8h_source.html#l00048">BambuBusProtocol.h:48</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a11bff287b64c24fe91500ba99c6f21c8"><div class="ttname"><a href="#a11bff287b64c24fe91500ba99c6f21c8">ControlLogic::unload_target_dist</a></div><div class="ttdeci">static int32_t unload_target_dist[4]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00216">ControlLogic.cpp:216</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a33f7ccbf87b78ae7394f88ffe1a4a75e"><div class="ttname"><a href="#a33f7ccbf87b78ae7394f88ffe1a4a75e">ControlLogic::pull_state_old</a></div><div class="ttdeci">static bool pull_state_old</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00210">ControlLogic.cpp:210</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a3cb6555c20c1e3a386f34fa9f5e6b596"><div class="ttname"><a href="#a3cb6555c20c1e3a386f34fa9f5e6b596">ControlLogic::filament_now_position</a></div><div class="ttdeci">static filament_now_position_enum filament_now_position[4]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00220">ControlLogic.cpp:220</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a4ddc46100d9f991cb0d171e62707ee7c"><div class="ttname"><a href="#a4ddc46100d9f991cb0d171e62707ee7c">ControlLogic::get_time64</a></div><div class="ttdeci">uint64_t get_time64()</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00227">ControlLogic.cpp:227</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_aef70a34b1f25019450171bfa5c07ab62"><div class="ttname"><a href="#aef70a34b1f25019450171bfa5c07ab62">ControlLogic::is_backing_out</a></div><div class="ttdeci">static bool is_backing_out</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00211">ControlLogic.cpp:211</a></div></div>
<div class="ttc" id="anamespace_hardware_html_a44347f62b4ee1789ecfed67b195572e4"><div class="ttname"><a href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4">Hardware::LED_SetColor</a></div><div class="ttdeci">void LED_SetColor(uint8_t channel, int led_idx, uint8_t r, uint8_t g, uint8_t b)</div><div class="ttdoc">Set Color of a specific LED.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00530">Hardware.cpp:530</a></div></div>
<div class="ttc" id="anamespace_hardware_html_ad3ec7cad074d6d73508844a06a7bea50"><div class="ttname"><a href="namespace_hardware.html#ad3ec7cad074d6d73508844a06a7bea50">Hardware::UART_Send</a></div><div class="ttdeci">void UART_Send(const uint8_t *data, uint16_t length)</div><div class="ttdoc">Send a buffer via UART1.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00261">Hardware.cpp:261</a></div></div>
<div class="ttc" id="astruct_filament_state_html_a183761f2029f1dfed9c1a9f56426d030"><div class="ttname"><a href="struct_filament_state.html#a183761f2029f1dfed9c1a9f56426d030">FilamentState::motion_set</a></div><div class="ttdeci">AMS_filament_motion motion_set</div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00050">UnitState.h:50</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_bambu_bus_protocol_8h_source.html#l00048">BambuBus_AMS_lite</a>, <a class="el" href="_bambu_bus_protocol_8h_source.html#l00017">before_pull_back</a>, <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>, <a class="el" href="_control_logic_8cpp_source.html#l00038">device_type_addr</a>, <a class="el" href="_control_logic_8cpp_source.html#l00172">filament_idle</a>, <a class="el" href="_control_logic_8cpp_source.html#l00177">filament_loading</a>, <a class="el" href="_control_logic_8cpp_source.html#l00220">filament_now_position</a>, <a class="el" href="_control_logic_8cpp_source.html#l00175">filament_pulling_back</a>, <a class="el" href="_control_logic_8cpp_source.html#l00173">filament_sending_out</a>, <a class="el" href="_control_logic_8cpp_source.html#l00178">filament_unloading</a>, <a class="el" href="_control_logic_8cpp_source.html#l00174">filament_using</a>, <a class="el" href="_control_logic_8cpp_source.html#l00227">get_time64()</a>, <a class="el" href="_hardware_8cpp_source.html#l00115">Hardware::GetTime()</a>, <a class="el" href="_bambu_bus_protocol_8h_source.html#l00021">idle</a>, <a class="el" href="_bambu_bus_protocol_8h_source.html#l00020">in_use</a>, <a class="el" href="_control_logic_8cpp_source.html#l00211">is_backing_out</a>, <a class="el" href="_control_logic_8cpp_source.html#l00035">last_total_distance</a>, <a class="el" href="_hardware_8cpp_source.html#l00530">Hardware::LED_SetColor()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00208">MC_ONLINE_key_stu</a>, <a class="el" href="_control_logic_8cpp_source.html#l00205">MC_PULL_stu_raw</a>, <a class="el" href="_control_logic_8cpp_source.html#l00517">motors</a>, <a class="el" href="_bambu_bus_protocol_8h_source.html#l00018">need_pull_back</a>, <a class="el" href="_bambu_bus_protocol_8h_source.html#l00019">need_send_out</a>, <a class="el" href="_control_logic_8cpp_source.html#l00187">pressure_ctrl_idle</a>, <a class="el" href="_control_logic_8cpp_source.html#l00188">pressure_ctrl_in_use</a>, <a class="el" href="_control_logic_8cpp_source.html#l00185">pull</a>, <a class="el" href="_control_logic_8cpp_source.html#l00210">pull_state_old</a>, <a class="el" href="_control_logic_8cpp_source.html#l00196">PULL_voltage_up</a>, <a class="el" href="_control_logic_8cpp_source.html#l00184">send</a>, <a class="el" href="_control_logic_8cpp_source.html#l00186">slow_send</a>, <a class="el" href="_control_logic_8cpp_source.html#l00183">stop</a>, <a class="el" href="_hardware_8cpp_source.html#l00261">Hardware::UART_Send()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00216">unload_target_dist</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00190">velocity_control</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00792">Run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_ac2d890c891494072159ebc2b30490197_cgraph.png" border="0" usemap="#anamespace_control_logic_ac2d890c891494072159ebc2b30490197_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_ac2d890c891494072159ebc2b30490197_cgraph" id="anamespace_control_logic_ac2d890c891494072159ebc2b30490197_cgraph">
<area shape="rect" title="State Machine for BambuBus Logic." alt="" coords="5,73,141,116"/>
<area shape="rect" href="namespace_control_logic.html#a4ddc46100d9f991cb0d171e62707ee7c" title=" " alt="" coords="190,5,356,32"/>
<area shape="poly" title=" " alt="" coords="130,70,188,48,224,36,220,39,190,53,133,75"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="431,31,566,57"/>
<area shape="poly" title=" " alt="" coords="140,84,416,51,415,56,141,89"/>
<area shape="rect" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4" title="Set Color of a specific LED." alt="" coords="189,107,358,133"/>
<area shape="poly" title=" " alt="" coords="141,101,176,106,171,108,142,106"/>
<area shape="rect" href="namespace_hardware.html#ad3ec7cad074d6d73508844a06a7bea50" title="Send a buffer via UART1." alt="" coords="194,157,352,184"/>
<area shape="poly" title=" " alt="" coords="120,114,190,143,211,152,206,152,188,148,120,119"/>
<area shape="poly" title=" " alt="" coords="357,25,418,34,413,35,357,31"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="666,31,751,57"/>
<area shape="poly" title=" " alt="" coords="566,41,653,43,648,45,567,47"/>
<area shape="rect" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157" title=" " alt="" coords="459,107,538,133"/>
<area shape="poly" title=" " alt="" coords="358,117,446,119,441,121,358,123"/>
<area shape="rect" href="namespace_hardware.html#a0ada30189b8e1d1dbec145140849b778" title="Microsecond Delay." alt="" coords="639,183,778,209"/>
<area shape="poly" title=" " alt="" coords="353,173,626,190,621,192,353,178"/>
<area shape="rect" href="namespace_hardware.html#aaaf02ef3df5811e2ba28dd009eadfaae" title="Send a single byte blocking." alt="" coords="406,208,591,235"/>
<area shape="poly" title=" " alt="" coords="336,182,424,204,419,204,336,187"/>
<area shape="poly" title=" " alt="" coords="591,207,622,206,627,206,592,213"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_ac2d890c891494072159ebc2b30490197_icgraph.png" border="0" usemap="#anamespace_control_logic_ac2d890c891494072159ebc2b30490197_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_ac2d890c891494072159ebc2b30490197_icgraph" id="anamespace_control_logic_ac2d890c891494072159ebc2b30490197_icgraph">
<area shape="rect" title="State Machine for BambuBus Logic." alt="" coords="669,5,804,48"/>
<area shape="rect" href="namespace_control_logic.html#adc8c269923e0c76c6d104a005833a7f9" title="Main Control Loop." alt="" coords="494,13,621,40"/>
<area shape="poly" title=" " alt="" coords="651,27,621,29,621,24,656,27"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,13,446,40"/>
<area shape="poly" title=" " alt="" coords="476,27,447,29,447,24,482,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,13,353,40"/>
<area shape="poly" title=" " alt="" coords="383,27,353,29,353,24,388,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,5,140,48"/>
<area shape="poly" title=" " alt="" coords="170,27,140,29,140,24,175,26"/>
</map>
</div>

</div>
</div>
<a id="a484eadc314267f8bc9aa0f025c1137d9" name="a484eadc314267f8bc9aa0f025c1137d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a484eadc314267f8bc9aa0f025c1137d9">&#9670;&#160;</a></span>MoveAxis()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::MoveAxis </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>axis</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>dist_mm</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>speed</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Manually move an axis (Klipper Primitive). </p>
<p>Uses Velocity Control mode to move a specific distance at a specific speed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">axis</td><td>Axis index (0-3). </td></tr>
    <tr><td class="paramname">dist_mm</td><td>Distance to move (positive). </td></tr>
    <tr><td class="paramname">speed</td><td>Speed in mm/s. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00616">616</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  616</span>                                                        {</div>
<div class="line"><span class="lineno">  617</span>        <span class="keywordflow">if</span>(axis &lt; 0 || axis &gt;= 4) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  618</span>        </div>
<div class="line"><span class="lineno">  619</span>        <span class="comment">// Use Velocity Control</span></div>
<div class="line"><span class="lineno">  620</span>        <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[axis].target_velocity = speed;</div>
<div class="line"><span class="lineno">  621</span>        <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[axis].target_distance = fabs(dist_mm); <span class="comment">// Ensure positive</span></div>
<div class="line"><span class="lineno">  622</span>        <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[axis].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa564e40f75901e1ab2eedc66858c1a6f3">filament_motion_enum::velocity_control</a>);</div>
<div class="line"><span class="lineno">  623</span>    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00517">motors</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00190">velocity_control</a>.</p>

<p class="reference">Referenced by <a class="el" href="_klipper_c_l_i_8cpp_source.html#l00208">KlipperCLI::HandleMove()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a484eadc314267f8bc9aa0f025c1137d9_icgraph.png" border="0" usemap="#anamespace_control_logic_a484eadc314267f8bc9aa0f025c1137d9_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a484eadc314267f8bc9aa0f025c1137d9_icgraph" id="anamespace_control_logic_a484eadc314267f8bc9aa0f025c1137d9_icgraph">
<area shape="rect" title="Manually move an axis (Klipper Primitive)." alt="" coords="1296,13,1456,40"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a12cef4b97fbfa7cfb7bdb1540e626ae9" title="Handler for MOVE command." alt="" coords="1084,13,1248,40"/>
<area shape="poly" title=" " alt="" coords="1278,27,1248,29,1248,24,1283,27"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a6089e6db2e7edddf19fdf095b9826c88" title="Parse and Dispatch a JSON Packet." alt="" coords="857,13,1036,40"/>
<area shape="poly" title=" " alt="" coords="1066,27,1037,29,1037,24,1072,27"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afe96c8a3898aa7a50f68ab6d726860c3" title="Main Execution Loop." alt="" coords="695,13,809,40"/>
<area shape="poly" title=" " alt="" coords="839,27,809,29,809,24,844,27"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,13,647,40"/>
<area shape="poly" title=" " alt="" coords="677,27,647,29,647,24,682,27"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,13,446,40"/>
<area shape="poly" title=" " alt="" coords="476,27,447,29,447,24,481,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,13,353,40"/>
<area shape="poly" title=" " alt="" coords="383,27,353,29,353,24,388,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,5,140,48"/>
<area shape="poly" title=" " alt="" coords="170,27,140,29,140,24,175,26"/>
</map>
</div>

</div>
</div>
<a id="acb78560c64e5ea050853ab319a03f14e" name="acb78560c64e5ea050853ab319a03f14e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb78560c64e5ea050853ab319a03f14e">&#9670;&#160;</a></span>Prepare_For_filament_Pull_Back()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ControlLogic::Prepare_For_filament_Pull_Back </td>
          <td>(</td>
          <td class="paramtype">float_t</td>          <td class="paramname"><span class="paramname"><em>OUT_filament_meters</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if pullback is required (Smart Pullback Logic). </p>
<p>If a lane is in <span class="tt"><a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049">filament_pulling_back</a></span> state, this checks if it has reached the target distance (<span class="tt">OUT_filament_meters</span>). Stops it if so.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">OUT_filament_meters</td><td>Target distance. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true If any lane is actively pulling back. </dd>
<dd>
false If no lanes are pulling back. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00751">751</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  752</span>    {</div>
<div class="line"><span class="lineno">  753</span>        <span class="keywordtype">bool</span> wait = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  754</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; i++)</div>
<div class="line"><span class="lineno">  755</span>        {</div>
<div class="line"><span class="lineno">  756</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[i] == <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a84065cd61f9cbea85edc429058d9f049">filament_pulling_back</a>)</div>
<div class="line"><span class="lineno">  757</span>            {</div>
<div class="line"><span class="lineno">  758</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a92f9b1daa685f9041b79423442d440e3">last_total_distance</a>[i] &lt; OUT_filament_meters)</div>
<div class="line"><span class="lineno">  759</span>                {</div>
<div class="line"><span class="lineno">  760</span>                    <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[i].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0">filament_motion_enum::pull</a>);</div>
<div class="line"><span class="lineno">  761</span>                    </div>
<div class="line"><span class="lineno">  762</span>                    <span class="keywordtype">float</span> npercent = (<a class="code hl_variable" href="_control_logic_8cpp.html#a92f9b1daa685f9041b79423442d440e3">last_total_distance</a>[i] / OUT_filament_meters) * 100.0f;</div>
<div class="line"><span class="lineno">  763</span>                    <span class="keywordtype">int</span> r = 255 - ((255 / 100) * npercent);</div>
<div class="line"><span class="lineno">  764</span>                    <span class="keywordtype">int</span> g = 125 - ((125 / 100) * npercent);</div>
<div class="line"><span class="lineno">  765</span>                    <span class="keywordtype">int</span> b = (255 / 100) * npercent;</div>
<div class="line"><span class="lineno">  766</span>                    <span class="keywordflow">if</span>(r&lt;0) r=0; </div>
<div class="line"><span class="lineno">  767</span>                    <span class="keywordflow">if</span>(g&lt;0) g=0; </div>
<div class="line"><span class="lineno">  768</span>                    <span class="keywordflow">if</span>(b&lt;0) b=0;</div>
<div class="line"><span class="lineno">  769</span>                    <a class="code hl_function" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4">Hardware::LED_SetColor</a>(i, 0, r, g, b);</div>
<div class="line"><span class="lineno">  770</span>                }</div>
<div class="line"><span class="lineno">  771</span>                <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  772</span>                {</div>
<div class="line"><span class="lineno">  773</span>                    <a class="code hl_variable" href="#aef70a34b1f25019450171bfa5c07ab62">is_backing_out</a> = <span class="keyword">false</span>; </div>
<div class="line"><span class="lineno">  774</span>                    <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[i].<a class="code hl_function" href="class_control_logic_1_1_motor_channel.html#a0b8ed284da431b3325320e709433a454">SetMotion</a>(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b">filament_motion_enum::stop</a>);</div>
<div class="line"><span class="lineno">  775</span>                    <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[i] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>;               </div>
<div class="line"><span class="lineno">  776</span>                    <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.filament[i].motion_set = <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb">AMS_filament_motion::idle</a>;</div>
<div class="line"><span class="lineno">  777</span>                    <a class="code hl_variable" href="_control_logic_8cpp.html#a92f9b1daa685f9041b79423442d440e3">last_total_distance</a>[i] = 0;                             </div>
<div class="line"><span class="lineno">  778</span>                }</div>
<div class="line"><span class="lineno">  779</span>                wait = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  780</span>            }</div>
<div class="line"><span class="lineno">  781</span>        }</div>
<div class="line"><span class="lineno">  782</span>        <span class="keywordflow">return</span> wait;</div>
<div class="line"><span class="lineno">  783</span>    }</div>
<div class="ttc" id="aclass_control_logic_1_1_motor_channel_html_a0b8ed284da431b3325320e709433a454"><div class="ttname"><a href="class_control_logic_1_1_motor_channel.html#a0b8ed284da431b3325320e709433a454">ControlLogic::MotorChannel::SetMotion</a></div><div class="ttdeci">void SetMotion(filament_motion_enum m)</div><div class="ttdoc">Set the motion mode for this channel.</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00347">ControlLogic.cpp:347</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>, <a class="el" href="_control_logic_8cpp_source.html#l00172">filament_idle</a>, <a class="el" href="_control_logic_8cpp_source.html#l00220">filament_now_position</a>, <a class="el" href="_control_logic_8cpp_source.html#l00175">filament_pulling_back</a>, <a class="el" href="_bambu_bus_protocol_8h_source.html#l00021">idle</a>, <a class="el" href="_control_logic_8cpp_source.html#l00211">is_backing_out</a>, <a class="el" href="_control_logic_8cpp_source.html#l00035">last_total_distance</a>, <a class="el" href="_hardware_8cpp_source.html#l00530">Hardware::LED_SetColor()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00517">motors</a>, <a class="el" href="_control_logic_8cpp_source.html#l00185">pull</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00183">stop</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00792">Run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_acb78560c64e5ea050853ab319a03f14e_cgraph.png" border="0" usemap="#anamespace_control_logic_acb78560c64e5ea050853ab319a03f14e_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_acb78560c64e5ea050853ab319a03f14e_cgraph" id="anamespace_control_logic_acb78560c64e5ea050853ab319a03f14e_cgraph">
<area shape="rect" title="Check if pullback is required (Smart Pullback Logic)." alt="" coords="5,5,172,48"/>
<area shape="rect" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4" title="Set Color of a specific LED." alt="" coords="220,13,389,40"/>
<area shape="poly" title=" " alt="" coords="172,24,206,26,201,27,172,29"/>
<area shape="rect" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157" title=" " alt="" coords="437,13,516,40"/>
<area shape="poly" title=" " alt="" coords="389,24,424,27,419,27,390,29"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_acb78560c64e5ea050853ab319a03f14e_icgraph.png" border="0" usemap="#anamespace_control_logic_acb78560c64e5ea050853ab319a03f14e_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_acb78560c64e5ea050853ab319a03f14e_icgraph" id="anamespace_control_logic_acb78560c64e5ea050853ab319a03f14e_icgraph">
<area shape="rect" title="Check if pullback is required (Smart Pullback Logic)." alt="" coords="669,5,835,48"/>
<area shape="rect" href="namespace_control_logic.html#adc8c269923e0c76c6d104a005833a7f9" title="Main Control Loop." alt="" coords="494,13,621,40"/>
<area shape="poly" title=" " alt="" coords="650,27,621,29,621,24,655,27"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,13,446,40"/>
<area shape="poly" title=" " alt="" coords="476,27,447,29,447,24,482,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,13,353,40"/>
<area shape="poly" title=" " alt="" coords="383,27,353,29,353,24,388,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,5,140,48"/>
<area shape="poly" title=" " alt="" coords="170,27,140,29,140,24,175,26"/>
</map>
</div>

</div>
</div>
<a id="a0c4206af909c8128bc68eb6a1bcfa16e" name="a0c4206af909c8128bc68eb6a1bcfa16e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c4206af909c8128bc68eb6a1bcfa16e">&#9670;&#160;</a></span>ProcessHeartbeat()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::ProcessHeartbeat </td>
          <td>(</td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for Heartbeat (0x20). </p>
<p>Updates connectivity timestamp. </p>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l01355">1355</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1355</span>                                                            {</div>
<div class="line"><span class="lineno"> 1356</span>        <a class="code hl_function" href="#a9716be5fe9da72481bee41a80681d8e5">UpdateConnectivity</a>(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1357</span>    }</div>
<div class="ttc" id="anamespace_control_logic_html_a9716be5fe9da72481bee41a80681d8e5"><div class="ttname"><a href="#a9716be5fe9da72481bee41a80681d8e5">ControlLogic::UpdateConnectivity</a></div><div class="ttdeci">void UpdateConnectivity(bool online)</div><div class="ttdoc">Update connectivity status (Online/Offline).</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00948">ControlLogic.cpp:948</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00948">UpdateConnectivity()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a0c4206af909c8128bc68eb6a1bcfa16e_cgraph.png" border="0" usemap="#anamespace_control_logic_a0c4206af909c8128bc68eb6a1bcfa16e_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a0c4206af909c8128bc68eb6a1bcfa16e_cgraph" id="anamespace_control_logic_a0c4206af909c8128bc68eb6a1bcfa16e_cgraph">
<area shape="rect" title="Handler for Heartbeat (0x20)." alt="" coords="5,5,213,32"/>
<area shape="rect" href="namespace_control_logic.html#a9716be5fe9da72481bee41a80681d8e5" title="Update connectivity status (Online/Offline)." alt="" coords="261,5,478,32"/>
<area shape="poly" title=" " alt="" coords="213,16,248,19,242,19,213,21"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="526,5,661,32"/>
<area shape="poly" title=" " alt="" coords="478,16,513,19,508,19,478,21"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="709,5,795,32"/>
<area shape="poly" title=" " alt="" coords="662,16,696,19,691,19,662,21"/>
</map>
</div>

</div>
</div>
<a id="a1ff0bcee8062346fb963e4dd845c8bdf" name="a1ff0bcee8062346fb963e4dd845c8bdf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ff0bcee8062346fb963e4dd845c8bdf">&#9670;&#160;</a></span>ProcessLongPacket()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::ProcessLongPacket </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlong__packge__data.html">long_packge_data</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>data</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler/Dispatcher for Long Packets. </p>
<p>Processes parsed long packets based on their type (0x211, 0x218, 0x103, etc.).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Reference to parsed <span class="tt"><a class="el" href="structlong__packge__data.html">long_packge_data</a></span>. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l01435">1435</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1435</span>                                                          {</div>
<div class="line"><span class="lineno"> 1436</span>        <span class="comment">// switch data.type...</span></div>
<div class="line"><span class="lineno"> 1437</span>        <span class="comment">// 0x211 Read Filament -&gt; Send Response</span></div>
<div class="line"><span class="lineno"> 1438</span>        <span class="comment">// 0x218 Set Filament -&gt; Update &amp; Send ACK</span></div>
<div class="line"><span class="lineno"> 1439</span>        <span class="comment">// 0x103 Version -&gt; Send Response</span></div>
<div class="line"><span class="lineno"> 1440</span>        </div>
<div class="line"><span class="lineno"> 1441</span>        <span class="comment">// This function executes the Logic for Long Packets.</span></div>
<div class="line"><span class="lineno"> 1442</span>        <span class="comment">// It uses &quot;SendPacket&quot; to send replies.</span></div>
<div class="line"><span class="lineno"> 1443</span>        </div>
<div class="line"><span class="lineno"> 1444</span>        <span class="comment">// Implementation omitted for brevity but should be here.</span></div>
<div class="line"><span class="lineno"> 1445</span>        <span class="comment">// ...</span></div>
<div class="line"><span class="lineno"> 1446</span>    }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_command_router_8cpp_source.html#l00061">CommandRouter::HandleLongPacket()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a1ff0bcee8062346fb963e4dd845c8bdf_icgraph.png" border="0" usemap="#anamespace_control_logic_a1ff0bcee8062346fb963e4dd845c8bdf_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a1ff0bcee8062346fb963e4dd845c8bdf_icgraph" id="anamespace_control_logic_a1ff0bcee8062346fb963e4dd845c8bdf_icgraph">
<area shape="rect" title="Handler/Dispatcher for Long Packets." alt="" coords="1151,5,1330,48"/>
<area shape="rect" href="namespace_command_router.html#a1d2e53549b25a63274ad073b375e5f21" title="wrapper to handle Long Packets by parsing and dispatching." alt="" coords="906,5,1103,48"/>
<area shape="poly" title=" " alt="" coords="1133,27,1104,29,1104,24,1139,27"/>
<area shape="rect" href="namespace_command_router.html#a329f0a7e2f53debf5c7cb5f47579151b" title="Route an incoming command to its specific handler." alt="" coords="695,13,858,40"/>
<area shape="poly" title=" " alt="" coords="888,27,859,29,859,24,893,27"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,13,647,40"/>
<area shape="poly" title=" " alt="" coords="676,27,647,29,647,24,682,27"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,13,446,40"/>
<area shape="poly" title=" " alt="" coords="476,27,447,29,447,24,481,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,13,353,40"/>
<area shape="poly" title=" " alt="" coords="383,27,353,29,353,24,388,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,5,140,48"/>
<area shape="poly" title=" " alt="" coords="170,27,140,29,140,24,175,26"/>
</map>
</div>

</div>
</div>
<a id="a2ab840bfd454a7709553b89529285b74" name="a2ab840bfd454a7709553b89529285b74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ab840bfd454a7709553b89529285b74">&#9670;&#160;</a></span>ProcessMotionLong()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::ProcessMotionLong </td>
          <td>(</td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for Filament Motion Long packet (0x04). </p>
<dl class="section note"><dt>Note</dt><dd>Currently a placeholder. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l01302">1302</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1302</span>                                                             {</div>
<div class="line"><span class="lineno"> 1303</span>        <span class="comment">// Just forward for now or implement logic if found</span></div>
<div class="line"><span class="lineno"> 1304</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa490d28f0823086ff5e1e97451425dc7" name="aa490d28f0823086ff5e1e97451425dc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa490d28f0823086ff5e1e97451425dc7">&#9670;&#160;</a></span>ProcessMotionLongLogic()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::ProcessMotionLongLogic </td>
          <td>(</td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>payload</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5f85db884abd1a66d8b120729ec0d99e" name="a5f85db884abd1a66d8b120729ec0d99e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f85db884abd1a66d8b120729ec0d99e">&#9670;&#160;</a></span>ProcessMotionShort()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::ProcessMotionShort </td>
          <td>(</td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for Filament Motion Short packet (0x03). </p>
<p>Extracts arguments from the buffer and calls <span class="tt"><a class="el" href="#a8880b393facb6828519b8dac8e96393c" title="Core logic for processing Short Motion packets.">ProcessMotionShortLogic</a></span>. </p>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l01285">1285</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1285</span>                                                              {</div>
<div class="line"><span class="lineno"> 1286</span>        <span class="keywordflow">if</span> (length &lt; 9) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1287</span>        <span class="comment">// Parse Args</span></div>
<div class="line"><span class="lineno"> 1288</span>        uint8_t ams_num = buffer[5];</div>
<div class="line"><span class="lineno"> 1289</span>        <span class="keywordflow">if</span> (ams_num != 0) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1290</span>        uint8_t statu_flags = buffer[6];</div>
<div class="line"><span class="lineno"> 1291</span>        uint8_t read_num = buffer[7];</div>
<div class="line"><span class="lineno"> 1292</span>        uint8_t motion_flag = buffer[8];</div>
<div class="line"><span class="lineno"> 1293</span>        </div>
<div class="line"><span class="lineno"> 1294</span>        <a class="code hl_function" href="#a8880b393facb6828519b8dac8e96393c">ProcessMotionShortLogic</a>(ams_num, statu_flags, read_num, motion_flag);</div>
<div class="line"><span class="lineno"> 1295</span>    }</div>
<div class="ttc" id="anamespace_control_logic_html_a8880b393facb6828519b8dac8e96393c"><div class="ttname"><a href="#a8880b393facb6828519b8dac8e96393c">ControlLogic::ProcessMotionShortLogic</a></div><div class="ttdeci">void ProcessMotionShortLogic(uint8_t ams_num, uint8_t statu_flags, uint8_t read_num, uint8_t fliment_motion_flag)</div><div class="ttdoc">Core logic for processing Short Motion packets.</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l01160">ControlLogic.cpp:1160</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l01160">ProcessMotionShortLogic()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a5f85db884abd1a66d8b120729ec0d99e_cgraph.png" border="0" usemap="#anamespace_control_logic_a5f85db884abd1a66d8b120729ec0d99e_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a5f85db884abd1a66d8b120729ec0d99e_cgraph" id="anamespace_control_logic_a5f85db884abd1a66d8b120729ec0d99e_cgraph">
<area shape="rect" title="Handler for Filament Motion Short packet (0x03)." alt="" coords="5,64,195,107"/>
<area shape="rect" href="namespace_control_logic.html#a8880b393facb6828519b8dac8e96393c" title="Core logic for processing Short Motion packets." alt="" coords="243,64,432,107"/>
<area shape="poly" title=" " alt="" coords="195,83,230,85,224,86,196,88"/>
<area shape="rect" href="class_bambu_bus_protocol.html#af9d11bc755538718e6ba8fbc5c8e9187" title="Finalize a packet for transmission by calculating and appending CRCs." alt="" coords="480,5,691,48"/>
<area shape="poly" title=" " alt="" coords="430,61,480,51,475,53,431,66"/>
<area shape="rect" href="namespace_control_logic.html#a4ddc46100d9f991cb0d171e62707ee7c" title=" " alt="" coords="502,72,669,99"/>
<area shape="poly" title=" " alt="" coords="432,83,490,85,485,86,433,88"/>
<area shape="rect" href="namespace_command_router.html#a1cf14aabb538f71f140e6b1aa7ef965d" title="Send a raw data packet via UART." alt="" coords="486,123,685,149"/>
<area shape="poly" title=" " alt="" coords="433,102,504,119,499,119,432,107"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="751,72,886,99"/>
<area shape="poly" title=" " alt="" coords="669,83,738,85,733,86,670,88"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="996,72,1081,99"/>
<area shape="poly" title=" " alt="" coords="887,83,983,85,977,86,887,88"/>
<area shape="rect" href="namespace_hardware.html#ad3ec7cad074d6d73508844a06a7bea50" title="Send a buffer via UART1." alt="" coords="739,123,898,149"/>
<area shape="poly" title=" " alt="" coords="686,133,726,136,721,136,686,139"/>
<area shape="rect" href="namespace_hardware.html#a0ada30189b8e1d1dbec145140849b778" title="Microsecond Delay." alt="" coords="1179,148,1317,175"/>
<area shape="poly" title=" " alt="" coords="898,138,1166,156,1161,156,898,143"/>
<area shape="rect" href="namespace_hardware.html#aaaf02ef3df5811e2ba28dd009eadfaae" title="Send a single byte blocking." alt="" coords="946,173,1131,200"/>
<area shape="poly" title=" " alt="" coords="880,147,965,170,960,169,879,153"/>
<area shape="poly" title=" " alt="" coords="1131,173,1161,172,1167,171,1131,178"/>
</map>
</div>

</div>
</div>
<a id="a8880b393facb6828519b8dac8e96393c" name="a8880b393facb6828519b8dac8e96393c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8880b393facb6828519b8dac8e96393c">&#9670;&#160;</a></span>ProcessMotionShortLogic()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::ProcessMotionShortLogic </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>ams_num</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>statu_flags</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>read_num</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>fliment_motion_flag</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Core logic for processing Short Motion packets. </p>
<p>Handles state transitions based on status flags received from the printer. Updates filament meter usage, pressure status, and responds with the current status.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ams_num</td><td>AMS Unit ID (0-3). </td></tr>
    <tr><td class="paramname">statu_flags</td><td>Status bitmask. </td></tr>
    <tr><td class="paramname">read_num</td><td>Filament/Tray index interacting. </td></tr>
    <tr><td class="paramname">fliment_motion_flag</td><td>Motion control flags. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l01160">1160</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1160</span>                                                                                                                      {</div>
<div class="line"><span class="lineno"> 1161</span>        <span class="comment">// Core Logic from ProcessMotionShort</span></div>
<div class="line"><span class="lineno"> 1162</span>        </div>
<div class="line"><span class="lineno"> 1163</span>        <span class="keyword">static</span> uint64_t time_last = 0;</div>
<div class="line"><span class="lineno"> 1164</span>        uint64_t time_now = <a class="code hl_function" href="#a4ddc46100d9f991cb0d171e62707ee7c">get_time64</a>();</div>
<div class="line"><span class="lineno"> 1165</span>        uint64_t time_used = time_now - time_last;</div>
<div class="line"><span class="lineno"> 1166</span>        time_last = time_now;</div>
<div class="line"><span class="lineno"> 1167</span> </div>
<div class="line"><span class="lineno"> 1168</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a52925c91da70ade3c48b8eb3fe99caf6">device_type_addr</a> == <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a955491d79368cb27f0ba2ab28aba5701a1468bae394016b2d3dd75dea179a6578">BambuBus_AMS</a>) { <span class="comment">// AMS08</span></div>
<div class="line"><span class="lineno"> 1169</span>             <span class="keywordflow">if</span> (read_num &lt; 4) {</div>
<div class="line"><span class="lineno"> 1170</span>                 <a class="code hl_struct" href="struct_filament_state.html">FilamentState</a> &amp;f = <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.filament[read_num];</div>
<div class="line"><span class="lineno"> 1171</span>                 </div>
<div class="line"><span class="lineno"> 1172</span>                 <span class="keywordflow">if</span> ((statu_flags == 0x03) &amp;&amp; (fliment_motion_flag == 0x00)) { <span class="comment">// 03 00</span></div>
<div class="line"><span class="lineno"> 1173</span>                     <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.BambuBus_now_filament_num != read_num) {</div>
<div class="line"><span class="lineno"> 1174</span>                         <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.BambuBus_now_filament_num &lt; 4) {</div>
<div class="line"><span class="lineno"> 1175</span>                             <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.filament[<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.BambuBus_now_filament_num].motion_set = <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb">AMS_filament_motion::idle</a>;</div>
<div class="line"><span class="lineno"> 1176</span>                             <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.filament_use_flag = 0x00;</div>
<div class="line"><span class="lineno"> 1177</span>                             <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.filament[<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.BambuBus_now_filament_num].pressure = 0xFFFF;</div>
<div class="line"><span class="lineno"> 1178</span>                         }</div>
<div class="line"><span class="lineno"> 1179</span>                         <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.BambuBus_now_filament_num = read_num;</div>
<div class="line"><span class="lineno"> 1180</span>                     }</div>
<div class="line"><span class="lineno"> 1181</span>                     f.<a class="code hl_variable" href="struct_filament_state.html#a183761f2029f1dfed9c1a9f56426d030">motion_set</a> = <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695a3a05a41f36f9cb89bd92231a31cbe492">AMS_filament_motion::need_send_out</a>;</div>
<div class="line"><span class="lineno"> 1182</span>                     <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#a921a5777c50455edf8775c22430bcfa3">filament_use_flag</a> = 0x02;</div>
<div class="line"><span class="lineno"> 1183</span>                     f.<a class="code hl_variable" href="struct_filament_state.html#a2210f4ad5b00137bf844f1289ee79226">pressure</a> = 0x4700;</div>
<div class="line"><span class="lineno"> 1184</span>                 }</div>
<div class="line"><span class="lineno"> 1185</span>                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (statu_flags == 0x09) { <span class="comment">// 09 A5 / 09 3F</span></div>
<div class="line"><span class="lineno"> 1186</span>                      <span class="keywordflow">if</span> (f.<a class="code hl_variable" href="struct_filament_state.html#a183761f2029f1dfed9c1a9f56426d030">motion_set</a> == <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695a3a05a41f36f9cb89bd92231a31cbe492">AMS_filament_motion::need_send_out</a>) {</div>
<div class="line"><span class="lineno"> 1187</span>                          f.<a class="code hl_variable" href="struct_filament_state.html#a183761f2029f1dfed9c1a9f56426d030">motion_set</a> = <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695a98b23b2fb5bb3781d8bd041e8ff6e5e3">AMS_filament_motion::in_use</a>;</div>
<div class="line"><span class="lineno"> 1188</span>                          <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#a921a5777c50455edf8775c22430bcfa3">filament_use_flag</a> = 0x04;</div>
<div class="line"><span class="lineno"> 1189</span>                          f.<a class="code hl_variable" href="struct_filament_state.html#a3a223cbec99bcd0f6c113bbd073df9fe">meters_virtual_count</a> = 0;</div>
<div class="line"><span class="lineno"> 1190</span>                      }</div>
<div class="line"><span class="lineno"> 1191</span>                      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f.<a class="code hl_variable" href="struct_filament_state.html#a3a223cbec99bcd0f6c113bbd073df9fe">meters_virtual_count</a> &lt; 10000) { </div>
<div class="line"><span class="lineno"> 1192</span>                          f.<a class="code hl_variable" href="struct_filament_state.html#aabba44628ec691809d7b13b94b8a507e">meters</a> += (float)time_used / 300000; </div>
<div class="line"><span class="lineno"> 1193</span>                          f.<a class="code hl_variable" href="struct_filament_state.html#a3a223cbec99bcd0f6c113bbd073df9fe">meters_virtual_count</a> += time_used;</div>
<div class="line"><span class="lineno"> 1194</span>                      }</div>
<div class="line"><span class="lineno"> 1195</span>                      f.<a class="code hl_variable" href="struct_filament_state.html#a2210f4ad5b00137bf844f1289ee79226">pressure</a> = 0x2B00;</div>
<div class="line"><span class="lineno"> 1196</span>                 }</div>
<div class="line"><span class="lineno"> 1197</span>                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((statu_flags == 0x07) &amp;&amp; (fliment_motion_flag == 0x7F)) { <span class="comment">// 07 7F</span></div>
<div class="line"><span class="lineno"> 1198</span>                      f.<a class="code hl_variable" href="struct_filament_state.html#a183761f2029f1dfed9c1a9f56426d030">motion_set</a> = <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695a98b23b2fb5bb3781d8bd041e8ff6e5e3">AMS_filament_motion::in_use</a>;</div>
<div class="line"><span class="lineno"> 1199</span>                      <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#a921a5777c50455edf8775c22430bcfa3">filament_use_flag</a> = 0x04;</div>
<div class="line"><span class="lineno"> 1200</span>                      f.<a class="code hl_variable" href="struct_filament_state.html#a2210f4ad5b00137bf844f1289ee79226">pressure</a> = 0x2B00;</div>
<div class="line"><span class="lineno"> 1201</span>                 }</div>
<div class="line"><span class="lineno"> 1202</span>             }</div>
<div class="line"><span class="lineno"> 1203</span>             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (read_num == 0xFF) {</div>
<div class="line"><span class="lineno"> 1204</span>                 <span class="keywordflow">if</span> ((statu_flags == 0x03) &amp;&amp; (fliment_motion_flag == 0x00)) { <span class="comment">// 03 00(FF)</span></div>
<div class="line"><span class="lineno"> 1205</span>                     <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#ad0e64263f719a9fafab8cd0dc04f4a06">BambuBus_now_filament_num</a> &lt; 4) {</div>
<div class="line"><span class="lineno"> 1206</span>                         FilamentState &amp;f = <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#af6b0be8daad68d06efd980f1fb68ef72">filament</a>[<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#ad0e64263f719a9fafab8cd0dc04f4a06">BambuBus_now_filament_num</a>];</div>
<div class="line"><span class="lineno"> 1207</span>                         <span class="keywordflow">if</span> (f.<a class="code hl_variable" href="struct_filament_state.html#a183761f2029f1dfed9c1a9f56426d030">motion_set</a> == <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695a98b23b2fb5bb3781d8bd041e8ff6e5e3">AMS_filament_motion::in_use</a>) {</div>
<div class="line"><span class="lineno"> 1208</span>                             f.<a class="code hl_variable" href="struct_filament_state.html#a183761f2029f1dfed9c1a9f56426d030">motion_set</a> = <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695a4d8b2afa72d93ce2db8ae49c464cab22">AMS_filament_motion::need_pull_back</a>;</div>
<div class="line"><span class="lineno"> 1209</span>                             <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#a921a5777c50455edf8775c22430bcfa3">filament_use_flag</a> = 0x02;</div>
<div class="line"><span class="lineno"> 1210</span>                         }</div>
<div class="line"><span class="lineno"> 1211</span>                         f.<a class="code hl_variable" href="struct_filament_state.html#a2210f4ad5b00137bf844f1289ee79226">pressure</a> = 0x4700;</div>
<div class="line"><span class="lineno"> 1212</span>                     }</div>
<div class="line"><span class="lineno"> 1213</span>                 } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1214</span>                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++) {</div>
<div class="line"><span class="lineno"> 1215</span>                         <span class="keywordflow">if</span>(<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#af6b0be8daad68d06efd980f1fb68ef72">filament</a>[i].<a class="code hl_variable" href="struct_filament_state.html#a183761f2029f1dfed9c1a9f56426d030">motion_set</a> != <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb">AMS_filament_motion::idle</a>) {</div>
<div class="line"><span class="lineno"> 1216</span>                             <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#af6b0be8daad68d06efd980f1fb68ef72">filament</a>[i].<a class="code hl_variable" href="struct_filament_state.html#a183761f2029f1dfed9c1a9f56426d030">motion_set</a> = <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb">AMS_filament_motion::idle</a>;</div>
<div class="line"><span class="lineno"> 1217</span>                         }</div>
<div class="line"><span class="lineno"> 1218</span>                     }</div>
<div class="line"><span class="lineno"> 1219</span>                     <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#ad0e64263f719a9fafab8cd0dc04f4a06">BambuBus_now_filament_num</a> = 0xFF;</div>
<div class="line"><span class="lineno"> 1220</span>                     <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#a921a5777c50455edf8775c22430bcfa3">filament_use_flag</a> = 0x00;</div>
<div class="line"><span class="lineno"> 1221</span>                 }</div>
<div class="line"><span class="lineno"> 1222</span>             }</div>
<div class="line"><span class="lineno"> 1223</span>        }</div>
<div class="line"><span class="lineno"> 1224</span>        </div>
<div class="line"><span class="lineno"> 1225</span>        <span class="comment">// Respond</span></div>
<div class="line"><span class="lineno"> 1226</span>        <span class="comment">// IMPORTANT: We need to send a response. The response format handles details.</span></div>
<div class="line"><span class="lineno"> 1227</span>        <span class="comment">// We will construct the default response payload here.</span></div>
<div class="line"><span class="lineno"> 1228</span>        <span class="comment">// Or call utility?</span></div>
<div class="line"><span class="lineno"> 1229</span>        </div>
<div class="line"><span class="lineno"> 1230</span>        <span class="comment">// [PAYLOAD: AMS_NUM(0), flags(8), filament_left_char(1), 00, 00, 00, 00, 00, 00, 00]</span></div>
<div class="line"><span class="lineno"> 1231</span>        <span class="comment">// Length around 10.</span></div>
<div class="line"><span class="lineno"> 1232</span>        <span class="comment">// Helper needed.</span></div>
<div class="line"><span class="lineno"> 1233</span>        uint8_t res_buf[14];</div>
<div class="line"><span class="lineno"> 1234</span>        memset(res_buf, 0, 14);</div>
<div class="line"><span class="lineno"> 1235</span>        res_buf[0] = ams_num; <span class="comment">// 0</span></div>
<div class="line"><span class="lineno"> 1236</span>        </div>
<div class="line"><span class="lineno"> 1237</span>        <span class="comment">// Byte 1: Flags of some sort?</span></div>
<div class="line"><span class="lineno"> 1238</span>        <span class="comment">// Original: package_send_short logic used constant array C_test?</span></div>
<div class="line"><span class="lineno"> 1239</span>        <span class="comment">// No, C_test was #define. </span></div>
<div class="line"><span class="lineno"> 1240</span>        <span class="comment">// BambuBus.cpp logic was lost in previous turn but snippet in ControlLogic.cpp showed some logic.</span></div>
<div class="line"><span class="lineno"> 1241</span>        <span class="comment">// Let&#39;s assume response is simple status.</span></div>
<div class="line"><span class="lineno"> 1242</span>        </div>
<div class="line"><span class="lineno"> 1243</span>        <span class="comment">// Byte 1: 0x80 | (0x4 if data_save.filament_use_flag &amp; 0x02?) </span></div>
<div class="line"><span class="lineno"> 1244</span>        <span class="comment">// Let&#39;s simplified response based on observation:</span></div>
<div class="line"><span class="lineno"> 1245</span>        res_buf[1] = 0x80;</div>
<div class="line"><span class="lineno"> 1246</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#a921a5777c50455edf8775c22430bcfa3">filament_use_flag</a> &amp; 0x02) res_buf[1] |= 0x04;</div>
<div class="line"><span class="lineno"> 1247</span>        </div>
<div class="line"><span class="lineno"> 1248</span>        <span class="comment">// Byte 2: Filament Left Char (Bitmask)</span></div>
<div class="line"><span class="lineno"> 1249</span>        uint8_t filament_left = 0;</div>
<div class="line"><span class="lineno"> 1250</span>         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; i++) {</div>
<div class="line"><span class="lineno"> 1251</span>             <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#af6b0be8daad68d06efd980f1fb68ef72">filament</a>[i].<a class="code hl_variable" href="struct_filament_state.html#a18524f9eb8074bc706971d1d62974179">status</a> == <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a9148fdd6f33c42faedeb9cc1a5520646a7f46165474d11ee5836777d85df2cdab">AMS_filament_status::online</a>) {</div>
<div class="line"><span class="lineno"> 1252</span>                 filament_left |= (0x1 &lt;&lt; (2*i));</div>
<div class="line"><span class="lineno"> 1253</span>                 <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a52925c91da70ade3c48b8eb3fe99caf6">device_type_addr</a> == <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a955491d79368cb27f0ba2ab28aba5701a1468bae394016b2d3dd75dea179a6578">BambuBus_AMS</a>) {</div>
<div class="line"><span class="lineno"> 1254</span>                     <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#af6b0be8daad68d06efd980f1fb68ef72">filament</a>[i].<a class="code hl_variable" href="struct_filament_state.html#a183761f2029f1dfed9c1a9f56426d030">motion_set</a> != <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a83dede43fdaba7acdcee93b724737695aec2f993aec2c27fc750119ab17b16cdb">AMS_filament_motion::idle</a>) {</div>
<div class="line"><span class="lineno"> 1255</span>                         filament_left |= (0x2 &lt;&lt; (2*i));</div>
<div class="line"><span class="lineno"> 1256</span>                     }</div>
<div class="line"><span class="lineno"> 1257</span>                 }</div>
<div class="line"><span class="lineno"> 1258</span>             }</div>
<div class="line"><span class="lineno"> 1259</span>         }</div>
<div class="line"><span class="lineno"> 1260</span>        res_buf[2] = filament_left;</div>
<div class="line"><span class="lineno"> 1261</span>        </div>
<div class="line"><span class="lineno"> 1262</span>        <span class="comment">// Send Packet Wrapper</span></div>
<div class="line"><span class="lineno"> 1263</span>        <span class="comment">// We need a way to send the packet.</span></div>
<div class="line"><span class="lineno"> 1264</span>        <span class="comment">// Create a buffer for CommandRouter::SendPacket</span></div>
<div class="line"><span class="lineno"> 1265</span>        uint8_t packet[32];</div>
<div class="line"><span class="lineno"> 1266</span>        packet[0] = 0x3D; packet[1] = 0xC5;</div>
<div class="line"><span class="lineno"> 1267</span>        packet[4] = 0x03; <span class="comment">// CMD (Echoing command type? Or Res type?)</span></div>
<div class="line"><span class="lineno"> 1268</span>        <span class="comment">// If Request was 0x03, Response is 0x03? Check logs.</span></div>
<div class="line"><span class="lineno"> 1269</span>        <span class="comment">// Usually Motion Short response is same Command ID with different data.</span></div>
<div class="line"><span class="lineno"> 1270</span>        </div>
<div class="line"><span class="lineno"> 1271</span>        packet[2] = 10 + 5; <span class="comment">// LEN</span></div>
<div class="line"><span class="lineno"> 1272</span>        memcpy(packet+5, res_buf, 10);</div>
<div class="line"><span class="lineno"> 1273</span>        </div>
<div class="line"><span class="lineno"> 1274</span>        uint16_t len = 15;</div>
<div class="line"><span class="lineno"> 1275</span>        <a class="code hl_function" href="class_bambu_bus_protocol.html#af9d11bc755538718e6ba8fbc5c8e9187">BambuBusProtocol::BuildPacketWithCRC</a>(packet, len);</div>
<div class="line"><span class="lineno"> 1276</span>        <a class="code hl_function" href="namespace_command_router.html#a1cf14aabb538f71f140e6b1aa7ef965d">CommandRouter::SendPacket</a>(packet, len);</div>
<div class="line"><span class="lineno"> 1277</span>    }</div>
<div class="ttc" id="a_bambu_bus_protocol_8h_html_a955491d79368cb27f0ba2ab28aba5701a1468bae394016b2d3dd75dea179a6578"><div class="ttname"><a href="_bambu_bus_protocol_8h.html#a955491d79368cb27f0ba2ab28aba5701a1468bae394016b2d3dd75dea179a6578">BambuBus_AMS</a></div><div class="ttdeci">@ BambuBus_AMS</div><div class="ttdef"><b>Definition</b> <a href="_bambu_bus_protocol_8h_source.html#l00047">BambuBusProtocol.h:47</a></div></div>
<div class="ttc" id="aclass_bambu_bus_protocol_html_af9d11bc755538718e6ba8fbc5c8e9187"><div class="ttname"><a href="class_bambu_bus_protocol.html#af9d11bc755538718e6ba8fbc5c8e9187">BambuBusProtocol::BuildPacketWithCRC</a></div><div class="ttdeci">static void BuildPacketWithCRC(uint8_t *data, uint16_t &amp;length)</div><div class="ttdoc">Finalize a packet for transmission by calculating and appending CRCs.</div><div class="ttdef"><b>Definition</b> <a href="_bambu_bus_protocol_8cpp_source.html#l00231">BambuBusProtocol.cpp:231</a></div></div>
<div class="ttc" id="anamespace_command_router_html_a1cf14aabb538f71f140e6b1aa7ef965d"><div class="ttname"><a href="namespace_command_router.html#a1cf14aabb538f71f140e6b1aa7ef965d">CommandRouter::SendPacket</a></div><div class="ttdeci">void SendPacket(uint8_t *data, uint16_t length)</div><div class="ttdoc">Send a raw data packet via UART.</div><div class="ttdef"><b>Definition</b> <a href="_command_router_8cpp_source.html#l00234">CommandRouter.cpp:234</a></div></div>
<div class="ttc" id="astruct_filament_state_html"><div class="ttname"><a href="struct_filament_state.html">FilamentState</a></div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00044">UnitState.h:44</a></div></div>
<div class="ttc" id="astruct_filament_state_html_a3a223cbec99bcd0f6c113bbd073df9fe"><div class="ttname"><a href="struct_filament_state.html#a3a223cbec99bcd0f6c113bbd073df9fe">FilamentState::meters_virtual_count</a></div><div class="ttdeci">uint64_t meters_virtual_count</div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00048">UnitState.h:48</a></div></div>
<div class="ttc" id="astruct_filament_state_html_aabba44628ec691809d7b13b94b8a507e"><div class="ttname"><a href="struct_filament_state.html#aabba44628ec691809d7b13b94b8a507e">FilamentState::meters</a></div><div class="ttdeci">float meters</div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00047">UnitState.h:47</a></div></div>
<div class="ttc" id="astructflash__save__struct_html_a921a5777c50455edf8775c22430bcfa3"><div class="ttname"><a href="structflash__save__struct.html#a921a5777c50455edf8775c22430bcfa3">flash_save_struct::filament_use_flag</a></div><div class="ttdeci">uint8_t filament_use_flag</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00024">ControlLogic.cpp:24</a></div></div>
<div class="ttc" id="astructflash__save__struct_html_ad0e64263f719a9fafab8cd0dc04f4a06"><div class="ttname"><a href="structflash__save__struct.html#ad0e64263f719a9fafab8cd0dc04f4a06">flash_save_struct::BambuBus_now_filament_num</a></div><div class="ttdeci">int BambuBus_now_filament_num</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00023">ControlLogic.cpp:23</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_bambu_bus_protocol_8h_source.html#l00047">BambuBus_AMS</a>, <a class="el" href="_bambu_bus_protocol_8cpp_source.html#l00231">BambuBusProtocol::BuildPacketWithCRC()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>, <a class="el" href="_control_logic_8cpp_source.html#l00038">device_type_addr</a>, <a class="el" href="_control_logic_8cpp_source.html#l00227">get_time64()</a>, <a class="el" href="_bambu_bus_protocol_8h_source.html#l00021">idle</a>, <a class="el" href="_bambu_bus_protocol_8h_source.html#l00020">in_use</a>, <a class="el" href="_unit_state_8h_source.html#l00047">FilamentState::meters</a>, <a class="el" href="_unit_state_8h_source.html#l00048">FilamentState::meters_virtual_count</a>, <a class="el" href="_unit_state_8h_source.html#l00050">FilamentState::motion_set</a>, <a class="el" href="_bambu_bus_protocol_8h_source.html#l00018">need_pull_back</a>, <a class="el" href="_bambu_bus_protocol_8h_source.html#l00019">need_send_out</a>, <a class="el" href="_bambu_bus_protocol_8h_source.html#l00011">online</a>, <a class="el" href="_unit_state_8h_source.html#l00051">FilamentState::pressure</a>, and <a class="el" href="_command_router_8cpp_source.html#l00234">CommandRouter::SendPacket()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l01285">ProcessMotionShort()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a8880b393facb6828519b8dac8e96393c_cgraph.png" border="0" usemap="#anamespace_control_logic_a8880b393facb6828519b8dac8e96393c_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a8880b393facb6828519b8dac8e96393c_cgraph" id="anamespace_control_logic_a8880b393facb6828519b8dac8e96393c_cgraph">
<area shape="rect" title="Core logic for processing Short Motion packets." alt="" coords="5,64,195,107"/>
<area shape="rect" href="class_bambu_bus_protocol.html#af9d11bc755538718e6ba8fbc5c8e9187" title="Finalize a packet for transmission by calculating and appending CRCs." alt="" coords="243,5,454,48"/>
<area shape="poly" title=" " alt="" coords="192,61,242,51,238,53,194,66"/>
<area shape="rect" href="namespace_control_logic.html#a4ddc46100d9f991cb0d171e62707ee7c" title=" " alt="" coords="265,72,432,99"/>
<area shape="poly" title=" " alt="" coords="195,83,252,84,247,86,196,88"/>
<area shape="rect" href="namespace_command_router.html#a1cf14aabb538f71f140e6b1aa7ef965d" title="Send a raw data packet via UART." alt="" coords="249,123,448,149"/>
<area shape="poly" title=" " alt="" coords="195,102,267,118,262,120,195,107"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="514,72,649,99"/>
<area shape="poly" title=" " alt="" coords="432,83,501,85,495,86,432,88"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="758,72,844,99"/>
<area shape="poly" title=" " alt="" coords="649,83,745,85,740,86,650,88"/>
<area shape="rect" href="namespace_hardware.html#ad3ec7cad074d6d73508844a06a7bea50" title="Send a buffer via UART1." alt="" coords="502,123,660,149"/>
<area shape="poly" title=" " alt="" coords="448,133,489,136,484,136,449,139"/>
<area shape="rect" href="namespace_hardware.html#a0ada30189b8e1d1dbec145140849b778" title="Microsecond Delay." alt="" coords="942,148,1080,175"/>
<area shape="poly" title=" " alt="" coords="661,138,929,156,924,157,661,143"/>
<area shape="rect" href="namespace_hardware.html#aaaf02ef3df5811e2ba28dd009eadfaae" title="Send a single byte blocking." alt="" coords="708,173,894,200"/>
<area shape="poly" title=" " alt="" coords="643,147,728,169,723,169,642,153"/>
<area shape="poly" title=" " alt="" coords="894,173,924,172,929,171,894,178"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a8880b393facb6828519b8dac8e96393c_icgraph.png" border="0" usemap="#anamespace_control_logic_a8880b393facb6828519b8dac8e96393c_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a8880b393facb6828519b8dac8e96393c_icgraph" id="anamespace_control_logic_a8880b393facb6828519b8dac8e96393c_icgraph">
<area shape="rect" title="Core logic for processing Short Motion packets." alt="" coords="243,5,432,48"/>
<area shape="rect" href="namespace_control_logic.html#a5f85db884abd1a66d8b120729ec0d99e" title="Handler for Filament Motion Short packet (0x03)." alt="" coords="5,5,195,48"/>
<area shape="poly" title=" " alt="" coords="224,27,195,29,195,24,230,26"/>
</map>
</div>

</div>
</div>
<a id="a412a7a597ff3c04c0ea1480094600ef4" name="a412a7a597ff3c04c0ea1480094600ef4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a412a7a597ff3c04c0ea1480094600ef4">&#9670;&#160;</a></span>ProcessOnlineDetect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::ProcessOnlineDetect </td>
          <td>(</td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for Online Detect (0x05). </p>
<p>Responds with the Online (0x05) packet to announce presence to the printer. </p>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l01311">1311</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1311</span>                                                               {</div>
<div class="line"><span class="lineno"> 1312</span>         <span class="comment">// Respond 0x05</span></div>
<div class="line"><span class="lineno"> 1313</span>         <span class="comment">// uint8_t res[1]; // Unused</span></div>
<div class="line"><span class="lineno"> 1314</span>         <span class="comment">// res[0] = 0x00;</span></div>
<div class="line"><span class="lineno"> 1315</span>         </div>
<div class="line"><span class="lineno"> 1316</span>         <span class="comment">// 3D C5 LEN CRC8 CMD(05) Payload...</span></div>
<div class="line"><span class="lineno"> 1317</span>         uint8_t packet[32];</div>
<div class="line"><span class="lineno"> 1318</span>         packet[0] = 0x3D; packet[1] = 0xC5;</div>
<div class="line"><span class="lineno"> 1319</span>         packet[4] = 0x05;</div>
<div class="line"><span class="lineno"> 1320</span>         </div>
<div class="line"><span class="lineno"> 1321</span>         <span class="comment">// Payload currently nothing?</span></div>
<div class="line"><span class="lineno"> 1322</span>         <span class="comment">// Original code sent 1 byte payload?</span></div>
<div class="line"><span class="lineno"> 1323</span>         packet[5] = 0x00; <span class="comment">// AMS number?</span></div>
<div class="line"><span class="lineno"> 1324</span>         </div>
<div class="line"><span class="lineno"> 1325</span>         uint16_t len = 6; <span class="comment">// Header(5) + Payload(1) </span></div>
<div class="line"><span class="lineno"> 1326</span>         packet[2] = len;</div>
<div class="line"><span class="lineno"> 1327</span>         </div>
<div class="line"><span class="lineno"> 1328</span>         <a class="code hl_function" href="class_bambu_bus_protocol.html#af9d11bc755538718e6ba8fbc5c8e9187">BambuBusProtocol::BuildPacketWithCRC</a>(packet, len);</div>
<div class="line"><span class="lineno"> 1329</span>         <a class="code hl_function" href="namespace_command_router.html#a1cf14aabb538f71f140e6b1aa7ef965d">CommandRouter::SendPacket</a>(packet, len);</div>
<div class="line"><span class="lineno"> 1330</span>         <a class="code hl_function" href="#a9716be5fe9da72481bee41a80681d8e5">UpdateConnectivity</a>(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1331</span>    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_bambu_bus_protocol_8cpp_source.html#l00231">BambuBusProtocol::BuildPacketWithCRC()</a>, <a class="el" href="_command_router_8cpp_source.html#l00234">CommandRouter::SendPacket()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00948">UpdateConnectivity()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a412a7a597ff3c04c0ea1480094600ef4_cgraph.png" border="0" usemap="#anamespace_control_logic_a412a7a597ff3c04c0ea1480094600ef4_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a412a7a597ff3c04c0ea1480094600ef4_cgraph" id="anamespace_control_logic_a412a7a597ff3c04c0ea1480094600ef4_cgraph">
<area shape="rect" title="Handler for Online Detect (0x05)." alt="" coords="5,64,193,107"/>
<area shape="rect" href="class_bambu_bus_protocol.html#af9d11bc755538718e6ba8fbc5c8e9187" title="Finalize a packet for transmission by calculating and appending CRCs." alt="" coords="244,5,455,48"/>
<area shape="poly" title=" " alt="" coords="192,61,243,51,238,53,194,66"/>
<area shape="rect" href="namespace_command_router.html#a1cf14aabb538f71f140e6b1aa7ef965d" title="Send a raw data packet via UART." alt="" coords="250,72,449,99"/>
<area shape="poly" title=" " alt="" coords="193,83,237,85,231,86,194,88"/>
<area shape="rect" href="namespace_control_logic.html#a9716be5fe9da72481bee41a80681d8e5" title="Update connectivity status (Online/Offline)." alt="" coords="241,123,458,149"/>
<area shape="poly" title=" " alt="" coords="193,102,268,119,262,119,193,107"/>
<area shape="rect" href="namespace_hardware.html#ad3ec7cad074d6d73508844a06a7bea50" title="Send a buffer via UART1." alt="" coords="506,72,664,99"/>
<area shape="poly" title=" " alt="" coords="449,83,493,85,488,86,450,88"/>
<area shape="rect" href="namespace_hardware.html#a0ada30189b8e1d1dbec145140849b778" title="Microsecond Delay." alt="" coords="946,47,1084,73"/>
<area shape="poly" title=" " alt="" coords="643,69,712,57,826,52,933,55,927,56,826,57,713,63,644,74"/>
<area shape="rect" href="namespace_hardware.html#aaaf02ef3df5811e2ba28dd009eadfaae" title="Send a single byte blocking." alt="" coords="712,72,898,99"/>
<area shape="poly" title=" " alt="" coords="665,83,699,85,694,85,665,88"/>
<area shape="poly" title=" " alt="" coords="898,71,928,70,933,70,898,77"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="518,123,653,149"/>
<area shape="poly" title=" " alt="" coords="458,133,505,136,499,136,458,139"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="762,123,848,149"/>
<area shape="poly" title=" " alt="" coords="653,133,749,136,744,136,653,139"/>
</map>
</div>

</div>
</div>
<a id="a82b9a1fb120cd91615d2ac478daafefd" name="a82b9a1fb120cd91615d2ac478daafefd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82b9a1fb120cd91615d2ac478daafefd">&#9670;&#160;</a></span>ProcessREQx6()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::ProcessREQx6 </td>
          <td>(</td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for REQx6 (0x06). </p>
<p>Responds with a simple ACK (0x06). </p>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l01338">1338</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1338</span>                                                        {</div>
<div class="line"><span class="lineno"> 1339</span>        <span class="comment">// Just ACK with 0x06</span></div>
<div class="line"><span class="lineno"> 1340</span>        uint8_t packet[32];</div>
<div class="line"><span class="lineno"> 1341</span>        packet[0] = 0x3D; packet[1] = 0xC5;</div>
<div class="line"><span class="lineno"> 1342</span>        packet[4] = 0x06;</div>
<div class="line"><span class="lineno"> 1343</span>        packet[5] = 0x00;</div>
<div class="line"><span class="lineno"> 1344</span>        uint16_t len = 6;</div>
<div class="line"><span class="lineno"> 1345</span>        packet[2] = len;</div>
<div class="line"><span class="lineno"> 1346</span>        <a class="code hl_function" href="class_bambu_bus_protocol.html#af9d11bc755538718e6ba8fbc5c8e9187">BambuBusProtocol::BuildPacketWithCRC</a>(packet, len);</div>
<div class="line"><span class="lineno"> 1347</span>        <a class="code hl_function" href="namespace_command_router.html#a1cf14aabb538f71f140e6b1aa7ef965d">CommandRouter::SendPacket</a>(packet, len);</div>
<div class="line"><span class="lineno"> 1348</span>    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_bambu_bus_protocol_8cpp_source.html#l00231">BambuBusProtocol::BuildPacketWithCRC()</a>, and <a class="el" href="_command_router_8cpp_source.html#l00234">CommandRouter::SendPacket()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a82b9a1fb120cd91615d2ac478daafefd_cgraph.png" border="0" usemap="#anamespace_control_logic_a82b9a1fb120cd91615d2ac478daafefd_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a82b9a1fb120cd91615d2ac478daafefd_cgraph" id="anamespace_control_logic_a82b9a1fb120cd91615d2ac478daafefd_cgraph">
<area shape="rect" title="Handler for REQx6 (0x06)." alt="" coords="5,43,199,69"/>
<area shape="rect" href="class_bambu_bus_protocol.html#af9d11bc755538718e6ba8fbc5c8e9187" title="Finalize a packet for transmission by calculating and appending CRCs." alt="" coords="247,5,458,48"/>
<area shape="poly" title=" " alt="" coords="199,42,234,40,228,42,200,47"/>
<area shape="rect" href="namespace_command_router.html#a1cf14aabb538f71f140e6b1aa7ef965d" title="Send a raw data packet via UART." alt="" coords="253,72,452,99"/>
<area shape="poly" title=" " alt="" coords="199,65,240,72,235,72,199,70"/>
<area shape="rect" href="namespace_hardware.html#ad3ec7cad074d6d73508844a06a7bea50" title="Send a buffer via UART1." alt="" coords="506,72,664,99"/>
<area shape="poly" title=" " alt="" coords="453,83,493,85,488,85,453,88"/>
<area shape="rect" href="namespace_hardware.html#a0ada30189b8e1d1dbec145140849b778" title="Microsecond Delay." alt="" coords="946,72,1084,99"/>
<area shape="poly" title=" " alt="" coords="665,83,933,85,927,85,665,88"/>
<area shape="rect" href="namespace_hardware.html#aaaf02ef3df5811e2ba28dd009eadfaae" title="Send a single byte blocking." alt="" coords="712,97,898,124"/>
<area shape="poly" title=" " alt="" coords="665,92,699,98,694,98,665,97"/>
<area shape="poly" title=" " alt="" coords="898,97,928,96,933,95,898,102"/>
</map>
</div>

</div>
</div>
<a id="ada1dd6f18fca06d8b26836f4788ab0ad" name="ada1dd6f18fca06d8b26836f4788ab0ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada1dd6f18fca06d8b26836f4788ab0ad">&#9670;&#160;</a></span>ProcessSetFilamentInfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::ProcessSetFilamentInfo </td>
          <td>(</td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>buffer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for Set Filament Info (0x08 - Short). </p>
<p>Decodes payload and calls <span class="tt"><a class="el" href="#a3aed4ef4cb26632467a000c0130b11b4" title="Action helper to update filament metadata.">SetFilamentInfoAction</a></span>. </p>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l01364">1364</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1364</span>                                                                  {</div>
<div class="line"><span class="lineno"> 1365</span>        <span class="comment">// Short Packet Set Filament Info (0x08)</span></div>
<div class="line"><span class="lineno"> 1366</span>        <span class="comment">// Offset 5 is start of payload.</span></div>
<div class="line"><span class="lineno"> 1367</span>        <span class="comment">// Logic from original: </span></div>
<div class="line"><span class="lineno"> 1368</span>        <span class="comment">// buffer[5] = AMS num?</span></div>
<div class="line"><span class="lineno"> 1369</span>        <span class="comment">// buffer[6] = Filament Index?</span></div>
<div class="line"><span class="lineno"> 1370</span>        <span class="comment">// buffer[7]... color?</span></div>
<div class="line"><span class="lineno"> 1371</span>        <span class="comment">// Let&#39;s assume payload matches SetFilamentInfoAction args.</span></div>
<div class="line"><span class="lineno"> 1372</span>        </div>
<div class="line"><span class="lineno"> 1373</span>        <span class="keywordflow">if</span> (length &lt; 10) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1374</span>        <span class="comment">// uint8_t tray_index = buffer[5]; // Unused warning fix</span></div>
<div class="line"><span class="lineno"> 1375</span>        <span class="comment">// Wait, normally payload is: [AMS_Num] [Tray_Num] [R] [G] [B] [A] ...</span></div>
<div class="line"><span class="lineno"> 1376</span>        <span class="comment">// Needs verifying protocol.</span></div>
<div class="line"><span class="lineno"> 1377</span>        <span class="comment">// Assuming:</span></div>
<div class="line"><span class="lineno"> 1378</span>        <span class="keywordtype">int</span> <span class="keywordtype">id</span> = buffer[5]; <span class="comment">// If direct tray mapping</span></div>
<div class="line"><span class="lineno"> 1379</span>        <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &gt;= 4) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1380</span>        </div>
<div class="line"><span class="lineno"> 1381</span>        <a class="code hl_struct" href="struct_filament_info.html">FilamentInfo</a> info;</div>
<div class="line"><span class="lineno"> 1382</span>        <span class="comment">// Populate info from buffer...</span></div>
<div class="line"><span class="lineno"> 1383</span>        </div>
<div class="line"><span class="lineno"> 1384</span>        <span class="comment">// Call Action</span></div>
<div class="line"><span class="lineno"> 1385</span>        <a class="code hl_function" href="#a3aed4ef4cb26632467a000c0130b11b4">SetFilamentInfoAction</a>(<span class="keywordtype">id</span>, info);</div>
<div class="line"><span class="lineno"> 1386</span>        </div>
<div class="line"><span class="lineno"> 1387</span>        <span class="comment">// Send ACK (0x08)</span></div>
<div class="line"><span class="lineno"> 1388</span>        <span class="comment">// ...</span></div>
<div class="line"><span class="lineno"> 1389</span>    }</div>
<div class="ttc" id="anamespace_control_logic_html_a3aed4ef4cb26632467a000c0130b11b4"><div class="ttname"><a href="#a3aed4ef4cb26632467a000c0130b11b4">ControlLogic::SetFilamentInfoAction</a></div><div class="ttdeci">void SetFilamentInfoAction(int id, const FilamentInfo &amp;info, float meters)</div><div class="ttdoc">Action helper to update filament metadata.</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l01401">ControlLogic.cpp:1401</a></div></div>
<div class="ttc" id="astruct_filament_info_html"><div class="ttname"><a href="struct_filament_info.html">FilamentInfo</a></div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00012">UnitState.h:12</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l01401">SetFilamentInfoAction()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_ada1dd6f18fca06d8b26836f4788ab0ad_cgraph.png" border="0" usemap="#anamespace_control_logic_ada1dd6f18fca06d8b26836f4788ab0ad_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_ada1dd6f18fca06d8b26836f4788ab0ad_cgraph" id="anamespace_control_logic_ada1dd6f18fca06d8b26836f4788ab0ad_cgraph">
<area shape="rect" title="Handler for Set Filament Info (0x08 &#45; Short)." alt="" coords="5,5,176,48"/>
<area shape="rect" href="namespace_control_logic.html#a3aed4ef4cb26632467a000c0130b11b4" title="Action helper to update filament metadata." alt="" coords="224,5,396,48"/>
<area shape="poly" title=" " alt="" coords="176,24,211,26,206,27,176,29"/>
<area shape="rect" href="namespace_control_logic.html#afe90d7f284c20f90f74787274f01c51b" title="Flag that settings need to be saved." alt="" coords="444,13,641,40"/>
<area shape="poly" title=" " alt="" coords="396,24,431,27,426,27,396,29"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="689,13,825,40"/>
<area shape="poly" title=" " alt="" coords="642,24,677,27,671,27,642,29"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="873,13,958,40"/>
<area shape="poly" title=" " alt="" coords="825,24,860,27,854,27,825,29"/>
</map>
</div>

</div>
</div>
<a id="adc8c269923e0c76c6d104a005833a7f9" name="adc8c269923e0c76c6d104a005833a7f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc8c269923e0c76c6d104a005833a7f9">&#9670;&#160;</a></span>Run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::Run </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main Control Loop. </p>
<p>Called repeatedly from main. Checks sensors, manages logic switching, updates motor control, handles LED updates, and manages Flash saving. </p>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00792">792</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  792</span>               {</div>
<div class="line"><span class="lineno">  793</span>        <span class="keyword">static</span> uint64_t last_run = 0;</div>
<div class="line"><span class="lineno">  794</span>        uint64_t now = <a class="code hl_function" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3">Hardware::GetTime</a>();</div>
<div class="line"><span class="lineno">  795</span>        <span class="keywordtype">float</span> time_E = (now - last_run) / 1000.0f;</div>
<div class="line"><span class="lineno">  796</span>        last_run = now;</div>
<div class="line"><span class="lineno">  797</span>        </div>
<div class="line"><span class="lineno">  798</span>        <a class="code hl_function" href="#ab1b5b19d84cdbba6ef3ad97fba14ce13">MC_PULL_ONLINE_read</a>();</div>
<div class="line"><span class="lineno">  799</span>        <a class="code hl_function" href="#aa3d38299372c0822e90d6e649344e8ad">AS5600_Update</a>(time_E);</div>
<div class="line"><span class="lineno">  800</span>        </div>
<div class="line"><span class="lineno">  801</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5cc135d9070e574d8b2fe9c9b328a148">Bambubus_need_to_save</a>) {</div>
<div class="line"><span class="lineno">  802</span>            <span class="keywordflow">if</span> (now - <a class="code hl_variable" href="#a17835f3a0e8384e40e9d647ce79d3d22">save_timer</a> &gt; 500) { </div>
<div class="line"><span class="lineno">  803</span>                <a class="code hl_function" href="#a175e5057d122e1fee05a99bb0e40bbf3">SaveSettings</a>(); </div>
<div class="line"><span class="lineno">  804</span>            }</div>
<div class="line"><span class="lineno">  805</span>        }</div>
<div class="line"><span class="lineno">  806</span>        </div>
<div class="line"><span class="lineno">  807</span>        <span class="keywordtype">bool</span> pulling = <a class="code hl_function" href="#acb78560c64e5ea050853ab319a03f14e">Prepare_For_filament_Pull_Back</a>(<a class="code hl_variable" href="#a0dc914125ce5b958b6d1620c814a580d">P1X_OUT_filament_meters</a>);</div>
<div class="line"><span class="lineno">  808</span>        </div>
<div class="line"><span class="lineno">  809</span>        <span class="keywordflow">if</span> (!pulling) {</div>
<div class="line"><span class="lineno">  810</span>            <a class="code hl_function" href="#ac2d890c891494072159ebc2b30490197">motor_motion_switch</a>();</div>
<div class="line"><span class="lineno">  811</span>        }</div>
<div class="line"><span class="lineno">  812</span>        </div>
<div class="line"><span class="lineno">  813</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++) {</div>
<div class="line"><span class="lineno">  814</span>            <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[i].Run(time_E);</div>
<div class="line"><span class="lineno">  815</span>        }</div>
<div class="line"><span class="lineno">  816</span>        </div>
<div class="line"><span class="lineno">  817</span>        <span class="comment">// System LED Debug Flash</span></div>
<div class="line"><span class="lineno">  818</span>        <span class="keyword">static</span> uint64_t last_led_update = 0;</div>
<div class="line"><span class="lineno">  819</span>        <span class="keywordflow">if</span> (now - last_led_update &gt; 1000) {</div>
<div class="line"><span class="lineno">  820</span>             <span class="keyword">static</span> <span class="keywordtype">bool</span> toggle = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  821</span>             toggle = !toggle;</div>
<div class="line"><span class="lineno">  822</span>             <span class="comment">// Heartbeat color: Green for BambuBus, White for Klipper</span></div>
<div class="line"><span class="lineno">  823</span>             <span class="keywordflow">if</span> (toggle) {</div>
<div class="line"><span class="lineno">  824</span>                 <span class="keywordflow">if</span> (<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.<a class="code hl_variable" href="structflash__save__struct.html#a2c383f5bdbb468f12fb4ea625b5823b6">boot_mode</a> == (uint32_t)<a class="code hl_enumvalue" href="#aa23e295fa5022b6569547cf94f091070a6de97d301a2cd910140aca79b2b50a55">BootMode::Klipper</a>) {</div>
<div class="line"><span class="lineno">  825</span>                     <a class="code hl_function" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4">Hardware::LED_SetColor</a>(4, 0, 10, 10, 10); <span class="comment">// White</span></div>
<div class="line"><span class="lineno">  826</span>                 } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  827</span>                     <a class="code hl_function" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4">Hardware::LED_SetColor</a>(4, 0, 0, 10, 0); <span class="comment">// Green</span></div>
<div class="line"><span class="lineno">  828</span>                 }</div>
<div class="line"><span class="lineno">  829</span>             }</div>
<div class="line"><span class="lineno">  830</span>             <span class="keywordflow">else</span> <a class="code hl_function" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4">Hardware::LED_SetColor</a>(4, 0, 0, 0, 0); </div>
<div class="line"><span class="lineno">  831</span>             last_led_update = now;</div>
<div class="line"><span class="lineno">  832</span>        }</div>
<div class="line"><span class="lineno">  833</span>        <span class="comment">// Update LED physical output at ~20Hz to prevent blocking interrupts too often</span></div>
<div class="line"><span class="lineno">  834</span>        <span class="keyword">static</span> uint64_t last_led_show_time = 0;</div>
<div class="line"><span class="lineno">  835</span>        <span class="keywordflow">if</span> (now - last_led_show_time &gt; 50) {</div>
<div class="line"><span class="lineno">  836</span>             <a class="code hl_function" href="namespace_hardware.html#a365d946e0cf0fe8cfc8dbcb25cfbdad9">Hardware::LED_Show</a>();</div>
<div class="line"><span class="lineno">  837</span>             last_led_show_time = now;</div>
<div class="line"><span class="lineno">  838</span>        }</div>
<div class="line"><span class="lineno">  839</span>    }</div>
<div class="ttc" id="anamespace_control_logic_html_a0dc914125ce5b958b6d1620c814a580d"><div class="ttname"><a href="#a0dc914125ce5b958b6d1620c814a580d">ControlLogic::P1X_OUT_filament_meters</a></div><div class="ttdeci">float_t P1X_OUT_filament_meters</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00201">ControlLogic.cpp:201</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a175e5057d122e1fee05a99bb0e40bbf3"><div class="ttname"><a href="#a175e5057d122e1fee05a99bb0e40bbf3">ControlLogic::SaveSettings</a></div><div class="ttdeci">void SaveSettings()</div><div class="ttdoc">Commit settings to Flash memory.</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00722">ControlLogic.cpp:722</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a17835f3a0e8384e40e9d647ce79d3d22"><div class="ttname"><a href="#a17835f3a0e8384e40e9d647ce79d3d22">ControlLogic::save_timer</a></div><div class="ttdeci">static uint64_t save_timer</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00224">ControlLogic.cpp:224</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_a5cc135d9070e574d8b2fe9c9b328a148"><div class="ttname"><a href="#a5cc135d9070e574d8b2fe9c9b328a148">ControlLogic::Bambubus_need_to_save</a></div><div class="ttdeci">static bool Bambubus_need_to_save</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00223">ControlLogic.cpp:223</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_aa3d38299372c0822e90d6e649344e8ad"><div class="ttname"><a href="#aa3d38299372c0822e90d6e649344e8ad">ControlLogic::AS5600_Update</a></div><div class="ttdeci">void AS5600_Update(float time_E)</div><div class="ttdoc">Update Odometer and Speed from AS5600 sensors.</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00694">ControlLogic.cpp:694</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_ac2d890c891494072159ebc2b30490197"><div class="ttname"><a href="#ac2d890c891494072159ebc2b30490197">ControlLogic::motor_motion_switch</a></div><div class="ttdeci">void motor_motion_switch()</div><div class="ttdoc">State Machine for BambuBus Logic.</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00962">ControlLogic.cpp:962</a></div></div>
<div class="ttc" id="anamespace_control_logic_html_acb78560c64e5ea050853ab319a03f14e"><div class="ttname"><a href="#acb78560c64e5ea050853ab319a03f14e">ControlLogic::Prepare_For_filament_Pull_Back</a></div><div class="ttdeci">bool Prepare_For_filament_Pull_Back(float_t OUT_filament_meters)</div><div class="ttdoc">Check if pullback is required (Smart Pullback Logic).</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00751">ControlLogic.cpp:751</a></div></div>
<div class="ttc" id="anamespace_hardware_html_a365d946e0cf0fe8cfc8dbcb25cfbdad9"><div class="ttname"><a href="namespace_hardware.html#a365d946e0cf0fe8cfc8dbcb25cfbdad9">Hardware::LED_Show</a></div><div class="ttdeci">void LED_Show()</div><div class="ttdoc">Update LED Hardware.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00544">Hardware.cpp:544</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00694">AS5600_Update()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00223">Bambubus_need_to_save</a>, <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>, <a class="el" href="_hardware_8cpp_source.html#l00115">Hardware::GetTime()</a>, <a class="el" href="_control_logic_8h_source.html#l00016">Klipper</a>, <a class="el" href="_hardware_8cpp_source.html#l00530">Hardware::LED_SetColor()</a>, <a class="el" href="_hardware_8cpp_source.html#l00544">Hardware::LED_Show()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00240">MC_PULL_ONLINE_read()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00962">motor_motion_switch()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00517">motors</a>, <a class="el" href="_control_logic_8cpp_source.html#l00201">P1X_OUT_filament_meters</a>, <a class="el" href="_control_logic_8cpp_source.html#l00751">Prepare_For_filament_Pull_Back()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00224">save_timer</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00722">SaveSettings()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8cpp_source.html#l00040">loop()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_adc8c269923e0c76c6d104a005833a7f9_cgraph.png" border="0" usemap="#anamespace_control_logic_adc8c269923e0c76c6d104a005833a7f9_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_adc8c269923e0c76c6d104a005833a7f9_cgraph" id="anamespace_control_logic_adc8c269923e0c76c6d104a005833a7f9_cgraph">
<area shape="rect" title="Main Control Loop." alt="" coords="5,245,132,272"/>
<area shape="rect" href="namespace_control_logic.html#aa3d38299372c0822e90d6e649344e8ad" title="Update Odometer and Speed from AS5600 sensors." alt="" coords="196,5,344,48"/>
<area shape="poly" title=" " alt="" coords="72,244,85,209,107,162,138,110,178,65,195,54,191,58,181,69,142,114,112,164,90,211,77,246"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="662,123,798,149"/>
<area shape="poly" title=" " alt="" coords="75,243,114,189,144,159,178,135,241,109,307,94,375,86,442,85,507,89,567,96,668,118,663,119,566,102,506,94,442,90,375,91,308,99,243,115,181,140,147,163,118,192,80,246"/>
<area shape="rect" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4" title="Set Color of a specific LED." alt="" coords="414,275,583,301"/>
<area shape="poly" title=" " alt="" coords="131,254,180,252,270,248,310,248,360,252,440,269,435,271,360,257,309,253,270,253,180,257,133,258"/>
<area shape="rect" href="namespace_hardware.html#a365d946e0cf0fe8cfc8dbcb25cfbdad9" title="Update LED Hardware." alt="" coords="423,329,574,356"/>
<area shape="poly" title=" " alt="" coords="88,270,130,296,181,319,238,332,297,340,410,346,405,348,297,346,237,338,179,324,127,301,88,275"/>
<area shape="rect" href="namespace_control_logic.html#ab1b5b19d84cdbba6ef3ad97fba14ce13" title="Read Analog Sensors and Update State." alt="" coords="188,384,352,427"/>
<area shape="poly" title=" " alt="" coords="81,270,124,315,181,363,201,376,196,377,178,368,120,319,81,275"/>
<area shape="rect" href="namespace_control_logic.html#ac2d890c891494072159ebc2b30490197" title="State Machine for BambuBus Logic." alt="" coords="202,149,338,192"/>
<area shape="poly" title=" " alt="" coords="100,243,207,196,204,201,103,247"/>
<area shape="rect" href="namespace_control_logic.html#acb78560c64e5ea050853ab319a03f14e" title="Check if pullback is required (Smart Pullback Logic)." alt="" coords="187,267,353,309"/>
<area shape="poly" title=" " alt="" coords="131,265,174,272,169,275,133,270"/>
<area shape="rect" href="namespace_control_logic.html#a175e5057d122e1fee05a99bb0e40bbf3" title="Commit settings to Flash memory." alt="" coords="180,451,360,477"/>
<area shape="poly" title=" " alt="" coords="75,270,90,305,111,350,142,397,181,437,189,444,183,443,178,441,138,400,107,352,85,307,74,275"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="897,123,982,149"/>
<area shape="poly" title=" " alt="" coords="798,133,884,135,879,137,798,139"/>
<area shape="rect" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157" title=" " alt="" coords="690,315,770,341"/>
<area shape="poly" title=" " alt="" coords="580,299,678,318,673,319,580,305"/>
<area shape="poly" title=" " alt="" coords="575,335,678,331,672,332,575,341"/>
<area shape="rect" href="namespace_hardware.html#aa54da804a3d4c6d89ba5d7a2931fc463" title="Get filtered ADC voltage values." alt="" coords="408,392,589,419"/>
<area shape="poly" title=" " alt="" coords="351,403,395,405,390,406,352,408"/>
<area shape="poly" title=" " alt="" coords="337,169,455,167,589,159,651,152,646,154,590,164,455,173,338,174"/>
<area shape="poly" title=" " alt="" coords="329,190,362,209,377,222,386,236,395,248,409,260,421,268,415,268,407,265,391,252,381,239,372,226,358,213,329,195"/>
<area shape="rect" href="namespace_control_logic.html#a4ddc46100d9f991cb0d171e62707ee7c" title=" " alt="" coords="416,123,582,149"/>
<area shape="poly" title=" " alt="" coords="337,158,402,150,398,152,339,163"/>
<area shape="rect" href="namespace_hardware.html#ad3ec7cad074d6d73508844a06a7bea50" title="Send a buffer via UART1." alt="" coords="420,224,578,251"/>
<area shape="poly" title=" " alt="" coords="338,188,438,218,433,220,338,193"/>
<area shape="poly" title=" " alt="" coords="581,133,649,135,644,137,583,139"/>
<area shape="rect" href="namespace_hardware.html#a0ada30189b8e1d1dbec145140849b778" title="Microsecond Delay." alt="" coords="871,224,1009,251"/>
<area shape="poly" title=" " alt="" coords="578,235,858,236,853,238,579,240"/>
<area shape="rect" href="namespace_hardware.html#aaaf02ef3df5811e2ba28dd009eadfaae" title="Send a single byte blocking." alt="" coords="637,249,823,276"/>
<area shape="poly" title=" " alt="" coords="578,243,624,250,619,251,578,249"/>
<area shape="poly" title=" " alt="" coords="822,249,858,247,853,248,823,254"/>
<area shape="poly" title=" " alt="" coords="353,285,401,287,396,289,354,291"/>
<area shape="rect" href="_flash__saves_8cpp.html#ae5951341b70b0da0d768d418bfcb76ce" title="Save a buffer to Flash Memory." alt="" coords="451,451,546,477"/>
<area shape="poly" title=" " alt="" coords="361,461,438,464,433,464,361,467"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_adc8c269923e0c76c6d104a005833a7f9_icgraph.png" border="0" usemap="#anamespace_control_logic_adc8c269923e0c76c6d104a005833a7f9_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_adc8c269923e0c76c6d104a005833a7f9_icgraph" id="anamespace_control_logic_adc8c269923e0c76c6d104a005833a7f9_icgraph">
<area shape="rect" title="Main Control Loop." alt="" coords="494,13,621,40"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,13,446,40"/>
<area shape="poly" title=" " alt="" coords="476,27,447,29,447,24,482,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,13,353,40"/>
<area shape="poly" title=" " alt="" coords="383,27,353,29,353,24,388,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,5,140,48"/>
<area shape="poly" title=" " alt="" coords="170,27,140,29,140,24,175,26"/>
</map>
</div>

</div>
</div>
<a id="a175e5057d122e1fee05a99bb0e40bbf3" name="a175e5057d122e1fee05a99bb0e40bbf3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a175e5057d122e1fee05a99bb0e40bbf3">&#9670;&#160;</a></span>SaveSettings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::SaveSettings </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Commit settings to Flash memory. </p>
<p>Writes the current <span class="tt"><a class="el" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a></span> struct to flash. </p>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00722">722</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  722</span>                        {</div>
<div class="line"><span class="lineno">  723</span>        <a class="code hl_function" href="_flash__saves_8cpp.html#ae5951341b70b0da0d768d418bfcb76ce">Flash_saves</a>(&amp;<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>), <a class="code hl_define" href="_control_logic_8cpp.html#a377d54c27966e6b7bcfb0810524885b1">use_flash_addr</a>);</div>
<div class="line"><span class="lineno">  724</span>        <a class="code hl_variable" href="#a5cc135d9070e574d8b2fe9c9b328a148">Bambubus_need_to_save</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  725</span>    }</div>
<div class="ttc" id="a_flash__saves_8cpp_html_ae5951341b70b0da0d768d418bfcb76ce"><div class="ttname"><a href="_flash__saves_8cpp.html#ae5951341b70b0da0d768d418bfcb76ce">Flash_saves</a></div><div class="ttdeci">bool Flash_saves(void *buf, uint32_t length, uint32_t address)</div><div class="ttdoc">Save a buffer to Flash Memory.</div><div class="ttdef"><b>Definition</b> <a href="_flash__saves_8cpp_source.html#l00051">Flash_saves.cpp:51</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00223">Bambubus_need_to_save</a>, <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>, <a class="el" href="_flash__saves_8cpp_source.html#l00051">Flash_saves()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00018">use_flash_addr</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00792">Run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3_cgraph.png" border="0" usemap="#anamespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3_cgraph" id="anamespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3_cgraph">
<area shape="rect" title="Commit settings to Flash memory." alt="" coords="5,5,186,32"/>
<area shape="rect" href="_flash__saves_8cpp.html#ae5951341b70b0da0d768d418bfcb76ce" title="Save a buffer to Flash Memory." alt="" coords="234,5,329,32"/>
<area shape="poly" title=" " alt="" coords="186,16,221,19,215,19,186,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3_icgraph.png" border="0" usemap="#anamespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3_icgraph" id="anamespace_control_logic_a175e5057d122e1fee05a99bb0e40bbf3_icgraph">
<area shape="rect" title="Commit settings to Flash memory." alt="" coords="669,13,849,40"/>
<area shape="rect" href="namespace_control_logic.html#adc8c269923e0c76c6d104a005833a7f9" title="Main Control Loop." alt="" coords="494,13,621,40"/>
<area shape="poly" title=" " alt="" coords="650,27,621,29,621,24,655,27"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,13,446,40"/>
<area shape="poly" title=" " alt="" coords="476,27,447,29,447,24,482,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,13,353,40"/>
<area shape="poly" title=" " alt="" coords="383,27,353,29,353,24,388,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,5,140,48"/>
<area shape="poly" title=" " alt="" coords="170,27,140,29,140,24,175,26"/>
</map>
</div>

</div>
</div>
<a id="a9db355302a1c9d608e6dd5341151336e" name="a9db355302a1c9d608e6dd5341151336e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9db355302a1c9d608e6dd5341151336e">&#9670;&#160;</a></span>SetAutoFeed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::SetAutoFeed </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>lane</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>enable</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enable/Disable Auto-Feed (Pressure Control) for a lane. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lane</td><td>Lane index. </td></tr>
    <tr><td class="paramname">enable</td><td>True to enable, False to stop. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00643">643</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  643</span>                                            {</div>
<div class="line"><span class="lineno">  644</span>        <span class="keywordflow">if</span>(lane &lt; 0 || lane &gt;= 4) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  645</span>        </div>
<div class="line"><span class="lineno">  646</span>        <span class="keywordflow">if</span> (enable) {</div>
<div class="line"><span class="lineno">  647</span>             <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[lane].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfafe27fd8ed473c89e5c1f989ff314fc75">filament_motion_enum::pressure_ctrl_in_use</a>);</div>
<div class="line"><span class="lineno">  648</span>             <span class="comment">// We may need to ensure filament_now_position isn&#39;t overwriting this?</span></div>
<div class="line"><span class="lineno">  649</span>             <span class="comment">// Actually, motor_motion_switch checks motor[i].motion, so we should be good if we add check there.</span></div>
<div class="line"><span class="lineno">  650</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  651</span>             <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[lane].<a class="code hl_function" href="class_control_logic_1_1_motor_channel.html#a0b8ed284da431b3325320e709433a454">SetMotion</a>(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b">filament_motion_enum::stop</a>);</div>
<div class="line"><span class="lineno">  652</span>             <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[lane] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>;</div>
<div class="line"><span class="lineno">  653</span>        }</div>
<div class="line"><span class="lineno">  654</span>    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00172">filament_idle</a>, <a class="el" href="_control_logic_8cpp_source.html#l00220">filament_now_position</a>, <a class="el" href="_control_logic_8cpp_source.html#l00517">motors</a>, <a class="el" href="_control_logic_8cpp_source.html#l00188">pressure_ctrl_in_use</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00183">stop</a>.</p>

<p class="reference">Referenced by <a class="el" href="_klipper_c_l_i_8cpp_source.html#l00288">KlipperCLI::HandleSetAutoFeed()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a9db355302a1c9d608e6dd5341151336e_icgraph.png" border="0" usemap="#anamespace_control_logic_a9db355302a1c9d608e6dd5341151336e_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a9db355302a1c9d608e6dd5341151336e_icgraph" id="anamespace_control_logic_a9db355302a1c9d608e6dd5341151336e_icgraph">
<area shape="rect" title="Enable/Disable Auto&#45;Feed (Pressure Control) for a lane." alt="" coords="1340,13,1518,40"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a31ef4dae129916b85fdd8d1612553c77" title="Handler for SET_AUTO_FEED command." alt="" coords="1084,13,1292,40"/>
<area shape="poly" title=" " alt="" coords="1321,27,1292,29,1292,24,1327,27"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a6089e6db2e7edddf19fdf095b9826c88" title="Parse and Dispatch a JSON Packet." alt="" coords="857,13,1036,40"/>
<area shape="poly" title=" " alt="" coords="1066,27,1037,29,1037,24,1071,27"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afe96c8a3898aa7a50f68ab6d726860c3" title="Main Execution Loop." alt="" coords="695,13,809,40"/>
<area shape="poly" title=" " alt="" coords="839,27,809,29,809,24,844,27"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,13,647,40"/>
<area shape="poly" title=" " alt="" coords="677,27,647,29,647,24,682,27"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,13,446,40"/>
<area shape="poly" title=" " alt="" coords="476,27,447,29,447,24,481,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,13,353,40"/>
<area shape="poly" title=" " alt="" coords="383,27,353,29,353,24,388,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,5,140,48"/>
<area shape="poly" title=" " alt="" coords="170,27,140,29,140,24,175,26"/>
</map>
</div>

</div>
</div>
<a id="a3aed4ef4cb26632467a000c0130b11b4" name="a3aed4ef4cb26632467a000c0130b11b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3aed4ef4cb26632467a000c0130b11b4">&#9670;&#160;</a></span>SetFilamentInfoAction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::SetFilamentInfoAction </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>id</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_filament_info.html">FilamentInfo</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>info</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>meters</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Action helper to update filament metadata. </p>
<p>Updates Color, Type, ID, Temps, etc. for a specific tray. Triggers a Flash Save.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>Tray ID. </td></tr>
    <tr><td class="paramname">info</td><td>Info structure. </td></tr>
    <tr><td class="paramname">meters</td><td>Odometer reading (optional, -1 to ignore). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l01401">1401</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1401</span>                                                                               {</div>
<div class="line"><span class="lineno"> 1402</span>        <span class="keywordflow">if</span> (id &lt; 0 || id &gt;= 4) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1403</span>        </div>
<div class="line"><span class="lineno"> 1404</span>        <a class="code hl_struct" href="struct_filament_state.html">FilamentState</a> &amp;target = <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.filament[id];</div>
<div class="line"><span class="lineno"> 1405</span>        </div>
<div class="line"><span class="lineno"> 1406</span>        <span class="comment">// Copy Basic Fields</span></div>
<div class="line"><span class="lineno"> 1407</span>        memcpy(target.<a class="code hl_variable" href="struct_filament_info.html#a26e0e6218d4a40974be5086c2ac89087">ID</a>, info.<a class="code hl_variable" href="struct_filament_info.html#a26e0e6218d4a40974be5086c2ac89087">ID</a>, <span class="keyword">sizeof</span>(target.<a class="code hl_variable" href="struct_filament_info.html#a26e0e6218d4a40974be5086c2ac89087">ID</a>));</div>
<div class="line"><span class="lineno"> 1408</span>        memcpy(target.<a class="code hl_variable" href="struct_filament_info.html#a5bf1b8820cfc338a0e489064670e6672">name</a>, info.<a class="code hl_variable" href="struct_filament_info.html#a5bf1b8820cfc338a0e489064670e6672">name</a>, <span class="keyword">sizeof</span>(target.<a class="code hl_variable" href="struct_filament_info.html#a5bf1b8820cfc338a0e489064670e6672">name</a>));</div>
<div class="line"><span class="lineno"> 1409</span>        target.<a class="code hl_variable" href="struct_filament_info.html#a49b75d4f9105d90760ca96138c8fcf45">color_R</a> = info.<a class="code hl_variable" href="struct_filament_info.html#a49b75d4f9105d90760ca96138c8fcf45">color_R</a>;</div>
<div class="line"><span class="lineno"> 1410</span>        target.<a class="code hl_variable" href="struct_filament_info.html#a401880702bfbb50388082ccfc4da0ddd">color_G</a> = info.<a class="code hl_variable" href="struct_filament_info.html#a401880702bfbb50388082ccfc4da0ddd">color_G</a>;</div>
<div class="line"><span class="lineno"> 1411</span>        target.<a class="code hl_variable" href="struct_filament_info.html#ab1c9dff383b15c09a2fad0cf6d7e8714">color_B</a> = info.<a class="code hl_variable" href="struct_filament_info.html#ab1c9dff383b15c09a2fad0cf6d7e8714">color_B</a>;</div>
<div class="line"><span class="lineno"> 1412</span>        target.<a class="code hl_variable" href="struct_filament_info.html#a72997ce70a6852951aac4a8c907e24ac">color_A</a> = info.<a class="code hl_variable" href="struct_filament_info.html#a72997ce70a6852951aac4a8c907e24ac">color_A</a>;</div>
<div class="line"><span class="lineno"> 1413</span>        target.<a class="code hl_variable" href="struct_filament_info.html#a5868192ee8a9087a32bc1b242024aa72">temperature_min</a> = info.<a class="code hl_variable" href="struct_filament_info.html#a5868192ee8a9087a32bc1b242024aa72">temperature_min</a>;</div>
<div class="line"><span class="lineno"> 1414</span>        target.<a class="code hl_variable" href="struct_filament_info.html#a45dff2f7e9e7b3794d9ff6469f50113f">temperature_max</a> = info.<a class="code hl_variable" href="struct_filament_info.html#a45dff2f7e9e7b3794d9ff6469f50113f">temperature_max</a>;</div>
<div class="line"><span class="lineno"> 1415</span>        </div>
<div class="line"><span class="lineno"> 1416</span>        <span class="keywordflow">if</span> (meters &gt;= 0) {</div>
<div class="line"><span class="lineno"> 1417</span>             target.<a class="code hl_variable" href="struct_filament_state.html#aabba44628ec691809d7b13b94b8a507e">meters</a> = meters;</div>
<div class="line"><span class="lineno"> 1418</span>        }</div>
<div class="line"><span class="lineno"> 1419</span> </div>
<div class="line"><span class="lineno"> 1420</span>        <span class="comment">// Ensure strings are null terminated just in case</span></div>
<div class="line"><span class="lineno"> 1421</span>        target.<a class="code hl_variable" href="struct_filament_info.html#a26e0e6218d4a40974be5086c2ac89087">ID</a>[7] = 0;</div>
<div class="line"><span class="lineno"> 1422</span>        target.<a class="code hl_variable" href="struct_filament_info.html#a5bf1b8820cfc338a0e489064670e6672">name</a>[19] = 0;</div>
<div class="line"><span class="lineno"> 1423</span>        </div>
<div class="line"><span class="lineno"> 1424</span>        <a class="code hl_function" href="#afe90d7f284c20f90f74787274f01c51b">SetNeedToSave</a>();</div>
<div class="line"><span class="lineno"> 1425</span>    }</div>
<div class="ttc" id="astruct_filament_info_html_a26e0e6218d4a40974be5086c2ac89087"><div class="ttname"><a href="struct_filament_info.html#a26e0e6218d4a40974be5086c2ac89087">FilamentInfo::ID</a></div><div class="ttdeci">char ID[8]</div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00013">UnitState.h:13</a></div></div>
<div class="ttc" id="astruct_filament_info_html_a401880702bfbb50388082ccfc4da0ddd"><div class="ttname"><a href="struct_filament_info.html#a401880702bfbb50388082ccfc4da0ddd">FilamentInfo::color_G</a></div><div class="ttdeci">uint8_t color_G</div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00015">UnitState.h:15</a></div></div>
<div class="ttc" id="astruct_filament_info_html_a45dff2f7e9e7b3794d9ff6469f50113f"><div class="ttname"><a href="struct_filament_info.html#a45dff2f7e9e7b3794d9ff6469f50113f">FilamentInfo::temperature_max</a></div><div class="ttdeci">int16_t temperature_max</div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00019">UnitState.h:19</a></div></div>
<div class="ttc" id="astruct_filament_info_html_a49b75d4f9105d90760ca96138c8fcf45"><div class="ttname"><a href="struct_filament_info.html#a49b75d4f9105d90760ca96138c8fcf45">FilamentInfo::color_R</a></div><div class="ttdeci">uint8_t color_R</div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00014">UnitState.h:14</a></div></div>
<div class="ttc" id="astruct_filament_info_html_a5868192ee8a9087a32bc1b242024aa72"><div class="ttname"><a href="struct_filament_info.html#a5868192ee8a9087a32bc1b242024aa72">FilamentInfo::temperature_min</a></div><div class="ttdeci">int16_t temperature_min</div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00018">UnitState.h:18</a></div></div>
<div class="ttc" id="astruct_filament_info_html_a5bf1b8820cfc338a0e489064670e6672"><div class="ttname"><a href="struct_filament_info.html#a5bf1b8820cfc338a0e489064670e6672">FilamentInfo::name</a></div><div class="ttdeci">char name[20]</div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00020">UnitState.h:20</a></div></div>
<div class="ttc" id="astruct_filament_info_html_a72997ce70a6852951aac4a8c907e24ac"><div class="ttname"><a href="struct_filament_info.html#a72997ce70a6852951aac4a8c907e24ac">FilamentInfo::color_A</a></div><div class="ttdeci">uint8_t color_A</div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00017">UnitState.h:17</a></div></div>
<div class="ttc" id="astruct_filament_info_html_ab1c9dff383b15c09a2fad0cf6d7e8714"><div class="ttname"><a href="struct_filament_info.html#ab1c9dff383b15c09a2fad0cf6d7e8714">FilamentInfo::color_B</a></div><div class="ttdeci">uint8_t color_B</div><div class="ttdef"><b>Definition</b> <a href="_unit_state_8h_source.html#l00016">UnitState.h:16</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_unit_state_8h_source.html#l00017">FilamentInfo::color_A</a>, <a class="el" href="_unit_state_8h_source.html#l00016">FilamentInfo::color_B</a>, <a class="el" href="_unit_state_8h_source.html#l00015">FilamentInfo::color_G</a>, <a class="el" href="_unit_state_8h_source.html#l00014">FilamentInfo::color_R</a>, <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>, <a class="el" href="_unit_state_8h_source.html#l00013">FilamentInfo::ID</a>, <a class="el" href="_unit_state_8h_source.html#l00047">FilamentState::meters</a>, <a class="el" href="_unit_state_8h_source.html#l00020">FilamentInfo::name</a>, <a class="el" href="_control_logic_8cpp_source.html#l00733">SetNeedToSave()</a>, <a class="el" href="_unit_state_8h_source.html#l00019">FilamentInfo::temperature_max</a>, and <a class="el" href="_unit_state_8h_source.html#l00018">FilamentInfo::temperature_min</a>.</p>

<p class="reference">Referenced by <a class="el" href="_klipper_c_l_i_8cpp_source.html#l00347">KlipperCLI::HandleSetFilamentInfo()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l01364">ProcessSetFilamentInfo()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4_cgraph.png" border="0" usemap="#anamespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4_cgraph" id="anamespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4_cgraph">
<area shape="rect" title="Action helper to update filament metadata." alt="" coords="5,5,178,48"/>
<area shape="rect" href="namespace_control_logic.html#afe90d7f284c20f90f74787274f01c51b" title="Flag that settings need to be saved." alt="" coords="226,13,423,40"/>
<area shape="poly" title=" " alt="" coords="178,24,213,26,207,27,178,29"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="471,13,606,40"/>
<area shape="poly" title=" " alt="" coords="423,24,458,27,453,27,424,29"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="654,13,740,40"/>
<area shape="poly" title=" " alt="" coords="607,24,641,27,636,27,607,29"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4_icgraph.png" border="0" usemap="#anamespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4_icgraph" id="anamespace_control_logic_a3aed4ef4cb26632467a000c0130b11b4_icgraph">
<area shape="rect" title="Action helper to update filament metadata." alt="" coords="1356,35,1528,77"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a76547f35e246989843f1870c760ea514" title="Handler for SET_FILAMENT_INFO command." alt="" coords="1084,13,1308,40"/>
<area shape="poly" title=" " alt="" coords="1337,44,1308,43,1308,37,1343,44"/>
<area shape="rect" href="namespace_control_logic.html#ada1dd6f18fca06d8b26836f4788ab0ad" title="Handler for Set Filament Info (0x08 &#45; Short)." alt="" coords="1111,64,1281,107"/>
<area shape="poly" title=" " alt="" coords="1343,68,1282,78,1281,72,1338,68"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a6089e6db2e7edddf19fdf095b9826c88" title="Parse and Dispatch a JSON Packet." alt="" coords="857,13,1036,40"/>
<area shape="poly" title=" " alt="" coords="1066,27,1037,29,1037,24,1071,27"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afe96c8a3898aa7a50f68ab6d726860c3" title="Main Execution Loop." alt="" coords="695,13,809,40"/>
<area shape="poly" title=" " alt="" coords="839,27,809,29,809,24,844,27"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,13,647,40"/>
<area shape="poly" title=" " alt="" coords="677,27,647,29,647,24,682,26"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,13,446,40"/>
<area shape="poly" title=" " alt="" coords="476,27,447,29,447,24,481,26"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,13,353,40"/>
<area shape="poly" title=" " alt="" coords="383,27,354,29,353,24,388,26"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,5,140,48"/>
<area shape="poly" title=" " alt="" coords="170,28,140,29,139,24,175,26"/>
</map>
</div>

</div>
</div>
<a id="afe90d7f284c20f90f74787274f01c51b" name="afe90d7f284c20f90f74787274f01c51b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe90d7f284c20f90f74787274f01c51b">&#9670;&#160;</a></span>SetNeedToSave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::SetNeedToSave </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Flag that settings need to be saved. </p>
<p>Sets a dirty flag and resets the save timer (debounce). </p>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00733">733</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  733</span>                         {</div>
<div class="line"><span class="lineno">  734</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="#a5cc135d9070e574d8b2fe9c9b328a148">Bambubus_need_to_save</a>) {</div>
<div class="line"><span class="lineno">  735</span>             <a class="code hl_variable" href="#a5cc135d9070e574d8b2fe9c9b328a148">Bambubus_need_to_save</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  736</span>             <a class="code hl_variable" href="#a17835f3a0e8384e40e9d647ce79d3d22">save_timer</a> = <a class="code hl_function" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3">Hardware::GetTime</a>();</div>
<div class="line"><span class="lineno">  737</span>        }</div>
<div class="line"><span class="lineno">  738</span>    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00223">Bambubus_need_to_save</a>, <a class="el" href="_hardware_8cpp_source.html#l00115">Hardware::GetTime()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00224">save_timer</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00904">InitBootCheck()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00847">LoadSettings()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l01401">SetFilamentInfoAction()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_afe90d7f284c20f90f74787274f01c51b_cgraph.png" border="0" usemap="#anamespace_control_logic_afe90d7f284c20f90f74787274f01c51b_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_afe90d7f284c20f90f74787274f01c51b_cgraph" id="anamespace_control_logic_afe90d7f284c20f90f74787274f01c51b_cgraph">
<area shape="rect" title="Flag that settings need to be saved." alt="" coords="5,5,203,32"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="251,5,386,32"/>
<area shape="poly" title=" " alt="" coords="203,16,238,19,233,19,203,21"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="434,5,519,32"/>
<area shape="poly" title=" " alt="" coords="387,16,421,19,416,19,387,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_afe90d7f284c20f90f74787274f01c51b_icgraph.png" border="0" usemap="#anamespace_control_logic_afe90d7f284c20f90f74787274f01c51b_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_afe90d7f284c20f90f74787274f01c51b_icgraph" id="anamespace_control_logic_afe90d7f284c20f90f74787274f01c51b_icgraph">
<area shape="rect" title="Flag that settings need to be saved." alt="" coords="1589,61,1786,88"/>
<area shape="rect" href="namespace_control_logic.html#a0c732b28cf691fb77359c80a0c000665" title="Check Boot Mode (Button Press at Startup)." alt="" coords="1356,11,1541,37"/>
<area shape="poly" title=" " alt="" coords="1604,57,1515,41,1515,35,1609,58"/>
<area shape="rect" href="namespace_control_logic.html#ae855e1aa5895afa9999a3b9e6874e1e2" title="Load settings from Flash memory." alt="" coords="1359,61,1538,88"/>
<area shape="poly" title=" " alt="" coords="1570,75,1538,77,1538,72,1576,75"/>
<area shape="rect" href="namespace_control_logic.html#a3aed4ef4cb26632467a000c0130b11b4" title="Action helper to update filament metadata." alt="" coords="1362,113,1534,156"/>
<area shape="poly" title=" " alt="" coords="1619,92,1535,116,1534,110,1614,93"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="920,5,973,32"/>
<area shape="poly" title=" " alt="" coords="1338,23,974,22,974,16,1343,22"/>
<area shape="rect" href="namespace_control_logic.html#a1da226a05b7a8c46e16a840900265c03" title="Initialize ControlLogic." alt="" coords="1136,61,1256,88"/>
<area shape="poly" title=" " alt="" coords="1341,75,1257,77,1257,72,1346,75"/>
<area shape="poly" title=" " alt="" coords="1119,58,973,27,974,22,1124,58"/>
<area shape="rect" href="class_control_logic_1_1_m_o_t_o_r___p_i_d.html#a9edc970b22d74b15904b4929d862cc07" title=" " alt="" coords="871,56,1022,99"/>
<area shape="poly" title=" " alt="" coords="1118,76,1023,79,1023,74,1123,75"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a76547f35e246989843f1870c760ea514" title="Handler for SET_FILAMENT_INFO command." alt="" coords="1084,121,1308,148"/>
<area shape="poly" title=" " alt="" coords="1344,135,1308,137,1308,132,1349,135"/>
<area shape="rect" href="namespace_control_logic.html#ada1dd6f18fca06d8b26836f4788ab0ad" title="Handler for Set Filament Info (0x08 &#45; Short)." alt="" coords="1111,172,1281,215"/>
<area shape="poly" title=" " alt="" coords="1350,158,1282,176,1281,171,1344,158"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a6089e6db2e7edddf19fdf095b9826c88" title="Parse and Dispatch a JSON Packet." alt="" coords="857,123,1036,149"/>
<area shape="poly" title=" " alt="" coords="1066,135,1037,138,1037,133,1071,135"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afe96c8a3898aa7a50f68ab6d726860c3" title="Main Execution Loop." alt="" coords="695,123,809,149"/>
<area shape="poly" title=" " alt="" coords="839,136,809,139,809,133,844,136"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,123,647,149"/>
<area shape="poly" title=" " alt="" coords="677,136,647,139,647,133,682,136"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,123,446,149"/>
<area shape="poly" title=" " alt="" coords="476,136,447,139,447,133,481,136"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,123,353,149"/>
<area shape="poly" title=" " alt="" coords="383,136,354,139,353,133,388,136"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,115,140,157"/>
<area shape="poly" title=" " alt="" coords="170,137,140,139,139,133,175,135"/>
</map>
</div>

</div>
</div>
<a id="adb4ce7f82b449d6d6d97e7399ce391f5" name="adb4ce7f82b449d6d6d97e7399ce391f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb4ce7f82b449d6d6d97e7399ce391f5">&#9670;&#160;</a></span>StartLoadFilament()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::StartLoadFilament </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>tray</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>length_mm</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initiate a Filament Load sequence for a specific tray. </p>
<p>Sets the state machine to <span class="tt"><a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22">filament_loading</a></span>, initializes variables, and sets motor to send.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tray</td><td>Tray index (0-3). </td></tr>
    <tr><td class="paramname">length_mm</td><td>Target length in mm (if &gt; 0, stops at distance; otherwise uses pressure logic). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00529">529</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  529</span>                                                    {</div>
<div class="line"><span class="lineno">  530</span>        <span class="keywordflow">if</span> (tray &lt; 0 || tray &gt;= 4) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  531</span>        </div>
<div class="line"><span class="lineno">  532</span>        <span class="comment">// Setup state</span></div>
<div class="line"><span class="lineno">  533</span>        <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.BambuBus_now_filament_num = tray;</div>
<div class="line"><span class="lineno">  534</span>        <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.filament_use_flag = 0x02; </div>
<div class="line"><span class="lineno">  535</span>        </div>
<div class="line"><span class="lineno">  536</span>        <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[tray] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a2e5ef7992e470eb0e80e1991bdaa4a22">filament_loading</a>;</div>
<div class="line"><span class="lineno">  537</span>        <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[tray].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfa2541d938b0a58946090d7abdde0d3890">filament_motion_enum::send</a>); <span class="comment">// Start fast</span></div>
<div class="line"><span class="lineno">  538</span>        </div>
<div class="line"><span class="lineno">  539</span>        <a class="code hl_variable" href="#a11bff287b64c24fe91500ba99c6f21c8">unload_target_dist</a>[tray] = length_mm; <span class="comment">// Reuse this variable for target distance</span></div>
<div class="line"><span class="lineno">  540</span>        </div>
<div class="line"><span class="lineno">  541</span>        <span class="comment">// Reset distance tracking if we are using length</span></div>
<div class="line"><span class="lineno">  542</span>        <span class="keywordflow">if</span> (length_mm &gt; 0) {</div>
<div class="line"><span class="lineno">  543</span>            <a class="code hl_variable" href="#aef70a34b1f25019450171bfa5c07ab62">is_backing_out</a> = <span class="keyword">true</span>; <span class="comment">// Use backing out flag to enable distance accumulation in Run()?</span></div>
<div class="line"><span class="lineno">  544</span>            <span class="comment">// Wait, Run() only accumulates if &quot;is_backing_out&quot; is true?</span></div>
<div class="line"><span class="lineno">  545</span>            <span class="comment">// &quot;if (is_backing_out) last_total_distance += ...&quot;</span></div>
<div class="line"><span class="lineno">  546</span>            <span class="comment">// Yes. So we need to set is_backing_out = true even for loading if we want distance.</span></div>
<div class="line"><span class="lineno">  547</span>            <span class="comment">// But verify if &quot;StartUnloadFilament&quot; clears it? StartUnload sets it true.</span></div>
<div class="line"><span class="lineno">  548</span>            <span class="comment">// We should ensure Run() logic supports positive distance accumulation too if speed is positive?</span></div>
<div class="line"><span class="lineno">  549</span>            <span class="comment">// Run() uses fabs(speed * time). So direction doesn&#39;t matter for accumulation.</span></div>
<div class="line"><span class="lineno">  550</span>            </div>
<div class="line"><span class="lineno">  551</span>            <a class="code hl_variable" href="_control_logic_8cpp.html#a92f9b1daa685f9041b79423442d440e3">last_total_distance</a>[tray] = 0;</div>
<div class="line"><span class="lineno">  552</span>            <a class="code hl_variable" href="#aef70a34b1f25019450171bfa5c07ab62">is_backing_out</a> = <span class="keyword">true</span>; </div>
<div class="line"><span class="lineno">  553</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  554</span>             <a class="code hl_variable" href="#aef70a34b1f25019450171bfa5c07ab62">is_backing_out</a> = <span class="keyword">false</span>; <span class="comment">// Normal load doesn&#39;t track distance usually?</span></div>
<div class="line"><span class="lineno">  555</span>             <span class="comment">// Actually, regular load uses Pressure surveillance logic.</span></div>
<div class="line"><span class="lineno">  556</span>        }</div>
<div class="line"><span class="lineno">  557</span> </div>
<div class="line"><span class="lineno">  558</span>        <span class="comment">// Ensure others are idle</span></div>
<div class="line"><span class="lineno">  559</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++) {</div>
<div class="line"><span class="lineno">  560</span>            <span class="keywordflow">if</span>(i != tray) {</div>
<div class="line"><span class="lineno">  561</span>               <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[i] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>;</div>
<div class="line"><span class="lineno">  562</span>               <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[i].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c">filament_motion_enum::pressure_ctrl_idle</a>);</div>
<div class="line"><span class="lineno">  563</span>            }</div>
<div class="line"><span class="lineno">  564</span>        }</div>
<div class="line"><span class="lineno">  565</span>    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>, <a class="el" href="_control_logic_8cpp_source.html#l00172">filament_idle</a>, <a class="el" href="_control_logic_8cpp_source.html#l00177">filament_loading</a>, <a class="el" href="_control_logic_8cpp_source.html#l00220">filament_now_position</a>, <a class="el" href="_control_logic_8cpp_source.html#l00211">is_backing_out</a>, <a class="el" href="_control_logic_8cpp_source.html#l00035">last_total_distance</a>, <a class="el" href="_control_logic_8cpp_source.html#l00517">motors</a>, <a class="el" href="_control_logic_8cpp_source.html#l00187">pressure_ctrl_idle</a>, <a class="el" href="_control_logic_8cpp_source.html#l00184">send</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00216">unload_target_dist</a>.</p>

</div>
</div>
<a id="abcc93276e326829eec4d37024c647745" name="abcc93276e326829eec4d37024c647745"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcc93276e326829eec4d37024c647745">&#9670;&#160;</a></span>StartUnloadFilament()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::StartUnloadFilament </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>tray</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>length_mm</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initiate a Filament Unload sequence for a specific tray. </p>
<p>Sets state to <span class="tt"><a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2">filament_unloading</a></span>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tray</td><td>Tray index (0-3). </td></tr>
    <tr><td class="paramname">length_mm</td><td>Target distance to unload (or -1 to unload until sensor clear). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00576">576</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  576</span>                                                      {</div>
<div class="line"><span class="lineno">  577</span>        <span class="keywordflow">if</span> (tray &lt; 0 || tray &gt;= 4) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  578</span>        </div>
<div class="line"><span class="lineno">  579</span>        <span class="comment">// Setup state</span></div>
<div class="line"><span class="lineno">  580</span>        <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.BambuBus_now_filament_num = tray;</div>
<div class="line"><span class="lineno">  581</span>        <a class="code hl_variable" href="_control_logic_8cpp.html#a07df3d8e92f2b4de565d574c7950555a">data_save</a>.filament_use_flag = 0x02; <span class="comment">// Busy/Moving</span></div>
<div class="line"><span class="lineno">  582</span>        </div>
<div class="line"><span class="lineno">  583</span>        <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[tray] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a1a8deadce31cdab1bd84de4ed42e35d2">filament_unloading</a>;</div>
<div class="line"><span class="lineno">  584</span>        <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[tray].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfaf43dff9a0dc54f0643d0c6d7971635f0">filament_motion_enum::pull</a>); <span class="comment">// Start Pulling</span></div>
<div class="line"><span class="lineno">  585</span>        </div>
<div class="line"><span class="lineno">  586</span>        <a class="code hl_variable" href="#a11bff287b64c24fe91500ba99c6f21c8">unload_target_dist</a>[tray] = length_mm;</div>
<div class="line"><span class="lineno">  587</span>        <a class="code hl_variable" href="#a0efb555ba92cc1cedb47929db260e6c8">unload_start_meters</a>[tray] = <a class="code hl_variable" href="_control_logic_8cpp.html#a92f9b1daa685f9041b79423442d440e3">last_total_distance</a>[tray]; <span class="comment">// Capture start pos (using accumulated dist logic if valid or need tracking)</span></div>
<div class="line"><span class="lineno">  588</span>        <span class="comment">// Actually last_total_distance is used for pullback accumulation?</span></div>
<div class="line"><span class="lineno">  589</span>        <span class="comment">// Let&#39;s reset last_total_distance logic or use a new tracker?</span></div>
<div class="line"><span class="lineno">  590</span>        <span class="comment">// Existing &quot;Prepare_For_filament_Pull_Back&quot; uses &quot;last_total_distance&quot; which accumulates in Run() if &quot;is_backing_out&quot; is true.</span></div>
<div class="line"><span class="lineno">  591</span>        </div>
<div class="line"><span class="lineno">  592</span>        <a class="code hl_variable" href="#aef70a34b1f25019450171bfa5c07ab62">is_backing_out</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  593</span>        <a class="code hl_variable" href="_control_logic_8cpp.html#a92f9b1daa685f9041b79423442d440e3">last_total_distance</a>[tray] = 0; <span class="comment">// Reset counter for this op</span></div>
<div class="line"><span class="lineno">  594</span>        </div>
<div class="line"><span class="lineno">  595</span>        <span class="comment">// Ensure others are idle</span></div>
<div class="line"><span class="lineno">  596</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++) {</div>
<div class="line"><span class="lineno">  597</span>            <span class="keywordflow">if</span>(i != tray) {</div>
<div class="line"><span class="lineno">  598</span>               <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[i] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>;</div>
<div class="line"><span class="lineno">  599</span>               <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[i].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfac3cd02e6f65c947824c18d8cebbfd06c">filament_motion_enum::pressure_ctrl_idle</a>);</div>
<div class="line"><span class="lineno">  600</span>            }</div>
<div class="line"><span class="lineno">  601</span>        }</div>
<div class="line"><span class="lineno">  602</span>    }</div>
<div class="ttc" id="anamespace_control_logic_html_a0efb555ba92cc1cedb47929db260e6c8"><div class="ttname"><a href="#a0efb555ba92cc1cedb47929db260e6c8">ControlLogic::unload_start_meters</a></div><div class="ttdeci">static float unload_start_meters[4]</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00217">ControlLogic.cpp:217</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00031">data_save</a>, <a class="el" href="_control_logic_8cpp_source.html#l00172">filament_idle</a>, <a class="el" href="_control_logic_8cpp_source.html#l00220">filament_now_position</a>, <a class="el" href="_control_logic_8cpp_source.html#l00178">filament_unloading</a>, <a class="el" href="_control_logic_8cpp_source.html#l00211">is_backing_out</a>, <a class="el" href="_control_logic_8cpp_source.html#l00035">last_total_distance</a>, <a class="el" href="_control_logic_8cpp_source.html#l00517">motors</a>, <a class="el" href="_control_logic_8cpp_source.html#l00187">pressure_ctrl_idle</a>, <a class="el" href="_control_logic_8cpp_source.html#l00185">pull</a>, <a class="el" href="_control_logic_8cpp_source.html#l00217">unload_start_meters</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00216">unload_target_dist</a>.</p>

</div>
</div>
<a id="af084200798d6b89c1b448bf41b105d62" name="af084200798d6b89c1b448bf41b105d62"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af084200798d6b89c1b448bf41b105d62">&#9670;&#160;</a></span>StopAll()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::StopAll </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop all motors. </p>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00629">629</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  629</span>                   {</div>
<div class="line"><span class="lineno">  630</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++) {</div>
<div class="line"><span class="lineno">  631</span>             <a class="code hl_variable" href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">motors</a>[i].SetMotion(<a class="code hl_enumvalue" href="#ad46bf74f4e0b4c4fda041bdba813e8cfaef399b2d446bb37b7c32ad2cc1b6045b">filament_motion_enum::stop</a>);</div>
<div class="line"><span class="lineno">  632</span>             <a class="code hl_variable" href="#a3cb6555c20c1e3a386f34fa9f5e6b596">filament_now_position</a>[i] = <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>;</div>
<div class="line"><span class="lineno">  633</span>        }</div>
<div class="line"><span class="lineno">  634</span>    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_control_logic_8cpp_source.html#l00172">filament_idle</a>, <a class="el" href="_control_logic_8cpp_source.html#l00220">filament_now_position</a>, <a class="el" href="_control_logic_8cpp_source.html#l00517">motors</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00183">stop</a>.</p>

<p class="reference">Referenced by <a class="el" href="_klipper_c_l_i_8cpp_source.html#l00255">KlipperCLI::HandleStop()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_af084200798d6b89c1b448bf41b105d62_icgraph.png" border="0" usemap="#anamespace_control_logic_af084200798d6b89c1b448bf41b105d62_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_af084200798d6b89c1b448bf41b105d62_icgraph" id="anamespace_control_logic_af084200798d6b89c1b448bf41b105d62_icgraph">
<area shape="rect" title="Stop all motors." alt="" coords="1291,13,1435,40"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a5bc1dda1e0b24dccb6fdc1c475930c88" title="Handler for STOP command." alt="" coords="1084,13,1243,40"/>
<area shape="poly" title=" " alt="" coords="1273,27,1243,29,1243,24,1278,27"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a6089e6db2e7edddf19fdf095b9826c88" title="Parse and Dispatch a JSON Packet." alt="" coords="857,13,1036,40"/>
<area shape="poly" title=" " alt="" coords="1067,27,1037,29,1037,24,1072,27"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afe96c8a3898aa7a50f68ab6d726860c3" title="Main Execution Loop." alt="" coords="695,13,809,40"/>
<area shape="poly" title=" " alt="" coords="839,27,809,29,809,24,844,27"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,13,647,40"/>
<area shape="poly" title=" " alt="" coords="677,27,647,29,647,24,682,27"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,13,446,40"/>
<area shape="poly" title=" " alt="" coords="476,27,447,29,447,24,481,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,13,353,40"/>
<area shape="poly" title=" " alt="" coords="383,27,353,29,353,24,388,27"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,5,140,48"/>
<area shape="poly" title=" " alt="" coords="170,27,140,29,140,24,175,26"/>
</map>
</div>

</div>
</div>
<a id="a9716be5fe9da72481bee41a80681d8e5" name="a9716be5fe9da72481bee41a80681d8e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9716be5fe9da72481bee41a80681d8e5">&#9670;&#160;</a></span>UpdateConnectivity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ControlLogic::UpdateConnectivity </td>
          <td>(</td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>online</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update connectivity status (Online/Offline). </p>
<p>Resets Heartbeat timer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">online</td><td>Status. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00948">948</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  948</span>                                         {</div>
<div class="line"><span class="lineno">  949</span>        <a class="code hl_variable" href="_control_logic_8cpp.html#a5995db87b2ef40e52a47d2fb1f13ae42">is_connected</a> = <a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a9148fdd6f33c42faedeb9cc1a5520646a7f46165474d11ee5836777d85df2cdab">online</a>;</div>
<div class="line"><span class="lineno">  950</span>        <span class="keywordflow">if</span> (<a class="code hl_enumvalue" href="_bambu_bus_protocol_8h.html#a9148fdd6f33c42faedeb9cc1a5520646a7f46165474d11ee5836777d85df2cdab">online</a>) <a class="code hl_variable" href="_control_logic_8cpp.html#abeaf61fc41f3eae5245f0b7484a5fb5e">last_heartbeat_time</a> = <a class="code hl_function" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3">Hardware::GetTime</a>();</div>
<div class="line"><span class="lineno">  951</span>    }</div>
<div class="ttc" id="a_control_logic_8cpp_html_a5995db87b2ef40e52a47d2fb1f13ae42"><div class="ttname"><a href="_control_logic_8cpp.html#a5995db87b2ef40e52a47d2fb1f13ae42">is_connected</a></div><div class="ttdeci">static bool is_connected</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00036">ControlLogic.cpp:36</a></div></div>
<div class="ttc" id="a_control_logic_8cpp_html_abeaf61fc41f3eae5245f0b7484a5fb5e"><div class="ttname"><a href="_control_logic_8cpp.html#abeaf61fc41f3eae5245f0b7484a5fb5e">last_heartbeat_time</a></div><div class="ttdeci">static uint64_t last_heartbeat_time</div><div class="ttdef"><b>Definition</b> <a href="_control_logic_8cpp_source.html#l00037">ControlLogic.cpp:37</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00115">Hardware::GetTime()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00036">is_connected</a>, <a class="el" href="_control_logic_8cpp_source.html#l00037">last_heartbeat_time</a>, and <a class="el" href="_bambu_bus_protocol_8h_source.html#l00011">online</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l01355">ProcessHeartbeat()</a>, <a class="el" href="_control_logic_8cpp_source.html#l01311">ProcessOnlineDetect()</a>, <a class="el" href="_command_router_8cpp_source.html#l00133">CommandRouter::Route()</a>, and <a class="el" href="_command_router_8cpp_source.html#l00180">CommandRouter::Run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a9716be5fe9da72481bee41a80681d8e5_cgraph.png" border="0" usemap="#anamespace_control_logic_a9716be5fe9da72481bee41a80681d8e5_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a9716be5fe9da72481bee41a80681d8e5_cgraph" id="anamespace_control_logic_a9716be5fe9da72481bee41a80681d8e5_cgraph">
<area shape="rect" title="Update connectivity status (Online/Offline)." alt="" coords="5,5,223,32"/>
<area shape="rect" href="namespace_hardware.html#a8ea28b07408691bc126683a81aa220f3" title="Get System Time in Milliseconds." alt="" coords="271,5,406,32"/>
<area shape="poly" title=" " alt="" coords="223,16,258,19,252,19,223,21"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="454,5,539,32"/>
<area shape="poly" title=" " alt="" coords="407,16,441,19,436,19,407,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_control_logic_a9716be5fe9da72481bee41a80681d8e5_icgraph.png" border="0" usemap="#anamespace_control_logic_a9716be5fe9da72481bee41a80681d8e5_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_control_logic_a9716be5fe9da72481bee41a80681d8e5_icgraph" id="anamespace_control_logic_a9716be5fe9da72481bee41a80681d8e5_icgraph">
<area shape="rect" title="Update connectivity status (Online/Offline)." alt="" coords="950,93,1167,120"/>
<area shape="rect" href="namespace_control_logic.html#a0c4206af909c8128bc68eb6a1bcfa16e" title="Handler for Heartbeat (0x20)." alt="" coords="695,5,902,32"/>
<area shape="poly" title=" " alt="" coords="1011,87,901,47,862,35,862,30,903,41,1016,87"/>
<area shape="rect" href="namespace_control_logic.html#a412a7a597ff3c04c0ea1480094600ef4" title="Handler for Online Detect (0x05)." alt="" coords="705,56,892,99"/>
<area shape="poly" title=" " alt="" coords="932,93,892,91,892,85,937,93"/>
<area shape="rect" href="namespace_command_router.html#a329f0a7e2f53debf5c7cb5f47579151b" title="Route an incoming command to its specific handler." alt="" coords="717,123,880,149"/>
<area shape="poly" title=" " alt="" coords="937,120,881,129,880,124,932,121"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,148,647,175"/>
<area shape="poly" title=" " alt="" coords="1016,126,962,149,902,164,835,172,767,175,647,171,647,166,767,170,835,167,902,159,960,144,1011,127"/>
<area shape="poly" title=" " alt="" coords="704,147,647,156,647,150,699,147"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,148,446,175"/>
<area shape="poly" title=" " alt="" coords="476,161,447,164,447,159,481,161"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="RAMNeoPixels" alt="" coords="188,148,353,175"/>
<area shape="poly" title=" " alt="" coords="383,161,353,164,353,159,388,161"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="Adafruit_NeoPixel" alt="" coords="5,140,140,183"/>
<area shape="poly" title=" " alt="" coords="170,162,140,164,140,159,175,161"/>
</map>
</div>

</div>
</div>
<a name="doc-var-members" id="doc-var-members"></a><h2 id="header-doc-var-members" class="groupheader">Variable Documentation</h2>
<a id="ad161a11879586190d66f43141bb6578f" name="ad161a11879586190d66f43141bb6578f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad161a11879586190d66f43141bb6578f">&#9670;&#160;</a></span>as5600_distance_save</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32_t ControlLogic::as5600_distance_save[4] = {0, 0, 0, 0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00213">213</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  213</span>{0, 0, 0, 0};</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00694">AS5600_Update()</a>.</p>

</div>
</div>
<a id="a280d12e7265d1830d4859cc38dd5497e" name="a280d12e7265d1830d4859cc38dd5497e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a280d12e7265d1830d4859cc38dd5497e">&#9670;&#160;</a></span>Assist_send_filament</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ControlLogic::Assist_send_filament[4] = {false}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00209">209</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  209</span>{<span class="keyword">false</span>};</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00398">ControlLogic::MotorChannel::Run()</a>.</p>

</div>
</div>
<a id="a5cc135d9070e574d8b2fe9c9b328a148" name="a5cc135d9070e574d8b2fe9c9b328a148"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5cc135d9070e574d8b2fe9c9b328a148">&#9670;&#160;</a></span>Bambubus_need_to_save</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ControlLogic::Bambubus_need_to_save = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00223">223</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00792">Run()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00722">SaveSettings()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00733">SetNeedToSave()</a>.</p>

</div>
</div>
<a id="a3cb6555c20c1e3a386f34fa9f5e6b596" name="a3cb6555c20c1e3a386f34fa9f5e6b596"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cb6555c20c1e3a386f34fa9f5e6b596">&#9670;&#160;</a></span>filament_now_position</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76">filament_now_position_enum</a> ControlLogic::filament_now_position[4] = {<a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>, <a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>, <a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>, <a class="el" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00220">220</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  220</span>{<a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>, <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>, <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>, <a class="code hl_enumvalue" href="#a3a47e5f4732fefd1ac3a3f8d33402a76a3f3203b2544e7066baf775b37a8754c5">filament_idle</a>};</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00962">motor_motion_switch()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00751">Prepare_For_filament_Pull_Back()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00643">SetAutoFeed()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00529">StartLoadFilament()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00576">StartUnloadFilament()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00629">StopAll()</a>.</p>

</div>
</div>
<a id="aef70a34b1f25019450171bfa5c07ab62" name="aef70a34b1f25019450171bfa5c07ab62"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef70a34b1f25019450171bfa5c07ab62">&#9670;&#160;</a></span>is_backing_out</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ControlLogic::is_backing_out = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00211">211</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00962">motor_motion_switch()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00751">Prepare_For_filament_Pull_Back()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00398">ControlLogic::MotorChannel::Run()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00529">StartLoadFilament()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00576">StartUnloadFilament()</a>.</p>

</div>
</div>
<a id="a8abb9a7c0790b08a5e5f31c8874bb15f" name="a8abb9a7c0790b08a5e5f31c8874bb15f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8abb9a7c0790b08a5e5f31c8874bb15f">&#9670;&#160;</a></span>is_two</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const bool ControlLogic::is_two = true</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00212">212</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00240">MC_PULL_ONLINE_read()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00398">ControlLogic::MotorChannel::Run()</a>.</p>

</div>
</div>
<a id="a503041f38fbec420305ae1bb79aa4002" name="a503041f38fbec420305ae1bb79aa4002"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a503041f38fbec420305ae1bb79aa4002">&#9670;&#160;</a></span>MC_ONLINE_key_stu</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ControlLogic::MC_ONLINE_key_stu[4] = {0, 0, 0, 0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00208">208</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  208</span>{0, 0, 0, 0}; <span class="comment">// 0:Off, 1:Online(Two), 2:ExTrip, 3:InTrip</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00662">GetSensorState()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00240">MC_PULL_ONLINE_read()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00962">motor_motion_switch()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00398">ControlLogic::MotorChannel::Run()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00501">ControlLogic::MotorChannel::UpdateLEDStatus()</a>.</p>

</div>
</div>
<a id="ae2535696ce7487f6ec12d1f2e174e598" name="ae2535696ce7487f6ec12d1f2e174e598"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2535696ce7487f6ec12d1f2e174e598">&#9670;&#160;</a></span>MC_ONLINE_key_stu_raw</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float ControlLogic::MC_ONLINE_key_stu_raw[4] = {0, 0, 0, 0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00207">207</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  207</span>{0, 0, 0, 0};</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00240">MC_PULL_ONLINE_read()</a>.</p>

</div>
</div>
<a id="a87d54195660d73ebcd372cad0fd74915" name="a87d54195660d73ebcd372cad0fd74915"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87d54195660d73ebcd372cad0fd74915">&#9670;&#160;</a></span>MC_PULL_stu</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ControlLogic::MC_PULL_stu[4] = {0, 0, 0, 0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00206">206</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  206</span>{0, 0, 0, 0};</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00240">MC_PULL_ONLINE_read()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00398">ControlLogic::MotorChannel::Run()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00501">ControlLogic::MotorChannel::UpdateLEDStatus()</a>.</p>

</div>
</div>
<a id="a14f470efe568bae229e028e1b1acd54f" name="a14f470efe568bae229e028e1b1acd54f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14f470efe568bae229e028e1b1acd54f">&#9670;&#160;</a></span>MC_PULL_stu_raw</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float ControlLogic::MC_PULL_stu_raw[4] = {0, 0, 0, 0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00205">205</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  205</span>{0, 0, 0, 0};</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00366">ControlLogic::MotorChannel::GetXByPressure()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00904">InitBootCheck()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00240">MC_PULL_ONLINE_read()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00962">motor_motion_switch()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00398">ControlLogic::MotorChannel::Run()</a>.</p>

</div>
</div>
<a id="ac4fff77bfcf6d233d9c740ce7bc1a4da" name="ac4fff77bfcf6d233d9c740ce7bc1a4da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4fff77bfcf6d233d9c740ce7bc1a4da">&#9670;&#160;</a></span>motors</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_control_logic_1_1_motor_channel.html">MotorChannel</a> ControlLogic::motors[4] = {0, 1, 2, 3}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00517">517</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  517</span>{0, 1, 2, 3};</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00679">GetLaneMotion()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00870">Init()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00962">motor_motion_switch()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00616">MoveAxis()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00751">Prepare_For_filament_Pull_Back()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00792">Run()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00643">SetAutoFeed()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00529">StartLoadFilament()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00576">StartUnloadFilament()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00629">StopAll()</a>.</p>

</div>
</div>
<a id="a0dc914125ce5b958b6d1620c814a580d" name="a0dc914125ce5b958b6d1620c814a580d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0dc914125ce5b958b6d1620c814a580d">&#9670;&#160;</a></span>P1X_OUT_filament_meters</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float_t ControlLogic::P1X_OUT_filament_meters = 200.0f</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00201">201</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00792">Run()</a>.</p>

</div>
</div>
<a id="a33f7ccbf87b78ae7394f88ffe1a4a75e" name="a33f7ccbf87b78ae7394f88ffe1a4a75e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a33f7ccbf87b78ae7394f88ffe1a4a75e">&#9670;&#160;</a></span>pull_state_old</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ControlLogic::pull_state_old = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00210">210</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00962">motor_motion_switch()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00398">ControlLogic::MotorChannel::Run()</a>.</p>

</div>
</div>
<a id="a73b9466c4e3c236a186659863283f00e" name="a73b9466c4e3c236a186659863283f00e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73b9466c4e3c236a186659863283f00e">&#9670;&#160;</a></span>PULL_voltage_down</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ControlLogic::PULL_voltage_down = 1.45f</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00197">197</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00240">MC_PULL_ONLINE_read()</a>.</p>

</div>
</div>
<a id="a9a6c6bb73ae52885ddaa5ec56d8603f9" name="a9a6c6bb73ae52885ddaa5ec56d8603f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a6c6bb73ae52885ddaa5ec56d8603f9">&#9670;&#160;</a></span>PULL_voltage_up</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ControlLogic::PULL_voltage_up = 1.85f</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00196">196</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00240">MC_PULL_ONLINE_read()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00962">motor_motion_switch()</a>.</p>

</div>
</div>
<a id="a17835f3a0e8384e40e9d647ce79d3d22" name="a17835f3a0e8384e40e9d647ce79d3d22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17835f3a0e8384e40e9d647ce79d3d22">&#9670;&#160;</a></span>save_timer</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t ControlLogic::save_timer = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00224">224</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00792">Run()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00733">SetNeedToSave()</a>.</p>

</div>
</div>
<a id="a5428672c2045ec91715338f32d8bb5f1" name="a5428672c2045ec91715338f32d8bb5f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5428672c2045ec91715338f32d8bb5f1">&#9670;&#160;</a></span>speed_as5600</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float ControlLogic::speed_as5600[4] = {0, 0, 0, 0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00204">204</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  204</span>{0, 0, 0, 0};</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00694">AS5600_Update()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00398">ControlLogic::MotorChannel::Run()</a>.</p>

</div>
</div>
<a id="a0efb555ba92cc1cedb47929db260e6c8" name="a0efb555ba92cc1cedb47929db260e6c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0efb555ba92cc1cedb47929db260e6c8">&#9670;&#160;</a></span>unload_start_meters</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float ControlLogic::unload_start_meters[4] = {0, 0, 0, 0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00217">217</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  217</span>{0, 0, 0, 0};</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00576">StartUnloadFilament()</a>.</p>

</div>
</div>
<a id="a11bff287b64c24fe91500ba99c6f21c8" name="a11bff287b64c24fe91500ba99c6f21c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11bff287b64c24fe91500ba99c6f21c8">&#9670;&#160;</a></span>unload_target_dist</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32_t ControlLogic::unload_target_dist[4] = {0, 0, 0, 0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_control_logic_8cpp_source.html#l00216">216</a> of file <a class="el" href="_control_logic_8cpp_source.html">ControlLogic.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  216</span>{0, 0, 0, 0}; <span class="comment">// -1 for clear sensor</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00962">motor_motion_switch()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00529">StartLoadFilament()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00576">StartUnloadFilament()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="namespace_control_logic.html">ControlLogic</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
