<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BMCU370 Firmware: Hardware Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BMCU370 Firmware
   </div>
   <div id="projectbrief">Modified BMCU-C 370 Hall firmware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('namespace_hardware.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Hardware Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a25837768e4f1568435bc6d889be37ba5" id="r_a25837768e4f1568435bc6d889be37ba5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a25837768e4f1568435bc6d889be37ba5">InitBase</a> ()</td></tr>
<tr class="memdesc:a25837768e4f1568435bc6d889be37ba5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize minimal <a class="el" href="namespace_hardware.html">Hardware</a> Base.  <br /></td></tr>
<tr class="memitem:a90a0cffa2efcfb8d76bc12f9734ca623" id="r_a90a0cffa2efcfb8d76bc12f9734ca623"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a90a0cffa2efcfb8d76bc12f9734ca623">Watchdog_Disable</a> ()</td></tr>
<tr class="memdesc:a90a0cffa2efcfb8d76bc12f9734ca623"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disable the Window Watchdog.  <br /></td></tr>
<tr class="memitem:a8ab0dbadec2826235277f8152a80155d" id="r_a8ab0dbadec2826235277f8152a80155d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8ab0dbadec2826235277f8152a80155d">System_Init</a> ()</td></tr>
<tr class="memdesc:a8ab0dbadec2826235277f8152a80155d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure System Clocks and Pin Remapping.  <br /></td></tr>
<tr class="memitem:a0ada30189b8e1d1dbec145140849b778" id="r_a0ada30189b8e1d1dbec145140849b778"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0ada30189b8e1d1dbec145140849b778">DelayUS</a> (uint32_t time)</td></tr>
<tr class="memdesc:a0ada30189b8e1d1dbec145140849b778"><td class="mdescLeft">&#160;</td><td class="mdescRight">Microsecond Delay.  <br /></td></tr>
<tr class="memitem:ad269fd29299dd87118b408e4551f4d2d" id="r_ad269fd29299dd87118b408e4551f4d2d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad269fd29299dd87118b408e4551f4d2d">DelayMS</a> (uint32_t time)</td></tr>
<tr class="memdesc:ad269fd29299dd87118b408e4551f4d2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Millisecond Delay.  <br /></td></tr>
<tr class="memitem:a8ea28b07408691bc126683a81aa220f3" id="r_a8ea28b07408691bc126683a81aa220f3"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8ea28b07408691bc126683a81aa220f3">GetTime</a> ()</td></tr>
<tr class="memdesc:a8ea28b07408691bc126683a81aa220f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get System Time in Milliseconds.  <br /></td></tr>
<tr class="memitem:a8eaf73ad39643f6bb1bbe74d9b5e8b86" id="r_a8eaf73ad39643f6bb1bbe74d9b5e8b86"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8eaf73ad39643f6bb1bbe74d9b5e8b86">UART_SetRxCallback</a> (void(*callback)(uint8_t))</td></tr>
<tr class="memdesc:a8eaf73ad39643f6bb1bbe74d9b5e8b86"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register a callback for UART1 RX.  <br /></td></tr>
<tr class="memitem:a29ba54eb55c1b296fa35c18043ce9cb5" id="r_a29ba54eb55c1b296fa35c18043ce9cb5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a29ba54eb55c1b296fa35c18043ce9cb5">InitUART</a> (bool isKlipper)</td></tr>
<tr class="memdesc:a29ba54eb55c1b296fa35c18043ce9cb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize UART1 for Bus/Serial communication.  <br /></td></tr>
<tr class="memitem:afeb16bfe3e187a44a3c51c9738a933df" id="r_afeb16bfe3e187a44a3c51c9738a933df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afeb16bfe3e187a44a3c51c9738a933df">USART1_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:afeb16bfe3e187a44a3c51c9738a933df"><td class="mdescLeft">&#160;</td><td class="mdescRight">UART1 Interrupt Service Routine.  <br /></td></tr>
<tr class="memitem:aaaf02ef3df5811e2ba28dd009eadfaae" id="r_aaaf02ef3df5811e2ba28dd009eadfaae"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaaf02ef3df5811e2ba28dd009eadfaae">UART_SendByte</a> (uint8_t data)</td></tr>
<tr class="memdesc:aaaf02ef3df5811e2ba28dd009eadfaae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a single byte blocking.  <br /></td></tr>
<tr class="memitem:ad3ec7cad074d6d73508844a06a7bea50" id="r_ad3ec7cad074d6d73508844a06a7bea50"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad3ec7cad074d6d73508844a06a7bea50">UART_Send</a> (const uint8_t *data, uint16_t length)</td></tr>
<tr class="memdesc:ad3ec7cad074d6d73508844a06a7bea50"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a buffer via UART1.  <br /></td></tr>
<tr class="memitem:a72bd28689a22ff9e3db6b911c020ecbb" id="r_a72bd28689a22ff9e3db6b911c020ecbb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a72bd28689a22ff9e3db6b911c020ecbb">ADC_Init</a> ()</td></tr>
<tr class="memdesc:a72bd28689a22ff9e3db6b911c020ecbb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the Analog-to-Digital Converter.  <br /></td></tr>
<tr class="memitem:aa54da804a3d4c6d89ba5d7a2931fc463" id="r_aa54da804a3d4c6d89ba5d7a2931fc463"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa54da804a3d4c6d89ba5d7a2931fc463">ADC_GetValues</a> ()</td></tr>
<tr class="memdesc:aa54da804a3d4c6d89ba5d7a2931fc463"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get filtered ADC voltage values.  <br /></td></tr>
<tr class="memitem:a0745af097a6d21fc3fb1f1ebd9e141ff" id="r_a0745af097a6d21fc3fb1f1ebd9e141ff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0745af097a6d21fc3fb1f1ebd9e141ff">PWM_Init</a> ()</td></tr>
<tr class="memdesc:a0745af097a6d21fc3fb1f1ebd9e141ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize PWM Timers for Motor Control.  <br /></td></tr>
<tr class="memitem:af8a83d19b30aeb46530bd36c63b3fab7" id="r_af8a83d19b30aeb46530bd36c63b3fab7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af8a83d19b30aeb46530bd36c63b3fab7">PWM_Set</a> (uint8_t channel, int PWM)</td></tr>
<tr class="memdesc:af8a83d19b30aeb46530bd36c63b3fab7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set PWM duty cycle for a Motor Channel.  <br /></td></tr>
<tr class="memitem:a87dd189117be2ce6e98135f024fd972c" id="r_a87dd189117be2ce6e98135f024fd972c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a87dd189117be2ce6e98135f024fd972c">LED_Init</a> ()</td></tr>
<tr class="memdesc:a87dd189117be2ce6e98135f024fd972c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize NeoPixel LEDs.  <br /></td></tr>
<tr class="memitem:a44347f62b4ee1789ecfed67b195572e4" id="r_a44347f62b4ee1789ecfed67b195572e4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a44347f62b4ee1789ecfed67b195572e4">LED_SetColor</a> (uint8_t channel, int led_idx, uint8_t r, uint8_t g, uint8_t b)</td></tr>
<tr class="memdesc:a44347f62b4ee1789ecfed67b195572e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set Color of a specific LED.  <br /></td></tr>
<tr class="memitem:a365d946e0cf0fe8cfc8dbcb25cfbdad9" id="r_a365d946e0cf0fe8cfc8dbcb25cfbdad9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a365d946e0cf0fe8cfc8dbcb25cfbdad9">LED_Show</a> ()</td></tr>
<tr class="memdesc:a365d946e0cf0fe8cfc8dbcb25cfbdad9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update LED <a class="el" href="namespace_hardware.html">Hardware</a>.  <br /></td></tr>
<tr class="memitem:aca1ef8aa807fb9291ad5d727697f427a" id="r_aca1ef8aa807fb9291ad5d727697f427a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aca1ef8aa807fb9291ad5d727697f427a">LED_SetBrightness</a> (uint8_t brightness)</td></tr>
<tr class="memdesc:aca1ef8aa807fb9291ad5d727697f427a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set Global Brightness for LEDs.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5d7ac173bff318607226970e0e864b1e" id="r_a5d7ac173bff318607226970e0e864b1e"><td class="memItemLeft" align="right" valign="top">static void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5d7ac173bff318607226970e0e864b1e">uart_rx_callback</a> )(uint8_t) = nullptr</td></tr>
</table>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="aa54da804a3d4c6d89ba5d7a2931fc463" name="aa54da804a3d4c6d89ba5d7a2931fc463"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa54da804a3d4c6d89ba5d7a2931fc463">&#9670;&#160;</a></span>ADC_GetValues()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float * Hardware::ADC_GetValues </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get filtered ADC voltage values. </p>
<p>Calculates the average of the DMA buffer for each channel, converts to Voltage, and returns the array.</p>
<dl class="section return"><dt>Returns</dt><dd>float* Pointer to array of 8 float voltages (0.0 - 3.3V). </dd></dl>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00387">387</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  387</span>                           {</div>
<div class="line"><span class="lineno">  388</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {</div>
<div class="line"><span class="lineno">  389</span>            <span class="keywordtype">int</span> data_sum = 0;</div>
<div class="line"><span class="lineno">  390</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code hl_variable" href="_hardware_8cpp.html#a7f0a3595a7279d996b9755c1d0a869c3">ADC_filter_n</a>; j++) {</div>
<div class="line"><span class="lineno">  391</span>                uint16_t val = <a class="code hl_variable" href="_hardware_8cpp.html#a1f55c9492f5c46c9dccc9ef82fa29fa4">ADC_data</a>[j][i];</div>
<div class="line"><span class="lineno">  392</span>                <span class="keywordtype">int</span> sum = val + <a class="code hl_variable" href="_hardware_8cpp.html#aa783e3422e532b9e461a5f4587f92af3">ADC_Calibrattion_Val</a>;</div>
<div class="line"><span class="lineno">  393</span>                <span class="keywordflow">if</span> (sum &lt; 0 || val == 0) ;</div>
<div class="line"><span class="lineno">  394</span>                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sum &gt; 4095 || val == 4095) data_sum += 4095;</div>
<div class="line"><span class="lineno">  395</span>                <span class="keywordflow">else</span> data_sum += sum;</div>
<div class="line"><span class="lineno">  396</span>            }</div>
<div class="line"><span class="lineno">  397</span>            data_sum &gt;&gt;= <a class="code hl_define" href="_hardware_8cpp.html#a0f3218e1a4efff25733c15e62edc8b95">ADC_filter_n_pow</a>;</div>
<div class="line"><span class="lineno">  398</span>            <a class="code hl_variable" href="_hardware_8cpp.html#a5c39ff64ad392377dca1128f55eadd51">ADC_V</a>[i] = ((float)data_sum) / 4096 * 3.3;</div>
<div class="line"><span class="lineno">  399</span>        }</div>
<div class="line"><span class="lineno">  400</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="_hardware_8cpp.html#a5c39ff64ad392377dca1128f55eadd51">ADC_V</a>;</div>
<div class="line"><span class="lineno">  401</span>    }</div>
<div class="ttc" id="a_hardware_8cpp_html_a0f3218e1a4efff25733c15e62edc8b95"><div class="ttname"><a href="_hardware_8cpp.html#a0f3218e1a4efff25733c15e62edc8b95">ADC_filter_n_pow</a></div><div class="ttdeci">#define ADC_filter_n_pow</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00029">Hardware.cpp:29</a></div></div>
<div class="ttc" id="a_hardware_8cpp_html_a1f55c9492f5c46c9dccc9ef82fa29fa4"><div class="ttname"><a href="_hardware_8cpp.html#a1f55c9492f5c46c9dccc9ef82fa29fa4">ADC_data</a></div><div class="ttdeci">uint16_t ADC_data[ADC_filter_n][8]</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00036">Hardware.cpp:36</a></div></div>
<div class="ttc" id="a_hardware_8cpp_html_a5c39ff64ad392377dca1128f55eadd51"><div class="ttname"><a href="_hardware_8cpp.html#a5c39ff64ad392377dca1128f55eadd51">ADC_V</a></div><div class="ttdeci">float ADC_V[8]</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00037">Hardware.cpp:37</a></div></div>
<div class="ttc" id="a_hardware_8cpp_html_a7f0a3595a7279d996b9755c1d0a869c3"><div class="ttname"><a href="_hardware_8cpp.html#a7f0a3595a7279d996b9755c1d0a869c3">ADC_filter_n</a></div><div class="ttdeci">constexpr const int ADC_filter_n</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00035">Hardware.cpp:35</a></div></div>
<div class="ttc" id="a_hardware_8cpp_html_aa783e3422e532b9e461a5f4587f92af3"><div class="ttname"><a href="_hardware_8cpp.html#aa783e3422e532b9e461a5f4587f92af3">ADC_Calibrattion_Val</a></div><div class="ttdeci">int16_t ADC_Calibrattion_Val</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00028">Hardware.cpp:28</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00028">ADC_Calibrattion_Val</a>, <a class="el" href="_hardware_8cpp_source.html#l00036">ADC_data</a>, <a class="el" href="_hardware_8cpp_source.html#l00035">ADC_filter_n</a>, <a class="el" href="_hardware_8cpp_source.html#l00029">ADC_filter_n_pow</a>, and <a class="el" href="_hardware_8cpp_source.html#l00037">ADC_V</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00240">ControlLogic::MC_PULL_ONLINE_read()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_aa54da804a3d4c6d89ba5d7a2931fc463_icgraph.png" border="0" usemap="#anamespace_hardware_aa54da804a3d4c6d89ba5d7a2931fc463_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_aa54da804a3d4c6d89ba5d7a2931fc463_icgraph" id="anamespace_hardware_aa54da804a3d4c6d89ba5d7a2931fc463_icgraph">
<area shape="rect" title="Get filtered ADC voltage values." alt="" coords="947,31,1128,57"/>
<area shape="rect" href="namespace_control_logic.html#ab1b5b19d84cdbba6ef3ad97fba14ce13" title="Read Analog Sensors and Update State." alt="" coords="736,23,899,65"/>
<area shape="poly" title=" " alt="" coords="929,44,900,47,899,41,934,44"/>
<area shape="rect" href="namespace_control_logic.html#a0c732b28cf691fb77359c80a0c000665" title="Check Boot Mode (Button Press at Startup)." alt="" coords="502,5,688,32"/>
<area shape="poly" title=" " alt="" coords="718,33,688,32,688,27,723,33"/>
<area shape="rect" href="namespace_control_logic.html#adc8c269923e0c76c6d104a005833a7f9" title="Main Control Loop." alt="" coords="532,56,658,83"/>
<area shape="poly" title=" " alt="" coords="723,55,659,65,658,59,718,55"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="401,5,454,32"/>
<area shape="poly" title=" " alt="" coords="484,19,455,21,455,16,489,18"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="405,56,450,83"/>
<area shape="poly" title=" " alt="" coords="514,69,451,72,451,67,519,69"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="将RAM中的像素数据传输到NeoPixels。" alt="" coords="188,56,353,83"/>
<area shape="poly" title=" " alt="" coords="387,69,353,72,353,67,392,69"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="释放Adafruit_NeoPixel对象，将数据引脚恢复为输入模式。" alt="" coords="5,48,140,91"/>
<area shape="poly" title=" " alt="" coords="170,70,140,72,140,67,175,69"/>
</map>
</div>

</div>
</div>
<a id="a72bd28689a22ff9e3db6b911c020ecbb" name="a72bd28689a22ff9e3db6b911c020ecbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72bd28689a22ff9e3db6b911c020ecbb">&#9670;&#160;</a></span>ADC_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::ADC_Init </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the Analog-to-Digital Converter. </p>
<p>Configures GPIO (PA0-PA7), DMA1 Channel 1 (Circular Buffer), and ADC1. Runs calibration and starts continuous conversion via DMA. </p>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00317">317</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  317</span>                    {</div>
<div class="line"><span class="lineno">  318</span>        <span class="comment">// GPIO</span></div>
<div class="line"><span class="lineno">  319</span>        {</div>
<div class="line"><span class="lineno">  320</span>            RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);</div>
<div class="line"><span class="lineno">  321</span>            GPIO_InitTypeDef GPIO_InitStructure;</div>
<div class="line"><span class="lineno">  322</span>            GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AIN;</div>
<div class="line"><span class="lineno">  323</span>            GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</div>
<div class="line"><span class="lineno">  324</span>            GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0 | GPIO_Pin_1 | GPIO_Pin_2 | GPIO_Pin_3 | GPIO_Pin_4 | GPIO_Pin_5 | GPIO_Pin_6 | GPIO_Pin_7;</div>
<div class="line"><span class="lineno">  325</span>            GPIO_Init(GPIOA, &amp;GPIO_InitStructure);</div>
<div class="line"><span class="lineno">  326</span>        }</div>
<div class="line"><span class="lineno">  327</span> </div>
<div class="line"><span class="lineno">  328</span>        <span class="comment">// DMA</span></div>
<div class="line"><span class="lineno">  329</span>        {</div>
<div class="line"><span class="lineno">  330</span>            DMA_InitTypeDef DMA_InitStructure;</div>
<div class="line"><span class="lineno">  331</span>            RCC_AHBPeriphClockCmd(RCC_AHBPeriph_DMA1, ENABLE);</div>
<div class="line"><span class="lineno">  332</span>            DMA_DeInit(DMA1_Channel1);</div>
<div class="line"><span class="lineno">  333</span>            DMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)&amp;ADC1-&gt;RDATAR;</div>
<div class="line"><span class="lineno">  334</span>            DMA_InitStructure.DMA_MemoryBaseAddr = (uint32_t)<a class="code hl_variable" href="_hardware_8cpp.html#a1f55c9492f5c46c9dccc9ef82fa29fa4">ADC_data</a>;</div>
<div class="line"><span class="lineno">  335</span>            DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralSRC;</div>
<div class="line"><span class="lineno">  336</span>            DMA_InitStructure.DMA_BufferSize = <a class="code hl_variable" href="_hardware_8cpp.html#a7f0a3595a7279d996b9755c1d0a869c3">ADC_filter_n</a> * 8;</div>
<div class="line"><span class="lineno">  337</span>            DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;</div>
<div class="line"><span class="lineno">  338</span>            DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;</div>
<div class="line"><span class="lineno">  339</span>            DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_HalfWord;</div>
<div class="line"><span class="lineno">  340</span>            DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_HalfWord;</div>
<div class="line"><span class="lineno">  341</span>            DMA_InitStructure.DMA_Mode = DMA_Mode_Circular;</div>
<div class="line"><span class="lineno">  342</span>            DMA_InitStructure.DMA_Priority = DMA_Priority_VeryHigh;</div>
<div class="line"><span class="lineno">  343</span>            DMA_InitStructure.DMA_M2M = DMA_M2M_Disable;</div>
<div class="line"><span class="lineno">  344</span>            DMA_Init(DMA1_Channel1, &amp;DMA_InitStructure);</div>
<div class="line"><span class="lineno">  345</span>            DMA_Cmd(DMA1_Channel1, ENABLE);</div>
<div class="line"><span class="lineno">  346</span>        }</div>
<div class="line"><span class="lineno">  347</span> </div>
<div class="line"><span class="lineno">  348</span>        <span class="comment">// ADC</span></div>
<div class="line"><span class="lineno">  349</span>        {</div>
<div class="line"><span class="lineno">  350</span>            ADC_DeInit(ADC1);</div>
<div class="line"><span class="lineno">  351</span>            RCC_ADCCLKConfig(RCC_PCLK2_Div8);</div>
<div class="line"><span class="lineno">  352</span>            RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE);</div>
<div class="line"><span class="lineno">  353</span>            ADC_InitTypeDef ADC_InitStructure;</div>
<div class="line"><span class="lineno">  354</span>            ADC_InitStructure.ADC_Mode = ADC_Mode_Independent;</div>
<div class="line"><span class="lineno">  355</span>            ADC_InitStructure.ADC_ScanConvMode = ENABLE;</div>
<div class="line"><span class="lineno">  356</span>            ADC_InitStructure.ADC_ContinuousConvMode = ENABLE;</div>
<div class="line"><span class="lineno">  357</span>            ADC_InitStructure.ADC_ExternalTrigConv = ADC_ExternalTrigConv_None;</div>
<div class="line"><span class="lineno">  358</span>            ADC_InitStructure.ADC_DataAlign = ADC_DataAlign_Right;</div>
<div class="line"><span class="lineno">  359</span>            ADC_InitStructure.ADC_NbrOfChannel = 8;</div>
<div class="line"><span class="lineno">  360</span>            <a class="code hl_function" href="#a72bd28689a22ff9e3db6b911c020ecbb">ADC_Init</a>(ADC1, &amp;ADC_InitStructure);</div>
<div class="line"><span class="lineno">  361</span> </div>
<div class="line"><span class="lineno">  362</span>            ADC_Cmd(ADC1, ENABLE);</div>
<div class="line"><span class="lineno">  363</span>            ADC_BufferCmd(ADC1, DISABLE);</div>
<div class="line"><span class="lineno">  364</span> </div>
<div class="line"><span class="lineno">  365</span>            ADC_ResetCalibration(ADC1);</div>
<div class="line"><span class="lineno">  366</span>            <span class="keywordflow">while</span> (ADC_GetResetCalibrationStatus(ADC1));</div>
<div class="line"><span class="lineno">  367</span>            ADC_StartCalibration(ADC1);</div>
<div class="line"><span class="lineno">  368</span>            <span class="keywordflow">while</span> (ADC_GetCalibrationStatus(ADC1));</div>
<div class="line"><span class="lineno">  369</span>            <a class="code hl_variable" href="_hardware_8cpp.html#aa783e3422e532b9e461a5f4587f92af3">ADC_Calibrattion_Val</a> = Get_CalibrationValue(ADC1);</div>
<div class="line"><span class="lineno">  370</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 8; i++)</div>
<div class="line"><span class="lineno">  371</span>                ADC_RegularChannelConfig(ADC1, i, i + 1, ADC_SampleTime_239Cycles5);</div>
<div class="line"><span class="lineno">  372</span>            ADC_DMACmd(ADC1, ENABLE);</div>
<div class="line"><span class="lineno">  373</span>            ADC_SoftwareStartConvCmd(ADC1, ENABLE);</div>
<div class="line"><span class="lineno">  374</span>        }</div>
<div class="line"><span class="lineno">  375</span>        <a class="code hl_function" href="#ad269fd29299dd87118b408e4551f4d2d">DelayMS</a>(256); <span class="comment">// Wait for buffer fill (ADC_filter_n = 256)</span></div>
<div class="line"><span class="lineno">  376</span>    }</div>
<div class="ttc" id="anamespace_hardware_html_a72bd28689a22ff9e3db6b911c020ecbb"><div class="ttname"><a href="#a72bd28689a22ff9e3db6b911c020ecbb">Hardware::ADC_Init</a></div><div class="ttdeci">void ADC_Init()</div><div class="ttdoc">Initialize the Analog-to-Digital Converter.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00317">Hardware.cpp:317</a></div></div>
<div class="ttc" id="anamespace_hardware_html_ad269fd29299dd87118b408e4551f4d2d"><div class="ttname"><a href="#ad269fd29299dd87118b408e4551f4d2d">Hardware::DelayMS</a></div><div class="ttdeci">void DelayMS(uint32_t time)</div><div class="ttdoc">Millisecond Delay.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00105">Hardware.cpp:105</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00028">ADC_Calibrattion_Val</a>, <a class="el" href="_hardware_8cpp_source.html#l00036">ADC_data</a>, <a class="el" href="_hardware_8cpp_source.html#l00035">ADC_filter_n</a>, <a class="el" href="_hardware_8cpp_source.html#l00317">ADC_Init()</a>, and <a class="el" href="_hardware_8cpp_source.html#l00105">DelayMS()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_hardware_8cpp_source.html#l00317">ADC_Init()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00870">ControlLogic::Init()</a>, and <a class="el" href="_hardware_8cpp_source.html#l00052">InitBase()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a72bd28689a22ff9e3db6b911c020ecbb_cgraph.png" border="0" usemap="#anamespace_hardware_a72bd28689a22ff9e3db6b911c020ecbb_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a72bd28689a22ff9e3db6b911c020ecbb_cgraph" id="anamespace_hardware_a72bd28689a22ff9e3db6b911c020ecbb_cgraph">
<area shape="rect" title="Initialize the Analog&#45;to&#45;Digital Converter." alt="" coords="5,29,145,56"/>
<area shape="poly" title=" " alt="" coords="43,29,37,21,41,11,54,5,75,3,97,5,111,14,105,14,96,10,75,8,56,10,45,15,43,20,48,29"/>
<area shape="rect" href="namespace_hardware.html#ad269fd29299dd87118b408e4551f4d2d" title="Millisecond Delay." alt="" coords="193,29,332,56"/>
<area shape="poly" title=" " alt="" coords="145,40,180,43,175,43,145,45"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a72bd28689a22ff9e3db6b911c020ecbb_icgraph.png" border="0" usemap="#anamespace_hardware_a72bd28689a22ff9e3db6b911c020ecbb_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a72bd28689a22ff9e3db6b911c020ecbb_icgraph" id="anamespace_hardware_a72bd28689a22ff9e3db6b911c020ecbb_icgraph">
<area shape="rect" title="Initialize the Analog&#45;to&#45;Digital Converter." alt="" coords="386,47,525,73"/>
<area shape="poly" title=" " alt="" coords="486,31,476,28,456,25,437,27,426,32,424,37,429,47,424,45,419,38,422,28,435,22,456,20,478,23,491,32"/>
<area shape="rect" href="namespace_control_logic.html#a1da226a05b7a8c46e16a840900265c03" title="Initialize ControlLogic." alt="" coords="211,21,332,48"/>
<area shape="poly" title=" " alt="" coords="368,48,332,46,332,40,373,48"/>
<area shape="rect" href="namespace_hardware.html#a25837768e4f1568435bc6d889be37ba5" title="Initialize minimal Hardware Base." alt="" coords="205,72,338,99"/>
<area shape="poly" title=" " alt="" coords="373,71,339,79,338,74,368,72"/>
<area shape="rect" href="class_control_logic_1_1_m_o_t_o_r___p_i_d.html#a9edc970b22d74b15904b4929d862cc07" title=" " alt="" coords="5,5,157,48"/>
<area shape="poly" title=" " alt="" coords="193,32,157,33,157,27,198,31"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="54,72,108,99"/>
<area shape="poly" title=" " alt="" coords="206,53,109,81,107,76,201,52"/>
<area shape="poly" title=" " alt="" coords="187,86,108,88,108,83,192,85"/>
</map>
</div>

</div>
</div>
<a id="ad269fd29299dd87118b408e4551f4d2d" name="ad269fd29299dd87118b408e4551f4d2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad269fd29299dd87118b408e4551f4d2d">&#9670;&#160;</a></span>DelayMS()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::DelayMS </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>time</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Millisecond Delay. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">time</td><td>Milliseconds to wait. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00105">105</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  105</span>                                {</div>
<div class="line"><span class="lineno">  106</span>        delay(time);</div>
<div class="line"><span class="lineno">  107</span>    }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_hardware_8cpp_source.html#l00317">ADC_Init()</a>, <a class="el" href="_hardware_8cpp_source.html#l00052">InitBase()</a>, and <a class="el" href="_command_router_8cpp_source.html#l00180">CommandRouter::Run()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_ad269fd29299dd87118b408e4551f4d2d_icgraph.png" border="0" usemap="#anamespace_hardware_ad269fd29299dd87118b408e4551f4d2d_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_ad269fd29299dd87118b408e4551f4d2d_icgraph" id="anamespace_hardware_ad269fd29299dd87118b408e4551f4d2d_icgraph">
<area shape="rect" title="Millisecond Delay." alt="" coords="783,80,922,107"/>
<area shape="rect" href="namespace_hardware.html#a72bd28689a22ff9e3db6b911c020ecbb" title="Initialize the Analog&#45;to&#45;Digital Converter." alt="" coords="589,29,728,56"/>
<area shape="poly" title=" " alt="" coords="781,76,712,59,713,54,787,76"/>
<area shape="rect" href="namespace_hardware.html#a25837768e4f1568435bc6d889be37ba5" title="Initialize minimal Hardware Base." alt="" coords="401,80,534,107"/>
<area shape="poly" title=" " alt="" coords="765,94,535,96,535,91,770,93"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="582,131,735,157"/>
<area shape="poly" title=" " alt="" coords="787,111,713,133,712,127,781,111"/>
<area shape="poly" title=" " alt="" coords="690,14,680,10,658,8,639,10,628,15,625,20,631,30,626,28,620,21,624,11,637,5,659,3,681,5,695,14"/>
<area shape="rect" href="namespace_control_logic.html#a1da226a05b7a8c46e16a840900265c03" title="Initialize ControlLogic." alt="" coords="408,29,528,56"/>
<area shape="poly" title=" " alt="" coords="570,43,528,45,528,40,576,42"/>
<area shape="poly" title=" " alt="" coords="593,60,521,82,520,77,588,61"/>
<area shape="rect" href="class_control_logic_1_1_m_o_t_o_r___p_i_d.html#a9edc970b22d74b15904b4929d862cc07" title=" " alt="" coords="195,13,346,56"/>
<area shape="poly" title=" " alt="" coords="389,40,347,40,346,35,394,39"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="244,80,297,107"/>
<area shape="poly" title=" " alt="" coords="395,61,298,89,297,84,401,60"/>
<area shape="poly" title=" " alt="" coords="383,94,298,96,297,91,388,93"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="445,131,490,157"/>
<area shape="poly" title=" " alt="" coords="564,144,491,147,491,141,569,144"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="将RAM中的像素数据传输到NeoPixels。" alt="" coords="188,131,353,157"/>
<area shape="poly" title=" " alt="" coords="427,144,353,147,353,141,432,144"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="释放Adafruit_NeoPixel对象，将数据引脚恢复为输入模式。" alt="" coords="5,123,140,165"/>
<area shape="poly" title=" " alt="" coords="170,144,140,147,140,141,175,144"/>
</map>
</div>

</div>
</div>
<a id="a0ada30189b8e1d1dbec145140849b778" name="a0ada30189b8e1d1dbec145140849b778"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ada30189b8e1d1dbec145140849b778">&#9670;&#160;</a></span>DelayUS()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::DelayUS </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>time</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Microsecond Delay. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">time</td><td>Microseconds to wait. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00095">95</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   95</span>                                {</div>
<div class="line"><span class="lineno">   96</span>        delayMicroseconds(time);</div>
<div class="line"><span class="lineno">   97</span>    }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_hardware_8cpp_source.html#l00261">UART_Send()</a>, and <a class="el" href="_hardware_8cpp_source.html#l00243">UART_SendByte()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a0ada30189b8e1d1dbec145140849b778_icgraph.png" border="0" usemap="#anamespace_hardware_a0ada30189b8e1d1dbec145140849b778_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a0ada30189b8e1d1dbec145140849b778_icgraph" id="anamespace_hardware_a0ada30189b8e1d1dbec145140849b778_icgraph">
<area shape="rect" title="Microsecond Delay." alt="" coords="2285,284,2423,311"/>
<area shape="rect" href="namespace_hardware.html#ad3ec7cad074d6d73508844a06a7bea50" title="Send a buffer via UART1." alt="" coords="1845,284,2004,311"/>
<area shape="poly" title=" " alt="" coords="2267,298,2005,300,2004,295,2272,297"/>
<area shape="rect" href="namespace_hardware.html#aaaf02ef3df5811e2ba28dd009eadfaae" title="Send a single byte blocking." alt="" coords="2052,310,2237,336"/>
<area shape="poly" title=" " alt="" coords="2267,308,2238,314,2237,309,2272,307"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afeb304003d4b85010afd5e183e1bbf16" title="Handler for GET_FILAMENT_INFO command." alt="" coords="1084,158,1309,184"/>
<area shape="poly" title=" " alt="" coords="1865,279,1724,239,1637,217,1550,199,1425,183,1310,176,1309,171,1426,178,1550,194,1639,212,1726,234,1871,279"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a6089e6db2e7edddf19fdf095b9826c88" title="Parse and Dispatch a JSON Packet." alt="" coords="857,284,1036,311"/>
<area shape="poly" title=" " alt="" coords="1914,268,1900,225,1876,170,1842,116,1820,92,1796,72,1764,53,1735,42,1708,38,1681,37,1622,42,1550,43,1477,36,1414,26,1305,10,1254,9,1202,17,1147,36,1086,69,1057,92,1032,119,1011,149,993,181,968,241,954,285,949,282,963,239,989,178,1007,146,1028,116,1054,88,1083,65,1145,31,1201,11,1254,4,1305,5,1415,21,1478,31,1550,38,1622,36,1681,32,1708,32,1736,37,1766,48,1799,67,1824,88,1846,112,1881,167,1905,223,1919,270"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a8f239072c1896e64e9f6075edaaea515" title="Handler for STATUS command." alt="" coords="1613,82,1782,108"/>
<area shape="poly" title=" " alt="" coords="1902,271,1857,216,1796,154,1761,130,1728,112,1729,106,1764,126,1799,150,1861,212,1907,272"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a5498861593ca8083d7be1d71c8373f29" title="Initialize Klipper CLI." alt="" coords="1644,520,1752,547"/>
<area shape="poly" title=" " alt="" coords="1909,322,1862,391,1799,463,1760,496,1723,522,1720,517,1757,492,1795,460,1858,387,1904,325"/>
<area shape="rect" href="namespace_control_logic.html#ac2d890c891494072159ebc2b30490197" title="State Machine for BambuBus Logic." alt="" coords="1630,407,1765,450"/>
<area shape="poly" title=" " alt="" coords="1889,318,1738,409,1736,404,1884,320"/>
<area shape="rect" href="namespace_command_router.html#a1cf14aabb538f71f140e6b1aa7ef965d" title="Send a raw data packet via UART." alt="" coords="1598,706,1797,732"/>
<area shape="poly" title=" " alt="" coords="1913,323,1866,430,1800,560,1750,644,1710,707,1707,703,1746,641,1795,558,1861,428,1909,327"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a9ec392d53485800126189969c2c4981a" title="Serialize and send a JSON response." alt="" coords="1608,284,1787,311"/>
<area shape="poly" title=" " alt="" coords="1827,298,1788,300,1787,295,1832,297"/>
<area shape="poly" title=" " alt="" coords="1099,191,1085,199,1049,219,1015,242,964,286,961,282,1012,238,1046,214,1083,194,1104,188"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afe96c8a3898aa7a50f68ab6d726860c3" title="Main Execution Loop." alt="" coords="695,323,809,350"/>
<area shape="poly" title=" " alt="" coords="859,316,810,327,808,322,864,313"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,348,647,375"/>
<area shape="poly" title=" " alt="" coords="677,347,648,353,646,348,682,345"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,424,446,451"/>
<area shape="poly" title=" " alt="" coords="527,384,448,428,445,424,531,381"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="将RAM中的像素数据传输到NeoPixels。" alt="" coords="188,424,353,451"/>
<area shape="poly" title=" " alt="" coords="383,439,354,440,352,435,388,436"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="释放Adafruit_NeoPixel对象，将数据引脚恢复为输入模式。" alt="" coords="5,416,140,459"/>
<area shape="poly" title=" " alt="" coords="170,439,141,440,138,435,174,436"/>
<area shape="poly" title=" " alt="" coords="1620,78,1512,64,1446,58,1374,56,1300,59,1226,70,1154,89,1086,117,1060,134,1037,154,999,202,972,249,955,285,951,282,967,246,995,199,1033,150,1057,129,1083,113,1152,84,1225,65,1300,54,1374,51,1446,52,1513,58,1626,78"/>
<area shape="rect" href="namespace_command_router.html#a652cfc164ac7a2a2c016da37f341c42e" title="Initialize the Command Router and CLI subsystems." alt="" coords="1380,614,1526,640"/>
<area shape="poly" title=" " alt="" coords="1654,553,1551,597,1499,616,1498,610,1549,592,1649,554"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="1170,614,1223,640"/>
<area shape="poly" title=" " alt="" coords="1362,627,1224,630,1223,624,1367,627"/>
<area shape="rect" href="namespace_control_logic.html#adc8c269923e0c76c6d104a005833a7f9" title="Main Control Loop." alt="" coords="884,551,1010,578"/>
<area shape="poly" title=" " alt="" coords="1631,455,1484,509,1397,534,1309,554,1229,564,1148,569,1011,570,1010,564,1148,564,1228,559,1308,548,1396,529,1483,504,1626,456"/>
<area shape="poly" title=" " alt="" coords="871,548,446,445,447,440,876,545"/>
<area shape="rect" href="namespace_control_logic.html#a8880b393facb6828519b8dac8e96393c" title="Core logic for processing Short Motion packets." alt="" coords="1359,664,1548,707"/>
<area shape="poly" title=" " alt="" coords="1580,703,1548,701,1549,696,1585,703"/>
<area shape="rect" href="namespace_control_logic.html#a412a7a597ff3c04c0ea1480094600ef4" title="Handler for Online Detect (0x05)." alt="" coords="1360,731,1547,774"/>
<area shape="poly" title=" " alt="" coords="1585,734,1548,742,1547,737,1580,735"/>
<area shape="rect" href="namespace_control_logic.html#a82b9a1fb120cd91615d2ac478daafefd" title="Handler for REQx6 (0x06)." alt="" coords="1357,798,1550,824"/>
<area shape="poly" title=" " alt="" coords="1658,739,1551,788,1514,800,1513,794,1549,783,1653,740"/>
<area shape="rect" href="namespace_control_logic.html#a5f85db884abd1a66d8b120729ec0d99e" title="Handler for Filament Motion Short packet (0x03)." alt="" coords="1102,664,1291,707"/>
<area shape="poly" title=" " alt="" coords="1341,686,1292,688,1292,683,1346,685"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#ae13dcd8cc2528c12d0a241046fcc304e" title="Handler for GET_SENSORS command." alt="" coords="1096,208,1297,235"/>
<area shape="poly" title=" " alt="" coords="1590,283,1356,250,1285,238,1284,233,1357,244,1595,282"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a81f1646e6adb42482d4109a33b9bb9c5" title="Handler for PING command." alt="" coords="1375,208,1532,235"/>
<area shape="poly" title=" " alt="" coords="1635,279,1499,238,1499,233,1640,279"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#ad0e99d2fdcfd1c0690f850816ac1f67c" title="Helper to send an Error response." alt="" coords="1379,310,1528,336"/>
<area shape="poly" title=" " alt="" coords="1590,309,1529,318,1527,313,1595,308"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a1d7d7986d99cb52ab4feb4826ffc4428" title="Helper to send a Success (OK) response." alt="" coords="1385,386,1522,412"/>
<area shape="poly" title=" " alt="" coords="1652,316,1489,388,1487,383,1647,318"/>
<area shape="poly" title=" " alt="" coords="1129,241,1085,256,991,286,989,281,1084,251,1134,239"/>
<area shape="poly" title=" " alt="" coords="1418,199,1369,172,1339,158,1308,148,1245,132,1194,124,1145,128,1085,148,1062,161,1041,177,1004,216,975,255,957,286,953,282,971,252,999,212,1037,173,1059,156,1083,143,1144,122,1194,119,1246,127,1309,143,1341,153,1371,167,1424,199"/>
<area shape="poly" title=" " alt="" coords="1418,300,1355,249,1332,221,1322,210,1307,199,1283,187,1283,182,1310,194,1326,206,1336,218,1359,245,1424,300"/>
<area shape="poly" title=" " alt="" coords="1370,307,1308,300,1165,294,1037,296,1036,291,1165,289,1309,295,1375,306"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a12cef4b97fbfa7cfb7bdb1540e626ae9" title="Handler for MOVE command." alt="" coords="1115,360,1278,387"/>
<area shape="poly" title=" " alt="" coords="1364,341,1268,362,1267,357,1369,339"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a685b6d688593b458b5edafda4adfd4d4" title="Handler for SELECT_LANE command." alt="" coords="1098,411,1295,438"/>
<area shape="poly" title=" " alt="" coords="1415,343,1310,401,1272,413,1271,408,1308,396,1410,345"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a31ef4dae129916b85fdd8d1612553c77" title="Handler for SET_AUTO_FEED command." alt="" coords="1093,462,1300,488"/>
<area shape="poly" title=" " alt="" coords="1405,342,1380,359,1359,375,1344,395,1336,414,1328,433,1310,452,1289,463,1287,459,1307,447,1324,430,1331,412,1339,392,1355,372,1377,355,1400,344"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a76547f35e246989843f1870c760ea514" title="Handler for SET_FILAMENT_INFO command." alt="" coords="1085,310,1308,336"/>
<area shape="poly" title=" " alt="" coords="1361,323,1309,326,1308,320,1366,322"/>
<area shape="poly" title=" " alt="" coords="1111,356,1084,351,982,314,982,309,1085,346,1116,356"/>
<area shape="poly" title=" " alt="" coords="1098,406,1083,401,1046,381,1012,357,962,314,963,309,1015,353,1049,376,1085,397,1104,406"/>
<area shape="poly" title=" " alt="" coords="1093,455,1083,452,1040,419,1002,380,955,314,957,309,1007,377,1043,415,1086,447,1098,456"/>
<area shape="poly" title=" " alt="" coords="1067,311,1037,309,1036,304,1072,310"/>
<area shape="poly" title=" " alt="" coords="1367,391,1279,384,1278,379,1372,390"/>
<area shape="poly" title=" " alt="" coords="1366,408,1296,417,1295,412,1372,407"/>
<area shape="poly" title=" " alt="" coords="1405,417,1309,452,1265,464,1264,458,1308,447,1400,419"/>
<area shape="poly" title=" " alt="" coords="1399,380,1308,351,1264,339,1264,334,1309,346,1405,380"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a5bc1dda1e0b24dccb6fdc1c475930c88" title="Handler for STOP command." alt="" coords="1117,512,1276,539"/>
<area shape="poly" title=" " alt="" coords="1428,421,1375,465,1310,503,1277,514,1275,509,1308,498,1372,460,1423,424"/>
<area shape="poly" title=" " alt="" coords="1100,510,1083,502,1057,481,1033,457,995,403,967,351,952,314,954,309,972,349,999,400,1037,453,1060,477,1086,498,1105,510"/>
<area shape="poly" title=" " alt="" coords="2034,311,2004,309,2004,304,2039,310"/>
</map>
</div>

</div>
</div>
<a id="a8ea28b07408691bc126683a81aa220f3" name="a8ea28b07408691bc126683a81aa220f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ea28b07408691bc126683a81aa220f3">&#9670;&#160;</a></span>GetTime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t Hardware::GetTime </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get System Time in Milliseconds. </p>
<dl class="section return"><dt>Returns</dt><dd>uint64_t Time since boot (approx) in ms. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00115">115</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  115</span>                       {</div>
<div class="line"><span class="lineno">  116</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0">get_time64</a>();</div>
<div class="line"><span class="lineno">  117</span>    }</div>
<div class="ttc" id="atime64_8cpp_html_a146d483f58902ba0184ce16f728edfb0"><div class="ttname"><a href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0">get_time64</a></div><div class="ttdeci">uint64_t get_time64()</div><div class="ttdoc">Get 64-bit System Time in Milliseconds.</div><div class="ttdef"><b>Definition</b> <a href="time64_8cpp_source.html#l00018">time64.cpp:18</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="time64_8cpp_source.html#l00018">get_time64()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00227">ControlLogic::get_time64()</a>, <a class="el" href="_klipper_c_l_i_8cpp_source.html#l00090">KlipperCLI::HandlePing()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00962">ControlLogic::motor_motion_switch()</a>, <a class="el" href="_command_router_8cpp_source.html#l00180">CommandRouter::Run()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00792">ControlLogic::Run()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00733">ControlLogic::SetNeedToSave()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00948">ControlLogic::UpdateConnectivity()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a8ea28b07408691bc126683a81aa220f3_cgraph.png" border="0" usemap="#anamespace_hardware_a8ea28b07408691bc126683a81aa220f3_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a8ea28b07408691bc126683a81aa220f3_cgraph" id="anamespace_hardware_a8ea28b07408691bc126683a81aa220f3_cgraph">
<area shape="rect" title="Get System Time in Milliseconds." alt="" coords="5,5,141,32"/>
<area shape="rect" href="time64_8cpp.html#a146d483f58902ba0184ce16f728edfb0" title="Get 64&#45;bit System Time in Milliseconds." alt="" coords="189,5,274,32"/>
<area shape="poly" title=" " alt="" coords="141,16,176,18,170,19,141,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a8ea28b07408691bc126683a81aa220f3_icgraph.png" border="0" usemap="#anamespace_hardware_a8ea28b07408691bc126683a81aa220f3_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a8ea28b07408691bc126683a81aa220f3_icgraph" id="anamespace_hardware_a8ea28b07408691bc126683a81aa220f3_icgraph">
<area shape="rect" title="Get System Time in Milliseconds." alt="" coords="1969,189,2105,216"/>
<area shape="rect" href="namespace_control_logic.html#a4ddc46100d9f991cb0d171e62707ee7c" title=" " alt="" coords="1740,37,1906,64"/>
<area shape="poly" title=" " alt="" coords="2014,176,1974,131,1948,106,1920,85,1882,67,1882,62,1923,80,1952,102,1978,127,2019,177"/>
<area shape="rect" href="namespace_control_logic.html#ac2d890c891494072159ebc2b30490197" title="State Machine for BambuBus Logic." alt="" coords="1514,72,1649,115"/>
<area shape="poly" title=" " alt="" coords="2004,180,1966,157,1920,136,1850,117,1777,105,1650,96,1649,90,1778,99,1851,111,1922,131,1969,152,2009,181"/>
<area shape="rect" href="namespace_control_logic.html#adc8c269923e0c76c6d104a005833a7f9" title="Main Control Loop." alt="" coords="1264,84,1390,111"/>
<area shape="poly" title=" " alt="" coords="1952,189,1921,187,1704,159,1486,129,1391,112,1391,107,1487,124,1704,153,1922,181,1957,189"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a81f1646e6adb42482d4109a33b9bb9c5" title="Handler for PING command." alt="" coords="1744,240,1901,267"/>
<area shape="poly" title=" " alt="" coords="1965,220,1883,242,1882,237,1960,221"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,185,647,212"/>
<area shape="poly" title=" " alt="" coords="2030,230,2016,273,1994,324,1963,375,1923,419,1841,481,1804,501,1767,515,1728,524,1686,530,1583,533,1057,533,946,527,901,519,859,506,820,488,781,463,693,394,650,348,616,297,590,249,576,215,578,210,595,246,620,294,654,345,696,390,784,459,823,483,861,501,902,514,947,522,1057,528,1583,528,1685,525,1727,519,1765,510,1802,496,1838,476,1920,415,1959,372,1990,321,2011,272,2026,233"/>
<area shape="rect" href="namespace_control_logic.html#afe90d7f284c20f90f74787274f01c51b" title="Flag that settings need to be saved." alt="" coords="1724,379,1921,405"/>
<area shape="poly" title=" " alt="" coords="2011,226,1841,380,1838,376,2006,228"/>
<area shape="rect" href="namespace_control_logic.html#a9716be5fe9da72481bee41a80681d8e5" title="Update connectivity status (Online/Offline)." alt="" coords="950,189,1167,216"/>
<area shape="poly" title=" " alt="" coords="1951,204,1168,205,1168,200,1956,202"/>
<area shape="poly" title=" " alt="" coords="1726,68,1650,84,1649,79,1731,67"/>
<area shape="rect" href="namespace_control_logic.html#a8880b393facb6828519b8dac8e96393c" title="Core logic for processing Short Motion packets." alt="" coords="1487,5,1676,48"/>
<area shape="poly" title=" " alt="" coords="1721,41,1677,39,1676,33,1727,41"/>
<area shape="poly" title=" " alt="" coords="1495,95,1391,99,1390,94,1501,94"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,135,446,161"/>
<area shape="poly" title=" " alt="" coords="1245,100,1001,110,695,125,448,148,446,143,694,120,1001,104,1251,98"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="将RAM中的像素数据传输到NeoPixels。" alt="" coords="188,135,353,161"/>
<area shape="poly" title=" " alt="" coords="383,149,354,150,352,146,388,147"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="释放Adafruit_NeoPixel对象，将数据引脚恢复为输入模式。" alt="" coords="5,127,140,169"/>
<area shape="poly" title=" " alt="" coords="170,150,141,150,138,146,174,146"/>
<area shape="rect" href="namespace_control_logic.html#a5f85db884abd1a66d8b120729ec0d99e" title="Handler for Filament Motion Short packet (0x03)." alt="" coords="1232,5,1422,48"/>
<area shape="poly" title=" " alt="" coords="1469,27,1423,29,1422,24,1474,26"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a6089e6db2e7edddf19fdf095b9826c88" title="Parse and Dispatch a JSON Packet." alt="" coords="969,291,1148,317"/>
<area shape="poly" title=" " alt="" coords="1726,254,1495,262,1355,270,1216,281,1135,293,1134,287,1215,276,1355,265,1495,257,1731,253"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afe96c8a3898aa7a50f68ab6d726860c3" title="Main Execution Loop." alt="" coords="741,353,856,380"/>
<area shape="poly" title=" " alt="" coords="988,321,856,356,855,350,983,322"/>
<area shape="poly" title=" " alt="" coords="724,355,693,344,654,313,621,277,579,215,581,210,625,273,658,309,696,339,729,355"/>
<area shape="poly" title=" " alt="" coords="512,180,447,158,447,153,518,179"/>
<area shape="rect" href="namespace_control_logic.html#a0c732b28cf691fb77359c80a0c000665" title="Check Boot Mode (Button Press at Startup)." alt="" coords="1489,408,1674,435"/>
<area shape="poly" title=" " alt="" coords="1711,406,1675,413,1674,407,1706,406"/>
<area shape="rect" href="namespace_control_logic.html#ae855e1aa5895afa9999a3b9e6874e1e2" title="Load settings from Flash memory." alt="" coords="1492,459,1670,485"/>
<area shape="poly" title=" " alt="" coords="1775,411,1677,449,1638,461,1637,455,1675,444,1770,412"/>
<area shape="rect" href="namespace_control_logic.html#a3aed4ef4cb26632467a000c0130b11b4" title="Action helper to update filament metadata." alt="" coords="1495,341,1668,384"/>
<area shape="poly" title=" " alt="" coords="1706,378,1668,376,1668,370,1711,378"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="1032,400,1085,427"/>
<area shape="poly" title=" " alt="" coords="1471,420,1086,416,1086,411,1476,419"/>
<area shape="rect" href="namespace_control_logic.html#a1da226a05b7a8c46e16a840900265c03" title="Initialize ControlLogic." alt="" coords="1267,459,1387,485"/>
<area shape="poly" title=" " alt="" coords="1474,472,1388,475,1388,469,1479,472"/>
<area shape="poly" title=" " alt="" coords="1249,456,1086,422,1086,416,1255,456"/>
<area shape="rect" href="class_control_logic_1_1_m_o_t_o_r___p_i_d.html#a9edc970b22d74b15904b4929d862cc07" title=" " alt="" coords="983,451,1134,493"/>
<area shape="poly" title=" " alt="" coords="1249,472,1135,475,1135,469,1254,472"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a76547f35e246989843f1870c760ea514" title="Handler for SET_FILAMENT_INFO command." alt="" coords="1215,291,1439,317"/>
<area shape="poly" title=" " alt="" coords="1477,339,1438,332,1389,321,1389,315,1439,327,1483,339"/>
<area shape="rect" href="namespace_control_logic.html#ada1dd6f18fca06d8b26836f4788ab0ad" title="Handler for Set Filament Info (0x08 &#45; Short)." alt="" coords="1242,341,1412,384"/>
<area shape="poly" title=" " alt="" coords="1477,363,1413,365,1412,360,1482,363"/>
<area shape="poly" title=" " alt="" coords="1197,304,1149,307,1148,301,1202,304"/>
<area shape="poly" title=" " alt="" coords="932,203,648,202,647,197,937,201"/>
<area shape="rect" href="namespace_control_logic.html#a0c4206af909c8128bc68eb6a1bcfa16e" title="Handler for Heartbeat (0x20)." alt="" coords="695,236,902,263"/>
<area shape="poly" title=" " alt="" coords="963,220,877,238,876,233,968,219"/>
<area shape="rect" href="namespace_control_logic.html#a412a7a597ff3c04c0ea1480094600ef4" title="Handler for Online Detect (0x05)." alt="" coords="705,287,892,329"/>
<area shape="poly" title=" " alt="" coords="1019,222,903,277,871,289,870,284,901,272,1014,224"/>
<area shape="rect" href="namespace_command_router.html#a329f0a7e2f53debf5c7cb5f47579151b" title="Route an incoming command to its specific handler." alt="" coords="717,135,880,161"/>
<area shape="poly" title=" " alt="" coords="974,186,865,165,865,159,979,185"/>
<area shape="poly" title=" " alt="" coords="718,166,635,187,633,182,723,164"/>
</map>
</div>

</div>
</div>
<a id="a25837768e4f1568435bc6d889be37ba5" name="a25837768e4f1568435bc6d889be37ba5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25837768e4f1568435bc6d889be37ba5">&#9670;&#160;</a></span>InitBase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::InitBase </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize minimal <a class="el" href="namespace_hardware.html">Hardware</a> Base. </p>
<p>Disables Watchdog, Configures Clock/AFIO, Inits LEDs, ADC, PWM. Performs a boot LED sequence. </p>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00052">52</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   52</span>                    {</div>
<div class="line"><span class="lineno">   53</span>        <a class="code hl_function" href="#a90a0cffa2efcfb8d76bc12f9734ca623">Watchdog_Disable</a>(); <span class="comment">// Disable WWDG first!</span></div>
<div class="line"><span class="lineno">   54</span>        <a class="code hl_function" href="#a8ab0dbadec2826235277f8152a80155d">System_Init</a>();</div>
<div class="line"><span class="lineno">   55</span>        <a class="code hl_function" href="#a87dd189117be2ce6e98135f024fd972c">LED_Init</a>();    <span class="comment">// Init LEDs </span></div>
<div class="line"><span class="lineno">   56</span>        <span class="comment">// UART_Init moved to explicit call</span></div>
<div class="line"><span class="lineno">   57</span>        <a class="code hl_function" href="#a72bd28689a22ff9e3db6b911c020ecbb">ADC_Init</a>();    </div>
<div class="line"><span class="lineno">   58</span>        <a class="code hl_function" href="#a0745af097a6d21fc3fb1f1ebd9e141ff">PWM_Init</a>();</div>
<div class="line"><span class="lineno">   59</span>        </div>
<div class="line"><span class="lineno">   60</span>        <span class="comment">// Debug Flash: Red -&gt; Blue -&gt; Green</span></div>
<div class="line"><span class="lineno">   61</span>        <a class="code hl_function" href="#a44347f62b4ee1789ecfed67b195572e4">LED_SetColor</a>(4, 0, 50, 0, 0); <a class="code hl_function" href="#a365d946e0cf0fe8cfc8dbcb25cfbdad9">LED_Show</a>(); <a class="code hl_function" href="#ad269fd29299dd87118b408e4551f4d2d">DelayMS</a>(200);</div>
<div class="line"><span class="lineno">   62</span>        <a class="code hl_function" href="#a44347f62b4ee1789ecfed67b195572e4">LED_SetColor</a>(4, 0, 0, 0, 50); <a class="code hl_function" href="#a365d946e0cf0fe8cfc8dbcb25cfbdad9">LED_Show</a>(); <a class="code hl_function" href="#ad269fd29299dd87118b408e4551f4d2d">DelayMS</a>(200);</div>
<div class="line"><span class="lineno">   63</span>        <a class="code hl_function" href="#a44347f62b4ee1789ecfed67b195572e4">LED_SetColor</a>(4, 0, 0, 50, 0); <a class="code hl_function" href="#a365d946e0cf0fe8cfc8dbcb25cfbdad9">LED_Show</a>(); <a class="code hl_function" href="#ad269fd29299dd87118b408e4551f4d2d">DelayMS</a>(200);</div>
<div class="line"><span class="lineno">   64</span>        <a class="code hl_function" href="#a44347f62b4ee1789ecfed67b195572e4">LED_SetColor</a>(4, 0, 0, 0, 0);  <a class="code hl_function" href="#a365d946e0cf0fe8cfc8dbcb25cfbdad9">LED_Show</a>();</div>
<div class="line"><span class="lineno">   65</span>    }</div>
<div class="ttc" id="anamespace_hardware_html_a0745af097a6d21fc3fb1f1ebd9e141ff"><div class="ttname"><a href="#a0745af097a6d21fc3fb1f1ebd9e141ff">Hardware::PWM_Init</a></div><div class="ttdeci">void PWM_Init()</div><div class="ttdoc">Initialize PWM Timers for Motor Control.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00411">Hardware.cpp:411</a></div></div>
<div class="ttc" id="anamespace_hardware_html_a365d946e0cf0fe8cfc8dbcb25cfbdad9"><div class="ttname"><a href="#a365d946e0cf0fe8cfc8dbcb25cfbdad9">Hardware::LED_Show</a></div><div class="ttdeci">void LED_Show()</div><div class="ttdoc">Update LED Hardware.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00544">Hardware.cpp:544</a></div></div>
<div class="ttc" id="anamespace_hardware_html_a44347f62b4ee1789ecfed67b195572e4"><div class="ttname"><a href="#a44347f62b4ee1789ecfed67b195572e4">Hardware::LED_SetColor</a></div><div class="ttdeci">void LED_SetColor(uint8_t channel, int led_idx, uint8_t r, uint8_t g, uint8_t b)</div><div class="ttdoc">Set Color of a specific LED.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00530">Hardware.cpp:530</a></div></div>
<div class="ttc" id="anamespace_hardware_html_a87dd189117be2ce6e98135f024fd972c"><div class="ttname"><a href="#a87dd189117be2ce6e98135f024fd972c">Hardware::LED_Init</a></div><div class="ttdeci">void LED_Init()</div><div class="ttdoc">Initialize NeoPixel LEDs.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00515">Hardware.cpp:515</a></div></div>
<div class="ttc" id="anamespace_hardware_html_a8ab0dbadec2826235277f8152a80155d"><div class="ttname"><a href="#a8ab0dbadec2826235277f8152a80155d">Hardware::System_Init</a></div><div class="ttdeci">void System_Init()</div><div class="ttdoc">Configure System Clocks and Pin Remapping.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00084">Hardware.cpp:84</a></div></div>
<div class="ttc" id="anamespace_hardware_html_a90a0cffa2efcfb8d76bc12f9734ca623"><div class="ttname"><a href="#a90a0cffa2efcfb8d76bc12f9734ca623">Hardware::Watchdog_Disable</a></div><div class="ttdeci">void Watchdog_Disable()</div><div class="ttdoc">Disable the Window Watchdog.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00073">Hardware.cpp:73</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00317">ADC_Init()</a>, <a class="el" href="_hardware_8cpp_source.html#l00105">DelayMS()</a>, <a class="el" href="_hardware_8cpp_source.html#l00515">LED_Init()</a>, <a class="el" href="_hardware_8cpp_source.html#l00530">LED_SetColor()</a>, <a class="el" href="_hardware_8cpp_source.html#l00544">LED_Show()</a>, <a class="el" href="_hardware_8cpp_source.html#l00411">PWM_Init()</a>, <a class="el" href="_hardware_8cpp_source.html#l00084">System_Init()</a>, and <a class="el" href="_hardware_8cpp_source.html#l00073">Watchdog_Disable()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8cpp_source.html#l00013">setup()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a25837768e4f1568435bc6d889be37ba5_cgraph.png" border="0" usemap="#anamespace_hardware_a25837768e4f1568435bc6d889be37ba5_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a25837768e4f1568435bc6d889be37ba5_cgraph" id="anamespace_hardware_a25837768e4f1568435bc6d889be37ba5_cgraph">
<area shape="rect" title="Initialize minimal Hardware Base." alt="" coords="5,207,139,233"/>
<area shape="rect" href="namespace_hardware.html#a72bd28689a22ff9e3db6b911c020ecbb" title="Initialize the Analog&#45;to&#45;Digital Converter." alt="" coords="202,29,341,56"/>
<area shape="poly" title=" " alt="" coords="78,205,118,142,149,105,185,73,209,61,205,65,188,77,153,109,123,146,83,208"/>
<area shape="rect" href="namespace_hardware.html#ad269fd29299dd87118b408e4551f4d2d" title="Millisecond Delay." alt="" coords="404,55,543,81"/>
<area shape="poly" title=" " alt="" coords="82,205,124,160,153,136,185,116,236,96,289,82,391,69,386,72,290,88,238,101,188,121,156,140,128,164,86,208"/>
<area shape="rect" href="namespace_hardware.html#a87dd189117be2ce6e98135f024fd972c" title="Initialize NeoPixel LEDs." alt="" coords="203,131,340,157"/>
<area shape="poly" title=" " alt="" coords="100,204,186,167,208,161,204,164,188,172,103,208"/>
<area shape="rect" href="namespace_hardware.html#a44347f62b4ee1789ecfed67b195572e4" title="Set Color of a specific LED." alt="" coords="187,181,356,208"/>
<area shape="poly" title=" " alt="" coords="138,209,173,206,169,209,140,214"/>
<area shape="rect" href="namespace_hardware.html#a365d946e0cf0fe8cfc8dbcb25cfbdad9" title="Update LED Hardware." alt="" coords="196,232,347,259"/>
<area shape="poly" title=" " alt="" coords="138,226,183,232,178,235,140,231"/>
<area shape="rect" href="namespace_hardware.html#a0745af097a6d21fc3fb1f1ebd9e141ff" title="Initialize PWM Timers for Motor Control." alt="" coords="200,283,343,309"/>
<area shape="poly" title=" " alt="" coords="102,231,188,268,209,277,203,278,186,273,102,237"/>
<area shape="rect" href="namespace_hardware.html#a8ab0dbadec2826235277f8152a80155d" title="Configure System Clocks and Pin Remapping." alt="" coords="194,333,349,360"/>
<area shape="poly" title=" " alt="" coords="85,231,129,275,157,299,188,319,201,327,196,327,185,324,154,303,125,279,85,237"/>
<area shape="rect" href="namespace_hardware.html#a90a0cffa2efcfb8d76bc12f9734ca623" title="Disable the Window Watchdog." alt="" coords="200,384,343,427"/>
<area shape="poly" title=" " alt="" coords="81,231,122,297,152,336,188,370,195,376,189,375,185,374,148,340,118,300,79,236"/>
<area shape="poly" title=" " alt="" coords="237,29,231,21,236,11,249,5,271,3,295,5,309,13,304,15,294,10,271,8,251,10,239,15,237,20,242,29"/>
<area shape="poly" title=" " alt="" coords="341,49,391,56,386,58,342,54"/>
<area shape="rect" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157" title=" " alt="" coords="434,181,513,208"/>
<area shape="poly" title=" " alt="" coords="328,155,422,180,417,182,328,161"/>
<area shape="poly" title=" " alt="" coords="356,192,421,194,416,196,357,197"/>
<area shape="poly" title=" " alt="" coords="327,229,422,207,417,209,329,234"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a25837768e4f1568435bc6d889be37ba5_icgraph.png" border="0" usemap="#anamespace_hardware_a25837768e4f1568435bc6d889be37ba5_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a25837768e4f1568435bc6d889be37ba5_icgraph" id="anamespace_hardware_a25837768e4f1568435bc6d889be37ba5_icgraph">
<area shape="rect" title="Initialize minimal Hardware Base." alt="" coords="107,5,240,32"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="5,5,59,32"/>
<area shape="poly" title=" " alt="" coords="88,19,59,21,59,16,94,18"/>
</map>
</div>

</div>
</div>
<a id="a29ba54eb55c1b296fa35c18043ce9cb5" name="a29ba54eb55c1b296fa35c18043ce9cb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29ba54eb55c1b296fa35c18043ce9cb5">&#9670;&#160;</a></span>InitUART()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::InitUART </td>
          <td>(</td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>isKlipper</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize UART1 for Bus/Serial communication. </p>
<p>Configures PA9(TX), PA10(RX), PA12(DE).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">isKlipper</td><td>True for 250k baud standard serial. False for 1.25M baud 9-bit bus. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00140">140</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  140</span>                                  {</div>
<div class="line"><span class="lineno">  141</span>        GPIO_InitTypeDef GPIO_InitStructure = {0};</div>
<div class="line"><span class="lineno">  142</span>        USART_InitTypeDef USART_InitStructure = {0};</div>
<div class="line"><span class="lineno">  143</span>        NVIC_InitTypeDef NVIC_InitStructure = {0};</div>
<div class="line"><span class="lineno">  144</span> </div>
<div class="line"><span class="lineno">  145</span>        RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1, ENABLE);</div>
<div class="line"><span class="lineno">  146</span>        RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);</div>
<div class="line"><span class="lineno">  147</span>        RCC_AHBPeriphClockCmd(RCC_AHBPeriph_DMA1, ENABLE);</div>
<div class="line"><span class="lineno">  148</span> </div>
<div class="line"><span class="lineno">  149</span>        <span class="comment">/* USART1 TX--&gt;A.9   RX--&gt;A.10 */</span></div>
<div class="line"><span class="lineno">  150</span>        GPIO_InitStructure.GPIO_Pin = GPIO_Pin_9; <span class="comment">// TX</span></div>
<div class="line"><span class="lineno">  151</span>        GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</div>
<div class="line"><span class="lineno">  152</span>        GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;</div>
<div class="line"><span class="lineno">  153</span>        GPIO_Init(GPIOA, &amp;GPIO_InitStructure);</div>
<div class="line"><span class="lineno">  154</span>        GPIO_InitStructure.GPIO_Pin = GPIO_Pin_10; <span class="comment">// RX</span></div>
<div class="line"><span class="lineno">  155</span>        GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU;</div>
<div class="line"><span class="lineno">  156</span>        GPIO_Init(GPIOA, &amp;GPIO_InitStructure);</div>
<div class="line"><span class="lineno">  157</span>        GPIO_InitStructure.GPIO_Pin = GPIO_Pin_12; <span class="comment">// DE</span></div>
<div class="line"><span class="lineno">  158</span>        GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</div>
<div class="line"><span class="lineno">  159</span>        GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;</div>
<div class="line"><span class="lineno">  160</span>        GPIO_Init(GPIOA, &amp;GPIO_InitStructure);</div>
<div class="line"><span class="lineno">  161</span>        GPIOA-&gt;BCR = GPIO_Pin_12;</div>
<div class="line"><span class="lineno">  162</span> </div>
<div class="line"><span class="lineno">  163</span>        <span class="keywordflow">if</span> (isKlipper) {</div>
<div class="line"><span class="lineno">  164</span>            <span class="comment">// Standard/Klipper Mode</span></div>
<div class="line"><span class="lineno">  165</span>            USART_InitStructure.USART_BaudRate = 250000;</div>
<div class="line"><span class="lineno">  166</span>            USART_InitStructure.USART_Parity = USART_Parity_No;</div>
<div class="line"><span class="lineno">  167</span>            USART_InitStructure.USART_WordLength = USART_WordLength_8b;</div>
<div class="line"><span class="lineno">  168</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  169</span>            <span class="comment">// BambuBus Mode</span></div>
<div class="line"><span class="lineno">  170</span>            USART_InitStructure.USART_BaudRate = 1250000;</div>
<div class="line"><span class="lineno">  171</span>            USART_InitStructure.USART_Parity = USART_Parity_Even;</div>
<div class="line"><span class="lineno">  172</span>            USART_InitStructure.USART_WordLength = USART_WordLength_9b;</div>
<div class="line"><span class="lineno">  173</span>        }</div>
<div class="line"><span class="lineno">  174</span>        USART_InitStructure.USART_StopBits = USART_StopBits_1;</div>
<div class="line"><span class="lineno">  175</span>        USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None;</div>
<div class="line"><span class="lineno">  176</span>        USART_InitStructure.USART_Mode = USART_Mode_Tx | USART_Mode_Rx;</div>
<div class="line"><span class="lineno">  177</span> </div>
<div class="line"><span class="lineno">  178</span>        USART_Init(USART1, &amp;USART_InitStructure);</div>
<div class="line"><span class="lineno">  179</span>        USART_ITConfig(USART1, USART_IT_RXNE, ENABLE);</div>
<div class="line"><span class="lineno">  180</span>        USART_ITConfig(USART1, USART_IT_TC, ENABLE);</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>        NVIC_InitStructure.NVIC_IRQChannel = USART1_IRQn;</div>
<div class="line"><span class="lineno">  183</span>        NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0;</div>
<div class="line"><span class="lineno">  184</span>        NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;</div>
<div class="line"><span class="lineno">  185</span>        NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;</div>
<div class="line"><span class="lineno">  186</span>        NVIC_Init(&amp;NVIC_InitStructure);</div>
<div class="line"><span class="lineno">  187</span> </div>
<div class="line"><span class="lineno">  188</span>        <span class="comment">// Configure DMA1 channel 4 for USART1 TX</span></div>
<div class="line"><span class="lineno">  189</span>        <a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>.DMA_PeripheralBaseAddr = (uint32_t)&amp;USART1-&gt;DATAR;</div>
<div class="line"><span class="lineno">  190</span>        <a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>.DMA_MemoryBaseAddr = (uint32_t)0;</div>
<div class="line"><span class="lineno">  191</span>        <a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>.DMA_DIR = DMA_DIR_PeripheralDST;</div>
<div class="line"><span class="lineno">  192</span>        <a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>.DMA_Mode = DMA_Mode_Normal;</div>
<div class="line"><span class="lineno">  193</span>        <a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>.DMA_PeripheralInc = DMA_PeripheralInc_Disable;</div>
<div class="line"><span class="lineno">  194</span>        <a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>.DMA_MemoryInc = DMA_MemoryInc_Enable;</div>
<div class="line"><span class="lineno">  195</span>        <a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>.DMA_Priority = DMA_Priority_VeryHigh;</div>
<div class="line"><span class="lineno">  196</span>        <a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>.DMA_M2M = DMA_M2M_Disable;</div>
<div class="line"><span class="lineno">  197</span>        <a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>.DMA_MemoryDataSize = DMA_MemoryDataSize_Byte;</div>
<div class="line"><span class="lineno">  198</span>        <a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Byte;</div>
<div class="line"><span class="lineno">  199</span>        <a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>.DMA_BufferSize = 0;</div>
<div class="line"><span class="lineno">  200</span> </div>
<div class="line"><span class="lineno">  201</span>        USART_Cmd(USART1, ENABLE);</div>
<div class="line"><span class="lineno">  202</span>    }</div>
<div class="ttc" id="a_hardware_8cpp_html_ad017efbf3c102f3760d9747d90fad0a1"><div class="ttname"><a href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a></div><div class="ttdeci">DMA_InitTypeDef Bambubus_DMA_InitStructure</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00040">Hardware.cpp:40</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00040">Bambubus_DMA_InitStructure</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8cpp_source.html#l00013">setup()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a29ba54eb55c1b296fa35c18043ce9cb5_icgraph.png" border="0" usemap="#anamespace_hardware_a29ba54eb55c1b296fa35c18043ce9cb5_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a29ba54eb55c1b296fa35c18043ce9cb5_icgraph" id="anamespace_hardware_a29ba54eb55c1b296fa35c18043ce9cb5_icgraph">
<area shape="rect" title="Initialize UART1 for Bus/Serial communication." alt="" coords="107,5,246,32"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="5,5,59,32"/>
<area shape="poly" title=" " alt="" coords="88,19,59,21,59,16,94,18"/>
</map>
</div>

</div>
</div>
<a id="a87dd189117be2ce6e98135f024fd972c" name="a87dd189117be2ce6e98135f024fd972c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87dd189117be2ce6e98135f024fd972c">&#9670;&#160;</a></span>LED_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::LED_Init </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize NeoPixel LEDs. </p>
<p>Starts the <a class="el" href="class_adafruit___neo_pixel.html" title="Class that stores state and functions for interacting with Adafruit NeoPixels and compatible devices.">Adafruit_NeoPixel</a> instances for mainboard and channels. </p>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00515">515</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  515</span>                    {</div>
<div class="line"><span class="lineno">  516</span>        <a class="code hl_function" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157">strip_PD1</a>.begin();</div>
<div class="line"><span class="lineno">  517</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++) <a class="code hl_variable" href="_hardware_8cpp.html#affd50541a0d4a3f33b745b8cf818a968">strip_channel</a>[i].begin();</div>
<div class="line"><span class="lineno">  518</span>    }</div>
<div class="ttc" id="a_hardware_8cpp_html_a766f13b53e03456789fd4fe8e009e157"><div class="ttname"><a href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157">strip_PD1</a></div><div class="ttdeci">Adafruit_NeoPixel strip_PD1(LED_PD1_NUM, PD1, NEO_GRB+NEO_KHZ800)</div></div>
<div class="ttc" id="a_hardware_8cpp_html_affd50541a0d4a3f33b745b8cf818a968"><div class="ttname"><a href="_hardware_8cpp.html#affd50541a0d4a3f33b745b8cf818a968">strip_channel</a></div><div class="ttdeci">Adafruit_NeoPixel strip_channel[4]</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00019">Hardware.cpp:19</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00019">strip_channel</a>, and <a class="el" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157">strip_PD1()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_hardware_8cpp_source.html#l00052">InitBase()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a87dd189117be2ce6e98135f024fd972c_cgraph.png" border="0" usemap="#anamespace_hardware_a87dd189117be2ce6e98135f024fd972c_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a87dd189117be2ce6e98135f024fd972c_cgraph" id="anamespace_hardware_a87dd189117be2ce6e98135f024fd972c_cgraph">
<area shape="rect" title="Initialize NeoPixel LEDs." alt="" coords="5,5,142,32"/>
<area shape="rect" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157" title=" " alt="" coords="190,5,269,32"/>
<area shape="poly" title=" " alt="" coords="142,16,177,18,171,19,142,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a87dd189117be2ce6e98135f024fd972c_icgraph.png" border="0" usemap="#anamespace_hardware_a87dd189117be2ce6e98135f024fd972c_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a87dd189117be2ce6e98135f024fd972c_icgraph" id="anamespace_hardware_a87dd189117be2ce6e98135f024fd972c_icgraph">
<area shape="rect" title="Initialize NeoPixel LEDs." alt="" coords="288,5,424,32"/>
<area shape="rect" href="namespace_hardware.html#a25837768e4f1568435bc6d889be37ba5" title="Initialize minimal Hardware Base." alt="" coords="107,5,240,32"/>
<area shape="poly" title=" " alt="" coords="270,19,241,21,241,16,275,19"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="5,5,59,32"/>
<area shape="poly" title=" " alt="" coords="88,19,59,21,59,16,94,18"/>
</map>
</div>

</div>
</div>
<a id="aca1ef8aa807fb9291ad5d727697f427a" name="aca1ef8aa807fb9291ad5d727697f427a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca1ef8aa807fb9291ad5d727697f427a">&#9670;&#160;</a></span>LED_SetBrightness()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::LED_SetBrightness </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>brightness</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set Global Brightness for LEDs. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">brightness</td><td>Brightness (0-255, 0 uses defaults). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00555">555</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  555</span>                                               {</div>
<div class="line"><span class="lineno">  556</span>         <span class="comment">// This is global brightness scaling, usually we set it once.</span></div>
<div class="line"><span class="lineno">  557</span>         <span class="comment">// Original code had different brightness for PD1 (35) and channels (15).</span></div>
<div class="line"><span class="lineno">  558</span>         </div>
<div class="line"><span class="lineno">  559</span>         <span class="comment">// If this function is intended to set a global brightness level, it might need more logic</span></div>
<div class="line"><span class="lineno">  560</span>         <span class="comment">// or separate functions. For now let&#39;s reproduce original setup if brightness == 0 (init).</span></div>
<div class="line"><span class="lineno">  561</span>         </div>
<div class="line"><span class="lineno">  562</span>         <span class="comment">// Allow custom brightness</span></div>
<div class="line"><span class="lineno">  563</span>         <a class="code hl_function" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157">strip_PD1</a>.setBrightness(brightness &gt; 0 ? brightness : 35);</div>
<div class="line"><span class="lineno">  564</span>         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++) <a class="code hl_variable" href="_hardware_8cpp.html#affd50541a0d4a3f33b745b8cf818a968">strip_channel</a>[i].setBrightness(brightness &gt; 0 ? brightness : 15);</div>
<div class="line"><span class="lineno">  565</span>    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00019">strip_channel</a>, and <a class="el" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157">strip_PD1()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8cpp_source.html#l00013">setup()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_aca1ef8aa807fb9291ad5d727697f427a_cgraph.png" border="0" usemap="#anamespace_hardware_aca1ef8aa807fb9291ad5d727697f427a_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_aca1ef8aa807fb9291ad5d727697f427a_cgraph" id="anamespace_hardware_aca1ef8aa807fb9291ad5d727697f427a_cgraph">
<area shape="rect" title="Set Global Brightness for LEDs." alt="" coords="5,5,206,32"/>
<area shape="rect" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157" title=" " alt="" coords="254,5,333,32"/>
<area shape="poly" title=" " alt="" coords="206,16,241,19,235,19,206,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_aca1ef8aa807fb9291ad5d727697f427a_icgraph.png" border="0" usemap="#anamespace_hardware_aca1ef8aa807fb9291ad5d727697f427a_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_aca1ef8aa807fb9291ad5d727697f427a_icgraph" id="anamespace_hardware_aca1ef8aa807fb9291ad5d727697f427a_icgraph">
<area shape="rect" title="Set Global Brightness for LEDs." alt="" coords="107,5,307,32"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="5,5,59,32"/>
<area shape="poly" title=" " alt="" coords="88,19,59,21,59,16,94,18"/>
</map>
</div>

</div>
</div>
<a id="a44347f62b4ee1789ecfed67b195572e4" name="a44347f62b4ee1789ecfed67b195572e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44347f62b4ee1789ecfed67b195572e4">&#9670;&#160;</a></span>LED_SetColor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::LED_SetColor </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>channel</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>led_idx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>r</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>g</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>b</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set Color of a specific LED. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">channel</td><td>Channel (0-3) or Mainboard (4). </td></tr>
    <tr><td class="paramname">led_idx</td><td>Index of LED in the strip (0-1 typically). </td></tr>
    <tr><td class="paramname">r</td><td>Red (0-255). </td></tr>
    <tr><td class="paramname">g</td><td>Green (0-255). </td></tr>
    <tr><td class="paramname">b</td><td>Blue (0-255). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00530">530</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  530</span>                                                                                     {</div>
<div class="line"><span class="lineno">  531</span>        <span class="keywordflow">if</span> (channel &lt; 4) {</div>
<div class="line"><span class="lineno">  532</span>             <a class="code hl_variable" href="_hardware_8cpp.html#affd50541a0d4a3f33b745b8cf818a968">strip_channel</a>[channel].setPixelColor(led_idx, <a class="code hl_variable" href="_hardware_8cpp.html#affd50541a0d4a3f33b745b8cf818a968">strip_channel</a>[channel].Color(r, g, b));</div>
<div class="line"><span class="lineno">  533</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (channel == 4) { <span class="comment">// Mainboard</span></div>
<div class="line"><span class="lineno">  534</span>             <a class="code hl_function" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157">strip_PD1</a>.setPixelColor(led_idx, <a class="code hl_function" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157">strip_PD1</a>.Color(r, g, b));</div>
<div class="line"><span class="lineno">  535</span>        }</div>
<div class="line"><span class="lineno">  536</span>    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00019">strip_channel</a>, and <a class="el" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157">strip_PD1()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_hardware_8cpp_source.html#l00052">InitBase()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00962">ControlLogic::motor_motion_switch()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00751">ControlLogic::Prepare_For_filament_Pull_Back()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00792">ControlLogic::Run()</a>, and <a class="el" href="_control_logic_8cpp_source.html#l00501">ControlLogic::MotorChannel::UpdateLEDStatus()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a44347f62b4ee1789ecfed67b195572e4_cgraph.png" border="0" usemap="#anamespace_hardware_a44347f62b4ee1789ecfed67b195572e4_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a44347f62b4ee1789ecfed67b195572e4_cgraph" id="anamespace_hardware_a44347f62b4ee1789ecfed67b195572e4_cgraph">
<area shape="rect" title="Set Color of a specific LED." alt="" coords="5,5,175,32"/>
<area shape="rect" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157" title=" " alt="" coords="223,5,302,32"/>
<area shape="poly" title=" " alt="" coords="175,16,210,19,204,19,175,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a44347f62b4ee1789ecfed67b195572e4_icgraph.png" border="0" usemap="#anamespace_hardware_a44347f62b4ee1789ecfed67b195572e4_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a44347f62b4ee1789ecfed67b195572e4_icgraph" id="anamespace_hardware_a44347f62b4ee1789ecfed67b195572e4_icgraph">
<area shape="rect" title="Set Color of a specific LED." alt="" coords="989,123,1158,149"/>
<area shape="rect" href="namespace_hardware.html#a25837768e4f1568435bc6d889be37ba5" title="Initialize minimal Hardware Base." alt="" coords="783,5,916,32"/>
<area shape="poly" title=" " alt="" coords="1042,112,996,80,940,46,911,35,912,30,942,42,999,75,1047,113"/>
<area shape="rect" href="namespace_control_logic.html#ac2d890c891494072159ebc2b30490197" title="State Machine for BambuBus Logic." alt="" coords="782,56,917,99"/>
<area shape="poly" title=" " alt="" coords="1003,118,917,98,918,92,1008,118"/>
<area shape="rect" href="namespace_control_logic.html#adc8c269923e0c76c6d104a005833a7f9" title="Main Control Loop." alt="" coords="539,123,665,149"/>
<area shape="poly" title=" " alt="" coords="971,137,666,139,665,133,976,135"/>
<area shape="rect" href="namespace_control_logic.html#acb78560c64e5ea050853ab319a03f14e" title="Check if pullback is required (Smart Pullback Logic)." alt="" coords="766,173,932,216"/>
<area shape="poly" title=" " alt="" coords="1008,153,934,175,933,170,1003,154"/>
<area shape="rect" href="class_control_logic_1_1_motor_channel.html#ad27c212152e484b6090e53cc1da6928a" title="Update the Lane LED based on status." alt="" coords="758,240,941,283"/>
<area shape="poly" title=" " alt="" coords="1047,158,999,196,942,230,917,242,916,237,940,226,996,191,1042,160"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="575,5,629,32"/>
<area shape="poly" title=" " alt="" coords="765,19,629,21,629,16,770,18"/>
<area shape="poly" title=" " alt="" coords="764,98,662,125,661,119,769,96"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,123,446,149"/>
<area shape="poly" title=" " alt="" coords="520,137,447,139,446,133,526,135"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="将RAM中的像素数据传输到NeoPixels。" alt="" coords="188,123,353,149"/>
<area shape="poly" title=" " alt="" coords="383,137,354,139,353,133,388,135"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="释放Adafruit_NeoPixel对象，将数据引脚恢复为输入模式。" alt="" coords="5,115,140,157"/>
<area shape="poly" title=" " alt="" coords="170,137,141,139,139,133,175,135"/>
<area shape="poly" title=" " alt="" coords="748,171,661,153,662,147,754,171"/>
<area shape="rect" href="class_control_logic_1_1_motor_channel.html#ae060b9a23578fd44423bca5006418033" title="Main Motor Loop for this channel." alt="" coords="494,248,710,275"/>
<area shape="poly" title=" " alt="" coords="739,261,710,264,710,259,745,261"/>
</map>
</div>

</div>
</div>
<a id="a365d946e0cf0fe8cfc8dbcb25cfbdad9" name="a365d946e0cf0fe8cfc8dbcb25cfbdad9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a365d946e0cf0fe8cfc8dbcb25cfbdad9">&#9670;&#160;</a></span>LED_Show()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::LED_Show </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update LED <a class="el" href="namespace_hardware.html">Hardware</a>. </p>
<p>Pushes the memory buffer to the LED strips. </p>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00544">544</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  544</span>                    {</div>
<div class="line"><span class="lineno">  545</span>        <a class="code hl_function" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157">strip_PD1</a>.show();</div>
<div class="line"><span class="lineno">  546</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++) <a class="code hl_variable" href="_hardware_8cpp.html#affd50541a0d4a3f33b745b8cf818a968">strip_channel</a>[i].show();</div>
<div class="line"><span class="lineno">  547</span>    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00019">strip_channel</a>, and <a class="el" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157">strip_PD1()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_hardware_8cpp_source.html#l00052">InitBase()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00792">ControlLogic::Run()</a>, and <a class="el" href="main_8cpp_source.html#l00013">setup()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a365d946e0cf0fe8cfc8dbcb25cfbdad9_cgraph.png" border="0" usemap="#anamespace_hardware_a365d946e0cf0fe8cfc8dbcb25cfbdad9_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a365d946e0cf0fe8cfc8dbcb25cfbdad9_cgraph" id="anamespace_hardware_a365d946e0cf0fe8cfc8dbcb25cfbdad9_cgraph">
<area shape="rect" title="Update LED Hardware." alt="" coords="5,5,157,32"/>
<area shape="rect" href="_hardware_8cpp.html#a766f13b53e03456789fd4fe8e009e157" title=" " alt="" coords="205,5,284,32"/>
<area shape="poly" title=" " alt="" coords="157,16,192,19,187,19,157,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a365d946e0cf0fe8cfc8dbcb25cfbdad9_icgraph.png" border="0" usemap="#anamespace_hardware_a365d946e0cf0fe8cfc8dbcb25cfbdad9_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a365d946e0cf0fe8cfc8dbcb25cfbdad9_icgraph" id="anamespace_hardware_a365d946e0cf0fe8cfc8dbcb25cfbdad9_icgraph">
<area shape="rect" title="Update LED Hardware." alt="" coords="684,56,835,83"/>
<area shape="rect" href="namespace_hardware.html#a25837768e4f1568435bc6d889be37ba5" title="Initialize minimal Hardware Base." alt="" coords="502,5,636,32"/>
<area shape="poly" title=" " alt="" coords="689,51,622,35,622,30,694,51"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="401,31,454,57"/>
<area shape="poly" title=" " alt="" coords="666,63,455,49,455,43,671,62"/>
<area shape="rect" href="namespace_control_logic.html#adc8c269923e0c76c6d104a005833a7f9" title="Main Control Loop." alt="" coords="506,107,632,133"/>
<area shape="poly" title=" " alt="" coords="694,87,622,109,621,103,689,88"/>
<area shape="poly" title=" " alt="" coords="484,34,455,42,454,37,490,33"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="405,107,450,133"/>
<area shape="poly" title=" " alt="" coords="487,120,451,123,451,117,493,120"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="将RAM中的像素数据传输到NeoPixels。" alt="" coords="188,107,353,133"/>
<area shape="poly" title=" " alt="" coords="387,120,353,123,353,117,392,120"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="释放Adafruit_NeoPixel对象，将数据引脚恢复为输入模式。" alt="" coords="5,99,140,141"/>
<area shape="poly" title=" " alt="" coords="170,120,140,123,140,117,175,120"/>
</map>
</div>

</div>
</div>
<a id="a0745af097a6d21fc3fb1f1ebd9e141ff" name="a0745af097a6d21fc3fb1f1ebd9e141ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0745af097a6d21fc3fb1f1ebd9e141ff">&#9670;&#160;</a></span>PWM_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::PWM_Init </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize PWM Timers for Motor Control. </p>
<p>Configures TIM2, TIM3, TIM4 channels for motor driver control pins. Remaps pins as necessary. </p>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00411">411</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  411</span>                    {</div>
<div class="line"><span class="lineno">  412</span>        GPIO_InitTypeDef GPIO_InitStructure;</div>
<div class="line"><span class="lineno">  413</span>        RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA | RCC_APB2Periph_GPIOB, ENABLE);</div>
<div class="line"><span class="lineno">  414</span>        GPIO_InitStructure.GPIO_Pin = GPIO_Pin_3 | GPIO_Pin_4 | GPIO_Pin_5 |</div>
<div class="line"><span class="lineno">  415</span>                                      GPIO_Pin_6 | GPIO_Pin_7 | GPIO_Pin_8 | GPIO_Pin_9;</div>
<div class="line"><span class="lineno">  416</span>        GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;</div>
<div class="line"><span class="lineno">  417</span>        GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</div>
<div class="line"><span class="lineno">  418</span>        GPIO_Init(GPIOB, &amp;GPIO_InitStructure);</div>
<div class="line"><span class="lineno">  419</span>        GPIO_InitStructure.GPIO_Pin = GPIO_Pin_15;</div>
<div class="line"><span class="lineno">  420</span>        GPIO_Init(GPIOA, &amp;GPIO_InitStructure);</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>        RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO, ENABLE);</div>
<div class="line"><span class="lineno">  423</span>        RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2, ENABLE);</div>
<div class="line"><span class="lineno">  424</span>        RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM3, ENABLE);</div>
<div class="line"><span class="lineno">  425</span>        RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM4, ENABLE);</div>
<div class="line"><span class="lineno">  426</span> </div>
<div class="line"><span class="lineno">  427</span>        <span class="comment">// Remap Pins for Motor Control</span></div>
<div class="line"><span class="lineno">  428</span>        GPIO_PinRemapConfig(GPIO_FullRemap_TIM2, ENABLE);    <span class="comment">// TIM2 CH1/CH2 -&gt; PA15/PB3</span></div>
<div class="line"><span class="lineno">  429</span>        GPIO_PinRemapConfig(GPIO_PartialRemap_TIM3, ENABLE); <span class="comment">// TIM3 CH1/CH2 -&gt; PB4/PB5</span></div>
<div class="line"><span class="lineno">  430</span> </div>
<div class="line"><span class="lineno">  431</span>        TIM_TimeBaseInitTypeDef TIM_TimeBaseStructure;</div>
<div class="line"><span class="lineno">  432</span>        TIM_OCInitTypeDef TIM_OCInitStructure;</div>
<div class="line"><span class="lineno">  433</span> </div>
<div class="line"><span class="lineno">  434</span>        TIM_TimeBaseStructure.TIM_Period = 999;</div>
<div class="line"><span class="lineno">  435</span>        TIM_TimeBaseStructure.TIM_Prescaler = 1;</div>
<div class="line"><span class="lineno">  436</span>        TIM_TimeBaseStructure.TIM_ClockDivision = 0;</div>
<div class="line"><span class="lineno">  437</span>        TIM_TimeBaseStructure.TIM_CounterMode = TIM_CounterMode_Up;</div>
<div class="line"><span class="lineno">  438</span>        TIM_TimeBaseInit(TIM2, &amp;TIM_TimeBaseStructure);</div>
<div class="line"><span class="lineno">  439</span>        TIM_TimeBaseInit(TIM3, &amp;TIM_TimeBaseStructure);</div>
<div class="line"><span class="lineno">  440</span>        TIM_TimeBaseInit(TIM4, &amp;TIM_TimeBaseStructure);</div>
<div class="line"><span class="lineno">  441</span> </div>
<div class="line"><span class="lineno">  442</span>        TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;</div>
<div class="line"><span class="lineno">  443</span>        TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;</div>
<div class="line"><span class="lineno">  444</span>        TIM_OCInitStructure.TIM_Pulse = 0;</div>
<div class="line"><span class="lineno">  445</span>        TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_High;</div>
<div class="line"><span class="lineno">  446</span>        TIM_OC1Init(TIM2, &amp;TIM_OCInitStructure);</div>
<div class="line"><span class="lineno">  447</span>        TIM_OC2Init(TIM2, &amp;TIM_OCInitStructure);</div>
<div class="line"><span class="lineno">  448</span>        TIM_OC1Init(TIM3, &amp;TIM_OCInitStructure);</div>
<div class="line"><span class="lineno">  449</span>        TIM_OC2Init(TIM3, &amp;TIM_OCInitStructure);</div>
<div class="line"><span class="lineno">  450</span>        TIM_OC3Init(TIM4, &amp;TIM_OCInitStructure); <span class="comment">// Note: Original looked like OC1/2 for TIM4 too? Let&#39;s check Motion_control.cpp.</span></div>
<div class="line"><span class="lineno">  451</span>        <span class="comment">// Motion_control.cpp: case 1: TIM_SetCompare1(TIM4, set1); ... case 0: TIM_SetCompare3(TIM4, set1); TIM_SetCompare4(TIM4, set2);</span></div>
<div class="line"><span class="lineno">  452</span>        <span class="comment">// So TIM4 uses Ch1, Ch2, Ch3, Ch4.</span></div>
<div class="line"><span class="lineno">  453</span>        </div>
<div class="line"><span class="lineno">  454</span>        <span class="comment">// Re-checking Motion_control.cpp lines 440+:</span></div>
<div class="line"><span class="lineno">  455</span>        <span class="comment">// Case 3: TIM2 Ch1/Ch2 (PA15 / PB3? Remap dependent?)</span></div>
<div class="line"><span class="lineno">  456</span>        <span class="comment">// Case 2: TIM3 Ch1/Ch2 (PB4 / PB5?)</span></div>
<div class="line"><span class="lineno">  457</span>        <span class="comment">// Case 1: TIM4 Ch1/Ch2 (PB6 / PB7)</span></div>
<div class="line"><span class="lineno">  458</span>        <span class="comment">// Case 0: TIM4 Ch3/Ch4 (PB8 / PB9)</span></div>
<div class="line"><span class="lineno">  459</span>        </div>
<div class="line"><span class="lineno">  460</span>        <span class="comment">// So we need to init all those channels.</span></div>
<div class="line"><span class="lineno">  461</span>        TIM_OC1Init(TIM4, &amp;TIM_OCInitStructure);</div>
<div class="line"><span class="lineno">  462</span>        TIM_OC2Init(TIM4, &amp;TIM_OCInitStructure);</div>
<div class="line"><span class="lineno">  463</span>        TIM_OC3Init(TIM4, &amp;TIM_OCInitStructure);</div>
<div class="line"><span class="lineno">  464</span>        TIM_OC4Init(TIM4, &amp;TIM_OCInitStructure);</div>
<div class="line"><span class="lineno">  465</span> </div>
<div class="line"><span class="lineno">  466</span>        TIM_Cmd(TIM2, ENABLE);</div>
<div class="line"><span class="lineno">  467</span>        TIM_Cmd(TIM3, ENABLE);</div>
<div class="line"><span class="lineno">  468</span>        TIM_Cmd(TIM4, ENABLE);</div>
<div class="line"><span class="lineno">  469</span>    }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00870">ControlLogic::Init()</a>, and <a class="el" href="_hardware_8cpp_source.html#l00052">InitBase()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a0745af097a6d21fc3fb1f1ebd9e141ff_icgraph.png" border="0" usemap="#anamespace_hardware_a0745af097a6d21fc3fb1f1ebd9e141ff_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a0745af097a6d21fc3fb1f1ebd9e141ff_icgraph" id="anamespace_hardware_a0745af097a6d21fc3fb1f1ebd9e141ff_icgraph">
<area shape="rect" title="Initialize PWM Timers for Motor Control." alt="" coords="386,47,529,73"/>
<area shape="rect" href="namespace_control_logic.html#a1da226a05b7a8c46e16a840900265c03" title="Initialize ControlLogic." alt="" coords="211,21,332,48"/>
<area shape="poly" title=" " alt="" coords="368,48,332,46,332,40,374,48"/>
<area shape="rect" href="namespace_hardware.html#a25837768e4f1568435bc6d889be37ba5" title="Initialize minimal Hardware Base." alt="" coords="205,72,338,99"/>
<area shape="poly" title=" " alt="" coords="373,72,339,79,338,74,368,72"/>
<area shape="rect" href="class_control_logic_1_1_m_o_t_o_r___p_i_d.html#a9edc970b22d74b15904b4929d862cc07" title=" " alt="" coords="5,5,157,48"/>
<area shape="poly" title=" " alt="" coords="193,32,157,33,157,27,198,31"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="54,72,108,99"/>
<area shape="poly" title=" " alt="" coords="206,53,109,81,107,76,201,52"/>
<area shape="poly" title=" " alt="" coords="187,86,108,88,108,83,192,85"/>
</map>
</div>

</div>
</div>
<a id="af8a83d19b30aeb46530bd36c63b3fab7" name="af8a83d19b30aeb46530bd36c63b3fab7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8a83d19b30aeb46530bd36c63b3fab7">&#9670;&#160;</a></span>PWM_Set()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::PWM_Set </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>channel</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>PWM</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set PWM duty cycle for a Motor Channel. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">channel</td><td>Motor Channel (0-3). </td></tr>
    <tr><td class="paramname">PWM</td><td>Value (-1000 to 1000). Positive for one direction, negative for other. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00478">478</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  478</span>                                           {</div>
<div class="line"><span class="lineno">  479</span>        uint16_t set1 = 0, set2 = 0;</div>
<div class="line"><span class="lineno">  480</span>        <span class="keywordflow">if</span> (PWM &gt; 0) {</div>
<div class="line"><span class="lineno">  481</span>            set1 = PWM;</div>
<div class="line"><span class="lineno">  482</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PWM &lt; 0) {</div>
<div class="line"><span class="lineno">  483</span>            set2 = -PWM;</div>
<div class="line"><span class="lineno">  484</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  485</span>            set1 = 1000;</div>
<div class="line"><span class="lineno">  486</span>            set2 = 1000;</div>
<div class="line"><span class="lineno">  487</span>        }</div>
<div class="line"><span class="lineno">  488</span>        <span class="keywordflow">switch</span> (channel) {</div>
<div class="line"><span class="lineno">  489</span>        <span class="keywordflow">case</span> 3:</div>
<div class="line"><span class="lineno">  490</span>            TIM_SetCompare1(TIM2, set1);</div>
<div class="line"><span class="lineno">  491</span>            TIM_SetCompare2(TIM2, set2);</div>
<div class="line"><span class="lineno">  492</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  493</span>        <span class="keywordflow">case</span> 2:</div>
<div class="line"><span class="lineno">  494</span>            TIM_SetCompare1(TIM3, set1);</div>
<div class="line"><span class="lineno">  495</span>            TIM_SetCompare2(TIM3, set2);</div>
<div class="line"><span class="lineno">  496</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  497</span>        <span class="keywordflow">case</span> 1:</div>
<div class="line"><span class="lineno">  498</span>            TIM_SetCompare1(TIM4, set1);</div>
<div class="line"><span class="lineno">  499</span>            TIM_SetCompare2(TIM4, set2);</div>
<div class="line"><span class="lineno">  500</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  501</span>        <span class="keywordflow">case</span> 0:</div>
<div class="line"><span class="lineno">  502</span>            TIM_SetCompare3(TIM4, set1);</div>
<div class="line"><span class="lineno">  503</span>            TIM_SetCompare4(TIM4, set2);</div>
<div class="line"><span class="lineno">  504</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  505</span>        }</div>
<div class="line"><span class="lineno">  506</span>    }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_control_logic_8cpp_source.html#l00398">ControlLogic::MotorChannel::Run()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_af8a83d19b30aeb46530bd36c63b3fab7_icgraph.png" border="0" usemap="#anamespace_hardware_af8a83d19b30aeb46530bd36c63b3fab7_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_af8a83d19b30aeb46530bd36c63b3fab7_icgraph" id="anamespace_hardware_af8a83d19b30aeb46530bd36c63b3fab7_icgraph">
<area shape="rect" title="Set PWM duty cycle for a Motor Channel." alt="" coords="269,5,414,32"/>
<area shape="rect" href="class_control_logic_1_1_motor_channel.html#ae060b9a23578fd44423bca5006418033" title="Main Motor Loop for this channel." alt="" coords="5,5,221,32"/>
<area shape="poly" title=" " alt="" coords="251,19,221,21,221,16,256,19"/>
</map>
</div>

</div>
</div>
<a id="a8ab0dbadec2826235277f8152a80155d" name="a8ab0dbadec2826235277f8152a80155d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ab0dbadec2826235277f8152a80155d">&#9670;&#160;</a></span>System_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::System_Init </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configure System Clocks and Pin Remapping. </p>
<p>Enables AFIO and sets PD0/PD1 remapping for HSE/LSE reuse if needed. </p>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00084">84</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   84</span>                       {</div>
<div class="line"><span class="lineno">   85</span>        RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO, ENABLE);</div>
<div class="line"><span class="lineno">   86</span>        GPIO_PinRemapConfig(GPIO_Remap_PD01, ENABLE);</div>
<div class="line"><span class="lineno">   87</span>    }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_hardware_8cpp_source.html#l00052">InitBase()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a8ab0dbadec2826235277f8152a80155d_icgraph.png" border="0" usemap="#anamespace_hardware_a8ab0dbadec2826235277f8152a80155d_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a8ab0dbadec2826235277f8152a80155d_icgraph" id="anamespace_hardware_a8ab0dbadec2826235277f8152a80155d_icgraph">
<area shape="rect" title="Configure System Clocks and Pin Remapping." alt="" coords="288,5,443,32"/>
<area shape="rect" href="namespace_hardware.html#a25837768e4f1568435bc6d889be37ba5" title="Initialize minimal Hardware Base." alt="" coords="107,5,240,32"/>
<area shape="poly" title=" " alt="" coords="270,19,241,21,241,16,275,19"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="5,5,59,32"/>
<area shape="poly" title=" " alt="" coords="88,19,59,21,59,16,94,18"/>
</map>
</div>

</div>
</div>
<a id="ad3ec7cad074d6d73508844a06a7bea50" name="ad3ec7cad074d6d73508844a06a7bea50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3ec7cad074d6d73508844a06a7bea50">&#9670;&#160;</a></span>UART_Send()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::UART_Send </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *</td>          <td class="paramname"><span class="paramname"><em>data</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a buffer via UART1. </p>
<dl class="section note"><dt>Note</dt><dd>If STANDARD_SERIAL is defined, uses blocking send. If not (BambuBus mode), uses DMA for high speed transfer.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Pointer to data. </td></tr>
    <tr><td class="paramname">length</td><td>Length of data. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00261">261</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  261</span>                                                         {</div>
<div class="line"><span class="lineno">  262</span><span class="preprocessor">#if defined(STANDARD_SERIAL)</span></div>
<div class="line"><span class="lineno">  263</span>        <span class="comment">// Blocking mode for CLI interactivity (safe with ISR echo)</span></div>
<div class="line"><span class="lineno">  264</span>        </div>
<div class="line"><span class="lineno">  265</span>        <span class="comment">// Disable TC interrupt to prevent ISR from disabling DE prematurely</span></div>
<div class="line"><span class="lineno">  266</span>        USART_ITConfig(USART1, USART_IT_TC, DISABLE);</div>
<div class="line"><span class="lineno">  267</span>        </div>
<div class="line"><span class="lineno">  268</span>        GPIOA-&gt;BSHR = GPIO_Pin_12; <span class="comment">// Set High (TX) for RS485</span></div>
<div class="line"><span class="lineno">  269</span>        <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; length; i++) {</div>
<div class="line"><span class="lineno">  270</span>             <a class="code hl_function" href="#aaaf02ef3df5811e2ba28dd009eadfaae">UART_SendByte</a>(data[i]);</div>
<div class="line"><span class="lineno">  271</span>        }</div>
<div class="line"><span class="lineno">  272</span>        </div>
<div class="line"><span class="lineno">  273</span>        <span class="comment">// Re-enable TC interrupt so ISR can disable DE when the *last byte* is actually done</span></div>
<div class="line"><span class="lineno">  274</span>        USART_ITConfig(USART1, USART_IT_TC, ENABLE);</div>
<div class="line"><span class="lineno">  275</span>        </div>
<div class="line"><span class="lineno">  276</span>        <span class="comment">// ISR handles DE pin Disable on TC interrupt.</span></div>
<div class="line"><span class="lineno">  277</span> </div>
<div class="line"><span class="lineno">  278</span> </div>
<div class="line"><span class="lineno">  279</span>        </div>
<div class="line"><span class="lineno">  280</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  281</span>        <span class="comment">// DMA mode for High Speed Bus (BambuBus)</span></div>
<div class="line"><span class="lineno">  282</span>        </div>
<div class="line"><span class="lineno">  283</span>        <span class="comment">// Check if DMA is currently enabled (transfer active)</span></div>
<div class="line"><span class="lineno">  284</span>        <span class="keywordflow">if</span> (DMA1_Channel4-&gt;CFGR &amp; 0x01) {</div>
<div class="line"><span class="lineno">  285</span>             <span class="comment">// Wait for data transfer to complete</span></div>
<div class="line"><span class="lineno">  286</span>             uint32_t timeout = 100000;</div>
<div class="line"><span class="lineno">  287</span>             <span class="keywordflow">while</span> (DMA_GetCurrDataCounter(DMA1_Channel4) != 0 &amp;&amp; timeout--) {</div>
<div class="line"><span class="lineno">  288</span>                 <a class="code hl_function" href="#a0ada30189b8e1d1dbec145140849b778">DelayUS</a>(1);</div>
<div class="line"><span class="lineno">  289</span>             }</div>
<div class="line"><span class="lineno">  290</span>             <span class="comment">// Ensure Transmission Complete flag is set (buffer clear)</span></div>
<div class="line"><span class="lineno">  291</span>             timeout = 100000;</div>
<div class="line"><span class="lineno">  292</span>             <span class="keywordflow">while</span> (USART_GetFlagStatus(USART1, USART_FLAG_TC) == RESET &amp;&amp; timeout--) {</div>
<div class="line"><span class="lineno">  293</span>                 <a class="code hl_function" href="#a0ada30189b8e1d1dbec145140849b778">DelayUS</a>(1);</div>
<div class="line"><span class="lineno">  294</span>             }</div>
<div class="line"><span class="lineno">  295</span>             <span class="comment">// Create a small gap or ensure Disable is clean</span></div>
<div class="line"><span class="lineno">  296</span>             DMA_Cmd(DMA1_Channel4, DISABLE);</div>
<div class="line"><span class="lineno">  297</span>        }</div>
<div class="line"><span class="lineno">  298</span> </div>
<div class="line"><span class="lineno">  299</span>        DMA_DeInit(DMA1_Channel4);</div>
<div class="line"><span class="lineno">  300</span>        <a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>.DMA_MemoryBaseAddr = (uint32_t)data;</div>
<div class="line"><span class="lineno">  301</span>        <a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>.DMA_BufferSize = length;</div>
<div class="line"><span class="lineno">  302</span>        DMA_Init(DMA1_Channel4, &amp;<a class="code hl_variable" href="_hardware_8cpp.html#ad017efbf3c102f3760d9747d90fad0a1">Bambubus_DMA_InitStructure</a>);</div>
<div class="line"><span class="lineno">  303</span>        DMA_Cmd(DMA1_Channel4, ENABLE);</div>
<div class="line"><span class="lineno">  304</span>        GPIOA-&gt;BSHR = GPIO_Pin_12;</div>
<div class="line"><span class="lineno">  305</span>        USART_DMACmd(USART1, USART_DMAReq_Tx, ENABLE);</div>
<div class="line"><span class="lineno">  306</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  307</span>    }</div>
<div class="ttc" id="anamespace_hardware_html_a0ada30189b8e1d1dbec145140849b778"><div class="ttname"><a href="#a0ada30189b8e1d1dbec145140849b778">Hardware::DelayUS</a></div><div class="ttdeci">void DelayUS(uint32_t time)</div><div class="ttdoc">Microsecond Delay.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00095">Hardware.cpp:95</a></div></div>
<div class="ttc" id="anamespace_hardware_html_aaaf02ef3df5811e2ba28dd009eadfaae"><div class="ttname"><a href="#aaaf02ef3df5811e2ba28dd009eadfaae">Hardware::UART_SendByte</a></div><div class="ttdeci">void UART_SendByte(uint8_t data)</div><div class="ttdoc">Send a single byte blocking.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00243">Hardware.cpp:243</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00040">Bambubus_DMA_InitStructure</a>, <a class="el" href="_hardware_8cpp_source.html#l00095">DelayUS()</a>, and <a class="el" href="_hardware_8cpp_source.html#l00243">UART_SendByte()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_klipper_c_l_i_8cpp_source.html#l00305">KlipperCLI::HandleGetFilamentInfo()</a>, <a class="el" href="_klipper_c_l_i_8cpp_source.html#l00111">KlipperCLI::HandleStatus()</a>, <a class="el" href="_klipper_c_l_i_8cpp_source.html#l00439">KlipperCLI::Init()</a>, <a class="el" href="_control_logic_8cpp_source.html#l00962">ControlLogic::motor_motion_switch()</a>, <a class="el" href="_klipper_c_l_i_8cpp_source.html#l00400">KlipperCLI::ProcessPacket()</a>, <a class="el" href="_command_router_8cpp_source.html#l00234">CommandRouter::SendPacket()</a>, and <a class="el" href="_klipper_c_l_i_8cpp_source.html#l00035">KlipperCLI::SendResponse()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_ad3ec7cad074d6d73508844a06a7bea50_cgraph.png" border="0" usemap="#anamespace_hardware_ad3ec7cad074d6d73508844a06a7bea50_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_ad3ec7cad074d6d73508844a06a7bea50_cgraph" id="anamespace_hardware_ad3ec7cad074d6d73508844a06a7bea50_cgraph">
<area shape="rect" title="Send a buffer via UART1." alt="" coords="5,5,164,32"/>
<area shape="rect" href="namespace_hardware.html#a0ada30189b8e1d1dbec145140849b778" title="Microsecond Delay." alt="" coords="445,5,583,32"/>
<area shape="poly" title=" " alt="" coords="164,16,430,16,429,21,164,21"/>
<area shape="rect" href="namespace_hardware.html#aaaf02ef3df5811e2ba28dd009eadfaae" title="Send a single byte blocking." alt="" coords="212,31,397,57"/>
<area shape="poly" title=" " alt="" coords="164,25,199,31,193,32,164,30"/>
<area shape="poly" title=" " alt="" coords="397,30,427,29,433,29,397,35"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_ad3ec7cad074d6d73508844a06a7bea50_icgraph.png" border="0" usemap="#anamespace_hardware_ad3ec7cad074d6d73508844a06a7bea50_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_ad3ec7cad074d6d73508844a06a7bea50_icgraph" id="anamespace_hardware_ad3ec7cad074d6d73508844a06a7bea50_icgraph">
<area shape="rect" title="Send a buffer via UART1." alt="" coords="1852,285,2011,312"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afeb304003d4b85010afd5e183e1bbf16" title="Handler for GET_FILAMENT_INFO command." alt="" coords="1084,158,1309,185"/>
<area shape="poly" title=" " alt="" coords="1872,280,1731,239,1644,217,1557,200,1429,184,1310,177,1309,171,1429,179,1557,194,1646,212,1733,234,1878,280"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a6089e6db2e7edddf19fdf095b9826c88" title="Parse and Dispatch a JSON Packet." alt="" coords="857,285,1036,312"/>
<area shape="poly" title=" " alt="" coords="1921,269,1907,225,1883,171,1849,116,1827,93,1803,73,1771,54,1742,43,1715,38,1688,38,1629,42,1557,44,1483,37,1419,27,1308,10,1257,9,1204,17,1148,36,1086,70,1057,92,1032,120,1011,150,993,181,968,241,954,286,949,283,963,240,989,179,1007,147,1028,116,1054,88,1083,65,1146,31,1203,11,1256,4,1309,5,1420,21,1484,31,1557,38,1629,37,1688,32,1715,33,1743,38,1773,49,1806,68,1831,89,1853,113,1888,168,1912,224,1926,271"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a8f239072c1896e64e9f6075edaaea515" title="Handler for STATUS command." alt="" coords="1620,82,1789,109"/>
<area shape="poly" title=" " alt="" coords="1909,272,1864,216,1803,155,1768,131,1735,112,1736,107,1771,126,1806,151,1868,213,1914,273"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a5498861593ca8083d7be1d71c8373f29" title="Initialize Klipper CLI." alt="" coords="1650,521,1759,548"/>
<area shape="poly" title=" " alt="" coords="1916,323,1869,392,1806,464,1767,497,1730,523,1727,518,1764,493,1802,460,1865,388,1911,326"/>
<area shape="rect" href="namespace_control_logic.html#ac2d890c891494072159ebc2b30490197" title="State Machine for BambuBus Logic." alt="" coords="1637,408,1772,450"/>
<area shape="poly" title=" " alt="" coords="1896,319,1745,410,1743,405,1891,321"/>
<area shape="rect" href="namespace_command_router.html#a1cf14aabb538f71f140e6b1aa7ef965d" title="Send a raw data packet via UART." alt="" coords="1605,706,1804,733"/>
<area shape="poly" title=" " alt="" coords="1920,324,1873,431,1807,561,1757,645,1717,708,1714,704,1753,642,1802,558,1868,428,1916,327"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a9ec392d53485800126189969c2c4981a" title="Serialize and send a JSON response." alt="" coords="1615,285,1794,312"/>
<area shape="poly" title=" " alt="" coords="1834,299,1795,301,1794,296,1839,298"/>
<area shape="poly" title=" " alt="" coords="1117,191,1086,206,1017,247,966,287,963,282,1014,243,1083,201,1121,189"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afe96c8a3898aa7a50f68ab6d726860c3" title="Main Execution Loop." alt="" coords="695,324,809,350"/>
<area shape="poly" title=" " alt="" coords="859,316,810,328,808,323,864,314"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,349,647,376"/>
<area shape="poly" title=" " alt="" coords="677,348,648,354,646,349,682,346"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,425,446,452"/>
<area shape="poly" title=" " alt="" coords="527,385,448,429,445,425,531,382"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="将RAM中的像素数据传输到NeoPixels。" alt="" coords="188,425,353,452"/>
<area shape="poly" title=" " alt="" coords="383,440,354,441,352,436,388,437"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="释放Adafruit_NeoPixel对象，将数据引脚恢复为输入模式。" alt="" coords="5,417,140,460"/>
<area shape="poly" title=" " alt="" coords="170,440,141,441,138,436,174,437"/>
<area shape="poly" title=" " alt="" coords="1627,79,1518,64,1451,58,1378,56,1303,60,1228,70,1155,89,1086,118,1060,134,1037,155,999,202,972,250,955,286,951,283,967,247,995,199,1033,151,1057,130,1083,113,1153,84,1227,65,1303,54,1378,51,1451,53,1519,59,1633,78"/>
<area shape="rect" href="namespace_command_router.html#a652cfc164ac7a2a2c016da37f341c42e" title="Initialize the Command Router and CLI subsystems." alt="" coords="1384,614,1530,641"/>
<area shape="poly" title=" " alt="" coords="1661,554,1558,598,1504,616,1503,611,1556,593,1656,555"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="1170,614,1223,641"/>
<area shape="poly" title=" " alt="" coords="1366,628,1224,630,1223,625,1371,627"/>
<area shape="rect" href="namespace_control_logic.html#adc8c269923e0c76c6d104a005833a7f9" title="Main Control Loop." alt="" coords="884,552,1010,578"/>
<area shape="poly" title=" " alt="" coords="1638,456,1488,510,1399,535,1309,554,1229,565,1148,570,1011,570,1010,565,1148,564,1228,559,1308,549,1398,530,1486,505,1632,457"/>
<area shape="poly" title=" " alt="" coords="871,549,446,446,447,441,876,546"/>
<area shape="rect" href="namespace_control_logic.html#a8880b393facb6828519b8dac8e96393c" title="Core logic for processing Short Motion packets." alt="" coords="1362,665,1552,708"/>
<area shape="poly" title=" " alt="" coords="1587,704,1552,702,1552,696,1593,704"/>
<area shape="rect" href="namespace_control_logic.html#a412a7a597ff3c04c0ea1480094600ef4" title="Handler for Online Detect (0x05)." alt="" coords="1363,732,1550,774"/>
<area shape="poly" title=" " alt="" coords="1592,735,1551,743,1551,738,1587,735"/>
<area shape="rect" href="namespace_control_logic.html#a82b9a1fb120cd91615d2ac478daafefd" title="Handler for REQx6 (0x06)." alt="" coords="1360,798,1554,825"/>
<area shape="poly" title=" " alt="" coords="1666,740,1614,766,1558,789,1520,800,1519,795,1556,784,1612,761,1661,741"/>
<area shape="rect" href="namespace_control_logic.html#a5f85db884abd1a66d8b120729ec0d99e" title="Handler for Filament Motion Short packet (0x03)." alt="" coords="1102,665,1291,708"/>
<area shape="poly" title=" " alt="" coords="1344,687,1292,689,1291,684,1349,686"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#ae13dcd8cc2528c12d0a241046fcc304e" title="Handler for GET_SENSORS command." alt="" coords="1357,260,1557,286"/>
<area shape="poly" title=" " alt="" coords="1597,288,1558,286,1557,281,1602,287"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a81f1646e6adb42482d4109a33b9bb9c5" title="Handler for PING command." alt="" coords="1378,209,1536,236"/>
<area shape="poly" title=" " alt="" coords="1649,279,1556,250,1516,239,1516,234,1558,245,1654,279"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#ad0e99d2fdcfd1c0690f850816ac1f67c" title="Helper to send an Error response." alt="" coords="1383,310,1531,337"/>
<area shape="poly" title=" " alt="" coords="1597,310,1532,319,1531,314,1602,309"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a1d7d7986d99cb52ab4feb4826ffc4428" title="Helper to send a Success (OK) response." alt="" coords="1388,386,1526,413"/>
<area shape="poly" title=" " alt="" coords="1658,317,1493,388,1491,383,1653,319"/>
<area shape="poly" title=" " alt="" coords="1354,258,1227,249,1155,250,1085,257,1030,270,982,287,980,282,1028,265,1084,252,1155,245,1227,244,1359,257"/>
<area shape="poly" title=" " alt="" coords="1421,200,1370,173,1340,159,1308,149,1245,133,1194,125,1145,129,1085,149,1062,162,1041,178,1004,216,975,255,957,287,953,283,971,253,999,213,1037,174,1059,157,1083,144,1144,123,1194,120,1246,128,1309,144,1341,154,1372,168,1426,200"/>
<area shape="poly" title=" " alt="" coords="1367,304,1355,301,1330,280,1307,256,1217,188,1218,183,1310,252,1333,276,1358,296,1372,305"/>
<area shape="poly" title=" " alt="" coords="1371,307,1308,301,1165,295,1037,297,1036,292,1165,290,1309,296,1377,307"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a12cef4b97fbfa7cfb7bdb1540e626ae9" title="Handler for MOVE command." alt="" coords="1115,361,1278,388"/>
<area shape="poly" title=" " alt="" coords="1367,341,1269,363,1268,358,1372,340"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a685b6d688593b458b5edafda4adfd4d4" title="Handler for SELECT_LANE command." alt="" coords="1098,412,1295,438"/>
<area shape="poly" title=" " alt="" coords="1417,343,1358,377,1334,390,1310,402,1272,414,1271,409,1308,397,1332,386,1355,372,1412,346"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a31ef4dae129916b85fdd8d1612553c77" title="Handler for SET_AUTO_FEED command." alt="" coords="1093,462,1300,489"/>
<area shape="poly" title=" " alt="" coords="1406,343,1381,360,1359,376,1344,396,1336,415,1328,434,1310,452,1289,464,1287,459,1307,448,1324,431,1331,413,1339,393,1355,372,1378,355,1401,345"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a76547f35e246989843f1870c760ea514" title="Handler for SET_FILAMENT_INFO command." alt="" coords="1085,310,1308,337"/>
<area shape="poly" title=" " alt="" coords="1365,324,1309,326,1308,321,1370,323"/>
<area shape="poly" title=" " alt="" coords="1111,357,1084,352,982,315,982,310,1085,346,1116,357"/>
<area shape="poly" title=" " alt="" coords="1098,406,1083,402,1046,382,1012,358,962,315,963,310,1015,353,1049,377,1085,397,1104,406"/>
<area shape="poly" title=" " alt="" coords="1093,456,1083,453,1040,420,1002,381,955,315,957,310,1007,378,1043,416,1086,448,1098,456"/>
<area shape="poly" title=" " alt="" coords="1067,311,1037,310,1036,305,1072,310"/>
<area shape="poly" title=" " alt="" coords="1370,392,1279,385,1279,380,1376,391"/>
<area shape="poly" title=" " alt="" coords="1370,408,1296,418,1295,413,1375,407"/>
<area shape="poly" title=" " alt="" coords="1407,418,1309,453,1265,464,1264,459,1308,448,1402,420"/>
<area shape="poly" title=" " alt="" coords="1402,381,1308,352,1264,340,1264,335,1309,346,1407,381"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a5bc1dda1e0b24dccb6fdc1c475930c88" title="Handler for STOP command." alt="" coords="1117,513,1276,540"/>
<area shape="poly" title=" " alt="" coords="1431,422,1377,465,1310,503,1277,515,1275,510,1308,499,1374,461,1426,424"/>
<area shape="poly" title=" " alt="" coords="1100,511,1083,503,1057,482,1033,458,995,403,967,352,952,315,954,310,972,349,999,401,1037,454,1060,478,1086,499,1105,511"/>
</map>
</div>

</div>
</div>
<a id="aaaf02ef3df5811e2ba28dd009eadfaae" name="aaaf02ef3df5811e2ba28dd009eadfaae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaaf02ef3df5811e2ba28dd009eadfaae">&#9670;&#160;</a></span>UART_SendByte()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::UART_SendByte </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>data</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a single byte blocking. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Byte to send. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00243">243</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  243</span>                                     {</div>
<div class="line"><span class="lineno">  244</span>         uint32_t timeout = 10000;</div>
<div class="line"><span class="lineno">  245</span>         <span class="keywordflow">while</span> (USART_GetFlagStatus(USART1, USART_FLAG_TXE) == RESET &amp;&amp; timeout--) {</div>
<div class="line"><span class="lineno">  246</span>             <a class="code hl_function" href="#a0ada30189b8e1d1dbec145140849b778">DelayUS</a>(1);</div>
<div class="line"><span class="lineno">  247</span>         }</div>
<div class="line"><span class="lineno">  248</span>         <span class="keywordflow">if</span> (timeout &gt; 0) USART_SendData(USART1, data);</div>
<div class="line"><span class="lineno">  249</span>    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00095">DelayUS()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_hardware_8cpp_source.html#l00261">UART_Send()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_aaaf02ef3df5811e2ba28dd009eadfaae_cgraph.png" border="0" usemap="#anamespace_hardware_aaaf02ef3df5811e2ba28dd009eadfaae_cgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_aaaf02ef3df5811e2ba28dd009eadfaae_cgraph" id="anamespace_hardware_aaaf02ef3df5811e2ba28dd009eadfaae_cgraph">
<area shape="rect" title="Send a single byte blocking." alt="" coords="5,5,191,32"/>
<area shape="rect" href="namespace_hardware.html#a0ada30189b8e1d1dbec145140849b778" title="Microsecond Delay." alt="" coords="239,5,377,32"/>
<area shape="poly" title=" " alt="" coords="191,16,226,19,221,19,191,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_aaaf02ef3df5811e2ba28dd009eadfaae_icgraph.png" border="0" usemap="#anamespace_hardware_aaaf02ef3df5811e2ba28dd009eadfaae_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_aaaf02ef3df5811e2ba28dd009eadfaae_icgraph" id="anamespace_hardware_aaaf02ef3df5811e2ba28dd009eadfaae_icgraph">
<area shape="rect" title="Send a single byte blocking." alt="" coords="2059,285,2244,312"/>
<area shape="rect" href="namespace_hardware.html#ad3ec7cad074d6d73508844a06a7bea50" title="Send a buffer via UART1." alt="" coords="1852,285,2011,312"/>
<area shape="poly" title=" " alt="" coords="2041,299,2011,301,2011,296,2046,298"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afeb304003d4b85010afd5e183e1bbf16" title="Handler for GET_FILAMENT_INFO command." alt="" coords="1084,158,1309,185"/>
<area shape="poly" title=" " alt="" coords="1872,280,1731,239,1644,217,1557,200,1429,184,1310,177,1309,171,1429,179,1557,194,1646,212,1733,234,1878,280"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a6089e6db2e7edddf19fdf095b9826c88" title="Parse and Dispatch a JSON Packet." alt="" coords="857,285,1036,312"/>
<area shape="poly" title=" " alt="" coords="1921,269,1907,225,1883,171,1849,116,1827,93,1803,73,1771,54,1742,43,1715,38,1688,38,1629,42,1557,44,1483,37,1419,27,1308,10,1257,9,1204,17,1148,36,1086,70,1057,92,1032,120,1011,150,993,181,968,241,954,286,949,283,963,240,989,179,1007,147,1028,116,1054,88,1083,65,1146,31,1203,11,1256,4,1309,5,1420,21,1484,31,1557,38,1629,37,1688,32,1715,33,1743,38,1773,49,1806,68,1831,89,1853,113,1888,168,1912,224,1926,271"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a8f239072c1896e64e9f6075edaaea515" title="Handler for STATUS command." alt="" coords="1620,82,1789,109"/>
<area shape="poly" title=" " alt="" coords="1909,272,1864,216,1803,155,1768,131,1735,112,1736,107,1771,126,1806,151,1868,213,1914,273"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a5498861593ca8083d7be1d71c8373f29" title="Initialize Klipper CLI." alt="" coords="1650,521,1759,548"/>
<area shape="poly" title=" " alt="" coords="1916,323,1869,392,1806,464,1767,497,1730,523,1727,518,1764,493,1802,460,1865,388,1911,326"/>
<area shape="rect" href="namespace_control_logic.html#ac2d890c891494072159ebc2b30490197" title="State Machine for BambuBus Logic." alt="" coords="1637,408,1772,450"/>
<area shape="poly" title=" " alt="" coords="1896,319,1745,410,1743,405,1891,321"/>
<area shape="rect" href="namespace_command_router.html#a1cf14aabb538f71f140e6b1aa7ef965d" title="Send a raw data packet via UART." alt="" coords="1605,706,1804,733"/>
<area shape="poly" title=" " alt="" coords="1920,324,1873,431,1807,561,1757,645,1717,708,1714,704,1753,642,1802,558,1868,428,1916,327"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a9ec392d53485800126189969c2c4981a" title="Serialize and send a JSON response." alt="" coords="1615,285,1794,312"/>
<area shape="poly" title=" " alt="" coords="1834,299,1795,301,1794,296,1839,298"/>
<area shape="poly" title=" " alt="" coords="1117,191,1086,206,1017,247,966,287,963,282,1014,243,1083,201,1121,189"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#afe96c8a3898aa7a50f68ab6d726860c3" title="Main Execution Loop." alt="" coords="695,324,809,350"/>
<area shape="poly" title=" " alt="" coords="859,316,810,328,808,323,864,314"/>
<area shape="rect" href="namespace_command_router.html#a96ff3718682e9322a64815a3d41d001b" title="Main execution loop for the Router." alt="" coords="494,349,647,376"/>
<area shape="poly" title=" " alt="" coords="677,348,648,354,646,349,682,346"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Arduino Main Loop." alt="" coords="401,425,446,452"/>
<area shape="poly" title=" " alt="" coords="527,385,448,429,445,425,531,382"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a4bcda7a15591065570d3598cbf970be7" title="将RAM中的像素数据传输到NeoPixels。" alt="" coords="188,425,353,452"/>
<area shape="poly" title=" " alt="" coords="383,440,354,441,352,436,388,437"/>
<area shape="rect" href="class_adafruit___neo_pixel.html#a61b1bd003a291520a367ab1712d6265c" title="释放Adafruit_NeoPixel对象，将数据引脚恢复为输入模式。" alt="" coords="5,417,140,460"/>
<area shape="poly" title=" " alt="" coords="170,440,141,441,138,436,174,437"/>
<area shape="poly" title=" " alt="" coords="1627,79,1518,64,1451,58,1378,56,1303,60,1228,70,1155,89,1086,118,1060,134,1037,155,999,202,972,250,955,286,951,283,967,247,995,199,1033,151,1057,130,1083,113,1153,84,1227,65,1303,54,1378,51,1451,53,1519,59,1633,78"/>
<area shape="rect" href="namespace_command_router.html#a652cfc164ac7a2a2c016da37f341c42e" title="Initialize the Command Router and CLI subsystems." alt="" coords="1384,614,1530,641"/>
<area shape="poly" title=" " alt="" coords="1661,554,1558,598,1504,616,1503,611,1556,593,1656,555"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="1170,614,1223,641"/>
<area shape="poly" title=" " alt="" coords="1366,628,1224,630,1223,625,1371,627"/>
<area shape="rect" href="namespace_control_logic.html#adc8c269923e0c76c6d104a005833a7f9" title="Main Control Loop." alt="" coords="884,552,1010,578"/>
<area shape="poly" title=" " alt="" coords="1638,456,1488,510,1399,535,1309,554,1229,565,1148,570,1011,570,1010,565,1148,564,1228,559,1308,549,1398,530,1486,505,1632,457"/>
<area shape="poly" title=" " alt="" coords="871,549,446,446,447,441,876,546"/>
<area shape="rect" href="namespace_control_logic.html#a8880b393facb6828519b8dac8e96393c" title="Core logic for processing Short Motion packets." alt="" coords="1362,665,1552,708"/>
<area shape="poly" title=" " alt="" coords="1587,704,1552,702,1552,696,1593,704"/>
<area shape="rect" href="namespace_control_logic.html#a412a7a597ff3c04c0ea1480094600ef4" title="Handler for Online Detect (0x05)." alt="" coords="1363,732,1550,774"/>
<area shape="poly" title=" " alt="" coords="1592,735,1551,743,1551,738,1587,735"/>
<area shape="rect" href="namespace_control_logic.html#a82b9a1fb120cd91615d2ac478daafefd" title="Handler for REQx6 (0x06)." alt="" coords="1360,798,1554,825"/>
<area shape="poly" title=" " alt="" coords="1666,740,1614,766,1558,789,1520,800,1519,795,1556,784,1612,761,1661,741"/>
<area shape="rect" href="namespace_control_logic.html#a5f85db884abd1a66d8b120729ec0d99e" title="Handler for Filament Motion Short packet (0x03)." alt="" coords="1102,665,1291,708"/>
<area shape="poly" title=" " alt="" coords="1344,687,1292,689,1291,684,1349,686"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#ae13dcd8cc2528c12d0a241046fcc304e" title="Handler for GET_SENSORS command." alt="" coords="1357,260,1557,286"/>
<area shape="poly" title=" " alt="" coords="1597,288,1558,286,1557,281,1602,287"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a81f1646e6adb42482d4109a33b9bb9c5" title="Handler for PING command." alt="" coords="1378,209,1536,236"/>
<area shape="poly" title=" " alt="" coords="1649,279,1556,250,1516,239,1516,234,1558,245,1654,279"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#ad0e99d2fdcfd1c0690f850816ac1f67c" title="Helper to send an Error response." alt="" coords="1383,310,1531,337"/>
<area shape="poly" title=" " alt="" coords="1597,310,1532,319,1531,314,1602,309"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a1d7d7986d99cb52ab4feb4826ffc4428" title="Helper to send a Success (OK) response." alt="" coords="1388,386,1526,413"/>
<area shape="poly" title=" " alt="" coords="1658,317,1493,388,1491,383,1653,319"/>
<area shape="poly" title=" " alt="" coords="1354,258,1227,249,1155,250,1085,257,1030,270,982,287,980,282,1028,265,1084,252,1155,245,1227,244,1359,257"/>
<area shape="poly" title=" " alt="" coords="1421,200,1370,173,1340,159,1308,149,1245,133,1194,125,1145,129,1085,149,1062,162,1041,178,1004,216,975,255,957,287,953,283,971,253,999,213,1037,174,1059,157,1083,144,1144,123,1194,120,1246,128,1309,144,1341,154,1372,168,1426,200"/>
<area shape="poly" title=" " alt="" coords="1367,304,1355,301,1330,280,1307,256,1217,188,1218,183,1310,252,1333,276,1358,296,1372,305"/>
<area shape="poly" title=" " alt="" coords="1371,307,1308,301,1165,295,1037,297,1036,292,1165,290,1309,296,1377,307"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a12cef4b97fbfa7cfb7bdb1540e626ae9" title="Handler for MOVE command." alt="" coords="1115,361,1278,388"/>
<area shape="poly" title=" " alt="" coords="1367,341,1269,363,1268,358,1372,340"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a685b6d688593b458b5edafda4adfd4d4" title="Handler for SELECT_LANE command." alt="" coords="1098,412,1295,438"/>
<area shape="poly" title=" " alt="" coords="1417,343,1358,377,1334,390,1310,402,1272,414,1271,409,1308,397,1332,386,1355,372,1412,346"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a31ef4dae129916b85fdd8d1612553c77" title="Handler for SET_AUTO_FEED command." alt="" coords="1093,462,1300,489"/>
<area shape="poly" title=" " alt="" coords="1406,343,1381,360,1359,376,1344,396,1336,415,1328,434,1310,452,1289,464,1287,459,1307,448,1324,431,1331,413,1339,393,1355,372,1378,355,1401,345"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a76547f35e246989843f1870c760ea514" title="Handler for SET_FILAMENT_INFO command." alt="" coords="1085,310,1308,337"/>
<area shape="poly" title=" " alt="" coords="1365,324,1309,326,1308,321,1370,323"/>
<area shape="poly" title=" " alt="" coords="1111,357,1084,352,982,315,982,310,1085,346,1116,357"/>
<area shape="poly" title=" " alt="" coords="1098,406,1083,402,1046,382,1012,358,962,315,963,310,1015,353,1049,377,1085,397,1104,406"/>
<area shape="poly" title=" " alt="" coords="1093,456,1083,453,1040,420,1002,381,955,315,957,310,1007,378,1043,416,1086,448,1098,456"/>
<area shape="poly" title=" " alt="" coords="1067,311,1037,310,1036,305,1072,310"/>
<area shape="poly" title=" " alt="" coords="1370,392,1279,385,1279,380,1376,391"/>
<area shape="poly" title=" " alt="" coords="1370,408,1296,418,1295,413,1375,407"/>
<area shape="poly" title=" " alt="" coords="1407,418,1309,453,1265,464,1264,459,1308,448,1402,420"/>
<area shape="poly" title=" " alt="" coords="1402,381,1308,352,1264,340,1264,335,1309,346,1407,381"/>
<area shape="rect" href="namespace_klipper_c_l_i.html#a5bc1dda1e0b24dccb6fdc1c475930c88" title="Handler for STOP command." alt="" coords="1117,513,1276,540"/>
<area shape="poly" title=" " alt="" coords="1431,422,1377,465,1310,503,1277,515,1275,510,1308,499,1374,461,1426,424"/>
<area shape="poly" title=" " alt="" coords="1100,511,1083,503,1057,482,1033,458,995,403,967,352,952,315,954,310,972,349,999,401,1037,454,1060,478,1086,499,1105,511"/>
</map>
</div>

</div>
</div>
<a id="a8eaf73ad39643f6bb1bbe74d9b5e8b86" name="a8eaf73ad39643f6bb1bbe74d9b5e8b86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8eaf73ad39643f6bb1bbe74d9b5e8b86">&#9670;&#160;</a></span>UART_SetRxCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::UART_SetRxCallback </td>
          <td>(</td>
          <td class="paramtype">void(*</td>          <td class="paramname"><span class="paramname"><em>callback&#160;</em></span>)(uint8_t)</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register a callback for UART1 RX. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">callback</td><td>Function pointer void(uint8_t byte). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00128">128</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  128</span>                                                       {</div>
<div class="line"><span class="lineno">  129</span>        <a class="code hl_variable" href="#a5d7ac173bff318607226970e0e864b1e">uart_rx_callback</a> = callback;</div>
<div class="line"><span class="lineno">  130</span>    }</div>
<div class="ttc" id="anamespace_hardware_html_a5d7ac173bff318607226970e0e864b1e"><div class="ttname"><a href="#a5d7ac173bff318607226970e0e864b1e">Hardware::uart_rx_callback</a></div><div class="ttdeci">static void(* uart_rx_callback)(uint8_t)</div><div class="ttdef"><b>Definition</b> <a href="_hardware_8cpp_source.html#l00120">Hardware.cpp:120</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00120">uart_rx_callback</a>.</p>

<p class="reference">Referenced by <a class="el" href="_command_router_8cpp_source.html#l00076">CommandRouter::Init()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a8eaf73ad39643f6bb1bbe74d9b5e8b86_icgraph.png" border="0" usemap="#anamespace_hardware_a8eaf73ad39643f6bb1bbe74d9b5e8b86_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a8eaf73ad39643f6bb1bbe74d9b5e8b86_icgraph" id="anamespace_hardware_a8eaf73ad39643f6bb1bbe74d9b5e8b86_icgraph">
<area shape="rect" title="Register a callback for UART1 RX." alt="" coords="301,5,517,32"/>
<area shape="rect" href="namespace_command_router.html#a652cfc164ac7a2a2c016da37f341c42e" title="Initialize the Command Router and CLI subsystems." alt="" coords="107,5,253,32"/>
<area shape="poly" title=" " alt="" coords="283,19,253,21,253,16,288,19"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="5,5,59,32"/>
<area shape="poly" title=" " alt="" coords="89,19,59,21,59,16,94,18"/>
</map>
</div>

</div>
</div>
<a id="afeb16bfe3e187a44a3c51c9738a933df" name="afeb16bfe3e187a44a3c51c9738a933df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeb16bfe3e187a44a3c51c9738a933df">&#9670;&#160;</a></span>USART1_IRQHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::USART1_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>UART1 Interrupt Service Routine. </p>
<p>Handles RXNE (Receive Data) and TC (Transmission Complete) logic. Manages RS485 DE pin (PA12). </p>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00212">212</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  213</span>    {</div>
<div class="line"><span class="lineno">  214</span>        <span class="keyword">volatile</span> uint32_t sr = USART1-&gt;STATR; <span class="comment">// Read Status Register</span></div>
<div class="line"><span class="lineno">  215</span>        <span class="keyword">volatile</span> uint32_t dr;</div>
<div class="line"><span class="lineno">  216</span>        </div>
<div class="line"><span class="lineno">  217</span>        <span class="comment">// Check for Read Data Register Not Empty (RXNE) OR Overrun Error (ORE)</span></div>
<div class="line"><span class="lineno">  218</span>        <span class="comment">// Note: Reading SR then DR clears ORE, NE, FE, PE</span></div>
<div class="line"><span class="lineno">  219</span>        <span class="keywordflow">if</span> ((sr &amp; USART_FLAG_RXNE) || (sr &amp; USART_FLAG_ORE)) </div>
<div class="line"><span class="lineno">  220</span>        {</div>
<div class="line"><span class="lineno">  221</span>            dr = USART1-&gt;DATAR; <span class="comment">// Read Data Register to clear flags</span></div>
<div class="line"><span class="lineno">  222</span>            <span class="comment">// Only convert to byte and callback if it was a valid RXNE</span></div>
<div class="line"><span class="lineno">  223</span>            <span class="comment">// (ORE might set RXNE too, or just ORE)</span></div>
<div class="line"><span class="lineno">  224</span>            <span class="keywordflow">if</span> (sr &amp; USART_FLAG_RXNE) {</div>
<div class="line"><span class="lineno">  225</span>                <span class="keywordflow">if</span>(<a class="code hl_variable" href="#a5d7ac173bff318607226970e0e864b1e">uart_rx_callback</a>) <a class="code hl_variable" href="#a5d7ac173bff318607226970e0e864b1e">uart_rx_callback</a>((uint8_t)dr);</div>
<div class="line"><span class="lineno">  226</span>            }</div>
<div class="line"><span class="lineno">  227</span>        }</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span>        <span class="comment">// Check for Transmission Complete (TC)</span></div>
<div class="line"><span class="lineno">  230</span>        <span class="keywordflow">if</span> (sr &amp; USART_FLAG_TC)</div>
<div class="line"><span class="lineno">  231</span>        {</div>
<div class="line"><span class="lineno">  232</span>            USART_ClearITPendingBit(USART1, USART_IT_TC);</div>
<div class="line"><span class="lineno">  233</span>            GPIOA-&gt;BCR = GPIO_Pin_12; <span class="comment">// Disable DE</span></div>
<div class="line"><span class="lineno">  234</span>        }</div>
<div class="line"><span class="lineno">  235</span>    }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_hardware_8cpp_source.html#l00120">uart_rx_callback</a>.</p>

</div>
</div>
<a id="a90a0cffa2efcfb8d76bc12f9734ca623" name="a90a0cffa2efcfb8d76bc12f9734ca623"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90a0cffa2efcfb8d76bc12f9734ca623">&#9670;&#160;</a></span>Watchdog_Disable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hardware::Watchdog_Disable </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disable the Window Watchdog. </p>
<p>Essential for debugging or development where timing isn't strict yet. </p>

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00073">73</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   73</span>                            {</div>
<div class="line"><span class="lineno">   74</span>        WWDG_DeInit();</div>
<div class="line"><span class="lineno">   75</span>        RCC_APB1PeriphClockCmd(RCC_APB1Periph_WWDG, DISABLE);</div>
<div class="line"><span class="lineno">   76</span>    }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_hardware_8cpp_source.html#l00052">InitBase()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespace_hardware_a90a0cffa2efcfb8d76bc12f9734ca623_icgraph.png" border="0" usemap="#anamespace_hardware_a90a0cffa2efcfb8d76bc12f9734ca623_icgraph" loading="lazy" alt=""/></div>
<map name="anamespace_hardware_a90a0cffa2efcfb8d76bc12f9734ca623_icgraph" id="anamespace_hardware_a90a0cffa2efcfb8d76bc12f9734ca623_icgraph">
<area shape="rect" title="Disable the Window Watchdog." alt="" coords="288,5,431,48"/>
<area shape="rect" href="namespace_hardware.html#a25837768e4f1568435bc6d889be37ba5" title="Initialize minimal Hardware Base." alt="" coords="107,13,240,40"/>
<area shape="poly" title=" " alt="" coords="270,27,241,29,240,24,275,27"/>
<area shape="rect" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d" title="Arduino Setup Function." alt="" coords="5,13,59,40"/>
<area shape="poly" title=" " alt="" coords="89,28,59,29,59,24,93,26"/>
</map>
</div>

</div>
</div>
<a name="doc-var-members" id="doc-var-members"></a><h2 id="header-doc-var-members" class="groupheader">Variable Documentation</h2>
<a id="a5d7ac173bff318607226970e0e864b1e" name="a5d7ac173bff318607226970e0e864b1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d7ac173bff318607226970e0e864b1e">&#9670;&#160;</a></span>uart_rx_callback</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void(* Hardware::uart_rx_callback) (uint8_t) </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> = nullptr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_hardware_8cpp_source.html#l00120">120</a> of file <a class="el" href="_hardware_8cpp_source.html">Hardware.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="_hardware_8cpp_source.html#l00128">UART_SetRxCallback()</a>, and <a class="el" href="_hardware_8cpp_source.html#l00212">USART1_IRQHandler()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="namespace_hardware.html">Hardware</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
